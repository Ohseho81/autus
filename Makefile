# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ›ï¸ AUTUS - Makefile
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ì‚¬ìš©ë²•: make [command]
# ì „ì²´ ëª…ë ¹ì–´: make help
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: help install dev test lint format clean docker-up docker-down frontend all

# ê¸°ë³¸ ë³€ìˆ˜
PYTHON := python3
PIP := pip
PROJECT_DIR := autus-unified
BACKEND_DIR := $(PROJECT_DIR)/backend
FRONTEND_DIR := $(PROJECT_DIR)/frontend
VENV_DIR := $(PROJECT_DIR)/venv
VENV_PYTHON := $(VENV_DIR)/bin/python
VENV_PIP := $(VENV_DIR)/bin/pip

# ìƒ‰ìƒ ì •ì˜
CYAN := \033[0;36m
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“š ë„ì›€ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

help:
	@echo ""
	@echo "$(CYAN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(CYAN)  ğŸ›ï¸  AUTUS - ê°œë°œ ëª…ë ¹ì–´$(NC)"
	@echo "$(CYAN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(GREEN)ğŸš€ ì‹œì‘$(NC)"
	@echo "   make install    - ì˜ì¡´ì„± ì„¤ì¹˜ (ê°€ìƒí™˜ê²½ í¬í•¨)"
	@echo "   make dev        - ê°œë°œ ì„œë²„ ì‹¤í–‰ (Backend)"
	@echo "   make frontend   - í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰"
	@echo "   make all        - Backend + Frontend ë™ì‹œ ì‹¤í–‰"
	@echo ""
	@echo "$(GREEN)ğŸ§ª í…ŒìŠ¤íŠ¸$(NC)"
	@echo "   make test       - ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
	@echo "   make test-cov   - ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸"
	@echo ""
	@echo "$(GREEN)ğŸ” ì½”ë“œ í’ˆì§ˆ$(NC)"
	@echo "   make lint       - ë¦°íŠ¸ ê²€ì‚¬ (Ruff)"
	@echo "   make format     - ì½”ë“œ í¬ë§·íŒ… (Ruff)"
	@echo "   make fix        - ë¦°íŠ¸ + í¬ë§· ìë™ ìˆ˜ì •"
	@echo ""
	@echo "$(GREEN)ğŸ³ Docker$(NC)"
	@echo "   make docker-up   - Docker Compose ì‹¤í–‰"
	@echo "   make docker-down - Docker Compose ì¢…ë£Œ"
	@echo "   make docker-build - Docker ì´ë¯¸ì§€ ë¹Œë“œ"
	@echo ""
	@echo "$(GREEN)ğŸ§¹ ì •ë¦¬$(NC)"
	@echo "   make clean      - ìºì‹œ íŒŒì¼ ì •ë¦¬"
	@echo ""
	@echo "$(CYAN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¦ ì„¤ì¹˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

install:
	@echo "$(CYAN)ğŸ“¦ ê°€ìƒí™˜ê²½ ìƒì„± ë° ì˜ì¡´ì„± ì„¤ì¹˜...$(NC)"
	@if [ ! -d "$(VENV_DIR)" ]; then \
		$(PYTHON) -m venv $(VENV_DIR); \
		echo "$(GREEN)âœ… ê°€ìƒí™˜ê²½ ìƒì„± ì™„ë£Œ$(NC)"; \
	fi
	@$(VENV_PIP) install --upgrade pip
	@$(VENV_PIP) install -r $(BACKEND_DIR)/requirements.txt
	@$(VENV_PIP) install ruff pytest pytest-cov httpx pytest-asyncio
	@echo "$(GREEN)âœ… ì„¤ì¹˜ ì™„ë£Œ!$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ’¡ ê°€ìƒí™˜ê²½ í™œì„±í™”: source $(VENV_DIR)/bin/activate$(NC)"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸš€ ê°œë°œ ì„œë²„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

dev:
	@echo "$(CYAN)ğŸš€ Backend API ì„œë²„ ì‹œì‘...$(NC)"
	@echo "$(GREEN)   ğŸ“ http://localhost:8000$(NC)"
	@echo "$(GREEN)   ğŸ“š http://localhost:8000/docs$(NC)"
	@echo ""
	@cd $(BACKEND_DIR) && $(VENV_PYTHON) -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

frontend:
	@echo "$(CYAN)ğŸŒ Frontend ì„œë²„ ì‹œì‘...$(NC)"
	@echo "$(GREEN)   ğŸ“ http://localhost:3000$(NC)"
	@echo "$(GREEN)   ğŸŒ Physics Map: http://localhost:3000/physics-map-unified.html$(NC)"
	@echo "$(GREEN)   ğŸŒ Globe: http://localhost:3000/physics-map-globe-5tier.html$(NC)"
	@echo "$(GREEN)   ğŸ›°ï¸ Satellite: http://localhost:3000/physics-map-satellite.html$(NC)"
	@echo ""
	@cd $(FRONTEND_DIR) && $(PYTHON) -m http.server 3000

# ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‘ ì„œë²„ ë™ì‹œ ì‹¤í–‰
all:
	@echo "$(CYAN)ğŸ”¥ Full Stack ì‹œì‘...$(NC)"
	@echo ""
	@echo "$(GREEN)ğŸš€ Backend: http://localhost:8000$(NC)"
	@echo "$(GREEN)ğŸŒ Frontend: http://localhost:3000$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ’¡ ì¢…ë£Œ: Ctrl+C$(NC)"
	@echo ""
	@(cd $(BACKEND_DIR) && $(VENV_PYTHON) -m uvicorn main:app --reload --host 0.0.0.0 --port 8000 &) && \
	 (cd $(FRONTEND_DIR) && $(PYTHON) -m http.server 3000)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§ª í…ŒìŠ¤íŠ¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

test:
	@echo "$(CYAN)ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰...$(NC)"
	@cd $(PROJECT_DIR) && $(VENV_PYTHON) -m pytest tests/ -v --tb=short

test-cov:
	@echo "$(CYAN)ğŸ§ª ì»¤ë²„ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...$(NC)"
	@cd $(PROJECT_DIR) && $(VENV_PYTHON) -m pytest tests/ -v --cov=backend --cov-report=html --cov-report=term

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ” ì½”ë“œ í’ˆì§ˆ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

lint:
	@echo "$(CYAN)ğŸ” ë¦°íŠ¸ ê²€ì‚¬...$(NC)"
	@$(VENV_PYTHON) -m ruff check $(BACKEND_DIR)/

format:
	@echo "$(CYAN)ğŸ¨ ì½”ë“œ í¬ë§·íŒ…...$(NC)"
	@$(VENV_PYTHON) -m ruff format $(BACKEND_DIR)/
	@echo "$(GREEN)âœ… í¬ë§·íŒ… ì™„ë£Œ$(NC)"

fix:
	@echo "$(CYAN)ğŸ”§ ë¦°íŠ¸ + í¬ë§· ìë™ ìˆ˜ì •...$(NC)"
	@$(VENV_PYTHON) -m ruff check --fix $(BACKEND_DIR)/
	@$(VENV_PYTHON) -m ruff format $(BACKEND_DIR)/
	@echo "$(GREEN)âœ… ìˆ˜ì • ì™„ë£Œ$(NC)"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ³ Docker
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

docker-up:
	@echo "$(CYAN)ğŸ³ Docker Compose ì‹œì‘...$(NC)"
	@cd $(PROJECT_DIR) && docker-compose up -d
	@echo "$(GREEN)âœ… ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘$(NC)"

docker-down:
	@echo "$(CYAN)ğŸ³ Docker Compose ì¢…ë£Œ...$(NC)"
	@cd $(PROJECT_DIR) && docker-compose down
	@echo "$(GREEN)âœ… ì»¨í…Œì´ë„ˆ ì¢…ë£Œ$(NC)"

docker-build:
	@echo "$(CYAN)ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ...$(NC)"
	@cd $(PROJECT_DIR) && docker-compose build
	@echo "$(GREEN)âœ… ë¹Œë“œ ì™„ë£Œ$(NC)"

docker-logs:
	@cd $(PROJECT_DIR) && docker-compose logs -f

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§¹ ì •ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

clean:
	@echo "$(CYAN)ğŸ§¹ ìºì‹œ ì •ë¦¬...$(NC)"
	@find . -type d -name '__pycache__' -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name '*.pyc' -delete 2>/dev/null || true
	@find . -type d -name '.pytest_cache' -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name '.mypy_cache' -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name '.ruff_cache' -exec rm -rf {} + 2>/dev/null || true
	@find . -type d -name '*.egg-info' -exec rm -rf {} + 2>/dev/null || true
	@echo "$(GREEN)âœ… ì •ë¦¬ ì™„ë£Œ$(NC)"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Š ìœ í‹¸ë¦¬í‹°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

status:
	@echo "$(CYAN)ğŸ“Š í”„ë¡œì íŠ¸ ìƒíƒœ$(NC)"
	@echo ""
	@echo "Git Status:"
	@git status --short
	@echo ""
	@echo "Python Version:"
	@$(PYTHON) --version
	@echo ""
	@echo "Running Servers:"
	@lsof -i :8000 2>/dev/null || echo "  Backend (8000): Not running"
	@lsof -i :3000 2>/dev/null || echo "  Frontend (3000): Not running"

# ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
open:
	@open http://localhost:8000/docs
	@open http://localhost:3000/physics-map-unified.html

open-globe:
	@open http://localhost:3000/physics-map-globe-5tier.html

open-satellite:
	@open http://localhost:3000/physics-map-satellite.html
