{
  "flow_id": "Flow::EMP_ONBOARD",
  "version": "1.0.0",
  "description": "고용처 온보딩 프로세스 - JobPack 생성부터 ScoreCard 시작까지",
  
  "triggered_by": ["RulePack::EmployerQuality"],
  "execution_mode": "async",
  "timeout_seconds": 172800,
  
  "retry_policy": {
    "max_retries": 3,
    "backoff_multiplier": 2,
    "initial_delay_seconds": 3600
  },
  
  "steps": [
    {
      "step_id": "step_1_convert_jobpack",
      "order": 1,
      "name": "JobPosting → JobPack 변환",
      "action_type": "data_validation",
      "action_config": {
        "source_format": "raw_job_posting",
        "target_format": "limepass_jobpack_v1",
        "validation_rules": [
          "salary_compliance",
          "work_hours_legal",
          "visa_support_valid",
          "benefits_standard"
        ],
        "output_path": "/data/employers/{{emp_id}}/jobpacks/"
      },
      "execution_mode": "sync",
      "on_success": {
        "next_step": "step_2_run_payroll_validator"
      },
      "on_failure": {
        "retry": true,
        "notify": ["emp_relations_team"]
      }
    },
    {
      "step_id": "step_2_run_payroll_validator",
      "order": 2,
      "name": "Payroll Validator 실행",
      "action_type": "api_call",
      "action_config": {
        "endpoint": "/api/v1/validation/payroll",
        "method": "POST",
        "payload_template": {
          "emp_id": "{{emp_id}}",
          "validation_type": "full",
          "check_items": [
            "minimum_wage_compliance",
            "overtime_calculation",
            "deduction_legality",
            "payment_schedule"
          ]
        },
        "timeout_seconds": 300,
        "success_threshold": 0.90
      },
      "execution_mode": "sync",
      "on_success": {
        "next_step": "step_3_setup_worklog"
      },
      "on_failure": {
        "retry": true,
        "fallback_step": "step_1_convert_jobpack",
        "notify": ["emp_relations_team", "compliance_team"]
      }
    },
    {
      "step_id": "step_3_setup_worklog",
      "order": 3,
      "name": "근무일지 업로드 Flow 안내",
      "action_type": "send_notification",
      "action_config": {
        "notification_type": "onboarding_guide",
        "channels": ["email", "portal"],
        "template_id": "emp_worklog_guide_v1",
        "variables": ["emp_name", "portal_url", "deadline", "support_contact"],
        "attachments": ["worklog_template.xlsx", "upload_guide.pdf"],
        "reminder_schedule": [3, 7, 14]
      },
      "execution_mode": "async",
      "on_success": {
        "next_step": "step_4_init_scorecard"
      },
      "on_failure": {
        "retry": true,
        "notify": ["emp_relations_team"]
      }
    },
    {
      "step_id": "step_4_init_scorecard",
      "order": 4,
      "name": "EMP ScoreCard 시작",
      "action_type": "create_record",
      "action_config": {
        "record_type": "scorecard",
        "entity_type": "employer",
        "initial_score": 0,
        "scoring_config": "scorecard_emp_v1",
        "metrics": [
          {"name": "worklog_accuracy", "weight": 0.30},
          {"name": "payroll_quality", "weight": 0.25},
          {"name": "evaluation_response", "weight": 0.20},
          {"name": "retention_improvement", "weight": 0.15},
          {"name": "satisfaction_score", "weight": 0.10}
        ]
      },
      "execution_mode": "sync",
      "on_success": {
        "emit_event": "EVT::EMP_SCORECARD_INITIALIZED"
      },
      "on_failure": {
        "retry": true,
        "notify": ["tech_team"]
      }
    }
  ],
  
  "on_complete": {
    "emit_event": "EVT::EMP_ONBOARD_COMPLETED",
    "update_scorecard": true,
    "notify": ["emp_relations_team", "ops_team"],
    "rekor_log": true
  },
  
  "delta_overrides": {
    "KR": {
      "steps": [
        {
          "step_id": "step_2_run_payroll_validator",
          "action_config": {
            "success_threshold": 0.95
          }
        }
      ]
    },
    "JP": {
      "steps": [
        {
          "step_id": "step_1_convert_jobpack",
          "action_config": {
            "validation_rules": [
              "salary_compliance",
              "work_hours_legal",
              "visa_support_valid",
              "benefits_standard",
              "jp_labor_law_compliance"
            ]
          }
        }
      ]
    }
  }
}
