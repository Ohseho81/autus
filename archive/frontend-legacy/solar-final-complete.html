<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AUTUS Solar HQ â€” Final Complete</title>
  <!--
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  AUTUS SOLAR HQ â€” FINAL COMPLETE VERSION                      â•‘
    â•‘                                                               â•‘
    â•‘  LAYERS:                                                      â•‘
    â•‘  - L0 SOLAR: 9í–‰ì„± + íƒœì–‘ê³„ (Base Reality)                    â•‘
    â•‘  - L2 SIMULATION: 2ì¤‘ ë§ (Forecast Overlay)                   â•‘
    â•‘  - L3 ACTION: 3ë²„íŠ¼ HUD (Preview-only)                        â•‘
    â•‘                                                               â•‘
    â•‘  9 PLANETS LOCKED:                                            â•‘
    â•‘  1. RECOVERY  - Shock ì´í›„ ê¸°ì¤€ì„  ë³µê·€ ëŠ¥ë ¥                    â•‘
    â•‘  2. STABILITY - í˜„ì¬ ìƒíƒœ ìœ ì§€ êµ¬ì¡°ì  ê°•ë„                     â•‘
    â•‘  3. COHESION  - êµ¬ì„±ìš”ì†Œ ê°„ ê²°ì†ë ¥                             â•‘
    â•‘  4. SHOCK     - ì™¸ë¶€ ì¶©ê²©ì˜ ë¶ˆí™•ì‹¤ì„± ì••ë ¥                      â•‘
    â•‘  5. FRICTION  - íë¦„ ë°©í•´ ì €í•­ê³¼ ë¹„íš¨ìœ¨                        â•‘
    â•‘  6. TRANSFER  - ìì› ì´ë™ íš¨ìœ¨                                 â•‘
    â•‘  7. TIME      - ë‚¨ì€ ì‹œê°„ ìì›                                 â•‘
    â•‘  8. QUALITY   - ì‚°ì¶œë¬¼ ì •í™•ì„±/ì™„ì„±ë„                           â•‘
    â•‘  9. OUTPUT    - ë‹¨ìœ„ ì‹œê°„ë‹¹ ìƒì‚°ëŸ‰                             â•‘
    â•‘                                                               â•‘
    â•‘  BUILD: 2025-12-17                                            â•‘
    â•‘  STATUS: PRODUCTION READY                                     â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  -->
  <style>
    /* ============================================
       RESET & BASE
       ============================================ */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:#020408;
      overflow:hidden;
      font-family:'Inter','SF Pro Display',system-ui,-apple-system,sans-serif;
      color:#fff;
    }
    
    /* ============================================
       FRAME (í…Œë‘ë¦¬)
       ============================================ */
    .frame{
      position:fixed;
      top:24px;left:24px;right:24px;bottom:24px;
      border:1px solid rgba(0,212,255,.2);
      border-radius:6px;
      pointer-events:none;
      z-index:50;
    }
    .corner{position:absolute;width:14px;height:14px}
    .corner::before,.corner::after{content:'';position:absolute;background:rgba(0,212,255,.4)}
    .corner.tl{top:-1px;left:-1px}
    .corner.tl::before{width:14px;height:1px;top:0;left:0}
    .corner.tl::after{width:1px;height:14px;top:0;left:0}
    .corner.tr{top:-1px;right:-1px}
    .corner.tr::before{width:14px;height:1px;top:0;right:0}
    .corner.tr::after{width:1px;height:14px;top:0;right:0}
    .corner.bl{bottom:-1px;left:-1px}
    .corner.bl::before{width:14px;height:1px;bottom:0;left:0}
    .corner.bl::after{width:1px;height:14px;bottom:0;left:0}
    .corner.br{bottom:-1px;right:-1px}
    .corner.br::before{width:14px;height:1px;bottom:0;right:0}
    .corner.br::after{width:1px;height:14px;bottom:0;right:0}
    
    /* ============================================
       GATE + SLA TOPBAR (ìƒë‹¨ ì¤‘ì•™)
       ============================================ */
    .autus-topbar{
      position:fixed;
      top:28px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:16px;
      align-items:center;
      z-index:200;
    }
    .gate-badge{
      padding:10px 20px;
      border:2px solid rgba(255,255,255,.2);
      border-radius:8px;
      font-size:14px;
      font-weight:700;
      letter-spacing:.15em;
      text-shadow:0 0 12px currentColor;
      transition:all .3s;
    }
    .gate-green{background:rgba(0,255,120,.15);color:#00ff88;border-color:#00ff88}
    .gate-amber{background:rgba(255,180,0,.15);color:#ffb400;border-color:#ffb400}
    .gate-red{background:rgba(255,60,60,.15);color:#ff4444;border-color:#ff4444}
    
    .sla-strip{display:flex;gap:8px;font-size:11px;letter-spacing:.05em}
    .sla-strip span{
      padding:6px 14px;
      border-radius:6px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(0,0,0,.4);
      transition:all .3s;
    }
    .sla-ok{color:#00ff88;border-color:rgba(0,255,136,.4)!important}
    .sla-risk{color:#ffb400;border-color:rgba(255,180,0,.4)!important;background:rgba(255,180,0,.1)!important}
    .sla-breach{color:#ff4444;border-color:rgba(255,60,60,.4)!important;background:rgba(255,60,60,.1)!important}
    
    /* ============================================
       INFO PANEL (ì¢Œì¸¡ ìƒë‹¨)
       ============================================ */
    #info{
      position:fixed;
      top:80px;
      left:40px;
      color:#fff;
      font-size:10px;
      z-index:100;
    }
    #info h1{
      font-size:12px;
      font-weight:600;
      letter-spacing:.25em;
      color:#00d4ff;
      margin-bottom:14px;
      text-shadow:0 0 10px rgba(0,212,255,.5);
    }
    .stat-row{
      display:flex;
      justify-content:space-between;
      width:160px;
      padding:5px 0;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .stat-label{opacity:.5;font-size:9px;letter-spacing:.05em}
    .stat-value{color:#00d4ff;font-variant-numeric:tabular-nums;font-weight:500}
    .stat-value.critical{color:#ff4444!important;font-weight:700}
    .stat-value.warning{color:#ffaa00!important}
    
    /* ============================================
       PLANETS PANEL (ì¢Œì¸¡)
       ============================================ */
    #planets{
      position:fixed;
      top:260px;
      left:40px;
      width:175px;
      z-index:100;
    }
    .panel-title{
      font-size:8px;
      letter-spacing:.18em;
      color:rgba(0,212,255,.6);
      margin-bottom:10px;
      padding-bottom:6px;
      border-bottom:1px solid rgba(0,212,255,.15);
    }
    .planet-row{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      margin-bottom:4px;
      background:rgba(0,20,40,.5);
      border:1px solid rgba(0,212,255,.12);
      border-radius:5px;
      cursor:pointer;
      transition:all .2s;
    }
    .planet-row:hover{
      background:rgba(0,212,255,.12);
      border-color:rgba(0,212,255,.35);
      transform:translateX(3px);
    }
    .planet-row.active{
      background:rgba(0,212,255,.18);
      border-color:#00d4ff;
      box-shadow:0 0 10px rgba(0,212,255,.2);
    }
    .planet-row.collapsed{
      opacity:.25;
      pointer-events:none;
      height:0;
      padding:0;
      margin:0;
      overflow:hidden;
      border:none;
    }
    .planet-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;box-shadow:0 0 6px currentColor}
    .planet-name{font-size:9px;flex:1;color:#ccc}
    .planet-val{font-size:10px;font-weight:600;font-family:'SF Mono','Fira Code',monospace}
    
    /* ============================================
       METRICS PANEL (ìš°ì¸¡ ìƒë‹¨)
       ============================================ */
    #metrics{
      position:fixed;
      top:80px;
      right:40px;
      width:210px;
      z-index:100;
    }
    .metric-section{margin-bottom:18px}
    .metric-title{
      font-size:8px;
      letter-spacing:.18em;
      color:rgba(0,212,255,.6);
      margin-bottom:10px;
      padding-bottom:6px;
      border-bottom:1px solid rgba(0,212,255,.15);
    }
    .metric-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .metric-card{
      background:rgba(0,20,40,.7);
      border:1px solid rgba(0,212,255,.18);
      border-radius:6px;
      padding:10px;
      text-align:center;
      transition:all .2s;
    }
    .metric-card:hover{border-color:rgba(0,212,255,.4)}
    .metric-value{font-size:18px;font-weight:200;color:#00d4ff}
    .metric-value.warning{color:#ffaa00}
    .metric-value.danger{color:#ff4444}
    .metric-label{font-size:7px;opacity:.45;margin-top:3px;letter-spacing:.12em}
    
    /* ============================================
       ACTION LOG (ìš°ì¸¡)
       ============================================ */
    #action-log{
      position:fixed;
      right:40px;
      bottom:300px;
      width:210px;
      max-height:160px;
      overflow-y:auto;
      z-index:150;
      border:1px solid rgba(0,212,255,.2);
      border-radius:8px;
      padding:12px;
      background:rgba(0,10,20,.9);
      font-size:9px;
      line-height:1.6;
    }
    #action-log::-webkit-scrollbar{width:4px}
    #action-log::-webkit-scrollbar-track{background:rgba(0,0,0,.2)}
    #action-log::-webkit-scrollbar-thumb{background:rgba(0,212,255,.3);border-radius:2px}
    #action-log .log-title{
      font-size:8px;
      letter-spacing:.18em;
      color:rgba(0,212,255,.7);
      margin-bottom:10px;
      padding-bottom:6px;
      border-bottom:1px solid rgba(0,212,255,.2);
    }
    #action-log .log-item{
      color:#8ac;
      padding:4px 0;
      border-bottom:1px solid rgba(255,255,255,.04);
    }
    #action-log .log-item:last-child{border-bottom:none}
    #action-log .log-item.warning{color:#ffb400}
    #action-log .log-item.critical{color:#ff6666}
    
    /* ============================================
       ACTION HUD (ìš°ì¸¡ í•˜ë‹¨)
       ============================================ */
    #action-hud{
      position:fixed;
      bottom:110px;
      right:40px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:150;
    }
    .action-btn{
      padding:14px 28px;
      border-radius:8px;
      font-size:11px;
      font-weight:600;
      letter-spacing:.12em;
      cursor:pointer;
      transition:all .2s;
      text-align:center;
      min-width:150px;
    }
    .action-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:0 0 20px currentColor}
    .action-btn:disabled{opacity:.25;cursor:not-allowed;transform:none}
    .action-btn.recover{background:rgba(0,255,136,.15);border:1px solid #00ff88;color:#00ff88}
    .action-btn.defriction{background:rgba(68,170,255,.15);border:1px solid #44aaff;color:#44aaff}
    .action-btn.shock-damp{background:rgba(255,170,0,.15);border:1px solid #ffaa00;color:#ffaa00}
    .action-btn.critical-highlight{animation:criticalPulse 1s infinite}
    @keyframes criticalPulse{
      0%,100%{box-shadow:0 0 5px currentColor}
      50%{box-shadow:0 0 25px currentColor,0 0 40px currentColor}
    }
    #action-hud .preview-label{
      font-size:8px;
      color:#666;
      text-align:center;
      margin-top:4px;
      letter-spacing:.12em;
    }
    
    /* ============================================
       SINGLE QUESTION (ì¢Œì¸¡ í•˜ë‹¨)
       ============================================ */
    #single-question{
      position:fixed;
      left:40px;
      bottom:110px;
      max-width:300px;
      padding:14px 18px;
      background:rgba(0,20,40,.9);
      border:1px solid rgba(0,212,255,.3);
      border-radius:10px;
      z-index:150;
      font-size:11px;
      color:#9ab;
      line-height:1.5;
    }
    #single-question strong{color:#00d4ff;font-weight:600}
    
    /* ============================================
       ORBIT LEGEND (ì¢Œì¸¡ í•˜ë‹¨)
       ============================================ */
    #orbit-legend{
      position:fixed;
      bottom:40px;
      left:40px;
      display:flex;
      gap:18px;
      z-index:100;
    }
    .legend-item{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:9px;
      color:#555;
      cursor:pointer;
      transition:all .2s;
    }
    .legend-item:hover{color:#888}
    .legend-item.active{color:#aaa}
    .legend-dot{width:8px;height:8px;border-radius:50%}
    .legend-dot.past{background:#444}
    .legend-dot.now{background:#00d4ff;box-shadow:0 0 8px #00d4ff}
    .legend-dot.forecast{background:#aa88ff;box-shadow:0 0 6px #aa88ff}
    
    /* ============================================
       CONTROLS (ìš°ì¸¡ í•˜ë‹¨)
       ============================================ */
    #controls{
      position:fixed;
      bottom:40px;
      right:40px;
      display:flex;
      gap:8px;
      z-index:100;
    }
    #controls button{
      padding:10px 16px;
      background:rgba(0,212,255,.1);
      border:1px solid rgba(0,212,255,.25);
      color:#00d4ff;
      border-radius:5px;
      font-size:9px;
      letter-spacing:.05em;
      cursor:pointer;
      transition:all .2s;
    }
    #controls button:hover{background:rgba(0,212,255,.2)}
    #controls button.active{background:rgba(0,212,255,.25);border-color:#00d4ff}
    
    /* ============================================
       PLANET LABELS (3D ë¼ë²¨)
       ============================================ */
    .planet-label{
      position:absolute;
      font-size:10px;
      color:#fff;
      pointer-events:none;
      text-shadow:0 0 10px rgba(0,0,0,.95);
      white-space:nowrap;
      transition:opacity .2s;
    }
    
    /* ============================================
       LOCK INDICATOR (ì ê¸ˆ í‘œì‹œ)
       ============================================ */
    .lock-indicator{
      position:fixed;
      top:28px;
      left:40px;
      font-size:9px;
      letter-spacing:.1em;
      color:rgba(0,255,136,.6);
      z-index:200;
    }
    .lock-indicator::before{content:'ğŸ”’ '}
  </style>
</head>
<body>
  <!-- Frame -->
  <div class="frame">
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>
  </div>
  
  <!-- Lock Indicator -->
  <div class="lock-indicator">9/9 PLANETS LOCKED</div>
  
  <!-- GATE + SLA TOPBAR -->
  <div class="autus-topbar">
    <div id="gate-badge" class="gate-badge gate-green">GATE: GREEN</div>
    <div id="sla-strip" class="sla-strip">
      <span data-sla="worker" class="sla-ok">WORKER Â· OK</span>
      <span data-sla="employer" class="sla-ok">EMPLOYER Â· OK</span>
      <span data-sla="ops" class="sla-ok">OPS Â· OK</span>
      <span data-sla="reg" class="sla-ok">REG Â· OK</span>
    </div>
  </div>
  
  <!-- Info Panel -->
  <div id="info">
    <h1>SOLAR HQ Â· FINAL</h1>
    <div class="stat-row"><span class="stat-label">VERSION</span><span class="stat-value">1.0</span></div>
    <div class="stat-row"><span class="stat-label">PLANETS</span><span class="stat-value">9</span></div>
    <div class="stat-row"><span class="stat-label">FPS</span><span class="stat-value" id="s-fps">60</span></div>
    <div class="stat-row"><span class="stat-label">STATUS</span><span class="stat-value" id="s-status">STABLE</span></div>
    <div class="stat-row"><span class="stat-label">ORBIT</span><span class="stat-value" id="s-orbit">0Â°</span></div>
  </div>
  
  <!-- Planets Panel -->
  <div id="planets">
    <div class="panel-title">9 PLANETS Â· PRIORITY ORDER</div>
    <div id="planet-list"></div>
  </div>
  
  <!-- Metrics -->
  <div id="metrics">
    <div class="metric-section">
      <div class="metric-title">TWIN STATE</div>
      <div class="metric-grid">
        <div class="metric-card"><div class="metric-value" id="m-entropy">0.00</div><div class="metric-label">ENTROPY</div></div>
        <div class="metric-card"><div class="metric-value" id="m-pressure">0.00</div><div class="metric-label">PRESSURE</div></div>
        <div class="metric-card"><div class="metric-value" id="m-risk">0.00</div><div class="metric-label">RISK</div></div>
        <div class="metric-card"><div class="metric-value" id="m-flow">0.00</div><div class="metric-label">FLOW</div></div>
      </div>
    </div>
    <div class="metric-section">
      <div class="metric-title">SYSTEM</div>
      <div class="metric-grid">
        <div class="metric-card"><div class="metric-value">99.9%</div><div class="metric-label">UPTIME</div></div>
        <div class="metric-card"><div class="metric-value">12ms</div><div class="metric-label">LATENCY</div></div>
      </div>
    </div>
  </div>
  
  <!-- Action Log -->
  <div id="action-log">
    <div class="log-title">ACTION LOG</div>
    <div id="log-items"></div>
  </div>
  
  <!-- Action HUD -->
  <div id="action-hud">
    <button class="action-btn recover" onclick="previewAction('recover')">RECOVER</button>
    <button class="action-btn defriction" onclick="previewAction('defriction')">DEFRICTION</button>
    <button class="action-btn shock-damp" onclick="previewAction('shock_damp')">SHOCK DAMP</button>
    <div class="preview-label">â–² PREVIEW ONLY</div>
  </div>
  
  <!-- Single Question -->
  <div id="single-question">
    <strong>Q â†’</strong> What single action raises Recovery fastest?
  </div>
  
  <!-- Orbit Legend -->
  <div id="orbit-legend">
    <div class="legend-item active" data-orbit="past"><div class="legend-dot past"></div>PAST</div>
    <div class="legend-item active" data-orbit="now"><div class="legend-dot now"></div>NOW</div>
    <div class="legend-item active" data-orbit="forecast"><div class="legend-dot forecast"></div>FORECAST</div>
  </div>
  
  <!-- Controls -->
  <div id="controls">
    <button onclick="toggleScan()" class="active">SCAN</button>
    <button onclick="addNode()">+NODE</button>
    <button onclick="toggleDayNight()" class="active">DAY/NIGHT</button>
    <button onclick="togglePlanets()" class="active">PLANETS</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTUS SOLAR HQ â€” FINAL COMPLETE VERSION
   
   9 PLANETS LOCKED:
   1. RECOVERY  - Shock ì´í›„ ê¸°ì¤€ì„  ë³µê·€ ëŠ¥ë ¥
   2. STABILITY - í˜„ì¬ ìƒíƒœ ìœ ì§€ êµ¬ì¡°ì  ê°•ë„  
   3. COHESION  - êµ¬ì„±ìš”ì†Œ ê°„ ê²°ì†ë ¥
   4. SHOCK     - ì™¸ë¶€ ì¶©ê²©ì˜ ë¶ˆí™•ì‹¤ì„± ì••ë ¥
   5. FRICTION  - íë¦„ ë°©í•´ ì €í•­ê³¼ ë¹„íš¨ìœ¨
   6. TRANSFER  - ìì› ì´ë™ íš¨ìœ¨
   7. TIME      - ë‚¨ì€ ì‹œê°„ ìì›
   8. QUALITY   - ì‚°ì¶œë¬¼ ì •í™•ì„±/ì™„ì„±ë„
   9. OUTPUT    - ë‹¨ìœ„ ì‹œê°„ë‹¹ ìƒì‚°ëŸ‰
   
   BUILD: 2025-12-17
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POLICY (FROZEN - DO NOT MODIFY)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const POLICY = Object.freeze({
  RECOVERY_AMBER: 0.60,
  RECOVERY_RED: 0.30,
  CRITICAL_THRESHOLD: 0.60,
  CRITICAL_COLLAPSE: ['OUTPUT', 'QUALITY', 'TIME'],
  PRIORITY: ['RECOVERY', 'STABILITY', 'COHESION', 'SHOCK', 'FRICTION', 'TRANSFER', 'TIME', 'QUALITY', 'OUTPUT'],
  
  // SLA Thresholds
  WORKER_BREACH: 0.35,
  WORKER_RISK: 0.50,
  EMPLOYER_STABILITY_RISK: 0.20,
  EMPLOYER_COHESION_RISK: 0.25,
  OPS_SHOCK_BREACH: 0.75,
  OPS_SHOCK_RISK: 0.60,
  REG_SHOCK_BREACH: 0.85
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLANET DEFINITIONS (LOCKED - 9/9)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLANETS = Object.freeze([
  { key: 'RECOVERY',  name: 'Recovery',  icon: 'ğŸ”§', desc: 'Bezos Â· íšŒë³µ',      color: 0x44ff44, size: 0.14, orbit: 5.4, speed: 0.50, definition: 'Shock ì´í›„ ê¸°ì¤€ì„  ë³µê·€ ëŠ¥ë ¥' },
  { key: 'STABILITY', name: 'Stability', icon: 'ğŸ¯', desc: 'Bezos Â· ì¥ê¸°ì•ˆì •',  color: 0x8844ff, size: 0.20, orbit: 4.4, speed: 0.35, rings: true, definition: 'í˜„ì¬ ìƒíƒœ ìœ ì§€ êµ¬ì¡°ì  ê°•ë„' },
  { key: 'COHESION',  name: 'Cohesion',  icon: 'ğŸ”—', desc: 'Huang Â· ê²°ì†',     color: 0xff44aa, size: 0.13, orbit: 4.9, speed: 0.60, definition: 'êµ¬ì„±ìš”ì†Œ ê°„ ê²°ì†ë ¥' },
  { key: 'SHOCK',     name: 'Shock',     icon: 'âš ï¸', desc: 'Thiel Â· ë¶ˆí™•ì‹¤ì„±', color: 0xff8800, size: 0.19, orbit: 6.4, speed: 0.30, definition: 'ì™¸ë¶€ ì¶©ê²©ì˜ ë¶ˆí™•ì‹¤ì„± ì••ë ¥' },
  { key: 'FRICTION',  name: 'Friction',  icon: 'âš¡', desc: 'Buffett Â· ë¦¬ìŠ¤í¬',  color: 0xff4444, size: 0.16, orbit: 3.9, speed: 0.45, definition: 'íë¦„ ë°©í•´ ì €í•­ê³¼ ë¹„íš¨ìœ¨' },
  { key: 'TRANSFER',  name: 'Transfer',  icon: 'ğŸ“¡', desc: 'Huang Â· ì „íŒŒ',     color: 0x44aaff, size: 0.12, orbit: 5.9, speed: 0.75, rings: true, definition: 'ìì› ì´ë™ íš¨ìœ¨' },
  { key: 'TIME',      name: 'Time',      icon: 'â±ï¸', desc: 'Altman Â· ì‹œê°„',   color: 0xffaa00, size: 0.14, orbit: 3.4, speed: 0.85, definition: 'ë‚¨ì€ ì‹œê°„ ìì›' },
  { key: 'QUALITY',   name: 'Quality',   icon: 'ğŸ›¡ï¸', desc: 'Jobs Â· í’ˆì§ˆ',     color: 0x00d4ff, size: 0.15, orbit: 2.9, speed: 0.55, rings: true, definition: 'ì‚°ì¶œë¬¼ ì •í™•ì„±/ì™„ì„±ë„' },
  { key: 'OUTPUT',    name: 'Output',    icon: 'ğŸ”¥', desc: 'Musk Â· ì‹¤í–‰ë ¥',    color: 0x00ff88, size: 0.18, orbit: 2.4, speed: 0.70, definition: 'ë‹¨ìœ„ ì‹œê°„ë‹¹ ìƒì‚°ëŸ‰' }
]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let planets9 = {};
let selectedPlanet = 'RECOVERY';
let state = { energy: 0.5, flow: 0.5, risk: 0.28, entropy: 0.2, pressure: 0.2 };
let showOrbits = { past: true, now: true, forecast: true };
let planetsVisible = true;
let lastCriticalState = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THREE.JS SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(50, innerWidth / innerHeight, 0.1, 1000);
camera.position.set(0, 8, 14);
camera.lookAt(0, 0, 0);

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
document.body.appendChild(renderer.domElement);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIGHTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
scene.add(new THREE.AmbientLight(0x404050, 0.5));
const sunLight = new THREE.PointLight(0xffffff, 1.5, 50);
scene.add(sunLight);
const rimLight = new THREE.DirectionalLight(0x00d4ff, 0.3);
rimLight.position.set(10, 5, 10);
scene.add(rimLight);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STARFIELD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const starsGeo = new THREE.BufferGeometry();
const starPos = [];
for (let i = 0; i < 2500; i++) {
  const r = 45 + Math.random() * 70;
  const t = Math.random() * Math.PI * 2;
  const p = Math.acos(2 * Math.random() - 1);
  starPos.push(r * Math.sin(p) * Math.cos(t), r * Math.sin(p) * Math.sin(t), r * Math.cos(p));
}
starsGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
scene.add(new THREE.Points(starsGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 0.08 })));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBE (ì¤‘ì•™ Entity)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const globeGroup = new THREE.Group();
scene.add(globeGroup);

const globeGeo = new THREE.SphereGeometry(1.5, 64, 64);
const globeMat = new THREE.MeshPhongMaterial({ color: 0x0066aa, emissive: 0x001133, transparent: true, opacity: 0.85, shininess: 30 });
const globe = new THREE.Mesh(globeGeo, globeMat);
globeGroup.add(globe);

const wireGeo = new THREE.SphereGeometry(1.52, 36, 18);
const wireMat = new THREE.MeshBasicMaterial({ color: 0x00d4ff, wireframe: true, transparent: true, opacity: 0.15 });
globeGroup.add(new THREE.Mesh(wireGeo, wireMat));

const glowGeo = new THREE.SphereGeometry(1.7, 32, 32);
const glowMat = new THREE.MeshBasicMaterial({ color: 0x00d4ff, transparent: true, opacity: 0.08, side: THREE.BackSide });
globeGroup.add(new THREE.Mesh(glowGeo, glowMat));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATION RINGS (L2 - Forecast Overlay)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const simGroup = new THREE.Group();

// Inner Ring (Recovery/Stability ê±´ê°•ë„)
const innerRingGeo = new THREE.RingGeometry(7.5, 7.7, 64);
const innerRingMat = new THREE.MeshBasicMaterial({ color: 0x00ffaa, transparent: true, opacity: 0.25, side: THREE.DoubleSide });
const innerRing = new THREE.Mesh(innerRingGeo, innerRingMat);
innerRing.rotation.x = -Math.PI / 2;
innerRing.position.y = 0.3;
simGroup.add(innerRing);

// Outer Ring (Shock/Friction ì••ë ¥)
const outerRingGeo = new THREE.RingGeometry(8.2, 8.5, 64);
const outerRingMat = new THREE.MeshBasicMaterial({ color: 0xff8844, transparent: true, opacity: 0.2, side: THREE.DoubleSide });
const outerRing = new THREE.Mesh(outerRingGeo, outerRingMat);
outerRing.rotation.x = -Math.PI / 2;
outerRing.position.y = 0.3;
simGroup.add(outerRing);

scene.add(simGroup);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLANETS (9ê°œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const planetGroup = new THREE.Group();
scene.add(planetGroup);

const planetMeshes = {};
const planetLabelsEl = {};
const orbitRings = { past: [], now: [], forecast: [] };

PLANETS.forEach((p, i) => {
  const group = new THREE.Group();
  
  // Planet sphere
  const geo = new THREE.SphereGeometry(p.size, 24, 24);
  const mat = new THREE.MeshStandardMaterial({ color: p.color, emissive: p.color, emissiveIntensity: 0.3, metalness: 0.2, roughness: 0.8 });
  group.add(new THREE.Mesh(geo, mat));
  
  // Glow
  const glowGeo = new THREE.SphereGeometry(p.size * 1.3, 16, 16);
  const glowMat = new THREE.MeshBasicMaterial({ color: p.color, transparent: true, opacity: 0.15, side: THREE.BackSide });
  group.add(new THREE.Mesh(glowGeo, glowMat));
  
  // Rings (ì„ íƒì )
  if (p.rings) {
    const ringGeo = new THREE.RingGeometry(p.size * 1.5, p.size * 2, 32);
    const ringMat = new THREE.MeshBasicMaterial({ color: p.color, transparent: true, opacity: 0.25, side: THREE.DoubleSide });
    const ring = new THREE.Mesh(ringGeo, ringMat);
    ring.rotation.x = Math.PI / 2.2;
    group.add(ring);
  }
  
  group.userData = p;
  planetGroup.add(group);
  planetMeshes[p.key] = group;
  
  // Orbit rings (PAST/NOW/FORECAST)
  [
    { key: 'past', color: 0x555555, opacity: 0.12, y: -0.15 },
    { key: 'now', color: 0x00d4ff, opacity: 0.35, y: 0 },
    { key: 'forecast', color: 0xaa88ff, opacity: 0.15, y: 0.15 }
  ].forEach(cfg => {
    const rGeo = new THREE.RingGeometry(p.orbit - 0.015, p.orbit + 0.015, 64);
    const rMat = new THREE.MeshBasicMaterial({ color: cfg.color, transparent: true, opacity: cfg.opacity, side: THREE.DoubleSide });
    const ring = new THREE.Mesh(rGeo, rMat);
    ring.rotation.x = -Math.PI / 2;
    ring.position.y = cfg.y;
    scene.add(ring);
    orbitRings[cfg.key].push(ring);
  });
  
  // DOM Labels
  const label = document.createElement('div');
  label.className = 'planet-label';
  label.innerHTML = `<span style="color:#${p.color.toString(16).padStart(6,'0')}">${p.icon}</span> ${p.name}`;
  document.body.appendChild(label);
  planetLabelsEl[p.key] = label;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTION LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function logAction(msg, type = 'info') {
  const container = document.getElementById('log-items');
  if (!container) return;
  
  const item = document.createElement('div');
  item.className = 'log-item' + (type === 'warning' ? ' warning' : type === 'critical' ? ' critical' : '');
  const ts = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
  item.textContent = `[${ts}] ${msg}`;
  container.insertBefore(item, container.firstChild);
  
  while (container.children.length > 20) container.removeChild(container.lastChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GATE COMPUTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function computeGate(recovery, risk) {
  if (risk > POLICY.CRITICAL_THRESHOLD) return 'AMBER';
  if (recovery < POLICY.RECOVERY_RED) return 'RED';
  if (recovery < POLICY.RECOVERY_AMBER) return 'AMBER';
  return 'GREEN';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SLA COMPUTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function computeSLA(rec, sta, coh, shk) {
  return {
    worker: rec < POLICY.WORKER_BREACH ? 'BREACH' : rec < POLICY.WORKER_RISK ? 'AT_RISK' : 'OK',
    employer: (sta < POLICY.EMPLOYER_STABILITY_RISK || coh < POLICY.EMPLOYER_COHESION_RISK) ? 'AT_RISK' : 'OK',
    ops: shk > POLICY.OPS_SHOCK_BREACH ? 'BREACH' : shk > POLICY.OPS_SHOCK_RISK ? 'AT_RISK' : 'OK',
    reg: shk > POLICY.REG_SHOCK_BREACH ? 'BREACH' : 'OK'
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPDATE GATE & SLA UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateGateSLA() {
  const rec = planets9.RECOVERY || 0.5;
  const sta = planets9.STABILITY || 0.5;
  const coh = planets9.COHESION || 0.5;
  const shk = planets9.SHOCK || 0.5;
  
  // GATE
  const gate = computeGate(rec, state.risk);
  const gateEl = document.getElementById('gate-badge');
  gateEl.className = 'gate-badge gate-' + gate.toLowerCase();
  gateEl.textContent = 'GATE: ' + gate;
  
  // SLA
  const sla = computeSLA(rec, sta, coh, shk);
  const classMap = { OK: 'sla-ok', AT_RISK: 'sla-risk', BREACH: 'sla-breach' };
  
  for (const [key, value] of Object.entries(sla)) {
    const el = document.querySelector(`#sla-strip span[data-sla="${key}"]`);
    if (el) {
      el.className = classMap[value] || 'sla-ok';
      el.textContent = `${key.toUpperCase()} Â· ${value.replace('_', ' ')}`;
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTION HUD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function previewAction(action) {
  let delta = {};
  if (action === 'recover') delta = { recovery: +0.15, stability: +0.05, friction: -0.05 };
  else if (action === 'defriction') delta = { friction: -0.20, transfer: +0.10, recovery: +0.05 };
  else if (action === 'shock_damp') delta = { shock: -0.15, stability: +0.10, recovery: +0.05 };
  
  // Flash simulation rings
  const origInner = innerRingMat.opacity;
  const origOuter = outerRingMat.opacity;
  innerRingMat.opacity = 0.6;
  outerRingMat.opacity = 0.6;
  setTimeout(() => { innerRingMat.opacity = origInner; outerRingMat.opacity = origOuter; }, 800);
  
  logAction(`Preview: ${action.toUpperCase()}`, 'warning');
  logAction(`Î”REC:${delta.recovery||0} Î”FRI:${delta.friction||0} Î”SHK:${delta.shock||0}`);
}

function updateActionHUD() {
  const rec = planets9.RECOVERY || 0.5;
  const fri = planets9.FRICTION || 0.5;
  const shk = planets9.SHOCK || 0.5;
  const isCritical = state.risk > POLICY.CRITICAL_THRESHOLD;
  
  const recoverBtn = document.querySelector('.action-btn.recover');
  const defrictionBtn = document.querySelector('.action-btn.defriction');
  const shockBtn = document.querySelector('.action-btn.shock-damp');
  
  if (isCritical) {
    recoverBtn.disabled = false;
    recoverBtn.classList.add('critical-highlight');
    defrictionBtn.disabled = true;
    shockBtn.disabled = true;
  } else {
    recoverBtn.disabled = rec > 0.7;
    recoverBtn.classList.remove('critical-highlight');
    defrictionBtn.disabled = fri < 0.4;
    shockBtn.disabled = shk < 0.4;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CRITICAL PROTECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enforceCriticalProtection() {
  const isCritical = state.risk > POLICY.CRITICAL_THRESHOLD;
  
  if (isCritical && !lastCriticalState) {
    logAction('CRITICAL state entered', 'critical');
    logAction('Recovery priority engaged', 'warning');
    logAction('Output/Quality/Time collapsed', 'warning');
  }
  if (!isCritical && lastCriticalState) {
    logAction('CRITICAL state cleared');
  }
  lastCriticalState = isCritical;
  
  // Collapse planets
  POLICY.CRITICAL_COLLAPSE.forEach(key => {
    const row = document.querySelector(`.planet-row[data-key="${key}"]`);
    if (row) row.classList.toggle('collapsed', isCritical);
  });
  
  // Status display
  const statusEl = document.getElementById('s-status');
  const status = isCritical ? 'CRITICAL' : state.risk > 0.35 ? 'WARNING' : 'STABLE';
  statusEl.textContent = status;
  statusEl.className = 'stat-value' + (isCritical ? ' critical' : state.risk > 0.35 ? ' warning' : '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PLANET LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlanetList() {
  const container = document.getElementById('planet-list');
  const isCritical = state.risk > POLICY.CRITICAL_THRESHOLD;
  
  container.innerHTML = PLANETS.map(p => {
    const value = Math.round((planets9[p.key] || 0.5) * 100);
    const isActive = p.key === selectedPlanet;
    const colorHex = '#' + p.color.toString(16).padStart(6, '0');
    const isCollapsed = isCritical && POLICY.CRITICAL_COLLAPSE.includes(p.key);
    
    return `
      <div class="planet-row ${isActive ? 'active' : ''} ${isCollapsed ? 'collapsed' : ''}" data-key="${p.key}" onclick="selectPlanet('${p.key}')">
        <div class="planet-dot" style="background:${colorHex};color:${colorHex}"></div>
        <span class="planet-name">${p.icon} ${p.name}</span>
        <span class="planet-val" style="color:${colorHex}">${value}%</span>
      </div>
    `;
  }).join('');
}

function selectPlanet(key) {
  if (state.risk > POLICY.CRITICAL_THRESHOLD && POLICY.CRITICAL_COLLAPSE.includes(key)) {
    logAction(`${key} blocked in CRITICAL`, 'warning');
    return;
  }
  selectedPlanet = key;
  renderPlanetList();
  
  const planet = PLANETS.find(p => p.key === key);
  if (planet) {
    logAction(`Selected: ${planet.name}`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANIMATION LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let time = 0;
let frames = 0, lastFPS = performance.now();

function animate() {
  requestAnimationFrame(animate);
  time += 0.016;
  
  // Globe rotation
  globeGroup.rotation.y += 0.003;
  
  // Planets orbit
  if (planetsVisible) {
    PLANETS.forEach((p, i) => {
      const value = planets9[p.key] || 0.5;
      const group = planetMeshes[p.key];
      
      const angle = time * p.speed * 0.3 + (i / PLANETS.length) * Math.PI * 2;
      const r = p.orbit + (value - 0.5) * 0.2;
      
      group.position.x = Math.cos(angle) * r;
      group.position.z = Math.sin(angle) * r;
      group.position.y = Math.sin(time * 0.2 + i) * 0.1;
      group.rotation.y += 0.02;
      
      // Selection scale
      const isSelected = p.key === selectedPlanet;
      group.scale.setScalar(isSelected ? 1.5 : 1);
      
      // Update label position
      const label = planetLabelsEl[p.key];
      const screenPos = group.position.clone().project(camera);
      if (screenPos.z < 1) {
        label.style.left = ((screenPos.x + 1) / 2 * innerWidth) + 'px';
        label.style.top = ((-screenPos.y + 1) / 2 * innerHeight - 22) + 'px';
        label.style.opacity = isSelected ? '1' : '0.5';
      } else {
        label.style.opacity = '0';
      }
    });
    
    // Orbit visibility
    Object.keys(orbitRings).forEach(key => {
      orbitRings[key].forEach(ring => ring.visible = showOrbits[key]);
    });
  }
  
  // SIMULATION RINGS (L2)
  const rec = planets9.RECOVERY || 0.5;
  const sta = planets9.STABILITY || 0.5;
  const shk = planets9.SHOCK || 0.5;
  const fri = planets9.FRICTION || 0.5;
  
  const innerHealth = (rec + sta) / 2;
  innerRingMat.color.setHex(innerHealth > 0.4 ? 0x00ffaa : 0xff4444);
  
  const outerPressure = (shk + fri) / 2;
  outerRingMat.color.setHex(outerPressure > 0.5 ? 0xff8844 : 0x44aaff);
  
  innerRing.rotation.z += 0.003;
  outerRing.rotation.z -= 0.002;
  
  // FPS counter
  frames++;
  if (performance.now() - lastFPS >= 1000) {
    document.getElementById('s-fps').textContent = frames;
    frames = 0;
    lastFPS = performance.now();
  }
  
  // UI Updates
  document.getElementById('s-orbit').textContent = Math.round(globeGroup.rotation.y * 180 / Math.PI % 360) + 'Â°';
  document.getElementById('m-entropy').textContent = shk.toFixed(2);
  document.getElementById('m-pressure').textContent = fri.toFixed(2);
  document.getElementById('m-risk').textContent = state.risk.toFixed(2);
  document.getElementById('m-flow').textContent = (planets9.TRANSFER || 0.5).toFixed(2);
  
  const riskEl = document.getElementById('m-risk');
  riskEl.className = 'metric-value' + (state.risk > 0.6 ? ' danger' : state.risk > 0.35 ? ' warning' : '');
  
  updateGateSLA();
  updateActionHUD();
  enforceCriticalProtection();
  
  renderer.render(scene, camera);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTROLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleScan() { document.querySelector('#controls button:nth-child(1)').classList.toggle('active'); }
function addNode() { logAction('Node added'); }
function toggleDayNight() { document.querySelector('#controls button:nth-child(3)').classList.toggle('active'); }
function togglePlanets() {
  planetsVisible = !planetsVisible;
  planetGroup.visible = planetsVisible;
  Object.values(planetLabelsEl).forEach(el => el.style.display = planetsVisible ? 'block' : 'none');
  document.querySelector('#controls button:nth-child(4)').classList.toggle('active', planetsVisible);
}

// Orbit legend clicks
document.querySelectorAll('.legend-item').forEach(item => {
  item.addEventListener('click', () => {
    const key = item.dataset.orbit;
    showOrbits[key] = !showOrbits[key];
    item.classList.toggle('active', showOrbits[key]);
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FETCH STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchState() {
  try {
    const r = await fetch('/status');
    const s = await r.json();
    state.energy = s.signals?.gravity || 0.5;
    state.flow = s.signals?.release || 0.5;
    state.entropy = s.signals?.entropy || 0.2;
    state.pressure = s.signals?.pressure || 0.2;
  } catch(e) {}
  
  try {
    const r = await fetch('/shadow/snapshot/ENT_001');
    const data = await r.json();
    if (data.shadow) {
      PLANETS.forEach(p => planets9[p.key] = data.shadow[p.key.toLowerCase()] || 0.5);
    }
  } catch(e) {
    // Simulated data for demo
    const base = {
      RECOVERY: 0.45, STABILITY: 0.32, COHESION: 0.38,
      SHOCK: 0.55, FRICTION: 0.48, TRANSFER: 0.62,
      TIME: 0.59, QUALITY: 0.70, OUTPUT: 0.53
    };
    PLANETS.forEach(p => {
      planets9[p.key] = base[p.key] || (0.4 + Math.sin(Date.now() / 5000) * 0.2);
    });
  }
  
  // Calculate risk
  const shk = planets9.SHOCK || 0.5;
  const fri = planets9.FRICTION || 0.5;
  state.risk = Math.min(1, shk * 1.2 + fri * 0.3);
  
  renderPlanetList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CAMERA CONTROLS (ë“œë˜ê·¸ + ì¤Œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let isDragging = false;
let prevMouse = { x: 0, y: 0 };
let cameraTheta = 0;
let cameraPhi = 1.0;
let cameraDistance = 16;

renderer.domElement.addEventListener('mousedown', e => {
  isDragging = true;
  prevMouse = { x: e.clientX, y: e.clientY };
});

renderer.domElement.addEventListener('mousemove', e => {
  if (!isDragging) return;
  const dx = e.clientX - prevMouse.x;
  const dy = e.clientY - prevMouse.y;
  cameraTheta += dx * 0.005;
  cameraPhi = Math.max(0.3, Math.min(2.5, cameraPhi + dy * 0.005));
  prevMouse = { x: e.clientX, y: e.clientY };
  
  camera.position.x = cameraDistance * Math.sin(cameraPhi) * Math.cos(cameraTheta);
  camera.position.y = cameraDistance * Math.cos(cameraPhi);
  camera.position.z = cameraDistance * Math.sin(cameraPhi) * Math.sin(cameraTheta);
  camera.lookAt(0, 0, 0);
});

renderer.domElement.addEventListener('mouseup', () => isDragging = false);
renderer.domElement.addEventListener('mouseleave', () => isDragging = false);

renderer.domElement.addEventListener('wheel', e => {
  cameraDistance = Math.max(8, Math.min(30, cameraDistance + e.deltaY * 0.02));
  camera.position.x = cameraDistance * Math.sin(cameraPhi) * Math.cos(cameraTheta);
  camera.position.y = cameraDistance * Math.cos(cameraPhi);
  camera.position.z = cameraDistance * Math.sin(cameraPhi) * Math.sin(cameraTheta);
  camera.lookAt(0, 0, 0);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onresize = () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
};

console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('  AUTUS SOLAR HQ â€” FINAL COMPLETE VERSION');
console.log('  9/9 PLANETS LOCKED');
console.log('  Layers: L0(SOLAR) + L2(SIMULATION) + L3(ACTION)');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('POLICY:', POLICY);
console.log('PLANETS:', PLANETS.map(p => p.key));

logAction('AUTUS Solar HQ Final initialized');
logAction('POLICY frozen');
logAction('9/9 planets LOCKED');
logAction('Layers: L0 + L2 + L3 active');

fetchState();
setInterval(fetchState, 3000);
renderPlanetList();
animate();
  </script>
</body>
</html>

