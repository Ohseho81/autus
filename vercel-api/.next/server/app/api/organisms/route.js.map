{"version":3,"file":"app/api/organisms/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/api/organisms/route.ts","webpack://_N_E/./app/api/organisms/route.ts?90a8","webpack://_N_E/?1db7"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","// ============================================\n// AUTUS Organisms API - Ïú†Í∏∞Ï≤¥ CRUD\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/lib/supabase';\nimport { calculateV, summarizeState, recommendImpulse } from '@/lib/physics';\n\nexport const runtime = 'edge';\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n};\n\nexport async function OPTIONS() {\n  return new NextResponse(null, { status: 200, headers: corsHeaders });\n}\n\n// GET /api/organisms?userId=xxx&id=xxx\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n    const id = searchParams.get('id');\n\n    if (id) {\n      // Îã®Ïùº Ïú†Í∏∞Ï≤¥ Ï°∞Ìöå\n      const organism = await db.getOrganism(id);\n      if (!organism) {\n        return NextResponse.json(\n          { success: false, error: 'Organism not found' },\n          { status: 404, headers: corsHeaders }\n        );\n      }\n\n      const state = {\n        mint: organism.mint,\n        tax: organism.tax,\n        synergy: organism.synergy,\n        entropy: organism.entropy,\n        velocity: organism.velocity,\n        friction: organism.friction\n      };\n\n      return NextResponse.json({\n        success: true,\n        data: {\n          ...organism,\n          computed_v: calculateV(organism.mint, organism.tax, organism.synergy),\n          summary: summarizeState(state),\n          recommended_impulse: recommendImpulse(state)\n        }\n      }, { status: 200, headers: corsHeaders });\n    }\n\n    if (!userId) {\n      return NextResponse.json(\n        { success: false, error: 'userId is required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // Ï†ÑÏ≤¥ Î™©Î°ù Ï°∞Ìöå\n    const organisms = await db.getOrganisms(userId);\n\n    return NextResponse.json({\n      success: true,\n      data: organisms.map(org => ({\n        ...org,\n        computed_v: calculateV(org.mint, org.tax, org.synergy)\n      }))\n    }, { status: 200, headers: corsHeaders });\n\n  } catch (error: any) {\n    console.error('Organisms GET Error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n\n// POST /api/organisms (ÏÉùÏÑ±)\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { userId, name, type, emoji, mint, tax, synergy } = body;\n\n    if (!userId || !name || !type) {\n      return NextResponse.json(\n        { success: false, error: 'userId, name, type are required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // SupabaseÏóê ÏßÅÏ†ë INSERT\n    const { getSupabaseAdmin } = await import('@/lib/supabase');\n    const supabaseAdmin = getSupabaseAdmin();\n    \n    // value_vÎäî DBÏóêÏÑú ÏûêÎèô Í≥ÑÏÇ∞Îê® (GENERATED ALWAYS AS)\n    const initialState = {\n      user_id: userId,\n      name,\n      type,\n      emoji: emoji || 'üë§',\n      mint: mint || 1000000,\n      tax: tax || 500000,\n      synergy: synergy || 0.1,\n      entropy: 0.3,\n      velocity: 0.05,\n      friction: 0.1,\n      sync_rate: 0.7,\n      status: 'stable',\n      urgency: 0.3\n    };\n\n    const { data, error } = await supabaseAdmin\n      .from('organisms')\n      .insert(initialState)\n      .select()\n      .single();\n\n    if (error) {\n      return NextResponse.json(\n        { success: false, error: error.message },\n        { status: 500, headers: corsHeaders }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data\n    }, { status: 201, headers: corsHeaders });\n\n  } catch (error: any) {\n    console.error('Organisms POST Error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n\n// PUT /api/organisms (ÏóÖÎç∞Ïù¥Ìä∏)\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { id, ...updates } = body;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'id is required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // V Ïû¨Í≥ÑÏÇ∞\n    if (updates.mint !== undefined || updates.tax !== undefined || updates.synergy !== undefined) {\n      const current = await db.getOrganism(id);\n      if (current) {\n        updates.value_v = calculateV(\n          updates.mint ?? current.mint,\n          updates.tax ?? current.tax,\n          updates.synergy ?? current.synergy\n        );\n      }\n    }\n\n    const success = await db.updateOrganism(id, updates);\n\n    if (!success) {\n      return NextResponse.json(\n        { success: false, error: 'Update failed' },\n        { status: 500, headers: corsHeaders }\n      );\n    }\n\n    const updated = await db.getOrganism(id);\n\n    return NextResponse.json({\n      success: true,\n      data: updated\n    }, { status: 200, headers: corsHeaders });\n\n  } catch (error: any) {\n    console.error('Organisms PUT Error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Users/oseho/Desktop/autus/vercel-api/app/api/organisms/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/organisms/route\",\n        pathname: \"/api/organisms\",\n        filename: \"route\",\n        bundlePath: \"app/api/organisms/route\"\n    },\n    resolvedPagePath: \"/Users/oseho/Desktop/autus/vercel-api/app/api/organisms/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/organisms/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Forganisms%2Froute&page=%2Fapi%2Forganisms%2Froute&pagePath=private-next-app-dir%2Fapi%2Forganisms%2Froute.ts&appDir=%2FUsers%2Foseho%2FDesktop%2Fautus%2Fvercel-api%2Fapp&appPaths=%2Fapi%2Forganisms%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/organisms/route.ts?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map"],"names":["module","exports","require","runtime","corsHeaders","OPTIONS","NextResponse","status","headers","GET","request","searchParams","URL","url","userId","get","id","organism","db","getOrganism","json","success","error","state","mint","tax","synergy","entropy","velocity","friction","data","computed_v","calculateV","summary","summarizeState","recommended_impulse","recommendImpulse","organisms","getOrganisms","map","org","console","message","POST","name","type","emoji","getSupabaseAdmin","Promise","resolve","then","__webpack_require__","bind","supabaseAdmin","from","insert","user_id","sync_rate","urgency","select","single","PUT","updates","undefined","current","value_v","updateOrganism","updated","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","pathname","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2Forganisms_2Froute_ts_page_2Fapi_2Forganisms_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGb3JnYW5pc21zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZvcmdhbmlzbXMlMkZyb3V0ZSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9yZ2FuaXNtcyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm9zZWhvJTJGRGVza3RvcCUyRmF1dHVzJTJGdmVyY2VsLWFwaSUyRmFwcCZhcHBQYXRocz0lMkZhcGklMkZvcmdhbmlzbXMlMkZyb3V0ZSZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCE_3D_nextConfigOutput_preferredRegion_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap"],"sourceRoot":""}