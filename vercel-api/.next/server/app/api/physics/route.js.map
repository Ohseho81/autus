{"version":3,"file":"app/api/physics/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/api/physics/route.ts","webpack://_N_E/./app/api/physics/route.ts?c3b8","webpack://_N_E/?ff82"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","// ============================================\n// AUTUS Physics API - V Engine\n// V = (M - T) × (1 + s)^t\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/lib/supabase';\nimport { \n  calculateV, \n  calculateVGrowth, \n  applyImpulse, \n  recommendImpulse,\n  summarizeState,\n  ImpulseType \n} from '@/lib/physics';\n\nexport const runtime = 'edge';\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n};\n\nexport async function OPTIONS() {\n  return new NextResponse(null, { status: 200, headers: corsHeaders });\n}\n\n// GET /api/physics?userId=xxx\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userId = searchParams.get('userId');\n\n    if (!userId) {\n      return NextResponse.json(\n        { success: false, error: 'userId is required' },\n        { status: 400, headers: corsHeaders }\n      );\n    }\n\n    // 유기체 목록 조회\n    const organisms = await db.getOrganisms(userId);\n\n    // 각 유기체의 V 계산\n    const withPhysics = organisms.map(org => ({\n      ...org,\n      computed_v: calculateV(org.mint, org.tax, org.synergy),\n      summary: summarizeState({\n        mint: org.mint,\n        tax: org.tax,\n        synergy: org.synergy,\n        entropy: org.entropy,\n        velocity: org.velocity,\n        friction: org.friction\n      }),\n      recommended_impulse: recommendImpulse({\n        mint: org.mint,\n        tax: org.tax,\n        synergy: org.synergy,\n        entropy: org.entropy,\n        velocity: org.velocity,\n        friction: org.friction\n      })\n    }));\n\n    // 전체 통계\n    const totalV = withPhysics.reduce((sum, org) => sum + org.computed_v, 0);\n    const avgSynergy = organisms.length > 0 \n      ? organisms.reduce((sum, org) => sum + org.synergy, 0) / organisms.length \n      : 0;\n    const urgentCount = withPhysics.filter(org => org.summary.status === 'urgent').length;\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        organisms: withPhysics,\n        summary: {\n          total_v: totalV,\n          avg_synergy: avgSynergy,\n          organism_count: organisms.length,\n          urgent_count: urgentCount\n        }\n      }\n    }, { status: 200, headers: corsHeaders });\n\n  } catch (error: any) {\n    console.error('Physics GET Error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n\n// POST /api/physics (Impulse 적용)\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { action, organismId, impulseType, intensity } = body;\n\n    if (action === 'apply_impulse') {\n      if (!organismId || !impulseType) {\n        return NextResponse.json(\n          { success: false, error: 'organismId and impulseType are required' },\n          { status: 400, headers: corsHeaders }\n        );\n      }\n\n      // 현재 상태 조회\n      const organism = await db.getOrganism(organismId);\n      if (!organism) {\n        return NextResponse.json(\n          { success: false, error: 'Organism not found' },\n          { status: 404, headers: corsHeaders }\n        );\n      }\n\n      const currentState = {\n        mint: organism.mint,\n        tax: organism.tax,\n        synergy: organism.synergy,\n        entropy: organism.entropy,\n        velocity: organism.velocity,\n        friction: organism.friction\n      };\n\n      // Impulse 적용\n      const newState = applyImpulse(currentState, impulseType as ImpulseType, intensity || 1.0);\n\n      // V 성장률 계산\n      const vGrowth = calculateVGrowth(\n        { mint: currentState.mint, tax: currentState.tax, synergy: currentState.synergy },\n        { mint: newState.mint, tax: newState.tax, synergy: newState.synergy }\n      );\n\n      // DB 업데이트\n      await db.updateOrganism(organismId, {\n        mint: newState.mint,\n        tax: newState.tax,\n        synergy: newState.synergy,\n        entropy: newState.entropy,\n        velocity: newState.velocity,\n        friction: newState.friction,\n        value_v: calculateV(newState.mint, newState.tax, newState.synergy)\n      });\n\n      return NextResponse.json({\n        success: true,\n        data: {\n          before: currentState,\n          after: newState,\n          v_growth: vGrowth,\n          new_v: calculateV(newState.mint, newState.tax, newState.synergy),\n          summary: summarizeState(newState)\n        }\n      }, { status: 200, headers: corsHeaders });\n    }\n\n    // 단순 V 계산\n    if (action === 'calculate_v') {\n      const { mint, tax, synergy, time } = body;\n      const v = calculateV(mint, tax, synergy, time || 1);\n      return NextResponse.json({\n        success: true,\n        data: { v, formula: `V = (${mint} - ${tax}) × (1 + ${synergy})^${time || 1}` }\n      }, { status: 200, headers: corsHeaders });\n    }\n\n    return NextResponse.json(\n      { success: false, error: 'Unknown action' },\n      { status: 400, headers: corsHeaders }\n    );\n\n  } catch (error: any) {\n    console.error('Physics POST Error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500, headers: corsHeaders }\n    );\n  }\n}\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Users/oseho/Desktop/autus/vercel-api/app/api/physics/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/physics/route\",\n        pathname: \"/api/physics\",\n        filename: \"route\",\n        bundlePath: \"app/api/physics/route\"\n    },\n    resolvedPagePath: \"/Users/oseho/Desktop/autus/vercel-api/app/api/physics/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/physics/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fphysics%2Froute&page=%2Fapi%2Fphysics%2Froute&pagePath=private-next-app-dir%2Fapi%2Fphysics%2Froute.ts&appDir=%2FUsers%2Foseho%2FDesktop%2Fautus%2Fvercel-api%2Fapp&appPaths=%2Fapi%2Fphysics%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/physics/route.ts?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map"],"names":["module","exports","require","runtime","corsHeaders","OPTIONS","NextResponse","status","headers","GET","request","searchParams","URL","url","userId","get","json","success","error","organisms","db","getOrganisms","withPhysics","map","org","computed_v","calculateV","mint","tax","synergy","summary","summarizeState","entropy","velocity","friction","recommended_impulse","recommendImpulse","totalV","reduce","sum","avgSynergy","length","urgentCount","filter","data","total_v","avg_synergy","organism_count","urgent_count","console","message","POST","body","action","organismId","impulseType","intensity","organism","getOrganism","currentState","newState","applyImpulse","vGrowth","calculateVGrowth","updateOrganism","value_v","before","after","v_growth","new_v","time","v","formula","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","pathname","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2Fphysics_2Froute_ts_page_2Fapi_2Fphysics_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGcGh5c2ljcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcGh5c2ljcyUyRnJvdXRlJnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcGh5c2ljcyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm9zZWhvJTJGRGVza3RvcCUyRmF1dHVzJTJGdmVyY2VsLWFwaSUyRmFwcCZhcHBQYXRocz0lMkZhcGklMkZwaHlzaWNzJTJGcm91dGUmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0Qh_nextConfigOutput_preferredRegion_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap"],"sourceRoot":""}