(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[370],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},1082:(e,s,t)=>{"use strict";t.r(s),t.d(s,{ComponentMod:()=>E,default:()=>S});var r={};t.r(r),t.d(r,{GET:()=>f,OPTIONS:()=>h,POST:()=>p,runtime:()=>l});var n={};t.r(n),t.d(n,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>v,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w});var a=t(932),o=t(2561),u=t(4828),c=t(6631),i=t(9985),d=t(8621),_=t(8178);let l="edge",g={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"};async function h(){return new i.xk(null,{status:200,headers:g})}async function f(e){try{let{searchParams:s}=new URL(e.url),t=s.get("taskId"),r=await d.db.getSolutionRanking(t||void 0),n=t?await d.db.getStandard(t):null;return i.xk.json({success:!0,data:{ranking:r,standard:n,criteria:{effectiveness_threshold:.8,usage_count_threshold:50,v_growth_threshold:.15}}},{status:200,headers:g})}catch(e){return console.error("Consensus GET Error:",e),i.xk.json({success:!1,error:e.message},{status:500,headers:g})}}async function p(e){try{let{action:s,payload:t}=await e.json();if("log_usage"===s){let{task_id:e,solution_id:s,user_id:r,before:n,after:a,duration_minutes:o}=t;if(!e||!s||!r||!n||!a)return i.xk.json({success:!1,error:"Missing required fields"},{status:400,headers:g});let u=n.m>0?(a.m-n.m)/n.m:0,c=n.t>0?(n.t-a.t)/n.t:0,l=n.s>0?(a.s-n.s)/n.s:0,h=(0,_.Nl)(u,c,.5,l),f=(0,_.HA)({mint:n.m,tax:n.t,synergy:n.s},{mint:a.m,tax:a.t,synergy:a.s}),p=await d.db.createUsageLog({task_id:e,solution_id:s,user_id:r,before_m:n.m,before_t:n.t,before_s:n.s,after_m:a.m,after_t:a.t,after_s:a.s,effectiveness_score:h,v_growth:f,duration_minutes:o||0});return i.xk.json({success:!0,data:{log:p,effectiveness_score:h,v_growth:f,is_effective:h>=.8}},{status:200,headers:g})}if("check_standard"===s){let{solution_id:e}=t,s=(await d.db.getSolutionRanking()).find(s=>s.solution_id===e);if(!s)return i.xk.json({success:!1,error:"Solution not found in ranking"},{status:404,headers:g});let r=(0,_.pq)(s.avg_score,s.usage_count,s.avg_v_growth);return i.xk.json({success:!0,data:{solution_id:e,current_stats:{effectiveness:s.avg_score,usage_count:s.usage_count,avg_v_growth:s.avg_v_growth},qualifies_for_standard:r,missing:{effectiveness:Math.max(0,.8-s.avg_score),usage:Math.max(0,50-s.usage_count),v_growth:Math.max(0,.15-s.avg_v_growth)}}},{status:200,headers:g})}return i.xk.json({success:!1,error:"Unknown action"},{status:400,headers:g})}catch(e){return console.error("Consensus POST Error:",e),i.xk.json({success:!1,error:e.message},{status:500,headers:g})}}let v=new o.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/consensus/route",pathname:"/api/consensus",filename:"route",bundlePath:"app/api/consensus/route"},resolvedPagePath:"/Users/oseho/Desktop/autus/vercel-api/app/api/consensus/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:k}=v,x="/api/consensus/route";function y(){return(0,c.XH)({serverHooks:k,staticGenerationAsyncStorage:w})}let E=n,S=a.a.wrap(v)}},e=>{var s=s=>e(e.s=s);e.O(0,[546,956,629],()=>s(1082));var t=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/consensus/route"]=t}]);
//# sourceMappingURL=route.js.map