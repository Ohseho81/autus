{
  "name": "KRATON ì¹´ë“œ ë°œì†¡ + í”¼ë“œë°± ë£¨í”„",
  "nodes": [
    {
      "parameters": { "rule": { "interval": [{ "field": "hours", "triggerAtHour": 17 }] } },
      "name": "ë§¤ì¼ ì˜¤í›„ 5ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [240, 300]
    },
    {
      "parameters": { "url": "{{$env.SUPABASE_URL}}/rest/v1/students?state=lt.4&order=v_growth.desc&limit=10" },
      "name": "ì„±ì¥ í•™ìƒ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "position": [460, 300]
    },
    {
      "parameters": { "url": "{{$env.SUPABASE_URL}}/rest/v1/students?state=gte.5&order=state.desc" },
      "name": "ìœ„í—˜ í•™ìƒ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "position": [460, 480]
    },
    {
      "parameters": {
        "jsCode": "const students = $input.all();\nreturn students.map(item => {\n  const s = item.json;\n  const highlights = [];\n  if (s.attendance_streak >= 7) highlights.push(`ğŸ”¥ ${s.attendance_streak}ì¼ ì—°ì† ì¶œì„!`);\n  if (s.score_improvement > 10) highlights.push(`ğŸ“ˆ ì„±ì  ${s.score_improvement}ì  í–¥ìƒ!`);\n  return { json: { card_type: 'growth_highlight', student_id: s.id, student_name: s.name, parent_phone: s.parent_phone, card_data: { highlights: highlights.length > 0 ? highlights : ['ê¾¸ì¤€íˆ ì„±ì¥í•˜ê³  ìˆì–´ìš”! ğŸ’ª'] }, kakao_vars: { student_name: s.name, feedback_url: `https://kraton.app/feedback/${s.id}?type=growth` } } };\n});"
      },
      "name": "ì„±ì¥ ì¹´ë“œ ìƒì„±",
      "type": "n8n-nodes-base.code",
      "position": [680, 300]
    },
    {
      "parameters": { "url": "https://api.solapi.com/messages/v4/send", "method": "POST" },
      "name": "ì•Œë¦¼í†¡ ë°œì†¡",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1120, 380]
    },
    {
      "parameters": { "httpMethod": "POST", "path": "feedback-webhook" },
      "name": "í”¼ë“œë°± Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [240, 700]
    },
    {
      "parameters": { "operation": "insert", "tableId": "feedbacks" },
      "name": "í”¼ë“œë°± ì €ì¥",
      "type": "n8n-nodes-base.supabase",
      "position": [680, 700]
    },
    {
      "parameters": { "url": "{{$env.VERCEL_URL}}/api/ai/learn-feedback", "method": "POST" },
      "name": "AI í•™ìŠµ ë°˜ì˜",
      "type": "n8n-nodes-base.httpRequest",
      "position": [900, 860]
    }
  ]
}
