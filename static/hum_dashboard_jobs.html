<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS OS · HUM Dashboard - Jobs Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root { font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif; color: #e5e7eb; background: #08090b; }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; background: radial-gradient(circle at top, #111827 0%, #020617 55%); }
        .hum-root { max-width: 1200px; margin: 24px auto; min-height: 90vh; border-radius: 24px; background: linear-gradient(145deg, #020617, #020617); border: 1px solid rgba(148,163,184,0.15); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 30px 80px rgba(15,23,42,0.7); }
        .hum-topbar { display: flex; align-items: center; padding: 16px 24px; border-bottom: 1px solid rgba(148,163,184,0.1); background: radial-gradient(circle at top left, rgba(37,99,235,0.18), transparent 55%); }
        .hum-logo { font-size: 13px; letter-spacing: 0.16em; text-transform: uppercase; color: #9ca3af; }
        .hum-spotlight { flex: 1; margin: 0 24px; }
        .hum-spotlight-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.16em; color: #6b7280; display: block; margin-bottom: 4px; }
        .hum-spotlight-input { width: 100%; border-radius: 999px; border: 1px solid rgba(148,163,184,0.5); background: #020617; color: #e5e7eb; padding: 8px 16px; font-size: 13px; outline: none; }
        .hum-spotlight-input:focus { border-color: #60a5fa; box-shadow: 0 0 0 1px rgba(37,99,235,0.5); }
        .hum-meta-mini { text-align: right; font-size: 11px; color: #9ca3af; }
        .hum-meta-id { font-weight: 600; color: #e5e7eb; display: block; }
        .hum-main-layout { flex: 1; display: grid; grid-template-columns: 2fr 1fr; padding: 16px 24px; }
        .hum-main-circle-section { display: flex; flex-direction: column; align-items: center; padding-right: 24px; border-right: 1px solid rgba(148,163,184,0.1); }
        .hum-main-circle { position: relative; width: 420px; height: 320px; display: flex; justify-content: center; align-items: center; }
        .hum-phase-ring { width: 260px; height: 260px; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 18px 45px rgba(15,23,42,0.8); }
        .hum-lime-ring { width: 210px; height: 210px; border-radius: 50%; border: 4px solid var(--lime-color, #22c55e); display: flex; justify-content: center; align-items: center; box-shadow: 0 0 18px rgba(37,99,235,0.35); }
        .hum-core { width: 160px; height: 160px; border-radius: 32px; background: radial-gradient(circle at top, #1f2937, #020617); box-shadow: 0 12px 35px rgba(15,23,42,0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hum-stage-glyph { font-size: 32px; margin-bottom: 6px; }
        .hum-stage-label { font-size: 12px; letter-spacing: 0.18em; text-transform: uppercase; color: #9ca3af; margin-bottom: 6px; }
        .hum-phase-lime-text { font-size: 11px; color: #6b7280; }
        .hum-sixd-ring { position: absolute; top: 50%; left: 50%; }
        .hum-sixd-badge { position: absolute; padding: 4px 8px; border-radius: 999px; background: rgba(15,23,42,0.96); border: 1px solid rgba(148,163,184,0.3); font-size: 10px; display: flex; gap: 4px; white-space: nowrap; }
        .hum-sixd-key { text-transform: uppercase; letter-spacing: 0.16em; color: #9ca3af; }
        .hum-sixd-value { color: #e5e7eb; }
        .hum-sixd-panel { width: 100%; max-width: 460px; margin-top: 16px; padding: 12px 14px; border-radius: 16px; border: 1px solid rgba(55,65,81,0.85); background: #020617; }
        .hum-panel-title { font-size: 11px; letter-spacing: 0.18em; text-transform: uppercase; color: #6b7280; margin-bottom: 8px; }
        .hum-sixd-row { display: grid; grid-template-columns: 40px 1fr 28px; align-items: center; gap: 6px; font-size: 11px; margin-bottom: 4px; }
        .hum-sixd-row-label { color: #9ca3af; }
        .hum-sixd-row-bar { height: 6px; border-radius: 999px; background: #020617; border: 1px solid rgba(55,65,81,0.9); overflow: hidden; }
        .hum-sixd-row-fill { height: 100%; border-radius: 999px; background: linear-gradient(90deg, #22c55e, #2563eb); transition: width 0.25s; }
        .hum-sixd-row-value { text-align: right; color: #9ca3af; }
        .hum-timeline-section { padding-left: 24px; display: flex; flex-direction: column; }
        .hum-timeline-title { font-size: 11px; letter-spacing: 0.18em; text-transform: uppercase; color: #6b7280; margin-bottom: 8px; }
        .hum-timeline-rail { flex: 1; border-radius: 16px; border: 1px solid rgba(31,41,55,0.9); padding: 12px; background: #020617; overflow-y: auto; max-height: 400px; }
        .hum-timeline-node { display: grid; grid-template-columns: 16px 1fr auto; gap: 8px; align-items: center; padding: 5px 2px; }
        .hum-timeline-dot { width: 8px; height: 8px; border-radius: 50%; border: 1px solid #4b5563; }
        .hum-timeline-dot.completed { background: #22c55e; border-color: #22c55e; }
        .hum-timeline-dot.active { background: #2563eb; border-color: #60a5fa; box-shadow: 0 0 10px rgba(37,99,235,0.9); }
        .hum-timeline-label { font-size: 11px; color: #e5e7eb; }
        .hum-timeline-code { font-size: 10px; color: #6b7280; }
        .hum-timeline-current-tag { font-size: 9px; padding: 2px 6px; border-radius: 999px; border: 1px solid rgba(37,99,235,0.8); color: #93c5fd; }
        .hum-actionbar { height: 64px; border-top: 1px solid rgba(148,163,184,0.12); padding: 8px 18px; display: flex; align-items: center; justify-content: space-between; background: radial-gradient(circle at bottom, rgba(15,23,42,0.9), #020617); }
        .hum-meta-name { font-size: 13px; color: #e5e7eb; display: block; }
        .hum-meta-track { font-size: 10px; color: #6b7280; letter-spacing: 0.12em; text-transform: uppercase; }
        .hum-actionbar-right { display: flex; gap: 8px; }
        .hum-action-button { border-radius: 999px; border: 1px solid rgba(55,65,81,0.9); background: #020617; color: #e5e7eb; padding: 6px 14px; font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer; transition: all 0.2s; }
        .hum-action-button:hover { border-color: #60a5fa; transform: translateY(-1px); box-shadow: 0 12px 25px rgba(15,23,42,0.9); }
        .hum-success-badge { padding: 6px 14px; border-radius: 999px; font-size: 12px; font-weight: 600; }
        .hum-success-low { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid rgba(239,68,68,0.5); }
        .hum-success-mid { background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid rgba(251,191,36,0.5); }
        .hum-success-high { background: rgba(34,197,94,0.2); color: #22c55e; border: 1px solid rgba(34,197,94,0.5); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const API_BASE = window.location.origin;

        const initialHum = {
            meta: { humId: "PH027", name: "Maria Santos", countryFrom: "PH", countryTo: "KR", track: "HEALTHCARE_ASSISTANT" },
            status: { stage: "PLACEMENT", phasePercent: 71, limeScore: 29, sixD: { DIR: 0.33, FOR: 0.40, GAP: 0.71, UNC: 0.60, TEM: 0.50, INT: 0.27 } },
            timeline: [
                { id: "ev1", code: "HUM:Registered", status: "COMPLETED", label: "HUM Created" },
                { id: "ev2", code: "EDU:Enrolled", status: "COMPLETED", label: "Training Enrolled" },
                { id: "ev3", code: "EDU:Completed", status: "COMPLETED", label: "Training Completed" },
                { id: "ev4", code: "EMP:Matched", status: "ACTIVE", label: "Employment Matched" },
                { id: "ev5", code: "GOV:VisaApproved", status: "PLANNED", label: "Visa Approved" },
                { id: "ev6", code: "EMP:Started", status: "PLANNED", label: "Employment Started" },
                { id: "ev7", code: "SOC:CommunityJoined", status: "PLANNED", label: "Community Joined" },
                { id: "ev8", code: "Settlement", status: "PLANNED", label: "Settlement Complete" },
            ],
            successProb: 19.1
        };

        const stageGlyphs = { DISCOVERY: "●", SELECTION: "◎", TRAINING: "▤", PLACEMENT: "➝", SETTLEMENT: "◉" };
        const sixDLabels = ["DIR", "FOR", "GAP", "UNC", "TEM", "INT"];

        function getLimeColor(lime) {
            if (lime >= 35) return "#22c55e";
            if (lime >= 20) return "#fbbf24";
            if (lime >= 10) return "#f97316";
            return "#ef4444";
        }

        function HumDashboard() {
            const [hum, setHum] = useState(initialHum);
            const [loading, setLoading] = useState(false);

            const limeColor = useMemo(() => getLimeColor(hum.status.limeScore), [hum.status.limeScore]);

            const applyEvent = async (eventCode, source, delta) => {
                setLoading(true);
                try {
                    const res = await fetch(`${API_BASE}/kernel/lime/v3/event/apply`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            hum_id: hum.meta.humId,
                            source: source,
                            event_code: eventCode,
                            event_delta: delta,
                            days_since_last: 7,
                            external_context: { economic_index: 0.65, policy_stability: 0.8 }
                        })
                    });
                    const data = await res.json();
                    
                    if (data.vectors) {
                        const newSixD = {};
                        sixDLabels.forEach(k => { newSixD[k] = data.vectors.after[k] || hum.status.sixD[k]; });
                        
                        const newTimeline = hum.timeline.map(ev => 
                            ev.code === eventCode ? { ...ev, status: "COMPLETED" } : ev
                        );
                        const activeIdx = newTimeline.findIndex(ev => ev.status === "PLANNED");
                        if (activeIdx >= 0) newTimeline[activeIdx].status = "ACTIVE";

                        setHum(prev => ({
                            ...prev,
                            status: { ...prev.status, sixD: newSixD, limeScore: Math.min(prev.status.limeScore + 5, 100), phasePercent: Math.min(prev.status.phasePercent + 5, 100) },
                            timeline: newTimeline,
                            successProb: data.analysis?.success_probability || prev.successProb
                        }));
                    }
                } catch (e) { console.error(e); }
                setLoading(false);
            };

            const eventActions = [
                { code: "EDU:Completed", source: "EDU", delta: { DIR: 0.15, GAP: -0.20, UNC: -0.15, INT: 0.10 }, label: "TRAINING" },
                { code: "GOV:VisaApproved", source: "GOV", delta: { DIR: 0.20, UNC: -0.25, FOR: 0.15 }, label: "VISA" },
                { code: "EMP:Started", source: "EMP", delta: { DIR: 0.15, FOR: 0.20, INT: 0.15 }, label: "EMPLOYMENT" },
                { code: "SOC:CommunityJoined", source: "SOC", delta: { INT: 0.25, GAP: -0.15 }, label: "COMMUNITY" },
            ];

            const successClass = hum.successProb >= 50 ? 'high' : hum.successProb >= 25 ? 'mid' : 'low';

            return (
                <div className="hum-root">
                    <header className="hum-topbar">
                        <div className="hum-logo">AUTUS OS · HUM</div>
                        <div className="hum-spotlight">
                            <span className="hum-spotlight-label">HUM Spotlight</span>
                            <input className="hum-spotlight-input" placeholder="Search HUM ID" defaultValue={hum.meta.humId} />
                        </div>
                        <div className="hum-meta-mini">
                            <span className="hum-meta-id">{hum.meta.name}</span>
                            <span>{hum.meta.countryFrom} → {hum.meta.countryTo}</span>
                        </div>
                    </header>

                    <main className="hum-main-layout">
                        <section className="hum-main-circle-section">
                            <div className="hum-main-circle">
                                <div className="hum-phase-ring" style={{ background: `radial-gradient(circle at center, #020617 64%, transparent 64%), conic-gradient(#2563eb ${hum.status.phasePercent}%, rgba(31,41,55,0.85) ${hum.status.phasePercent}%)` }}>
                                    <div className="hum-lime-ring" style={{ '--lime-color': limeColor }}>
                                        <div className="hum-core">
                                            <div className="hum-stage-glyph">{stageGlyphs[hum.status.stage] || "●"}</div>
                                            <div className="hum-stage-label">{hum.status.stage}</div>
                                            <div className="hum-phase-lime-text">Phase {hum.status.phasePercent}% · LIME {hum.status.limeScore}</div>
                                        </div>
                                    </div>
                                </div>
                                <div className="hum-sixd-ring">
                                    {sixDLabels.map((key, i) => {
                                        const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;
                                        const r = 160;
                                        const x = Math.cos(angle) * r;
                                        const y = Math.sin(angle) * r;
                                        const val = hum.status.sixD[key] || 0;
                                        return (
                                            <div key={key} className="hum-sixd-badge" style={{ transform: `translate(${x - 30}px, ${y - 12}px)` }}>
                                                <span className="hum-sixd-key">{key}</span>
                                                <span className="hum-sixd-value">{(val * 100).toFixed(0)}%</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="hum-sixd-panel">
                                <div className="hum-panel-title">6D Vector (Lime Kernel v3)</div>
                                {sixDLabels.map(key => {
                                    const val = hum.status.sixD[key] || 0;
                                    return (
                                        <div key={key} className="hum-sixd-row">
                                            <span className="hum-sixd-row-label">{key}</span>
                                            <div className="hum-sixd-row-bar">
                                                <div className="hum-sixd-row-fill" style={{ width: `${val * 100}%` }} />
                                            </div>
                                            <span className="hum-sixd-row-value">{(val * 100).toFixed(0)}%</span>
                                        </div>
                                    );
                                })}
                            </div>
                        </section>

                        <aside className="hum-timeline-section">
                            <div className="hum-timeline-title">Timeline</div>
                            <div className="hum-timeline-rail">
                                {hum.timeline.map(ev => (
                                    <div key={ev.id} className="hum-timeline-node">
                                        <div className={`hum-timeline-dot ${ev.status.toLowerCase()}`} />
                                        <div>
                                            <div className="hum-timeline-label">{ev.label}</div>
                                            <div className="hum-timeline-code">{ev.code}</div>
                                        </div>
                                        {ev.status === "ACTIVE" && <div className="hum-timeline-current-tag">NOW</div>}
                                    </div>
                                ))}
                            </div>
                        </aside>
                    </main>

                    <footer className="hum-actionbar">
                        <div>
                            <span className="hum-meta-name">{hum.meta.name}</span>
                            <span className="hum-meta-track">{hum.meta.track}</span>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                            <div className={`hum-success-badge hum-success-${successClass}`}>
                                Success: {hum.successProb.toFixed(1)}%
                            </div>
                            <div className="hum-actionbar-right">
                                {eventActions.map(ev => (
                                    <button key={ev.code} className="hum-action-button" onClick={() => applyEvent(ev.code, ev.source, ev.delta)} disabled={loading}>
                                        {ev.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<HumDashboard />);
    </script>
</body>
</html>
