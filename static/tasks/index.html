<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LimePass OS - Task Engine Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-label {
            color: #999;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .task-meta {
            font-size: 12px;
            color: #999;
        }
        
        .task-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-ready {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-blocked {
            background: #f8d7da;
            color: #721c24;
        }
        
        .domain-row {
            display: grid;
            grid-template-columns: 200px 1fr 100px 100px;
            gap: 20px;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .domain-row:last-child {
            border-bottom: none;
        }
        
        .domain-name {
            font-weight: bold;
            color: #333;
        }
        
        .domain-stats {
            font-size: 12px;
            color: #999;
        }
        
        #graph-container {
            background: #f9f9f9;
            border-radius: 5px;
            overflow: auto;
            height: 500px;
        }
        
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
            cursor: pointer;
        }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        
        .node-label {
            font-size: 10px;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .domain-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ LimePass OS - Task Engine Dashboard</h1>
            <p class="subtitle">Real-time task management and progress tracking</p>
        </header>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-label">Total Tasks</div>
                <div class="metric-value" id="total-tasks">17</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Completed</div>
                <div class="metric-value" id="completed-tasks">13</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Ready To Start</div>
                <div class="metric-value" id="ready-tasks">4</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Overall Progress</div>
                <div class="metric-value" id="overall-progress">76.5%</div>
            </div>
        </div>
        
        <div class="section">
            <h2>ðŸ“Š Domain Progress</h2>
            <div id="domains-container">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <div class="section">
            <h2>ðŸš€ Ready To Start</h2>
            <div id="ready-container">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <div class="section">
            <h2>ðŸ“‹ Task Dependency Graph</h2>
            <div id="graph-container">
                <!-- D3 graph will be rendered here -->
            </div>
        </div>
        
        <div class="section">
            <h2>ðŸ”„ Progress Timeline</h2>
            <div id="timeline-container">
                <!-- Timeline will be rendered here -->
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api/v1/tasks';
        
        async function loadDashboard() {
            try {
                // Load summary
                const summary = await fetch(`${API_BASE}/`).then(r => r.json());
                updateMetrics(summary.overall_progress);
                
                // Load domains
                const domains = await fetch(`${API_BASE}/domains`).then(r => r.json());
                renderDomains(domains);
                
                // Load ready tasks
                const ready = await fetch(`${API_BASE}/ready`).then(r => r.json());
                renderReadyTasks(ready.tasks);
                
                // Load dependency graph
                const graph = await fetch(`${API_BASE}/dag`).then(r => r.json());
                renderDependencyGraph(graph);
                
                // Load progress report
                const progress = await fetch(`${API_BASE}/progress`).then(r => r.json());
                renderTimeline(progress.execution_timeline);
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }
        
        function updateMetrics(progress) {
            document.getElementById('total-tasks').textContent = progress.total;
            document.getElementById('completed-tasks').textContent = progress.completed;
            document.getElementById('ready-tasks').textContent = progress.ready;
            document.getElementById('overall-progress').textContent = progress.progress + '%';
        }
        
        function renderDomains(domains) {
            const container = document.getElementById('domains-container');
            container.innerHTML = '';
            
            Object.entries(domains).forEach(([key, domain]) => {
                const row = document.createElement('div');
                row.className = 'domain-row';
                row.innerHTML = `
                    <div class="domain-name">${domain.name}</div>
                    <div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${domain.progress}%"></div>
                        </div>
                        <div class="domain-stats">
                            ${domain.completed}/${domain.total} â€¢ ${domain.progress}%
                        </div>
                    </div>
                `;
                container.appendChild(row);
            });
        }
        
        function renderReadyTasks(tasks) {
            const container = document.getElementById('ready-container');
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = '<p style="color: #999;">No tasks ready to start</p>';
                return;
            }
            
            tasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'task-item';
                item.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">ID: ${task.id} â€¢ Priority: ${task.priority} â€¢ ~${task.estimated_hours}h</div>
                    </div>
                    <div class="task-status status-ready">Ready</div>
                `;
                container.appendChild(item);
            });
        }
        
        function renderDependencyGraph(data) {
            const container = document.getElementById('graph-container');
            container.innerHTML = '';
            
            const width = container.clientWidth;
            const height = 500;
            
            const svg = d3.select('#graph-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const simulation = d3.forceSimulation(data.nodes)
                .force('link', d3.forceLink(data.links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2));
            
            const link = svg.append('g')
                .selectAll('line')
                .data(data.links)
                .enter()
                .append('line')
                .attr('class', 'link')
                .attr('stroke-width', 2);
            
            const node = svg.append('g')
                .selectAll('circle')
                .data(data.nodes)
                .enter()
                .append('circle')
                .attr('class', 'node')
                .attr('r', 6)
                .attr('fill', d => {
                    if (d.status === 'completed') return '#28a745';
                    if (d.status === 'ready') return '#007bff';
                    if (d.status === 'in_progress') return '#ffc107';
                    return '#dc3545';
                })
                .call(d3.drag()
                    .on('start', dragStarted)
                    .on('drag', dragged)
                    .on('end', dragEnded));
            
            node.append('title')
                .text(d => d.label);
            
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
            });
            
            function dragStarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragEnded(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }
        
        function renderTimeline(events) {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';
            
            if (events.length === 0) {
                container.innerHTML = '<p style="color: #999;">No events yet</p>';
                return;
            }
            
            events.forEach(event => {
                const item = document.createElement('div');
                item.className = 'task-item';
                item.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${event.task_id}</div>
                        <div class="task-meta">${new Date(event.timestamp).toLocaleString()} â€¢ ${event.action}</div>
                    </div>
                    <div class="task-status status-${event.status}">${event.status}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Load dashboard on page load
        window.addEventListener('load', loadDashboard);
        
        // Refresh every 30 seconds
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>
