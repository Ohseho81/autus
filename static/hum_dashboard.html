<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS OS - HUM Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); }
    </style>
</head>
<body class="min-h-screen text-white p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex items-center gap-3 mb-8">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-2xl">üåê</div>
            <div>
                <h1 class="text-2xl font-bold">AUTUS OS</h1>
                <p class="text-sm text-slate-400">Human Dashboard v1.1 - Elon Edition</p>
            </div>
        </header>

        <!-- Input Section -->
        <div class="bg-slate-800/50 rounded-2xl p-6 mb-6 border border-slate-700">
            <div class="flex flex-wrap gap-4 items-end">
                <div>
                    <label class="text-sm text-slate-400 block mb-2">HUM ID</label>
                    <input id="humId" type="text" placeholder="PH001" class="px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white w-32">
                </div>
                <div>
                    <label class="text-sm text-slate-400 block mb-2">Name</label>
                    <input id="humName" type="text" placeholder="Maria Santos" class="px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white w-44">
                </div>
                <button onclick="createHum()" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg font-medium">‚ûï Create</button>
                <button onclick="loadStatus()" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium">üîÑ Load</button>
                <span id="message" class="text-yellow-400 text-sm"></span>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Profile Card -->
            <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-3xl">üë§</div>
                    <div>
                        <h2 id="profileName" class="text-xl font-bold">-</h2>
                        <p id="profileInfo" class="text-sm text-slate-400">-</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-slate-900/50 rounded-xl text-center">
                        <div id="profilePhase" class="text-2xl font-bold text-indigo-400">-</div>
                        <div class="text-xs text-slate-500">Phase</div>
                    </div>
                    <div class="p-4 bg-slate-900/50 rounded-xl text-center">
                        <div id="profileSuccess" class="text-2xl font-bold text-emerald-400">-</div>
                        <div class="text-xs text-slate-500">Success</div>
                    </div>
                </div>
                <!-- Gauges -->
                <div class="flex justify-around">
                    <div class="text-center">
                        <div class="relative w-24 h-24">
                            <svg class="w-24 h-24 transform -rotate-90">
                                <circle cx="48" cy="48" r="40" fill="none" stroke="#1e293b" stroke-width="8"/>
                                <circle id="riskGauge" cx="48" cy="48" r="40" fill="none" stroke="#10b981" stroke-width="8" stroke-dasharray="251" stroke-dashoffset="125" stroke-linecap="round"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="riskValue" class="text-xl font-bold">-</span>
                            </div>
                        </div>
                        <span class="text-sm text-slate-400">Safety</span>
                    </div>
                    <div class="text-center">
                        <div class="relative w-24 h-24">
                            <svg class="w-24 h-24 transform -rotate-90">
                                <circle cx="48" cy="48" r="40" fill="none" stroke="#1e293b" stroke-width="8"/>
                                <circle id="successGauge" cx="48" cy="48" r="40" fill="none" stroke="#6366f1" stroke-width="8" stroke-dasharray="251" stroke-dashoffset="125" stroke-linecap="round"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="successValue" class="text-xl font-bold">-</span>
                            </div>
                        </div>
                        <span class="text-sm text-slate-400">Success</span>
                    </div>
                </div>
            </div>

            <!-- 6D Vector -->
            <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
                <h3 class="text-sm font-medium text-slate-400 mb-4">üõ°Ô∏è 6D Vector</h3>
                <svg id="radar" width="240" height="240" class="mx-auto"></svg>
                <!-- Phase Progress -->
                <div class="mt-4">
                    <div class="flex justify-between text-xs text-slate-500 mb-1">
                        <span>LIME</span><span>EDU</span><span>EMP</span><span>GOV</span><span>CITY</span>
                    </div>
                    <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
                        <div id="phaseBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                    <div id="phaseText" class="text-center text-sm text-slate-400 mt-2">-</div>
                </div>
            </div>

            <!-- Timeline & Events -->
            <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
                <h3 class="text-sm font-medium text-slate-400 mb-4">‚ö° Timeline</h3>
                <div id="timeline" class="space-y-2 max-h-40 overflow-y-auto mb-6">
                    <div class="text-slate-500 text-sm">No events yet</div>
                </div>
                <h4 class="text-sm font-medium text-slate-400 mb-3">Send Event</h4>
                <div id="eventButtons" class="flex flex-wrap gap-2"></div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="bg-slate-800/50 rounded-2xl p-12 border border-slate-700 text-center">
            <div class="text-6xl mb-4">üë§</div>
            <p class="text-slate-400">Enter HUM ID and click Load, or Create a new HUM</p>
        </div>
    </div>

    <script>
        const API = 'https://railway-up-detach-production.up.railway.app';
        const events = ['HUM.DOC.APPROVED','HUM.DOC.REJECTED','HUM.MEDICAL.PASSED','HUM.SCHOOL.ASSIGNED','HUM.TRAINING.COMPLETED','HUM.VISA.APPROVED','HUM.VISA.REJECTED','HUM.EMPLOYMENT.MATCHED','HUM.EMPLOYMENT.STARTED','HUM.SETTLEMENT.COMPLETE'];
        
        // Initialize event buttons
        const btnContainer = document.getElementById('eventButtons');
        events.forEach(e => {
            const btn = document.createElement('button');
            btn.innerText = e.split('.').slice(1).join('.');
            btn.className = `px-3 py-1 rounded text-xs font-medium text-white ${e.includes('APPROVED')||e.includes('COMPLETED')||e.includes('PASSED')||e.includes('STARTED')||e.includes('MATCHED')?'bg-emerald-600 hover:bg-emerald-500':e.includes('REJECTED')?'bg-red-600 hover:bg-red-500':'bg-indigo-600 hover:bg-indigo-500'}`;
            btn.onclick = () => sendEvent(e);
            btnContainer.appendChild(btn);
        });

        async function createHum() {
            const id = document.getElementById('humId').value;
            const name = document.getElementById('humName').value;
            if (!id || !name) { showMsg('Enter ID and Name'); return; }
            try {
                const res = await fetch(`${API}/hum/create`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({hum_id: id, name: name})
                });
                const data = await res.json();
                if (res.ok) { showMsg('Created!'); loadStatus(); }
                else showMsg(data.detail || 'Error');
            } catch(e) { showMsg('Network error'); }
        }

        async function loadStatus() {
            const id = document.getElementById('humId').value;
            if (!id) { showMsg('Enter HUM ID'); return; }
            try {
                const res = await fetch(`${API}/hum/status/${id}`);
                if (res.ok) { updateDashboard(await res.json()); showMsg(''); }
                else showMsg('HUM not found');
            } catch(e) { showMsg('Network error'); }
        }

        async function sendEvent(code) {
            const id = document.getElementById('humId').value;
            try {
                await fetch(`${API}/hum/event`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({hum_id: id, event_code: code})
                });
                showMsg('Sent: ' + code);
                loadStatus();
            } catch(e) { showMsg('Error'); }
        }

        function updateDashboard(data) {
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            
            // Profile
            document.getElementById('profileName').innerText = data.hum.name;
            document.getElementById('profileInfo').innerText = `${data.hum.hum_id} ¬∑ ${data.hum.route_code}`;
            document.getElementById('profilePhase').innerText = data.hum.phase;
            document.getElementById('profileSuccess').innerText = Math.round(data.hum.success * 100) + '%';
            
            // Gauges
            const safety = 1 - data.gauges.risk;
            const success = data.gauges.success;
            document.getElementById('riskGauge').style.strokeDashoffset = 251 - (safety * 251);
            document.getElementById('successGauge').style.strokeDashoffset = 251 - (success * 251);
            document.getElementById('riskValue').innerText = Math.round(safety * 100) + '%';
            document.getElementById('successValue').innerText = Math.round(success * 100) + '%';
            
            // Phase Progress
            const percent = data.phase_progress?.percent || 0;
            document.getElementById('phaseBar').style.width = percent + '%';
            document.getElementById('phaseText').innerText = `${data.phase_progress?.current} - ${percent}% complete`;
            
            // Radar
            drawRadar(data.radar);
            
            // Timeline
            const timeline = document.getElementById('timeline');
            if (data.timeline?.steps?.length > 0) {
                timeline.innerHTML = data.timeline.steps.map(s => `
                    <div class="flex justify-between items-center p-2 bg-slate-900/50 rounded text-sm">
                        <span class="text-slate-300">${s.event.split('.').slice(1).join('.')}</span>
                        <span class="text-emerald-400">${Math.round(s.success*100)}%</span>
                    </div>
                `).join('');
            } else {
                timeline.innerHTML = '<div class="text-slate-500 text-sm">No events yet</div>';
            }
        }

        function drawRadar(data) {
            const svg = document.getElementById('radar');
            const size = 240, center = 120, radius = 90;
            const labels = data.labels, values = data.values;
            
            const getPoint = (i, v) => {
                const angle = (Math.PI * 2 * i) / 6 - Math.PI / 2;
                return { x: center + radius * v * Math.cos(angle), y: center + radius * v * Math.sin(angle) };
            };
            
            let html = '';
            // Grid
            [0.25,0.5,0.75,1].forEach(level => {
                const pts = [0,1,2,3,4,5].map(i => { const p = getPoint(i, level); return `${p.x},${p.y}`; }).join(' ');
                html += `<polygon points="${pts}" fill="none" stroke="#334155" stroke-width="1" opacity="0.5"/>`;
            });
            // Axes
            [0,1,2,3,4,5].forEach(i => {
                const p = getPoint(i, 1);
                html += `<line x1="${center}" y1="${center}" x2="${p.x}" y2="${p.y}" stroke="#475569" stroke-width="1"/>`;
            });
            // Data
            const dataPts = values.map((v, i) => { const p = getPoint(i, v); return `${p.x},${p.y}`; }).join(' ');
            html += `<polygon points="${dataPts}" fill="rgba(99,102,241,0.3)" stroke="#6366f1" stroke-width="2"/>`;
            // Points
            values.forEach((v, i) => {
                const p = getPoint(i, v);
                html += `<circle cx="${p.x}" cy="${p.y}" r="5" fill="#6366f1"/>`;
            });
            // Labels
            labels.forEach((label, i) => {
                const p = getPoint(i, 1.2);
                html += `<text x="${p.x}" y="${p.y}" text-anchor="middle" dominant-baseline="middle" fill="#94a3b8" font-size="12">${label}</text>`;
            });
            svg.innerHTML = html;
        }

        function showMsg(msg) { document.getElementById('message').innerText = msg; }
    </script>
</body>
</html>
