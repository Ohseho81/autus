# ğŸ“Š í•„ë“œ ë§¤í•‘ ë¶„ì„

> ê¸°ì¡´ ë°ì´í„° í•„ë“œ vs Universal Schema ë§¤ì¹­

---

## ğŸ“‹ ì…ë ¥ ë°›ì€ í•„ë“œ ì •ë¦¬

### 1ï¸âƒ£ í•™ìƒ/íšŒì› ì •ë³´
| í•„ë“œ | ì„¤ëª… |
|------|------|
| ì´ë¦„ | í•™ìƒëª… |
| ì—°ë½ì²˜ | í•™ìƒ/í•™ë¶€ëª¨ ì „í™” |
| í•™ë¶€ëª¨ì´ë¦„ | ë³´í˜¸ìëª… |
| í•™êµ | ì†Œì† í•™êµ |
| ì—°ìƒ | ìƒë…„ |
| í•™ë…„ | í˜„ì¬ í•™ë…„ |
| ì…”í‹€ìœ ë¬´ | ì…”í‹€ ì´ìš© ì—¬ë¶€ |
| ìˆ˜ì—…ëª… | ë“±ë¡ ìˆ˜ì—… |
| ìˆ˜ì—…ì¼ì‹œ | ìˆ˜ì—… ìŠ¤ì¼€ì¤„ |
| ì£¼ ìˆ˜ì—… íšŸìˆ˜ | ì£¼ê°„ ìˆ˜ì—… ìˆ˜ |
| ìœ ë‹ˆí¼ | ìœ ë‹ˆí¼ ì§€ê¸‰ ì—¬ë¶€ |
| ë°±ë„˜ë²„ | ë°°ì •ëœ ë“±ë²ˆí˜¸ |
| ìˆ˜ë‚©í˜„í™© | ê²°ì œ ìƒíƒœ |
| ë¯¸ìˆ˜ê¸ˆ | ë¯¸ë‚© ê¸ˆì•¡ |
| ê°œì¸ì¼ë³„ë§¤ì¶œ | ì¼ì¼ ë§¤ì¶œ (ì¶œì„ ê¸°ì¤€) |
| ë¶„ê¸°/íšŸìˆ˜ | ì´ìš©ê¶Œ ê¸°ê°„/íšŸìˆ˜ |
| ì¶œì„ë¥  | ì¶œì„ ë¹„ìœ¨ |

### 2ï¸âƒ£ íšŒì›ê¶Œ ì •ë³´
| í•„ë“œ | ì„¤ëª… |
|------|------|
| íšŒì›ëª… | í•™ìƒëª… |
| ì—°ë½ì²˜ | ì „í™”ë²ˆí˜¸ |
| ìˆ˜ì—…ëª… | ë“±ë¡ ìˆ˜ì—… |
| íšŒì›ê¶Œ | ì´ìš©ê¶Œ ì¢…ë¥˜ |
| ë‹´ë‹¹ê°•ì‚¬ | ë‹´ë‹¹ ì½”ì¹˜ |
| ì´ìš©ì‹œì‘ì¼ | ì‹œì‘ì¼ |
| ì´ìš©ì¢…ë£Œì¼ | ì¢…ë£Œì¼ |
| ê¸°ê°„/íšŸìˆ˜ | ê¸°ê°„ì œ/íšŸìˆ˜ì œ |
| ê°•ìŠµë£Œ | ìˆ˜ì—…ë£Œ |
| ìƒë…„ì›”ì¼ | ìƒë…„ì›”ì¼ |
| í•™êµ | ì†Œì† í•™êµ |
| ë¯¸ìˆ˜ê¸ˆ | ë¯¸ë‚© ê¸ˆì•¡ |
| ì…”í‹€ | ì…”í‹€ ì´ìš© |

### 3ï¸âƒ£ íŒë§¤ ì •ë³´
| í•„ë“œ | ì„¤ëª… |
|------|------|
| íŒë§¤ì¼ì‹œ | ê±°ë˜ ì‹œê°„ |
| íšŒì›ëª… | êµ¬ë§¤ì |
| íŒë§¤ì | íŒë§¤ ë‹´ë‹¹ì |
| íŒë§¤ë‚´ì—­ | ìƒí’ˆëª… |
| ìˆ˜ëŸ‰ | êµ¬ë§¤ ìˆ˜ëŸ‰ |
| í•©ê³„ê¸ˆì•¡ | ì´ì•¡ |
| í• ì¸ê¸ˆì•¡ | í• ì¸ì•¡ |
| ê²°ì œê¸ˆì•¡ | ì‹¤ê²°ì œì•¡ |
| í˜„ê¸ˆ | í˜„ê¸ˆ ê²°ì œ |
| ì¹´ë“œ | ì¹´ë“œ ê²°ì œ |
| ê³„ì¢Œì´ì²´ | ì´ì²´ ê²°ì œ |
| ë¯¸ìˆ˜ê¸ˆ | ë¯¸ë‚©ì•¡ |
| íŒë§¤ë©”ëª¨ | ë©”ëª¨ |
| ë“±ë¡ì¼ì‹œ | ìƒì„±ì¼ |
| ë“±ë¡ì | ìƒì„±ì |
| ìˆ˜ì •ì¼ì‹œ | ìˆ˜ì •ì¼ |
| ìˆ˜ì •ì | ìˆ˜ì •ì |
| ë¹„ëŒ€ë©´ | ë¹„ëŒ€ë©´ ê²°ì œ |
| ì œë¡œí˜ì´ | ì œë¡œí˜ì´ ê²°ì œ |

---

## ğŸ”„ Universal Schema ë§¤í•‘

### âœ… ì´ë¯¸ êµ¬í˜„ë¨ (entities í…Œì´ë¸”)

| ê¸°ì¡´ í•„ë“œ | â†’ | Schema | ì €ì¥ ìœ„ì¹˜ |
|-----------|---|--------|----------|
| ì´ë¦„ | â†’ | `name` | entities.name |
| ì—°ë½ì²˜ | â†’ | `phone` | entities.phone |
| í•™ë¶€ëª¨ì´ë¦„ | â†’ | `name` | entities (type='parent') + relationships |
| í•™êµ | â†’ | `school` | **metadata** (key='school') |
| ì—°ìƒ/ìƒë…„ì›”ì¼ | â†’ | `birth_date` | **metadata** (key='birth_date') |
| í•™ë…„ | â†’ | `grade` | **metadata** (key='grade') |
| ì…”í‹€ìœ ë¬´ | â†’ | `shuttle` | **metadata** (key='shuttle') |
| ë‹´ë‹¹ê°•ì‚¬ | â†’ | relationship | relationships (coach_of) |

### âœ… ì´ë¯¸ êµ¬í˜„ë¨ (services í…Œì´ë¸”)

| ê¸°ì¡´ í•„ë“œ | â†’ | Schema | ì €ì¥ ìœ„ì¹˜ |
|-----------|---|--------|----------|
| ìˆ˜ì—…ëª… | â†’ | `name` | services.name |
| ê°•ìŠµë£Œ | â†’ | `price` | services.price |
| ê¸°ê°„/íšŸìˆ˜ | â†’ | `duration_type`, `duration_value` | services |
| íšŒì›ê¶Œ | â†’ | `type` | services.type |

### âœ… ì´ë¯¸ êµ¬í˜„ë¨ (events í…Œì´ë¸”)

| ê¸°ì¡´ í•„ë“œ | â†’ | Schema | ì €ì¥ ìœ„ì¹˜ |
|-----------|---|--------|----------|
| ìˆ˜ì—…ì¼ì‹œ | â†’ | `event_at` | events.event_at |
| ì¶œì„ë¥  | â†’ | **ê³„ì‚°** | eventsì—ì„œ ì§‘ê³„ |
| ê°œì¸ì¼ë³„ë§¤ì¶œ | â†’ | **ê³„ì‚°** | eventsì—ì„œ ì§‘ê³„ |

### âœ… ì´ë¯¸ êµ¬í˜„ë¨ (atb_payments í…Œì´ë¸”)

| ê¸°ì¡´ í•„ë“œ | â†’ | Schema | ì €ì¥ ìœ„ì¹˜ |
|-----------|---|--------|----------|
| íŒë§¤ì¼ì‹œ | â†’ | `created_at` | atb_payments |
| ê²°ì œê¸ˆì•¡ | â†’ | `amount` | atb_payments |
| ë¯¸ìˆ˜ê¸ˆ | â†’ | `outstanding` | atb_payments |
| ì¹´ë“œ | â†’ | `method` | atb_payments.method |

---

## âŒ ì¶”ê°€ í•„ìš” (metadataë¡œ í™•ì¥)

### ğŸ€ ë†êµ¬ ì•„ì¹´ë°ë¯¸ ì „ìš© í•„ë“œ

| í•„ë“œ | ì €ì¥ ë°©ë²• | ìš°ì„ ìˆœìœ„ |
|------|----------|----------|
| **ìœ ë‹ˆí¼** | metadata (key='uniform_issued', value=true/false) | ğŸŸ¡ ì¤‘ |
| **ë°±ë„˜ë²„** | metadata (key='back_number', value='23') | ğŸŸ¡ ì¤‘ |
| **ì£¼ ìˆ˜ì—… íšŸìˆ˜** | metadata (key='weekly_sessions', value=3) | ğŸŸ¢ ì € |

### ğŸ’³ ê²°ì œ ìƒì„¸ í•„ë“œ

| í•„ë“œ | ì €ì¥ ë°©ë²• | ìš°ì„ ìˆœìœ„ |
|------|----------|----------|
| **í˜„ê¸ˆ** | atb_payments.metadata (key='cash_amount') | ğŸ”´ ê³  |
| **ì¹´ë“œ** | atb_payments.metadata (key='card_amount') | ğŸ”´ ê³  |
| **ê³„ì¢Œì´ì²´** | atb_payments.metadata (key='transfer_amount') | ğŸ”´ ê³  |
| **ë¹„ëŒ€ë©´** | atb_payments.metadata (key='non_face') | ğŸŸ¡ ì¤‘ |
| **ì œë¡œí˜ì´** | atb_payments.method = 'zeropay' | ğŸŸ¡ ì¤‘ |
| **í• ì¸ê¸ˆì•¡** | atb_payments.discount | ğŸ”´ ê³  |

### ğŸ“ ê´€ë¦¬ í•„ë“œ

| í•„ë“œ | ì €ì¥ ë°©ë²• | ìš°ì„ ìˆœìœ„ |
|------|----------|----------|
| **íŒë§¤ì** | atb_payments.seller_id (FK â†’ entities) | ğŸŸ¡ ì¤‘ |
| **íŒë§¤ë‚´ì—­** | atb_payments.description | ğŸŸ¡ ì¤‘ |
| **ìˆ˜ëŸ‰** | atb_payments.quantity | ğŸŸ¡ ì¤‘ |
| **íŒë§¤ë©”ëª¨** | atb_payments.memo | ğŸŸ¢ ì € |
| **ë“±ë¡ì/ìˆ˜ì •ì** | atb_payments.created_by, updated_by | ğŸŸ¢ ì € |

---

## ğŸ—‘ï¸ ì‚­ì œ ê°€ëŠ¥ (ì¤‘ë³µ/ë¶ˆí•„ìš”)

| í•„ë“œ | ì´ìœ  |
|------|------|
| íšŒì›ëª… (ì¤‘ë³µ) | entities.nameìœ¼ë¡œ í†µí•© |
| ì—°ë½ì²˜ (ì¤‘ë³µ) | entities.phoneìœ¼ë¡œ í†µí•© |
| í•™êµ (ì¤‘ë³µ) | metadataë¡œ í†µí•© |
| ë¯¸ìˆ˜ê¸ˆ (ì¤‘ë³µ) | atb_paymentsì—ì„œ ê³„ì‚° |
| ë¶„ê¸°/íšŸìˆ˜ (ì¤‘ë³µ) | services.duration_type/valueë¡œ í†µí•© |

---

## ğŸ“ ìµœì¢… ìŠ¤í‚¤ë§ˆ ìˆ˜ì •ì•ˆ

### 1. atb_payments í…Œì´ë¸” í™•ì¥

```sql
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS discount INTEGER DEFAULT 0;
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS quantity INTEGER DEFAULT 1;
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS description TEXT;
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS memo TEXT;
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS seller_id UUID REFERENCES entities(id);
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS created_by UUID REFERENCES entities(id);
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS updated_by UUID REFERENCES entities(id);
ALTER TABLE atb_payments ADD COLUMN IF NOT EXISTS payment_details JSONB DEFAULT '{}';
-- payment_details: {"cash": 50000, "card": 100000, "transfer": 0, "zeropay": 0}
```

### 2. ë†êµ¬ ì „ìš© metadata í‚¤ í‘œì¤€í™”

```sql
-- í•™ìƒ metadata í‘œì¤€ í‚¤
INSERT INTO metadata (target_type, target_id, key, value, source) VALUES
('entity', :student_id, 'birth_date', '"2015-03-15"', 'manual'),
('entity', :student_id, 'grade', '"3"', 'manual'),
('entity', :student_id, 'school', '"ëŒ€ì¹˜ì´ˆë“±í•™êµ"', 'manual'),
('entity', :student_id, 'shuttle', 'true', 'manual'),
('entity', :student_id, 'uniform_issued', 'true', 'manual'),
('entity', :student_id, 'back_number', '"23"', 'manual'),
('entity', :student_id, 'weekly_sessions', '3', 'manual');
```

---

## âœ… êµ¬í˜„ ê°€ëŠ¥í•œ ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸

### ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥ (í˜„ì¬ ìŠ¤í‚¤ë§ˆë¡œ)

| # | ê¸°ëŠ¥ | ë°ì´í„° ì†ŒìŠ¤ |
|---|------|------------|
| 1 | í•™ìƒ ëª©ë¡ ì¡°íšŒ | entities (type='student') |
| 2 | í•™ë¶€ëª¨ ì—°ë½ì²˜ ì¡°íšŒ | entities + relationships |
| 3 | ìˆ˜ì—… ìŠ¤ì¼€ì¤„ ì¡°íšŒ | atb_lesson_sessions |
| 4 | ì¶œì„ ê¸°ë¡ ì¡°íšŒ | events (event_type='attendance') |
| 5 | ì¶œì„ë¥  ê³„ì‚° | events ì§‘ê³„ |
| 6 | ê²°ì œ ë‚´ì—­ ì¡°íšŒ | atb_payments |
| 7 | ë¯¸ìˆ˜ê¸ˆ í˜„í™© | atb_payments (outstanding > 0) |
| 8 | ë‹´ë‹¹ ì½”ì¹˜ ì¡°íšŒ | relationships (coach_of) |
| 9 | ìˆ˜ì—…ë³„ í•™ìƒ ëª©ë¡ | entities + services ì—°ê²° |
| 10 | ë³´ì¶©ê¶Œ í˜„í™© | atb_makeup_credits |

### í™•ì¥ í›„ êµ¬í˜„ ê°€ëŠ¥ (metadata ì¶”ê°€ ì‹œ)

| # | ê¸°ëŠ¥ | í•„ìš” metadata |
|---|------|--------------|
| 11 | í•™êµë³„ í•™ìƒ í†µê³„ | school |
| 12 | í•™ë…„ë³„ í•™ìƒ ë¶„í¬ | grade |
| 13 | ì…”í‹€ ì´ìš©ì ëª©ë¡ | shuttle |
| 14 | ìœ ë‹ˆí¼ ë¯¸ì§€ê¸‰ì | uniform_issued |
| 15 | ë“±ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ | back_number |
| 16 | ìƒì¼ì ì•Œë¦¼ | birth_date |

### ê²°ì œ í™•ì¥ í›„ êµ¬í˜„ ê°€ëŠ¥ (payment_details ì¶”ê°€ ì‹œ)

| # | ê¸°ëŠ¥ | í•„ìš” í•„ë“œ |
|---|------|----------|
| 17 | ê²°ì œ ìˆ˜ë‹¨ë³„ ë§¤ì¶œ | payment_details |
| 18 | í• ì¸ í†µê³„ | discount |
| 19 | íŒë§¤ìë³„ ì‹¤ì  | seller_id |
| 20 | ìƒí’ˆë³„ íŒë§¤ í˜„í™© | description, quantity |

---

## ğŸ“Š ë§¤í•‘ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í•„ë“œ ë§¤í•‘ í˜„í™©                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   âœ… ì´ë¯¸ êµ¬í˜„ë¨          18ê°œ                                  â”‚
â”‚   ğŸ”´ ì¶”ê°€ í•„ìš” (ê³ )        4ê°œ   (ê²°ì œ ìƒì„¸)                     â”‚
â”‚   ğŸŸ¡ ì¶”ê°€ í•„ìš” (ì¤‘)        6ê°œ   (ë†êµ¬ ì „ìš© + íŒë§¤ ê´€ë¦¬)         â”‚
â”‚   ğŸŸ¢ ì¶”ê°€ í•„ìš” (ì €)        4ê°œ   (ë©”ëª¨, ë“±ë¡ì ë“±)               â”‚
â”‚   ğŸ—‘ï¸ ì‚­ì œ ê°€ëŠ¥            5ê°œ   (ì¤‘ë³µ í•„ë“œ)                     â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   ì´ í•„ë“œ: 37ê°œ â†’ ìŠ¤í‚¤ë§ˆ í•„ìš”: 32ê°œ (14ê°œ ì¶”ê°€)                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ê¶Œì¥ ì‹¤í–‰ ìˆœì„œ

1. **ì¦‰ì‹œ**: `atb_payments` í…Œì´ë¸” í™•ì¥ (discount, payment_details)
2. **Phase 1**: ë†êµ¬ ì „ìš© metadata í‚¤ í‘œì¤€í™”
3. **Phase 2**: íŒë§¤ ê´€ë¦¬ í•„ë“œ (seller_id, quantity)
4. **ì„ íƒ**: ê´€ë¦¬ í•„ë“œ (ë“±ë¡ì/ìˆ˜ì •ì)

---

*Updated: 2026-02-04*
