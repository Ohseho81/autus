# ğŸ¤ ìŒì„± ì¹­ì°¬ ê°ì§€ ì‹œìŠ¤í…œ - Blueprint

> "ì½”ì¹˜ì˜ ë™ì„ (Log) ìì²´ê°€ ê³§ ë°ì´í„°ê°€ ë˜ì–´ì•¼ í•œë‹¤"

## ê°œìš”

ì½”ì¹˜ê°€ ìˆ˜ì—… ì¤‘ "ë‚˜ì´ìŠ¤!", "êµ¿!" ë“±ì˜ ì¹­ì°¬ì„ ì™¸ì¹˜ë©´, í•´ë‹¹ ìˆœê°„ ì „í›„ 15ì´ˆë¥¼ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ì—¬ í•™ë¶€ëª¨ì—ê²Œ ì „ì†¡ë˜ëŠ” í•˜ì´ë¼ì´íŠ¸ ì˜ìƒìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

---

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ì½”ì¹˜ ì•± (ì˜¨ë¦¬ìŒ¤)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   ë§ˆì´í¬      â”‚â”€â”€â”€â”€â–¶â”‚   STT ì—”ì§„    â”‚â”€â”€â”€â”€â–¶â”‚  í‚¤ì›Œë“œ ë§¤ì¹­   â”‚       â”‚
â”‚   â”‚   (ìƒì‹œ ON)   â”‚     â”‚  (Web Speech) â”‚     â”‚  (ì‹¤ì‹œê°„)     â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                        â”‚               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚               â”‚
â”‚   â”‚   ì¹´ë©”ë¼      â”‚â”€â”€â”€â”€â–¶â”‚  ë²„í¼ ì €ì¥    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚   â”‚   (ìƒì‹œ ë…¹í™”) â”‚     â”‚  (30ì´ˆ ë¡¤ë§)  â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚  í‚¤ì›Œë“œ ê°ì§€ ì‹œ   â”‚                               â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                               â”‚
â”‚                    â”‚  â”‚ ì „ 10ì´ˆ     â”‚  â”‚                               â”‚
â”‚                    â”‚  â”‚ + í›„ 5ì´ˆ    â”‚  â”‚                               â”‚
â”‚                    â”‚  â”‚ = 15ì´ˆ í´ë¦½ â”‚  â”‚                               â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                              â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Supabase Edge Functions                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  ì˜ìƒ ì—…ë¡œë“œ  â”‚â”€â”€â”€â”€â–¶â”‚  API.video    â”‚â”€â”€â”€â”€â–¶â”‚  CDN URL ìƒì„± â”‚        â”‚
â”‚   â”‚               â”‚     â”‚  (ì¸ì½”ë”©)     â”‚     â”‚               â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                        â”‚                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    highlight_clips í…Œì´ë¸”          â”‚            â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”‚ id | session_id | student_id | trigger_keyword | video_url â”‚ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                â”‚
â”‚   â”‚ ìˆ˜ì—… ì¢…ë£Œ ì‹œ  â”‚â”€â”€â”€â”€â–¶â”‚ í•™ë¶€ëª¨ ì•Œë¦¼í†¡ â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚   â”‚ ìë™ ë°œì†¡     â”‚     â”‚ + ì˜ìƒ ë§í¬   â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ êµ¬ì¡° (í˜„ì¬)

| í•­ëª© | ìƒíƒœ | ì„¤ëª… |
|------|------|------|
| DB í…Œì´ë¸” | âœ… | `highlight_clips`, `voice_trigger_keywords` |
| Edge Function | âœ… | `session-complete-report` (í•˜ì´ë¼ì´íŠ¸ ì—°ë™ ì¤€ë¹„) |
| í‚¤ì›Œë“œ ëª©ë¡ | âœ… | 10ê°œ ê¸°ë³¸ í‚¤ì›Œë“œ (ë‚˜ì´ìŠ¤, êµ¿, ì˜í–ˆì–´ ë“±) |

### Phase 2: ì•± êµ¬í˜„ (ë‹¤ìŒ ë‹¨ê³„)

```typescript
// VoiceCaptureService.ts (ì˜ˆì‹œ)
import Voice from '@react-native-voice/voice';

class VoiceCaptureService {
  private keywords: string[] = ['ë‚˜ì´ìŠ¤', 'êµ¿', 'ì˜í–ˆì–´', 'ìµœê³ '];
  private videoBuffer: VideoBuffer; // 30ì´ˆ ë¡¤ë§ ë²„í¼
  
  async startListening() {
    Voice.onSpeechResults = (event) => {
      const transcript = event.value?.[0] || '';
      this.checkKeywords(transcript);
    };
    await Voice.start('ko-KR');
  }
  
  private checkKeywords(transcript: string) {
    for (const keyword of this.keywords) {
      if (transcript.includes(keyword)) {
        this.captureHighlight(keyword);
        break;
      }
    }
  }
  
  private async captureHighlight(keyword: string) {
    // ë²„í¼ì—ì„œ ì „ 10ì´ˆ + í›„ 5ì´ˆ ì¶”ì¶œ
    const clip = await this.videoBuffer.extractClip(-10, 5);
    
    // Supabaseì— ì—…ë¡œë“œ
    await supabase.functions.invoke('upload-highlight', {
      body: {
        sessionId: currentSessionId,
        studentId: nearestStudentId, // AIë¡œ ê°€ì¥ ê°€ê¹Œìš´ í•™ìƒ ì¶”ë¡ 
        triggerKeyword: keyword,
        videoBlob: clip,
      }
    });
  }
}
```

### Phase 3: AI í–¥ìƒ (ë¯¸ë˜)

1. **í•™ìƒ ìë™ ë§¤ì¹­**: ì˜ìƒì—ì„œ í•™ìƒ ì–¼êµ´ ì¸ì‹ â†’ í•´ë‹¹ í•™ìƒì—ê²Œ í´ë¦½ ì—°ê²°
2. **ìµœì  êµ¬ê°„ ì¶”ì¶œ**: AIê°€ ê°€ì¥ í•˜ì´ë¼ì´íŠ¸ ê°€ì¹˜ê°€ ë†’ì€ êµ¬ê°„ ìë™ ì„ íƒ
3. **ìë™ í¸ì§‘**: ë°°ê²½ìŒì•… + ìŠ¬ë¡œëª¨ì…˜ + ìë§‰ ìë™ ì¶”ê°€

---

## í‚¤ì›Œë“œ ì„¤ì •

Supabaseì˜ `voice_trigger_keywords` í…Œì´ë¸”ì—ì„œ ê´€ë¦¬:

| í‚¤ì›Œë“œ | ì¹´í…Œê³ ë¦¬ | ì „ ë²„í¼ | í›„ ë²„í¼ |
|--------|----------|---------|---------|
| ë‚˜ì´ìŠ¤ | praise | 10ì´ˆ | 5ì´ˆ |
| êµ¿ | praise | 10ì´ˆ | 5ì´ˆ |
| ì˜í–ˆì–´ | praise | 10ì´ˆ | 5ì´ˆ |
| ìµœê³  | praise | 10ì´ˆ | 5ì´ˆ |
| ì™„ë²½ | praise | 10ì´ˆ | 5ì´ˆ |
| ìŠ› | action | 5ì´ˆ | 10ì´ˆ |
| ê³¨ | action | 5ì´ˆ | 10ì´ˆ |
| 3ì  | action | 3ì´ˆ | 12ì´ˆ |

---

## API ëª…ì„¸

### í•˜ì´ë¼ì´íŠ¸ ì—…ë¡œë“œ

```typescript
POST /functions/v1/upload-highlight
{
  "sessionId": "uuid",
  "studentId": "uuid", // optional
  "triggerKeyword": "ë‚˜ì´ìŠ¤",
  "triggerTimestamp": "2026-02-06T15:30:00Z",
  "videoBlob": "base64...",
  "durationSeconds": 15
}

Response:
{
  "success": true,
  "clipId": "uuid",
  "videoUrl": "https://cdn.api.video/..."
}
```

### í‚¤ì›Œë“œ ì¡°íšŒ

```typescript
GET /rest/v1/voice_trigger_keywords?org_id=eq.{org_id}&is_active=eq.true
```

---

## ë¹„ìš© ì¶”ì •

| ì„œë¹„ìŠ¤ | ë‹¨ê°€ | ì›”ê°„ ì˜ˆìƒ |
|--------|------|-----------|
| api.video | $0.008/ë¶„ | ~$50 (1,000ê°œ í´ë¦½ Ã— 0.25ë¶„) |
| Supabase Storage | $0.025/GB | ~$5 |
| STT (Web Speech) | ë¬´ë£Œ | $0 |
| **í•©ê³„** | | **~$55/ì›”** |

---

## ë‹¤ìŒ ì•¡ì…˜

1. [ ] `@react-native-voice/voice` íŒ¨í‚¤ì§€ ì„¤ì¹˜
2. [ ] `VoiceCaptureService.ts` êµ¬í˜„
3. [ ] `upload-highlight` Edge Function êµ¬í˜„
4. [ ] api.video ê³„ì • ìƒì„± ë° ì—°ë™
5. [ ] ì½”ì¹˜ì•±ì— "ìˆ˜ì—… ë…¹í™”" ëª¨ë“œ ì¶”ê°€

---

*"ì´¬ì˜ì„ ìœ„í•œ ìˆ˜ì—… ì¤‘ë‹¨ ì œë¡œí™”" - ì…ë ¥ì˜ ì œë¡œí™”*
