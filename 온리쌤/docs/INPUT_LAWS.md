# 📜 AUTUS 입력 법칙 (Input Laws)

> **"Zero Admin Input"** - 관리자 입력을 5% 이하로 최소화한다

---

## 🏛️ 6대 입력 법칙

### 법칙 1: 연동 우선 법칙 (Integration First)
> "직접 입력 전에, 연동 가능한 소스를 먼저 찾는다"

```
입력 필요 → 연동 가능? → YES → 자동 수집
                ↓ NO
          학부모 입력 가능? → YES → 셀프 서비스
                ↓ NO
          AI 추론 가능? → YES → 자동 산출
                ↓ NO
          관리자 입력 (최후 수단)
```

### 법칙 2: 원천 수집 법칙 (Source Collection)
> "데이터가 생성되는 원천에서 바로 수집한다"

| 데이터 | 원천 | 수집 방법 |
|--------|------|----------|
| 결제 | 토스페이먼츠 | Webhook |
| 알림 발송 | 솔라피/카카오 | Webhook |
| 출석 | QR/NFC/비콘 | 자동 스캔 |
| 학교 정보 | 카카오 가입 시 | OAuth Profile |
| 보험 가입 | 보험사 API | 자동 조회 |
| 주소 | 카카오 주소 API | 자동완성 |

### 법칙 3: 1회 입력 법칙 (Single Entry)
> "같은 정보는 절대 두 번 입력하지 않는다"

```
학부모가 카카오 로그인 → 이름, 전화번호, 이메일 자동 수집
                    ↓
              자녀 등록 시 "학부모 정보" 입력 불필요
```

### 법칙 4: 이벤트 기반 법칙 (Event-Driven)
> "입력 요청은 적절한 이벤트 타이밍에 한다"

| 이벤트 | 수집할 데이터 | 채널 |
|--------|-------------|------|
| **최초 등록** | 사진, 의료정보, 긴급연락처 | 카카오 폼 |
| **첫 결제 완료** | 사진 동의, 보험 동의 | 카카오 버튼 |
| **첫 출석** | 셔틀 신청, 사물함 신청 | 카카오 버튼 |
| **매월 1일** | 다음달 셔틀 확인 | 카카오 버튼 |
| **수업 전날** | 출석 예정 확인 | 카카오 버튼 |
| **수업 종료 후** | 만족도 (5초 설문) | 카카오 버튼 |
| **3개월마다** | 키/몸무게 업데이트 | 카카오 폼 |
| **학기 시작** | 학교/학년 변경 확인 | 카카오 폼 |

### 법칙 5: 추론 우선 법칙 (Inference First)
> "입력받지 않아도 알 수 있는 건 추론한다"

| 데이터 | 추론 방법 |
|--------|----------|
| 나이/학년 | 생년월일 → 자동 계산 |
| 수강 기간 | 첫 결제일 ~ 현재 |
| 출석률 | 출석 이벤트 집계 |
| 결제율 | 결제 이벤트 집계 |
| V-Index | AI 복합 산출 |
| 이탈 위험 | AI 예측 |
| 형제 관계 | 동일 학부모 ID 매칭 |
| 추천인 | 추천 코드 추적 |

### 법칙 6: 버튼 우선 법칙 (Button First)
> "학부모 입력은 버튼 클릭이 우선, 텍스트는 최후 수단"

```
입력 필요 → 버튼으로 해결? → YES → 버튼 제공
                ↓ NO
          선택지 제공 가능? → YES → 다중 선택 버튼
                ↓ NO
          짧은 텍스트? → YES → 한 줄 입력
                ↓ NO
          긴 텍스트 (최후 수단)
```

#### 버튼 유형별 사용

| 유형 | 용도 | 예시 |
|------|------|------|
| **예/아니오** | 이진 선택 | 셔틀 신청, 참석 여부 |
| **다중 선택** | 1개 선택 | 결석 사유, 만족도 |
| **복수 선택** | N개 선택 | 알레르기 종류, 관심 프로그램 |
| **숫자 버튼** | 수량/점수 | 만족도 1~5, 희망 횟수 |
| **날짜 선택** | 일정 | 상담 예약일 |
| **시간 선택** | 시간대 | 상담 희망 시간 |

#### 입력 복잡도 피라미드

```
                    ▲
                   /│\
                  / │ \
                 /  │  \  긴 텍스트 (서술형)
                /   │   \  → 상담 요청 내용
               /────┼────\
              /     │     \  짧은 텍스트 (1줄)
             /      │      \  → 학교명, 특이사항
            /───────┼───────\
           /        │        \  선택형 버튼 (N개)
          /         │         \  → 알레르기, 요일 선택
         /──────────┼──────────\
        /           │           \  단일 버튼 (예/아니오)
       /            │            \  → 셔틀, 동의, 참석
      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━
            ⬆️ 우선순위 높음 (마찰 최소)
```

#### 버튼 우선 적용 예시

| 데이터 | ❌ 텍스트 | ✅ 버튼 |
|--------|----------|--------|
| 셔틀 신청 | "셔틀 이용하실 건가요?" (텍스트) | `[신청]` `[안함]` |
| 결석 사유 | "결석 사유를 입력해주세요" | `[개인사정]` `[학교일정]` `[건강]` `[기타]` |
| 만족도 | "만족도를 1~5로 입력해주세요" | `[😡]` `[😕]` `[😐]` `[🙂]` `[😄]` |
| 알레르기 | "알레르기가 있으면 입력해주세요" | `[없음]` `[유제품]` `[견과류]` `[해산물]` `[기타]` |
| 상담 예약 | "원하시는 날짜를 입력해주세요" | 📅 날짜 선택 캘린더 |
| 희망 수업 횟수 | "주 몇 회 수업을 원하시나요?" | `[주1회]` `[주2회]` `[주3회]` `[주4회+]` |

#### 텍스트 입력이 필요한 경우

버튼으로 해결 불가능한 **예외 케이스만** 텍스트 입력:

| 데이터 | 이유 | 입력 방식 |
|--------|------|----------|
| 학교명 | 수천 개 존재 | 자동완성 검색 |
| 특이사항 | 예측 불가 | 선택 입력 (필수 아님) |
| 상담 내용 | 자유 서술 | 멀티라인 (선택) |
| 기타 사유 | 버튼 외 케이스 | 한 줄 입력 |

---

## 🔌 연동 소스 Tier

### Tier 1: 필수 연동 (Day 1)

| 연동 | 수집 데이터 | 방식 |
|------|-----------|------|
| **토스페이먼츠** | 결제금액, 방법, 카드사, 시간 | Webhook |
| **솔라피 (카카오)** | 발송결과, 읽음 여부 | Webhook |
| **카카오 로그인** | 이름, 전화, 이메일, 프사 | OAuth |
| **QR 코드** | 출석 시간, 위치 | 스캔 |

### Tier 2: 권장 연동 (Month 1)

| 연동 | 수집 데이터 | 방식 |
|------|-----------|------|
| **카카오 주소 API** | 주소 자동완성 | API |
| **카카오 캘린더** | 수업 일정 자동 등록 | API |
| **NFC 태그** | 빠른 출석 체크 | 터치 |
| **카카오 알림톡 응답** | 버튼 클릭, 이미지 전송 | Webhook |

### Tier 3: 고급 연동 (Quarter 1)

| 연동 | 수집 데이터 | 방식 |
|------|-----------|------|
| **학교 알리미** | 학교 정보 검증 | API |
| **보험 API** | 체육보험 가입 여부 | API |
| **날씨 API** | 우천 시 셔틀 알림 | API |
| **BLE 비콘** | 체육관 입장 자동 감지 | 자동 |

---

## 📋 데이터별 수집 법칙 매핑

### 학생 기본 정보

| 필드 | 법칙 | 수집 방식 |
|------|------|----------|
| 이름 | 법칙2 (원천) | 카카오 로그인 → 학부모가 자녀명 입력 |
| 생년월일 | 법칙4 (이벤트) | 최초 등록 시 1회 |
| 학교 | 법칙4 (이벤트) | 최초 등록 + 매년 3월 확인 |
| 학년 | 법칙5 (추론) | 생년월일 → 자동 계산 |
| 전화번호 | 법칙2 (원천) | 학부모 번호 자동 연결 |
| 사진 | 법칙4 (이벤트) | 첫 결제 후 카톡 요청 |

### 수업/출석 정보

| 필드 | 법칙 | 수집 방식 |
|------|------|----------|
| 출석 시간 | 법칙2 (원천) | QR/NFC 스캔 |
| 결석 여부 | 법칙5 (추론) | 출석 이벤트 없음 → 결석 |
| 결석 사유 | 법칙4 (이벤트) | 전날 알림톡 버튼 응답 |
| 지각 여부 | 법칙5 (추론) | 출석시간 > 수업시작 |

### 결제 정보

| 필드 | 법칙 | 수집 방식 |
|------|------|----------|
| 결제 금액 | 법칙2 (원천) | 토스 Webhook |
| 결제 방법 | 법칙2 (원천) | 토스 Webhook |
| 결제 일시 | 법칙2 (원천) | 토스 Webhook |
| 미납 여부 | 법칙5 (추론) | 기한 내 결제 이벤트 없음 |
| 납부 기한 | 법칙5 (추론) | 수강 시작일 기준 자동 설정 |

### 부가 정보

| 필드 | 법칙 | 수집 방식 |
|------|------|----------|
| 셔틀 신청 | 법칙4 (이벤트) | 첫 출석 후 알림톡 버튼 |
| 사물함 번호 | 법칙1 (연동) | 사물함 시스템 연동 or 관리자 |
| 의료 정보 | 법칙4 (이벤트) | 최초 등록 시 폼 링크 |
| 보험 가입 | 법칙1 (연동) | 보험 API 조회 |
| 키/몸무게 | 법칙4 (이벤트) | 분기별 알림톡 폼 |

---

## 📊 입력 비율 목표

```
┌─────────────────────────────────────────────────────┐
│           AUTUS Input Distribution                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ████████████████████████████████  40%  Webhook 자동│
│  ██████████████████████            25%  QR/NFC 자동 │
│  ██████████████                    15%  AI 추론     │
│  ██████████                        15%  학부모 셀프 │
│  ███                                5%  관리자 입력 │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## ✅ 새 필드 추가 시 체크리스트

새로운 데이터 필드를 추가할 때 아래 순서로 검토:

- [ ] **법칙1**: 연동 가능한 외부 소스가 있는가?
- [ ] **법칙2**: 데이터 원천에서 직접 수집 가능한가?
- [ ] **법칙3**: 이미 수집된 데이터에서 파생 가능한가?
- [ ] **법칙4**: 적절한 이벤트 타이밍이 있는가?
- [ ] **법칙5**: AI로 추론 가능한가?
- [ ] **법칙6**: 버튼으로 입력받을 수 있는가?

**⚠️ 모두 NO일 때만 텍스트 입력 허용**

---

## 📱 학부모 입력 채널 (버튼 우선)

### 카카오 알림톡 시나리오

#### 📸 학생 사진 수집
```
[온리쌤] 안녕하세요, {학부모명}님!

{학생명} 학생의 프로필 사진을 등록해주세요.

[사진 보내기]  ← 버튼 클릭 → 갤러리 열림
```

#### 🏥 의료정보 수집 (버튼 우선)
```
[온리쌤] {학생명} 학생의 건강 정보 확인

알레르기가 있나요?

[없음] [유제품] [견과류] [해산물] [기타]
```
→ `[기타]` 선택 시에만 텍스트 입력 요청

#### 🚌 셔틀 신청
```
[온리쌤] 3월 셔틀버스 신청

{학생명} 학생 셔틀버스 이용하시겠습니까?
(대치역 → 학원, 월 5만원)

[신청] [안함]
```

#### 📅 결석 사전신고
```
[온리쌤] 내일 수업 참석 확인

{학생명} 학생이 내일 수업에 참석하나요?

[참석] [결석]
```
→ `[결석]` 선택 시:
```
결석 사유를 선택해주세요

[개인사정] [학교일정] [건강문제] [기타]
```

#### ⭐ 수업 만족도
```
[온리쌤] 오늘 수업은 어떠셨나요?

{학생명} 학생의 수업 만족도를 알려주세요

[😡 1점] [😕 2점] [😐 3점] [🙂 4점] [😄 5점]
```

#### 📆 상담 예약
```
[온리쌤] 상담 예약 안내

코치와 상담을 원하시면 희망 시간을 선택해주세요

[이번 주 토요일 오전] [이번 주 토요일 오후]
[다음 주 토요일 오전] [다음 주 토요일 오후]
[다른 시간 원함]
```

#### 🏀 수업 횟수 희망
```
[온리쌤] 수업 횟수 확인

{학생명} 학생의 희망 수업 횟수는?

[주 1회] [주 2회] [주 3회] [주 4회 이상]
```

### 버튼 → 텍스트 전환 규칙

| 상황 | 처리 |
|------|------|
| 버튼 선택 완료 | 저장 후 감사 메시지 |
| `[기타]` 선택 | "구체적으로 알려주세요" 텍스트 요청 |
| `[다른 시간]` 선택 | "희망 시간을 알려주세요" 텍스트 요청 |
| 버튼 미응답 24시간 | 리마인더 발송 |
| 버튼 미응답 48시간 | 전화 연락 대상 플래그 |

---

## 🗄️ 관련 Supabase 테이블

```sql
-- 알림톡 응답 수집
CREATE TABLE kakao_responses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  message_id VARCHAR(100),
  entity_id UUID REFERENCES entities(id),
  response_type VARCHAR(50),  -- button_click, image, text
  response_value JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 웹폼 제출 기록
CREATE TABLE form_submissions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  form_type VARCHAR(50),  -- health_info, shuttle_request, absence_notice
  entity_id UUID REFERENCES entities(id),
  submitted_by UUID REFERENCES entities(id),
  data JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

*Last Updated: 2026-02-04*
*Version: 1.0*
