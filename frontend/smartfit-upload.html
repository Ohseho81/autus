<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS x ìŠ¤ë§ˆíŠ¸í• ì—°ë™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&display=swap');
        * { font-family: 'Pretendard', sans-serif; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    
    <div class="max-w-2xl mx-auto p-8">
        
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">
                <span class="text-blue-400">AUTUS</span> Ã— 
                <span class="text-green-400">ìŠ¤ë§ˆíŠ¸í•</span>
            </h1>
            <p class="text-gray-400">í•™ì› ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ë©´ AIê°€ í‡´ì› ìœ„í—˜ í•™ìƒì„ ìë™ ê°ì§€í•©ë‹ˆë‹¤</p>
        </div>

        <!-- Upload Section -->
        <div class="bg-gray-800 rounded-2xl p-8 mb-8">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                ğŸ“¤ ë°ì´í„° ì—…ë¡œë“œ
            </h2>
            
            <!-- Academy ID -->
            <div class="mb-6">
                <label class="block text-sm text-gray-400 mb-2">í•™ì› ID</label>
                <input type="text" id="academyId" value="demo-academy" 
                    class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none">
            </div>
            
            <!-- File Upload -->
            <div class="mb-6">
                <label class="block text-sm text-gray-400 mb-2">CSV íŒŒì¼ ì—…ë¡œë“œ</label>
                <div id="dropZone" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" class="hidden">
                    <div class="text-4xl mb-4">ğŸ“</div>
                    <p class="text-gray-400">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                    <p class="text-sm text-gray-500 mt-2">CSV, Excel íŒŒì¼ ì§€ì›</p>
                </div>
                <p id="fileName" class="text-sm text-green-400 mt-2 hidden"></p>
            </div>
            
            <!-- Or Divider -->
            <div class="flex items-center gap-4 my-6">
                <div class="flex-1 h-px bg-gray-700"></div>
                <span class="text-gray-500 text-sm">ë˜ëŠ”</span>
                <div class="flex-1 h-px bg-gray-700"></div>
            </div>
            
            <!-- Text Input -->
            <div class="mb-6">
                <label class="block text-sm text-gray-400 mb-2">CSV í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥</label>
                <textarea id="csvText" rows="8" 
                    placeholder="í•™ìƒì½”ë“œ,í•™ìƒëª…,í•™ë…„,ë°˜,í•™ë¶€ëª¨ëª…,ì—°ë½ì²˜,ë“±ë¡ê¸ˆ,ë¯¸ë‚©ê¸ˆ,ì¶œì„ë¥ 
ST001,ê¹€OO,ì¤‘2,ìˆ˜í•™A,ê¹€ì—„ë§ˆ,010-1234-5678,800000,0,95%
ST002,ì´OO,ê³ 1,ì˜ì–´B,ì´ì•„ë¹ ,010-2345-6789,1000000,200000,75%
ST003,ë°•OO,ì¤‘3,ì „ê³¼ëª©,ë°•ì—„ë§ˆ,010-3456-7890,1500000,450000,55%"
                    class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white text-sm font-mono focus:border-blue-500 focus:outline-none resize-none"></textarea>
            </div>
            
            <!-- Upload Button -->
            <button id="uploadBtn" onclick="uploadData()" 
                class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                <span>ğŸš€</span> ë°ì´í„° ì—…ë¡œë“œ ë° ë¶„ì„
            </button>
        </div>

        <!-- Results Section -->
        <div id="results" class="bg-gray-800 rounded-2xl p-8 hidden">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                ğŸ“Š ë¶„ì„ ê²°ê³¼
            </h2>
            
            <div id="resultContent" class="space-y-4">
                <!-- Results will be inserted here -->
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-6 flex gap-4">
                <a href="/autus-fsd.html" 
                    class="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg text-center transition-colors">
                    ğŸ¯ AUTUS ëŒ€ì‹œë³´ë“œ ì—´ê¸°
                </a>
                <button onclick="resetForm()" 
                    class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-colors">
                    ğŸ”„ ë‹¤ì‹œ ì—…ë¡œë“œ
                </button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-gray-800/50 rounded-2xl p-6 mt-8">
            <h3 class="font-bold mb-4 flex items-center gap-2">
                ğŸ’¡ ìŠ¤ë§ˆíŠ¸í•ì—ì„œ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            </h3>
            <ol class="space-y-3 text-sm text-gray-400">
                <li class="flex items-start gap-3">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs">1</span>
                    ìŠ¤ë§ˆíŠ¸í• ë¡œê·¸ì¸ â†’ <strong class="text-white">í•™ìƒê´€ë¦¬</strong> ë©”ë‰´
                </li>
                <li class="flex items-start gap-3">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs">2</span>
                    <strong class="text-white">ì „ì²´ ì„ íƒ</strong> â†’ ìƒë‹¨ <strong class="text-white">ë‚´ë³´ë‚´ê¸°</strong> ë²„íŠ¼ í´ë¦­
                </li>
                <li class="flex items-start gap-3">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs">3</span>
                    íŒŒì¼ í˜•ì‹: <strong class="text-white">CSV</strong> ë˜ëŠ” <strong class="text-white">Excel</strong> ì„ íƒ
                </li>
                <li class="flex items-start gap-3">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs">4</span>
                    ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì„ ìœ„ì— ì—…ë¡œë“œ!
                </li>
            </ol>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm mt-12">
            <p>AUTUS â€” í™•ì •ëœ ê²°ê³¼ë§Œ íŒë‹¤</p>
            <p class="mt-1">Â© 2024 AUTUS. All rights reserved.</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://vercel-4hp1bz9et-ohsehos-projects.vercel.app/api/erp/smartfit';
        // const API_URL = 'http://localhost:3000/api/erp/smartfit'; // ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©
        
        let selectedFile = null;
        
        // íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-500/10');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-500', 'bg-blue-500/10');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-500/10');
            
            const file = e.dataTransfer.files[0];
            handleFile(file);
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            handleFile(file);
        });
        
        function handleFile(file) {
            if (file && (file.name.endsWith('.csv') || file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                selectedFile = file;
                document.getElementById('fileName').textContent = `âœ… ${file.name} ì„ íƒë¨`;
                document.getElementById('fileName').classList.remove('hidden');
                document.getElementById('csvText').value = ''; // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ˆê¸°í™”
            } else {
                alert('CSV ë˜ëŠ” Excel íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        }
        
        async function uploadData() {
            const academyId = document.getElementById('academyId').value;
            const csvText = document.getElementById('csvText').value;
            const btn = document.getElementById('uploadBtn');
            
            if (!selectedFile && !csvText.trim()) {
                alert('íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ CSV í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin">â³</span> ë¶„ì„ ì¤‘...';
            
            try {
                let response;
                
                if (selectedFile) {
                    // íŒŒì¼ ì—…ë¡œë“œ
                    const formData = new FormData();
                    formData.append('file', selectedFile);
                    
                    response = await fetch(`${API_URL}?academy_id=${academyId}`, {
                        method: 'POST',
                        body: formData,
                    });
                } else {
                    // CSV í…ìŠ¤íŠ¸ ì „ì†¡
                    response = await fetch(`${API_URL}?academy_id=${academyId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ csv_text: csvText }),
                    });
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showResults(result);
                } else {
                    alert('ì˜¤ë¥˜: ' + result.error);
                }
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>ğŸš€</span> ë°ì´í„° ì—…ë¡œë“œ ë° ë¶„ì„';
            }
        }
        
        function showResults(result) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            const { data, alerts } = result;
            
            contentDiv.innerHTML = `
                <!-- Summary Cards -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-white">${data.total}</p>
                        <p class="text-sm text-gray-400">ì´ í•™ìƒ ìˆ˜</p>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <p class="text-3xl font-bold text-green-400">${data.synced}</p>
                        <p class="text-sm text-gray-400">ë™ê¸°í™” ì™„ë£Œ</p>
                    </div>
                </div>
                
                <!-- Risk Breakdown -->
                <div class="bg-gray-700 rounded-lg p-4 mb-4">
                    <h4 class="font-bold mb-3">ìœ„í—˜ë„ ë¶„ì„</h4>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <span class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                                Critical (ì¦‰ì‹œ ì¡°ì¹˜)
                            </span>
                            <span class="text-red-400 font-bold">${data.critical_students}ëª…</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                                High (ì£¼ì˜ í•„ìš”)
                            </span>
                            <span class="text-yellow-400 font-bold">${data.high_risk_students}ëª…</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                                Normal
                            </span>
                            <span class="text-green-400 font-bold">${data.synced - data.critical_students - data.high_risk_students}ëª…</span>
                        </div>
                    </div>
                </div>
                
                ${alerts && alerts.length > 0 ? `
                <div class="bg-red-900/30 border border-red-500/50 rounded-lg p-4">
                    <h4 class="font-bold text-red-400 mb-2">âš ï¸ ì•Œë¦¼</h4>
                    ${alerts.map(a => `<p class="text-sm text-red-300">${a}</p>`).join('')}
                </div>
                ` : ''}
                
                ${data.errors > 0 ? `
                <p class="text-sm text-yellow-400 mt-4">
                    âš ï¸ ${data.errors}ê°œ ë ˆì½”ë“œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ
                </p>
                ` : ''}
            `;
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function resetForm() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').classList.add('hidden');
            document.getElementById('csvText').value = '';
            document.getElementById('results').classList.add('hidden');
        }
    </script>
</body>
</html>
