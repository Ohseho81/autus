<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AUTUS Simulation Dashboard</title>
  <style>
    :root {
      --bg: #0a0a0f;
      --panel: #1a1a2e;
      --border: #333;
      --text: #fff;
      --muted: #888;
      --cyan: #00d4ff;
      --green: #00ff88;
      --yellow: #ffd43b;
      --red: #ff6b6b;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, sans-serif;
      min-height: 100vh;
    }
    
    .header {
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      font-size: 20px;
      font-weight: 800;
      color: var(--cyan);
    }
    
    .header .subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    
    .main {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 0;
      height: calc(100vh - 64px);
    }
    
    .sidebar {
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }
    
    .section {
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: var(--cyan);
      margin-bottom: 12px;
      text-transform: uppercase;
    }
    
    .control-group {
      margin-bottom: 16px;
    }
    
    .control-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
    }
    
    .control-value {
      color: var(--cyan);
      font-weight: 600;
    }
    
    input[type="range"] {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      background: var(--border);
      border-radius: 3px;
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: var(--cyan);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--cyan);
      color: #000;
    }
    
    .btn-primary:hover {
      background: #00b8e6;
    }
    
    .btn-secondary {
      background: var(--border);
      color: var(--text);
      margin-top: 8px;
    }
    
    .scenario-btn {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: transparent;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      margin-bottom: 8px;
      width: 100%;
      text-align: left;
      transition: all 0.2s;
    }
    
    .scenario-btn:hover {
      border-color: var(--cyan);
    }
    
    .scenario-btn.active {
      border-color: var(--cyan);
      background: rgba(0, 212, 255, 0.1);
    }
    
    .content {
      padding: 20px;
      overflow-y: auto;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 800;
    }
    
    .stat-value.green { color: var(--green); }
    .stat-value.yellow { color: var(--yellow); }
    .stat-value.red { color: var(--red); }
    
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .chart-container {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    
    .distribution-bar {
      height: 40px;
      border-radius: 6px;
      overflow: hidden;
      display: flex;
      margin-bottom: 12px;
    }
    
    .distribution-bar .segment {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      transition: width 0.5s ease;
    }
    
    .distribution-bar .green { background: var(--green); color: #000; }
    .distribution-bar .yellow { background: var(--yellow); color: #000; }
    .distribution-bar .red { background: var(--red); color: #000; }
    
    .legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      font-size: 12px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .histogram {
      display: flex;
      align-items: flex-end;
      height: 150px;
      gap: 2px;
      padding: 10px 0;
    }
    
    .histogram-bar {
      flex: 1;
      background: var(--cyan);
      border-radius: 2px 2px 0 0;
      min-width: 8px;
      transition: height 0.3s ease;
    }
    
    .histogram-labels {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      color: var(--muted);
      padding-top: 8px;
    }
    
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .comparison-table th,
    .comparison-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    
    .comparison-table th {
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .comparison-table td {
      font-size: 13px;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
    }
    
    .status-badge.green { background: rgba(0, 255, 136, 0.2); color: var(--green); }
    .status-badge.yellow { background: rgba(255, 212, 59, 0.2); color: var(--yellow); }
    .status-badge.red { background: rgba(255, 107, 107, 0.2); color: var(--red); }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--cyan);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }
      .sidebar {
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

<div class="header">
  <div>
    <h1>AUTUS Simulation Dashboard</h1>
    <div class="subtitle">7 Laws + TIME-MONEY Physics Â· Real-time Parameter Control</div>
  </div>
  <div style="display: flex; gap: 12px; align-items: center;">
    <span id="status-indicator" style="font-size: 12px; color: var(--green);">â— Ready</span>
  </div>
</div>

<div class="main">
  <div class="sidebar">
    <!-- ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ -->
    <div class="section">
      <div class="section-title">ì‹œë‚˜ë¦¬ì˜¤</div>
      <button class="scenario-btn active" data-scenario="BASELINE">
        ğŸŸ¢ BASELINE â€” ì •ìƒ ìš´ì˜
      </button>
      <button class="scenario-btn" data-scenario="GOV_CUT">
        ğŸŸ¡ GOV_CUT â€” ì •ë¶€ ì§€ì› 50% ì¤‘ë‹¨
      </button>
      <button class="scenario-btn" data-scenario="EMPLOYER_EXIT">
        ğŸ”´ EMPLOYER_EXIT â€” ê³ ìš©ì£¼ 20% ì´íƒˆ
      </button>
      <button class="scenario-btn" data-scenario="CRISIS">
        âš« CRISIS â€” ë³µí•© ìœ„ê¸°
      </button>
    </div>
    
    <!-- íŒŒë¼ë¯¸í„° ì¡°ì • -->
    <div class="section">
      <div class="section-title">íŒŒë¼ë¯¸í„°</div>
      
      <div class="control-group">
        <div class="control-label">
          <span>ì¸ì› (N)</span>
          <span class="control-value" id="val-n">1000</span>
        </div>
        <input type="range" id="slider-n" min="100" max="10000" step="100" value="1000">
      </div>
      
      <div class="control-group">
        <div class="control-label">
          <span>ì¶©ê²© í™•ë¥  (%)</span>
          <span class="control-value" id="val-shock">5</span>
        </div>
        <input type="range" id="slider-shock" min="0" max="50" step="1" value="5">
      </div>
      
      <div class="control-group">
        <div class="control-label">
          <span>ì§€ì›ê¸ˆ ì‚­ê° (%)</span>
          <span class="control-value" id="val-cut">0</span>
        </div>
        <input type="range" id="slider-cut" min="0" max="100" step="5" value="0">
      </div>
      
      <div class="control-group">
        <div class="control-label">
          <span>ë¹„ì ë¦¬ìŠ¤í¬ (%)</span>
          <span class="control-value" id="val-visa">15</span>
        </div>
        <input type="range" id="slider-visa" min="5" max="50" step="1" value="15">
      </div>
    </div>
    
    <!-- ì‹¤í–‰ ë²„íŠ¼ -->
    <div class="section">
      <button class="btn btn-primary" id="btn-run">â–¶ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
      <button class="btn btn-secondary" id="btn-compare">ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ</button>
    </div>
    
    <!-- 7 Laws ìƒíƒœ -->
    <div class="section">
      <div class="section-title">7 Laws ìƒíƒœ</div>
      <div id="laws-status" style="font-size: 12px; line-height: 1.8;">
        <div>â‘  Continuity <span style="color: var(--green);">âœ“</span></div>
        <div>â‘¡ Conservation <span style="color: var(--green);">âœ“</span></div>
        <div>â‘¢ State Dominance <span style="color: var(--green);">âœ“</span></div>
        <div>â‘£ Cognitive Min <span style="color: var(--green);">âœ“</span></div>
        <div>â‘¤ Containment <span style="color: var(--green);">âœ“</span></div>
        <div>â‘¥ Responsibility <span style="color: var(--green);">âœ“</span></div>
        <div>â‘¦ Survival Mass <span style="color: var(--green);">âœ“</span></div>
      </div>
    </div>
  </div>
  
  <div class="content">
    <!-- í•µì‹¬ í†µê³„ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value green" id="stat-survival">â€”</div>
        <div class="stat-label">í‰ê·  ìƒì¡´ (ì¼)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-pressure">â€”</div>
        <div class="stat-label">Float Pressure</div>
      </div>
      <div class="stat-card">
        <div class="stat-value yellow" id="stat-atrisk">â€”</div>
        <div class="stat-label">ìœ„í—˜êµ° (%)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value red" id="stat-critical">â€”</div>
        <div class="stat-label">ìœ„ê¸°êµ° (%)</div>
      </div>
    </div>
    
    <!-- ìƒíƒœ ë¶„í¬ ì°¨íŠ¸ -->
    <div class="chart-container">
      <div class="chart-title">ìƒíƒœ ë¶„í¬ (GREEN / YELLOW / RED)</div>
      <div class="distribution-bar" id="distribution-bar">
        <div class="segment green" style="width: 33%;">â€”</div>
        <div class="segment yellow" style="width: 33%;">â€”</div>
        <div class="segment red" style="width: 34%;">â€”</div>
      </div>
      <div class="legend">
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--green);"></div>
          <span>GREEN (ì•ˆì „)</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--yellow);"></div>
          <span>YELLOW (ì£¼ì˜)</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--red);"></div>
          <span>RED (ìœ„í—˜)</span>
        </div>
      </div>
    </div>
    
    <!-- ìƒì¡´ ì‹œê°„ íˆìŠ¤í† ê·¸ë¨ -->
    <div class="chart-container">
      <div class="chart-title">ìƒì¡´ ì‹œê°„ ë¶„í¬</div>
      <div class="histogram" id="histogram">
        <!-- JSë¡œ ë™ì  ìƒì„± -->
      </div>
      <div class="histogram-labels">
        <span>0ì¼</span>
        <span>90ì¼</span>
        <span>180ì¼</span>
        <span>270ì¼</span>
        <span>365ì¼+</span>
      </div>
    </div>
    
    <!-- ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ í…Œì´ë¸” -->
    <div class="chart-container" id="comparison-section" style="display: none;">
      <div class="chart-title">ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ</div>
      <table class="comparison-table">
        <thead>
          <tr>
            <th>ì‹œë‚˜ë¦¬ì˜¤</th>
            <th>ìƒíƒœ</th>
            <th>í‰ê·  ìƒì¡´</th>
            <th>Float P.</th>
            <th>ìœ„í—˜êµ°</th>
            <th>ìœ„ê¸°êµ°</th>
          </tr>
        </thead>
        <tbody id="comparison-body">
          <!-- JSë¡œ ë™ì  ìƒì„± -->
        </tbody>
      </table>
    </div>
    
    <!-- ë¡œë”© í‘œì‹œ -->
    <div class="loading" id="loading" style="display: none;">
      <div class="loading-spinner"></div>
      <div>ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ì¤‘...</div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTUS Simulation Engine (Browser Version)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const T_MIN = 180;

// ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë³¸ê°’
const SCENARIOS = {
  BASELINE: { shock_prob: 0.05, support_cut: 0 },
  GOV_CUT: { shock_prob: 0.05, support_cut: 0.5 },
  EMPLOYER_EXIT: { shock_prob: 0.20, support_cut: 0 },
  CRISIS: { shock_prob: 0.30, support_cut: 0.3 }
};

// í•™ìƒ ìƒì„±
function generateStudents(n, params) {
  const students = [];
  
  for (let i = 0; i < n; i++) {
    const tuition = (200 + Math.random() * 100) * 10000;
    const wage = (150 + Math.random() * 150) * 10000;
    const grant = Math.random() > 0.5 ? (30 + Math.random() * 70) * 10000 : 0;
    const living_cost = (80 + Math.random() * 70) * 10000;
    const visa_risk = 0.05 + Math.random() * (params.visa_risk / 100);
    const academic_risk = 0.05 + Math.random() * 0.15;
    
    students.push({
      tuition, wage, grant, living_cost, visa_risk, academic_risk,
      events: []
    });
  }
  
  return students;
}

// ì‹œë‚˜ë¦¬ì˜¤ ì ìš©
function applyScenario(students, params) {
  for (const student of students) {
    // ì¶©ê²© ì´ë²¤íŠ¸
    if (Math.random() < params.shock_prob) {
      student.wage = 0;
      student.events.push('EMPLOYER_EXIT');
    }
    
    // ì§€ì›ê¸ˆ ì‚­ê°
    if (params.support_cut > 0) {
      student.grant = student.grant * (1 - params.support_cut);
    }
  }
  
  return students;
}

// ë¬¼ë¦¬ê°’ ê³„ì‚°
function calculatePhysics(student) {
  const friction = Math.max(student.visa_risk, student.academic_risk);
  
  // ì›”ê°„ ìˆ˜ì…/ì§€ì¶œ
  const monthly_income = student.wage + student.grant;
  const monthly_expense = (student.tuition / 6) + student.living_cost;
  const effective_income = monthly_income * (1 - friction);
  
  // ìˆœ ì›”ê°„ íë¦„
  const net_monthly = effective_income - monthly_expense;
  const initial_savings = monthly_income * 2;
  
  // ìƒì¡´ ì‹œê°„
  let survival_days;
  if (net_monthly >= 0) {
    survival_days = Math.min(365, 180 + net_monthly / 10000);
  } else {
    const daily_deficit = Math.abs(net_monthly) / 30;
    survival_days = daily_deficit > 0 ? Math.max(0, initial_savings / daily_deficit) : 365;
  }
  
  // Float Pressure
  const float_pressure = effective_income > 0 
    ? monthly_expense / effective_income 
    : (monthly_expense > 0 ? Infinity : 0);
  
  // ìƒíƒœ
  let state;
  if (survival_days < T_MIN * 0.5 || float_pressure > 1.0) {
    state = 'RED';
  } else if (survival_days < T_MIN || float_pressure > 0.7) {
    state = 'YELLOW';
  } else {
    state = 'GREEN';
  }
  
  return { survival_days, float_pressure, state };
}

// ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
function runSimulation(params) {
  let students = generateStudents(params.n, params);
  students = applyScenario(students, params);
  
  // ë¬¼ë¦¬ê°’ ê³„ì‚°
  const results = students.map(s => {
    const physics = calculatePhysics(s);
    return { ...s, ...physics };
  });
  
  // í†µê³„ ê³„ì‚°
  const survival_days = results.map(r => r.survival_days);
  const float_pressures = results.map(r => r.float_pressure).filter(p => isFinite(p));
  
  const avg_survival = survival_days.reduce((a, b) => a + b, 0) / survival_days.length;
  const avg_pressure = float_pressures.reduce((a, b) => a + b, 0) / float_pressures.length;
  
  const green_count = results.filter(r => r.state === 'GREEN').length;
  const yellow_count = results.filter(r => r.state === 'YELLOW').length;
  const red_count = results.filter(r => r.state === 'RED').length;
  
  const at_risk = results.filter(r => r.survival_days < T_MIN).length;
  const critical = results.filter(r => r.survival_days < T_MIN * 0.5).length;
  
  return {
    n: params.n,
    avg_survival_days: avg_survival,
    avg_float_pressure: avg_pressure,
    green_count, yellow_count, red_count,
    at_risk_count: at_risk,
    critical_count: critical,
    survival_days_list: survival_days
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI ì—…ë°ì´íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentScenario = 'BASELINE';
let lastResult = null;
let comparisonResults = {};

// ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ
document.querySelectorAll('input[type="range"]').forEach(slider => {
  const valueEl = document.getElementById(`val-${slider.id.split('-')[1]}`);
  slider.addEventListener('input', () => {
    valueEl.textContent = slider.value;
  });
});

// ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ
document.querySelectorAll('.scenario-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentScenario = btn.dataset.scenario;
    
    // ì‹œë‚˜ë¦¬ì˜¤ë³„ íŒŒë¼ë¯¸í„° ì„¤ì •
    const scenario = SCENARIOS[currentScenario];
    document.getElementById('slider-shock').value = scenario.shock_prob * 100;
    document.getElementById('val-shock').textContent = Math.round(scenario.shock_prob * 100);
    document.getElementById('slider-cut').value = scenario.support_cut * 100;
    document.getElementById('val-cut').textContent = Math.round(scenario.support_cut * 100);
  });
});

// ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
document.getElementById('btn-run').addEventListener('click', async () => {
  const loading = document.getElementById('loading');
  loading.style.display = 'block';
  document.getElementById('status-indicator').textContent = 'â— Running...';
  document.getElementById('status-indicator').style.color = 'var(--yellow)';
  
  // ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ (UI ë¸”ë¡œí‚¹ ë°©ì§€)
  await new Promise(resolve => setTimeout(resolve, 50));
  
  const params = {
    n: parseInt(document.getElementById('slider-n').value),
    shock_prob: parseInt(document.getElementById('slider-shock').value) / 100,
    support_cut: parseInt(document.getElementById('slider-cut').value) / 100,
    visa_risk: parseInt(document.getElementById('slider-visa').value)
  };
  
  const result = runSimulation(params);
  lastResult = result;
  comparisonResults[currentScenario] = result;
  
  updateUI(result);
  
  loading.style.display = 'none';
  document.getElementById('status-indicator').textContent = 'â— Ready';
  document.getElementById('status-indicator').style.color = 'var(--green)';
});

// UI ì—…ë°ì´íŠ¸
function updateUI(result) {
  // í†µê³„ ì¹´ë“œ
  document.getElementById('stat-survival').textContent = Math.round(result.avg_survival_days);
  document.getElementById('stat-pressure').textContent = result.avg_float_pressure.toFixed(2);
  document.getElementById('stat-atrisk').textContent = ((result.at_risk_count / result.n) * 100).toFixed(1);
  document.getElementById('stat-critical').textContent = ((result.critical_count / result.n) * 100).toFixed(1);
  
  // ì••ë ¥ ìƒ‰ìƒ
  const pressureEl = document.getElementById('stat-pressure');
  if (result.avg_float_pressure < 0.7) {
    pressureEl.className = 'stat-value green';
  } else if (result.avg_float_pressure < 1.0) {
    pressureEl.className = 'stat-value yellow';
  } else {
    pressureEl.className = 'stat-value red';
  }
  
  // ë¶„í¬ ë°”
  const greenPct = (result.green_count / result.n) * 100;
  const yellowPct = (result.yellow_count / result.n) * 100;
  const redPct = (result.red_count / result.n) * 100;
  
  const bar = document.getElementById('distribution-bar');
  bar.innerHTML = `
    <div class="segment green" style="width: ${greenPct}%;">${greenPct.toFixed(1)}%</div>
    <div class="segment yellow" style="width: ${yellowPct}%;">${yellowPct.toFixed(1)}%</div>
    <div class="segment red" style="width: ${redPct}%;">${redPct.toFixed(1)}%</div>
  `;
  
  // íˆìŠ¤í† ê·¸ë¨
  updateHistogram(result.survival_days_list);
  
  // 7 Laws ìƒíƒœ ì—…ë°ì´íŠ¸
  updateLawsStatus(result);
}

// íˆìŠ¤í† ê·¸ë¨ ì—…ë°ì´íŠ¸
function updateHistogram(survival_days) {
  const bins = [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330, 365];
  const counts = new Array(bins.length - 1).fill(0);
  
  for (const days of survival_days) {
    for (let i = 0; i < bins.length - 1; i++) {
      if (days >= bins[i] && days < bins[i + 1]) {
        counts[i]++;
        break;
      }
      if (days >= 365) {
        counts[counts.length - 1]++;
        break;
      }
    }
  }
  
  const maxCount = Math.max(...counts);
  const histogram = document.getElementById('histogram');
  histogram.innerHTML = counts.map((count, i) => {
    const height = maxCount > 0 ? (count / maxCount) * 100 : 0;
    const color = i < 3 ? 'var(--red)' : i < 6 ? 'var(--yellow)' : 'var(--green)';
    return `<div class="histogram-bar" style="height: ${height}%; background: ${color};"></div>`;
  }).join('');
}

// 7 Laws ìƒíƒœ
function updateLawsStatus(result) {
  const continuity = result.at_risk_count < result.n * 0.1;
  const survivalMass = result.avg_survival_days >= T_MIN;
  
  const laws = [
    { name: 'Continuity', ok: continuity },
    { name: 'Conservation', ok: true },
    { name: 'State Dominance', ok: true },
    { name: 'Cognitive Min', ok: true },
    { name: 'Containment', ok: true },
    { name: 'Responsibility', ok: true },
    { name: 'Survival Mass', ok: survivalMass }
  ];
  
  const lawsEl = document.getElementById('laws-status');
  lawsEl.innerHTML = laws.map((law, i) => `
    <div>â‘  ${law.name} <span style="color: ${law.ok ? 'var(--green)' : 'var(--red)'};">${law.ok ? 'âœ“' : 'âœ—'}</span></div>
  `.replace('â‘ ', `${['â‘ ','â‘¡','â‘¢','â‘£','â‘¤','â‘¥','â‘¦'][i]}`)).join('');
}

// ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
document.getElementById('btn-compare').addEventListener('click', async () => {
  const loading = document.getElementById('loading');
  loading.style.display = 'block';
  
  const params = {
    n: parseInt(document.getElementById('slider-n').value),
    visa_risk: parseInt(document.getElementById('slider-visa').value)
  };
  
  // ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
  for (const [name, scenario] of Object.entries(SCENARIOS)) {
    await new Promise(resolve => setTimeout(resolve, 50));
    const result = runSimulation({
      ...params,
      shock_prob: scenario.shock_prob,
      support_cut: scenario.support_cut
    });
    comparisonResults[name] = result;
  }
  
  // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
  const tbody = document.getElementById('comparison-body');
  tbody.innerHTML = Object.entries(comparisonResults).map(([name, result]) => {
    const stateClass = result.avg_float_pressure < 0.7 ? 'green' : 
                       result.avg_float_pressure < 1.0 ? 'yellow' : 'red';
    return `
      <tr>
        <td>${name}</td>
        <td><span class="status-badge ${stateClass}">${stateClass.toUpperCase()}</span></td>
        <td>${Math.round(result.avg_survival_days)}ì¼</td>
        <td>${result.avg_float_pressure.toFixed(2)}</td>
        <td>${((result.at_risk_count / result.n) * 100).toFixed(1)}%</td>
        <td>${((result.critical_count / result.n) * 100).toFixed(1)}%</td>
      </tr>
    `;
  }).join('');
  
  document.getElementById('comparison-section').style.display = 'block';
  loading.style.display = 'none';
});

// ì´ˆê¸° ì‹¤í–‰
document.getElementById('btn-run').click();
</script>

</body>
</html>
