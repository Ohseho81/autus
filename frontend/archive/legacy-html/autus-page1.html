<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS / PAGE 1 — GOAL CALIBRATION</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #000;
            color: #00f0ff;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        
        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }
        
        /* Labels */
        .label {
            position: fixed;
            font-size: 12px;
            letter-spacing: 2px;
            opacity: 0.6;
            z-index: 5;
            color: #00f0ff;
        }
        
        #label-self-core { top: 28%; left: 50%; transform: translateX(-50%); }
        #label-volume { bottom: 22%; left: 50%; transform: translateX(-50%); }
        #label-sigma-a { top: 38%; left: 30%; transform: rotate(-25deg); }
        #label-sigma-v { top: 32%; right: 28%; transform: rotate(25deg); }
        #label-p-outcome { top: 18%; right: 22%; }
        
        .p-outcome-marker {
            position: fixed;
            top: 14%; right: 20%;
            width: 20px; height: 20px;
            border: 2px solid #00f0ff;
            border-radius: 50%;
            z-index: 5;
        }
        .p-outcome-marker::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 6px; height: 6px;
            background: #00f0ff;
            border-radius: 50%;
            box-shadow: 0 0 8px #00f0ff;
        }
        
        /* Controls - 가로 배열 */
        .controls-panel {
            position: fixed;
            bottom: 50px;
            left: 40px;
            z-index: 10;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 12px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .control-icon {
            width: 20px; height: 20px;
            opacity: 0.6;
        }
        
        .slider-container {
            width: 80px; height: 4px;
            background: rgba(0, 240, 255, 0.2);
            border-radius: 2px;
            position: relative;
        }
        
        .slider-thumb {
            width: 10px; height: 10px;
            background: #00f0ff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px #00f0ff;
        }
        
        .control-label {
            font-size: 10px;
            letter-spacing: 1px;
            opacity: 0.6;
        }
        
        .horizon-badge {
            width: 28px; height: 20px;
            border: 1px solid rgba(0, 240, 255, 0.5);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            opacity: 0.7;
        }
        
        /* Stats Panel */
        .stats-panel {
            position: fixed;
            bottom: 100px;
            right: 40px;
            z-index: 10;
            background: rgba(0, 10, 20, 0.85);
            border: 1px solid rgba(0, 240, 255, 0.3);
            padding: 14px 20px;
            font-family: 'SF Mono', monospace;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            gap: 24px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        .stat-label { opacity: 0.6; letter-spacing: 1px; }
        .stat-value { font-weight: 600; }
        
        /* Mode Toggle */
        .mode-toggle {
            position: fixed;
            bottom: 40px;
            right: 40px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mode-label {
            font-size: 11px;
            letter-spacing: 1px;
            opacity: 0.5;
        }
        
        .mode-button {
            width: 70px; height: 36px;
            border: 2px solid #00f0ff;
            border-radius: 18px;
            background: rgba(0, 240, 255, 0.1);
            color: #00f0ff;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .mode-button::after {
            content: '';
            position: absolute;
            top: 50%; right: 8px;
            width: 8px; height: 8px;
            background: #f0a000;
            border-radius: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 8px #f0a000;
        }
        
        /* Page Title */
        .page-title {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            letter-spacing: 3px;
            opacity: 0.4;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <!-- Labels -->
    <div class="label" id="label-self-core">Self Core</div>
    <div class="label" id="label-volume">Volume</div>
    <div class="label" id="label-sigma-a">Sigma_a</div>
    <div class="label" id="label-sigma-v">Sigma_v</div>
    <div class="label" id="label-p-outcome">P_outcome</div>
    <div class="p-outcome-marker"></div>
    
    <!-- Controls - 가로 배열 -->
    <div class="controls-panel">
        <div class="control-row">
            <div class="control-group">
                <svg class="control-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 3v18M3 12h18"/>
                </svg>
                <div class="slider-container">
                    <div class="slider-thumb" style="left: 50%"></div>
                </div>
            </div>
            <div class="control-group">
                <svg class="control-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="8"/>
                </svg>
                <div class="slider-container">
                    <div class="slider-thumb" style="left: 60%"></div>
                </div>
            </div>
            <div class="control-group">
                <svg class="control-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
                <div class="horizon-badge">D1</div>
            </div>
        </div>
        <div class="control-row">
            <span class="control-label">Mass</span>
            <span class="control-label">Volume</span>
            <span class="control-label">Horizon</span>
        </div>
    </div>
    
    <!-- Stats Panel -->
    <div class="stats-panel">
        <div class="stat-row">
            <span class="stat-label">DENSITY:</span>
            <span class="stat-value" id="density-value">0.50</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">STABILITY:</span>
            <span class="stat-value" id="stability-value">0.70</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">P_OUTCOME:</span>
            <span class="stat-value" id="p-outcome-value">0%</span>
        </div>
    </div>
    
    <!-- Mode Toggle -->
    <div class="mode-toggle">
        <span class="mode-label">SimLive</span>
        <button class="mode-button">LIVE</button>
    </div>
    
    <!-- Page Title -->
    <div class="page-title">AUTUS / PAGE 1 — GOAL CALIBRATION</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);
        
        const CYAN = 0x00f0ff;
        
        // Self Core (Main Sphere) - 더 크고 밝게
        const coreGeometry = new THREE.SphereGeometry(1.3, 64, 64);
        const coreMaterial = new THREE.MeshBasicMaterial({
            color: CYAN,
            transparent: true,
            opacity: 0.25
        });
        const core = new THREE.Mesh(coreGeometry, coreMaterial);
        scene.add(core);
        
        // Core inner glow
        const coreInnerGeometry = new THREE.SphereGeometry(1.1, 64, 64);
        const coreInnerMaterial = new THREE.MeshBasicMaterial({
            color: 0x88ffff,
            transparent: true,
            opacity: 0.4
        });
        const coreInner = new THREE.Mesh(coreInnerGeometry, coreInnerMaterial);
        scene.add(coreInner);
        
        // Core Rim
        const coreRimGeometry = new THREE.RingGeometry(1.28, 1.32, 128);
        const coreRimMaterial = new THREE.MeshBasicMaterial({
            color: CYAN,
            transparent: true,
            opacity: 0.9,
            side: THREE.DoubleSide
        });
        const coreRim = new THREE.Mesh(coreRimGeometry, coreRimMaterial);
        scene.add(coreRim);
        
        // Volume Ring (Outer)
        const volumeRingGeometry = new THREE.RingGeometry(2.1, 2.13, 128);
        const volumeRingMaterial = new THREE.MeshBasicMaterial({
            color: CYAN,
            transparent: true,
            opacity: 0.5,
            side: THREE.DoubleSide
        });
        const volumeRing = new THREE.Mesh(volumeRingGeometry, volumeRingMaterial);
        scene.add(volumeRing);
        
        // Sigma Orbit (Tilted Ellipse)
        function createOrbitLine(radiusX, radiusY, tiltX, tiltZ, opacity = 0.35) {
            const curve = new THREE.EllipseCurve(0, 0, radiusX, radiusY, 0, 2 * Math.PI, false, 0);
            const points = curve.getPoints(128);
            const geometry = new THREE.BufferGeometry().setFromPoints(
                points.map(p => new THREE.Vector3(p.x, p.y, 0))
            );
            const material = new THREE.LineBasicMaterial({
                color: CYAN,
                transparent: true,
                opacity: opacity
            });
            const line = new THREE.Line(geometry, material);
            line.rotation.x = tiltX;
            line.rotation.z = tiltZ;
            return line;
        }
        
        const sigmaOrbitA = createOrbitLine(2.4, 1.9, 0.4, -0.25, 0.3);
        scene.add(sigmaOrbitA);
        
        const sigmaOrbitV = createOrbitLine(2.5, 1.5, 0.5, 0.3, 0.25);
        scene.add(sigmaOrbitV);
        
        // Orbit marker
        const markerGeometry = new THREE.SphereGeometry(0.08, 16, 16);
        const markerMaterial = new THREE.MeshBasicMaterial({ color: CYAN });
        const marker = new THREE.Mesh(markerGeometry, markerMaterial);
        marker.position.set(1.8, 1.0, 0.3);
        scene.add(marker);
        
        // Particles (Star field) - 작은 사각형으로
        const particlesCount = 1500;
        const positions = new Float32Array(particlesCount * 3);
        
        for (let i = 0; i < particlesCount * 3; i += 3) {
            positions[i] = (Math.random() - 0.5) * 15;
            positions[i + 1] = (Math.random() - 0.5) * 12;
            positions[i + 2] = (Math.random() - 0.5) * 8;
        }
        
        const particlesGeometry = new THREE.BufferGeometry();
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        
        const particlesMaterial = new THREE.PointsMaterial({
            color: CYAN,
            size: 0.025,
            transparent: true,
            opacity: 0.5,
            blending: THREE.AdditiveBlending
        });
        
        const particles = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles);
        
        // Animation
        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            time += 0.005;
            
            core.rotation.y += 0.001;
            coreInner.rotation.y += 0.0015;
            
            const pulse = 1 + Math.sin(time * 2) * 0.015;
            core.scale.set(pulse, pulse, pulse);
            coreInner.scale.set(pulse * 0.98, pulse * 0.98, pulse * 0.98);
            
            particles.rotation.y += 0.0002;
            
            marker.position.x = 2.3 * Math.cos(time * 0.5);
            marker.position.y = 1.3 * Math.sin(time * 0.5);
            marker.position.z = 0.4 * Math.sin(time * 0.3);
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // API Connection
        async function fetchState() {
            try {
                const res = await fetch('http://localhost:8001/state?session_id=page1_session');
                const data = await res.json();
                document.getElementById('density-value').textContent = data.measure.density.toFixed(2);
                document.getElementById('stability-value').textContent = data.measure.stability.toFixed(2);
                document.getElementById('p-outcome-value').textContent = Math.round(data.forecast.P_outcome * 100) + '%';
            } catch (e) {}
        }
        fetchState();
        setInterval(fetchState, 3000);
    </script>
</body>
</html>

