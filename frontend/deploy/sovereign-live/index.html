<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0a0f1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>AUTUS v15.2 Â· Daily OS</title>
  <link rel="manifest" href="./manifest.json">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{
      --bg:#0a0f1a;--bg2:#111827;--bg3:#1f2937;
      --green:#10b981;--cyan:#06b6d4;--red:#ef4444;--orange:#f59e0b;--purple:#8b5cf6;
      --text:#f3f4f6;--text2:#9ca3af;--muted:#4b5563;
      --border:rgba(255,255,255,0.08);
      --glow:rgba(16,185,129,0.4);
      --safe-top:env(safe-area-inset-top,0px);
      --safe-bottom:env(safe-area-inset-bottom,0px);
    }
    html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}
    body{display:flex;flex-direction:column;padding-top:var(--safe-top);padding-bottom:var(--safe-bottom)}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LIVE BADGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .live{position:fixed;top:calc(var(--safe-top) + 12px);right:12px;display:flex;align-items:center;gap:6px;padding:4px 10px;background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.25);border-radius:20px;font-size:10px;color:var(--green);font-weight:600;z-index:100;letter-spacing:0.5px}
    .live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:blink 1.2s ease-in-out infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER (V Display)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header{flex:0 0 auto;padding:40px 20px 20px;text-align:center;background:linear-gradient(180deg,rgba(16,185,129,0.08) 0%,transparent 100%)}
    .v-amount{font-size:72px;font-weight:800;line-height:1;background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;position:relative;display:inline-block}
    .v-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:4px;margin-top:4px}
    .v-delta{position:absolute;top:0;right:-50px;font-size:18px;font-weight:700;color:var(--green);opacity:0;transform:translateY(10px);transition:all 0.3s}
    .v-delta.visible{opacity:1;transform:translateY(0)}
    .v-delta.negative{color:var(--red)}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUESTION ZONE (Center)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .question-zone{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative;overflow:hidden}
    
    /* Question Content */
    .question-content{text-align:center;max-width:320px;position:relative}
    .question-text{font-size:22px;font-weight:600;line-height:1.5;margin-bottom:16px;transition:all 0.3s}
    .question-meta{font-size:14px;color:var(--green);font-weight:600}
    .question-meta span{opacity:0.7;color:var(--text2);font-weight:400;margin-left:4px}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EMPTY STATES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .empty-state{text-align:center;animation:fadeIn 0.4s ease-out}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    
    .empty-icon{font-size:48px;margin-bottom:20px;display:inline-block}
    .empty-icon.spin{animation:spinSlow 20s linear infinite;color:var(--green)}
    .empty-icon.pulse{animation:pulse 2s ease-in-out infinite;color:var(--muted)}
    .empty-icon.flip{animation:flip 4s ease-in-out infinite}
    
    @keyframes spinSlow{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.08);opacity:1}}
    @keyframes flip{0%,45%{transform:rotateX(0)}50%,95%{transform:rotateX(180deg)}100%{transform:rotateX(360deg)}}
    
    .empty-title{font-size:18px;font-weight:600;margin-bottom:8px}
    .empty-subtitle{font-size:13px;color:var(--text2);line-height:1.5}
    .empty-stats{font-size:14px;color:var(--text2);margin-top:16px}
    .empty-stats strong{color:var(--green)}
    
    /* Progress Bar (for WAITING state) */
    .empty-progress{margin-top:24px;width:260px}
    .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:12px}
    .progress-source{display:flex;align-items:center;gap:6px;color:var(--text)}
    .progress-day{color:var(--text2)}
    .progress-bar{height:4px;background:var(--bg3);border-radius:2px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));transition:width 0.5s}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTON ZONE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .button-zone{flex:0 0 auto;padding:20px;padding-bottom:calc(20px + var(--safe-bottom))}
    .buttons{display:flex;gap:12px;max-width:400px;margin:0 auto}
    
    .btn{flex:1;padding:18px 24px;border-radius:14px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.15s;border:none;position:relative;overflow:hidden}
    .btn:active{transform:scale(0.97)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    
    .btn-no{background:transparent;border:2px solid var(--border);color:var(--text2);flex:0.8}
    .btn-no:hover{border-color:var(--muted);color:var(--text)}
    
    .btn-yes{background:linear-gradient(135deg,var(--green),var(--cyan));color:var(--bg);flex:1.2;box-shadow:0 4px 24px var(--glow)}
    .btn-yes:hover{box-shadow:0 6px 32px var(--glow)}
    
    /* Link Button (for GENESIS state) */
    .btn-link{width:100%;padding:16px;background:transparent;border:1px solid var(--border);border-radius:12px;color:var(--text2);font-size:14px;font-weight:500;cursor:pointer;transition:all 0.15s}
    .btn-link:hover{border-color:var(--cyan);color:var(--cyan)}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATIONS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Flash overlay */
    .flash{position:fixed;inset:0;pointer-events:none;opacity:0;transition:opacity 0.1s;z-index:1000}
    .flash.accept{background:radial-gradient(circle at center,rgba(16,185,129,0.4),transparent 70%)}
    .flash.reject{background:radial-gradient(circle at center,rgba(239,68,68,0.2),transparent 70%)}
    .flash.active{opacity:1}

    /* Question transitions */
    .question-content.accept-out{animation:acceptOut 0.4s ease-out forwards}
    .question-content.accept-in{animation:acceptIn 0.3s ease-out forwards}
    .question-content.reject-out{animation:rejectOut 0.35s ease-out forwards}
    .question-content.reject-in{animation:rejectIn 0.3s ease-out forwards}
    
    @keyframes acceptOut{
      0%{transform:translateY(0);opacity:1}
      100%{transform:translateY(-30px);opacity:0}
    }
    @keyframes acceptIn{
      0%{transform:translateY(30px);opacity:0}
      100%{transform:translateY(0);opacity:1}
    }
    @keyframes rejectOut{
      0%{transform:translateX(0);opacity:1}
      20%{transform:translateX(-8px)}
      40%{transform:translateX(8px)}
      60%{transform:translateX(-4px)}
      80%{transform:translateX(100%);opacity:0}
      100%{transform:translateX(100%);opacity:0}
    }
    @keyframes rejectIn{
      0%{transform:translateX(-100%);opacity:0}
      100%{transform:translateX(0);opacity:1}
    }

    /* V counter animation */
    .v-amount.counting{animation:vPulse 0.4s ease-out}
    @keyframes vPulse{
      0%{transform:scale(1)}
      50%{transform:scale(1.05)}
      100%{transform:scale(1)}
    }

    /* Checkmark morph */
    .checkmark{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(0.5)}
    .checkmark.visible{animation:checkIn 0.3s ease-out forwards}
    @keyframes checkIn{
      0%{opacity:0;transform:scale(0.5)}
      60%{transform:scale(1.2)}
      100%{opacity:1;transform:scale(1)}
    }
    .checkmark-icon{width:64px;height:64px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:0 0 40px var(--glow)}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAV
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:var(--bg2);border-top:1px solid var(--border);padding-bottom:var(--safe-bottom);z-index:50}
    .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;padding:10px 0;color:var(--muted);cursor:pointer;position:relative;transition:color 0.15s}
    .nav-item::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:0;height:2px;background:var(--cyan);transition:width 0.2s}
    .nav-item.active{color:var(--cyan)}
    .nav-item.active::before{width:24px}
    .nav-icon{font-size:20px}
    .nav-label{font-size:10px;margin-top:2px}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-size:13px;z-index:200;opacity:0;transition:all 0.3s}
    .toast.visible{transform:translateX(-50%) translateY(0);opacity:1}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-height: 600px) {
      .header{padding:20px 20px 10px}
      .v-amount{font-size:56px}
      .question-text{font-size:18px}
    }
  </style>
</head>
<body>

  <!-- Live Badge -->
  <div class="live">
    <div class="live-dot"></div>
    LIVE
  </div>

  <!-- Flash Overlay -->
  <div class="flash" id="flash"></div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Header: V Display -->
  <header class="header">
    <div class="v-amount" id="vAmount">0<span class="v-delta" id="vDelta">+0</span></div>
    <div class="v-label">V</div>
  </header>

  <!-- Question Zone -->
  <main class="question-zone" id="questionZone">
    <!-- Dynamic content: question or empty state -->
  </main>

  <!-- Button Zone -->
  <footer class="button-zone" id="buttonZone">
    <!-- Dynamic content: buttons or empty -->
  </footer>

  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-item active" data-tab="daily">
      <span class="nav-icon">âš¡</span>
      <span class="nav-label">Daily</span>
    </div>
    <div class="nav-item" data-tab="nodes">
      <span class="nav-icon">ğŸ‘¥</span>
      <span class="nav-label">Nodes</span>
    </div>
    <div class="nav-item" data-tab="ledger">
      <span class="nav-icon">ğŸ”</span>
      <span class="nav-label">Ledger</span>
    </div>
  </nav>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIG & STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const CONFIG = { DB_NAME: 'autus_v152', DB_VERSION: 1 };
    let db = null;
    
    const state = {
      V: 0,
      M: 0,
      T: 0,
      s: 0,
      currentIndex: 0,
      todayAccepts: 0,
      todayRejects: 0,
      hasIntegration: false,
      integrationProgress: { source: 'ìŠ¤ì™€íŠ¼ í•™ì›', day: 0, percent: 0 }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DECISIONS (Mock data - will be replaced by n8n)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const decisions = [
      { id: 1, text: 'ìŠ¤ì™€íŠ¼ ìˆ˜ê°•ìƒ ê´€ë¦¬ë¥¼\nìë™í™”í• ê¹Œìš”?', delta: 18, time: '2.4h' },
      { id: 2, text: 'ì„¸ ìë…€ ìŠ¤ì¼€ì¤„ì„\nì¼ê´„ ë™ê¸°í™”í• ê¹Œìš”?', delta: 12, time: '1.5h' },
      { id: 3, text: 'í•™ì› ë§¤ì¶œ ë¦¬í¬íŠ¸ë¥¼\nìë™ ìƒì„±í• ê¹Œìš”?', delta: 14, time: '3.2h' },
      { id: 4, text: 'ë°˜ë³µ ì´ë©”ì¼ ë°œì†¡ì„\nìë™í™”í• ê¹Œìš”?', delta: 8, time: '0.8h' },
      { id: 5, text: 'ì‹ ê·œ ë“±ë¡ í”„ë¡œì„¸ìŠ¤ë¥¼\n30% ë‹¨ì¶•í• ê¹Œìš”?', delta: 22, time: '4.1h' }
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DATABASE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function initDB() {
      return new Promise((resolve, reject) => {
        const req = indexedDB.open(CONFIG.DB_NAME, CONFIG.DB_VERSION);
        req.onerror = () => reject(req.error);
        req.onsuccess = () => { db = req.result; resolve(db); };
        req.onupgradeneeded = (e) => {
          const d = e.target.result;
          if (!d.objectStoreNames.contains('ledger')) {
            const s = d.createObjectStore('ledger', { keyPath: 'hash' });
            s.createIndex('timestamp', 'timestamp');
            s.createIndex('date', 'date');
          }
          if (!d.objectStoreNames.contains('state')) {
            d.createObjectStore('state', { keyPath: 'key' });
          }
        };
      });
    }

    async function sha256(msg) {
      const buf = new TextEncoder().encode(msg);
      const hash = await crypto.subtle.digest('SHA-256', buf);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function getLastBlock() {
      return new Promise(resolve => {
        const tx = db.transaction('ledger', 'readonly');
        const req = tx.objectStore('ledger').index('timestamp').openCursor(null, 'prev');
        req.onsuccess = (e) => {
          const cursor = e.target.result;
          resolve(cursor ? cursor.value : { hash: 'GENESIS_V152', timestamp: new Date().toISOString() });
        };
      });
    }

    async function addBlock(type, payload) {
      const last = await getLastBlock();
      const ts = new Date().toISOString();
      const date = ts.split('T')[0];
      const hash = await sha256(JSON.stringify({ prev: last.hash, ts, type, payload }));
      const block = { hash, prev_hash: last.hash, timestamp: ts, date, type, payload };
      
      return new Promise(resolve => {
        const tx = db.transaction('ledger', 'readwrite');
        tx.objectStore('ledger').add(block).onsuccess = () => resolve(block);
      });
    }

    async function getTodayBlocks() {
      const today = new Date().toISOString().split('T')[0];
      return new Promise(resolve => {
        const tx = db.transaction('ledger', 'readonly');
        const req = tx.objectStore('ledger').index('date').getAll(today);
        req.onsuccess = () => resolve(req.result || []);
      });
    }

    async function getAllBlocks() {
      return new Promise(resolve => {
        const tx = db.transaction('ledger', 'readonly');
        tx.objectStore('ledger').getAll().onsuccess = (e) => resolve(e.target.result || []);
      });
    }

    async function loadState() {
      return new Promise(resolve => {
        const tx = db.transaction('state', 'readonly');
        const req = tx.objectStore('state').get('main');
        req.onsuccess = () => {
          if (req.result) Object.assign(state, req.result.data);
          resolve();
        };
        req.onerror = () => resolve();
      });
    }

    async function saveState() {
      return new Promise(resolve => {
        const tx = db.transaction('state', 'readwrite');
        tx.objectStore('state').put({ key: 'main', data: state });
        tx.oncomplete = () => resolve();
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // V CALCULATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateV() {
      state.V = Math.round((state.M - state.T) * Math.pow(1 + state.s, 1));
      return state.V;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EMPTY STATE DETECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function getEmptyStateType() {
      const allBlocks = await getAllBlocks();
      const todayBlocks = await getTodayBlocks();
      const pendingCount = decisions.length - state.currentIndex;
      
      // Count today's decisions
      const todayDecisions = todayBlocks.filter(b => b.type === 'decision');
      state.todayAccepts = todayDecisions.filter(b => b.payload?.action === 'accept').length;
      state.todayRejects = todayDecisions.filter(b => b.payload?.action === 'reject').length;
      
      // A. DONE: Made decisions today, none pending
      if (todayDecisions.length > 0 && pendingCount === 0) {
        return 'DONE';
      }
      
      // B. GENESIS: First time (only genesis block)
      if (allBlocks.length <= 1) {
        return 'GENESIS';
      }
      
      // C. WAITING: Has integration but no pending
      if (state.hasIntegration && pendingCount === 0) {
        return 'WAITING';
      }
      
      // D. ACTIVE: Has pending decisions
      if (pendingCount > 0) {
        return 'ACTIVE';
      }
      
      return 'WAITING';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const $ = id => document.getElementById(id);

    function renderV(animate = false) {
      const el = $('vAmount');
      el.innerHTML = `${state.V}<span class="v-delta" id="vDelta"></span>`;
      if (animate) {
        el.classList.add('counting');
        setTimeout(() => el.classList.remove('counting'), 400);
      }
    }

    function showDelta(value) {
      const el = $('vDelta');
      el.textContent = value > 0 ? `+${value}` : value;
      el.className = `v-delta visible ${value < 0 ? 'negative' : ''}`;
      setTimeout(() => el.classList.remove('visible'), 2000);
    }

    function renderQuestion(decision) {
      const zone = $('questionZone');
      zone.innerHTML = `
        <div class="question-content" id="questionContent">
          <div class="question-text">${decision.text}</div>
          <div class="question-meta">+${decision.delta}V <span>Â· ${decision.time}</span></div>
        </div>
        <div class="checkmark" id="checkmark">
          <div class="checkmark-icon">âœ“</div>
        </div>
      `;
      
      $('buttonZone').innerHTML = `
        <div class="buttons">
          <button class="btn btn-no" id="btnNo">ì•„ë‹ˆì˜¤</button>
          <button class="btn btn-yes" id="btnYes">ì˜ˆ</button>
        </div>
      `;
      
      // Bind buttons
      $('btnNo').addEventListener('click', handleReject);
      $('btnYes').addEventListener('click', handleAccept);
    }

    function renderEmptyState(type) {
      const configs = {
        DONE: {
          icon: 'âœ¦',
          iconClass: 'spin',
          title: 'ì˜¤ëŠ˜ì˜ ê²°ì • ì™„ë£Œ',
          subtitle: '',
          stats: `<strong>${state.todayAccepts}</strong> Accept Â· <strong>${state.todayRejects}</strong> Reject`,
          button: null
        },
        GENESIS: {
          icon: 'â—¯',
          iconClass: 'pulse',
          title: 'ì²« ê²°ì •ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤',
          subtitle: 'ê²°ì •ì´ ë„ì°©í•˜ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.',
          stats: null,
          button: { text: 'ë°ì´í„° ì—°ë™ ì‹œì‘ â†’', action: 'startIntegration' }
        },
        WAITING: {
          icon: 'â³',
          iconClass: 'flip',
          title: 'ìƒˆ ê²°ì •ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘',
          subtitle: '',
          progress: state.integrationProgress,
          button: null
        }
      };
      
      const config = configs[type];
      const zone = $('questionZone');
      
      let progressHTML = '';
      if (config.progress) {
        progressHTML = `
          <div class="empty-progress">
            <div class="progress-header">
              <span class="progress-source">ğŸ« ${config.progress.source}</span>
              <span class="progress-day">${config.progress.day}ì¼ì°¨</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${config.progress.percent}%"></div>
            </div>
          </div>
        `;
      }
      
      zone.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon ${config.iconClass}">${config.icon}</div>
          <div class="empty-title">${config.title}</div>
          <div class="empty-subtitle">${config.subtitle}</div>
          ${config.stats ? `<div class="empty-stats">${config.stats}</div>` : ''}
          ${progressHTML}
        </div>
      `;
      
      if (config.button) {
        $('buttonZone').innerHTML = `
          <button class="btn-link" id="btnLink">${config.button.text}</button>
        `;
        $('btnLink').addEventListener('click', () => {
          // Simulate integration start
          state.hasIntegration = true;
          state.integrationProgress = { source: 'ìŠ¤ì™€íŠ¼ í•™ì›', day: 1, percent: 14 };
          state.currentIndex = 0; // Reset to show decisions
          saveState();
          render();
          toast('ğŸ« ìŠ¤ì™€íŠ¼ í•™ì› ì—°ë™ ì‹œì‘');
        });
      } else {
        $('buttonZone').innerHTML = '';
      }
    }

    async function render() {
      const stateType = await getEmptyStateType();
      
      if (stateType === 'ACTIVE') {
        const decision = decisions[state.currentIndex];
        renderQuestion(decision);
      } else {
        renderEmptyState(stateType);
      }
      
      renderV();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ACTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function handleAccept() {
      const decision = decisions[state.currentIndex];
      const oldV = state.V;
      
      // Update state
      state.M += decision.delta;
      state.s = Math.min(1, state.s + 0.02);
      calculateV();
      
      // Record to ledger
      await addBlock('decision', {
        action: 'accept',
        decisionId: decision.id,
        delta: state.V - oldV
      });
      await saveState();
      
      // Animations
      flash('accept');
      haptic();
      
      // Show checkmark
      const content = $('questionContent');
      const check = $('checkmark');
      content.classList.add('accept-out');
      
      setTimeout(() => {
        check.classList.add('visible');
        renderV(true);
        showDelta(state.V - oldV);
      }, 200);
      
      setTimeout(() => {
        state.currentIndex++;
        saveState();
        render();
        
        // Animate in
        const newContent = $('questionContent');
        if (newContent) newContent.classList.add('accept-in');
      }, 700);
    }

    async function handleReject() {
      const decision = decisions[state.currentIndex];
      
      // Record to ledger (no V change)
      await addBlock('decision', {
        action: 'reject',
        decisionId: decision.id,
        delta: 0
      });
      await saveState();
      
      // Animations
      flash('reject');
      
      const content = $('questionContent');
      content.classList.add('reject-out');
      
      setTimeout(() => {
        state.currentIndex++;
        saveState();
        render();
        
        const newContent = $('questionContent');
        if (newContent) newContent.classList.add('reject-in');
      }, 400);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function flash(type) {
      const el = $('flash');
      el.className = `flash ${type} active`;
      setTimeout(() => el.classList.remove('active'), 150);
    }

    function haptic() {
      if (navigator.vibrate) navigator.vibrate(30);
    }

    function toast(msg) {
      const el = $('toast');
      el.textContent = msg;
      el.classList.add('visible');
      setTimeout(() => el.classList.remove('visible'), 2500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEYBOARD SHORTCUTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('keydown', (e) => {
      const key = e.key.toLowerCase();
      if (key === 'y' || key === 'a' || key === ' ') {
        e.preventDefault();
        const btn = $('btnYes');
        if (btn) btn.click();
      }
      if (key === 'n' || key === 'r') {
        e.preventDefault();
        const btn = $('btnNo');
        if (btn) btn.click();
      }
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAV
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const tab = item.dataset.tab;
        if (tab !== 'daily') {
          toast(`${item.querySelector('.nav-label').textContent} íƒ­ ì¤€ë¹„ ì¤‘`);
        }
      });
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SERVICE WORKER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(() => {});
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function init() {
      await initDB();
      await loadState();
      calculateV();
      await render();
    }

    init();
  </script>
</body>
</html>
