<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AUTUS v15.1 Sovereign â€” Master Active</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;AUTUS Sovereign&quot;,&quot;short_name&quot;:&quot;AUTUS&quot;,&quot;start_url&quot;:&quot;/sovereign-v15.html&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%230a0f1a&quot;,&quot;theme_color&quot;:&quot;%2310b981&quot;}">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#0a0f1a;--bg2:#111827;--bg3:#1f2937;--green:#10b981;--cyan:#06b6d4;--purple:#8b5cf6;--orange:#f59e0b;--red:#ef4444;--text:#f3f4f6;--muted:#6b7280;--border:rgba(255,255,255,0.08)}
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
    
    /* Tab Navigation */
    .tab-nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:var(--bg2);border-top:1px solid var(--border);z-index:100}
    .tab-item{flex:1;padding:10px 4px;text-align:center;cursor:pointer;color:var(--muted);transition:all .15s;border-top:2px solid transparent}
    .tab-item:hover{color:var(--text)}
    .tab-item.active{color:var(--cyan);border-top-color:var(--cyan)}
    .tab-icon{font-size:18px;display:block;margin-bottom:2px}
    .tab-label{font-size:9px;font-weight:500}
    
    /* Tab Content */
    .tab-content{display:none;padding-bottom:70px;min-height:100vh}
    .tab-content.active{display:block}
    
    /* Header */
    .header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--bg2);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50}
    .logo{display:flex;align-items:center;gap:8px}
    .logo-icon{width:28px;height:28px;border-radius:7px;background:linear-gradient(135deg,var(--green),var(--cyan));display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:13px}
    .logo-text{font-size:15px;font-weight:700}
    .version{font-size:9px;color:var(--purple);background:rgba(139,92,246,0.15);padding:2px 6px;border-radius:8px;margin-left:6px}
    .status-badge{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--green)}
    .status-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    
    /* Cards */
    .card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;margin:12px 16px}
    .card-title{font-size:12px;font-weight:600;color:var(--muted);margin-bottom:12px;display:flex;align-items:center;gap:6px}
    
    /* Value Display */
    .value-hero{text-align:center;padding:24px 16px}
    .value-amount{font-size:52px;font-weight:800;background:linear-gradient(90deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .value-label{font-size:10px;color:var(--muted);letter-spacing:2px;margin-top:4px}
    .value-formula{font-size:9px;color:var(--muted);font-family:monospace;margin-top:6px}
    .value-breakdown{display:flex;justify-content:center;gap:20px;margin-top:16px}
    .breakdown-item{text-align:center}
    .breakdown-value{font-size:18px;font-weight:700}
    .breakdown-value.mint{color:var(--green)}
    .breakdown-value.tax{color:var(--red)}
    .breakdown-value.synergy{color:var(--purple)}
    .breakdown-label{font-size:9px;color:var(--muted)}
    
    /* Suggestion */
    .suggestion{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:20px;margin:0 16px}
    .sug-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .sug-cat{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--muted)}
    .proof-badge{display:flex;align-items:center;gap:4px;padding:3px 8px;background:rgba(139,92,246,0.15);border:1px solid rgba(139,92,246,0.3);border-radius:10px;font-size:9px;color:var(--purple)}
    .sug-text{font-size:16px;font-weight:600;line-height:1.4;margin-bottom:14px;text-align:center}
    .sug-text .hl{color:#00FFAA}
    .impact-row{display:flex;justify-content:center;gap:16px;padding:10px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);margin-bottom:14px}
    .impact-item{display:flex;align-items:center;gap:4px;font-size:11px}
    .impact-val{font-weight:700;color:var(--green)}
    .impact-val.neg{color:var(--muted)}
    .action-btns{display:flex;gap:10px}
    .btn-reject{flex:1;padding:12px;background:transparent;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:12px;font-weight:600;cursor:pointer}
    .btn-accept{flex:2;padding:12px;background:linear-gradient(135deg,#00FFAA,#00D1FF);border:none;border-radius:10px;color:var(--bg);font-size:13px;font-weight:700;cursor:pointer;box-shadow:0 0 20px rgba(0,255,170,0.4)}
    
    /* Outcome */
    .outcome{display:none;text-align:center;padding:24px}
    .outcome.visible{display:block;animation:fadeIn .3s}
    @keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
    .outcome-check{width:56px;height:56px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 12px;box-shadow:0 0 24px rgba(16,185,129,0.5)}
    .outcome-title{font-size:16px;font-weight:600;margin-bottom:6px}
    .outcome-hash{font-size:10px;font-family:monospace;color:var(--purple);margin-bottom:16px}
    .btn-next{padding:10px 20px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px;cursor:pointer}
    
    /* Genesis Injection */
    .genesis-section{padding:16px}
    .genesis-title{font-size:14px;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:6px}
    .node-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .node-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px;cursor:pointer;transition:all .15s}
    .node-card:hover{border-color:var(--cyan)}
    .node-card.active{border-color:var(--green);background:rgba(16,185,129,0.1)}
    .node-icon{font-size:24px;margin-bottom:6px}
    .node-name{font-size:12px;font-weight:600}
    .node-desc{font-size:10px;color:var(--muted)}
    .node-value{font-size:11px;color:var(--green);margin-top:4px}
    
    /* Input Forms */
    .form-group{margin-bottom:12px}
    .form-label{font-size:11px;color:var(--muted);margin-bottom:4px;display:block}
    .form-input{width:100%;padding:10px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px}
    .form-input:focus{outline:none;border-color:var(--cyan)}
    .form-textarea{min-height:80px;resize:vertical}
    .btn-primary{width:100%;padding:14px;background:linear-gradient(135deg,var(--green),var(--cyan));border:none;border-radius:10px;color:var(--bg);font-size:14px;font-weight:700;cursor:pointer;margin-top:12px}
    .btn-secondary{width:100%;padding:12px;background:var(--bg3);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:13px;cursor:pointer;margin-top:8px}
    
    /* P2P */
    .p2p-section{padding:16px}
    .qr-container{background:white;border-radius:12px;padding:16px;text-align:center;margin-bottom:16px}
    .qr-code{width:180px;height:180px;margin:0 auto;background:#eee;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#333}
    .peer-id-display{background:var(--bg3);border-radius:8px;padding:12px;font-family:monospace;font-size:13px;color:var(--cyan);text-align:center;margin-bottom:12px}
    .peer-list{margin-top:16px}
    .peer-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:var(--bg3);border-radius:8px;margin-bottom:8px}
    .peer-info{display:flex;align-items:center;gap:8px}
    .peer-status{width:8px;height:8px;border-radius:50%;background:var(--green)}
    .peer-status.offline{background:var(--muted)}
    .peer-name{font-size:12px}
    .peer-action{padding:6px 12px;background:var(--purple);border:none;border-radius:6px;color:white;font-size:10px;cursor:pointer}
    
    /* Gravity Map */
    .gravity-container{padding:16px}
    .gravity-canvas{width:100%;height:300px;background:var(--bg2);border:1px solid var(--border);border-radius:12px;position:relative;overflow:hidden}
    .gravity-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:48px;height:48px;background:linear-gradient(135deg,var(--green),var(--cyan));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;box-shadow:0 0 30px rgba(16,185,129,0.5);z-index:10}
    .gravity-orbit{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border:1px dashed rgba(255,255,255,0.1);border-radius:50%}
    .orbit-1{width:120px;height:120px}
    .orbit-2{width:200px;height:200px}
    .orbit-3{width:280px;height:280px}
    .gravity-node{position:absolute;width:32px;height:32px;background:var(--bg3);border:2px solid var(--purple);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;transition:all .2s}
    .gravity-node:hover{transform:scale(1.2);border-color:var(--cyan)}
    .gravity-node.family{border-color:var(--orange)}
    .gravity-node.business{border-color:var(--green)}
    
    /* Ledger */
    .ledger-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;padding:0 16px}
    .ledger-stat{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
    .stat-value{font-size:20px;font-weight:700;color:var(--purple)}
    .stat-label{font-size:9px;color:var(--muted);text-transform:uppercase}
    .ledger-list{margin:0 16px}
    .ledger-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;margin-bottom:8px;font-size:11px}
    .ledger-hash{font-family:monospace;color:var(--purple)}
    .ledger-type{padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600}
    .ledger-type.accept{background:rgba(16,185,129,0.2);color:var(--green)}
    .ledger-type.reject{background:rgba(239,68,68,0.2);color:var(--red)}
    .ledger-type.genesis{background:rgba(139,92,246,0.2);color:var(--purple)}
    .ledger-type.inject{background:rgba(245,158,11,0.2);color:var(--orange)}
    .ledger-delta{color:var(--green);font-weight:600}
    .ledger-time{margin-left:auto;color:var(--muted)}
    
    /* Settings */
    .settings-section{padding:16px}
    .settings-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
    .settings-label{font-size:13px}
    .settings-value{font-size:12px;color:var(--muted)}
    .btn-danger{width:100%;padding:12px;background:rgba(239,68,68,0.2);border:1px solid rgba(239,68,68,0.3);border-radius:10px;color:var(--red);font-size:13px;cursor:pointer;margin-top:12px}
    
    /* File Upload */
    .file-drop{border:2px dashed var(--border);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:all .2s}
    .file-drop:hover{border-color:var(--cyan);background:rgba(6,182,212,0.05)}
    .file-drop.dragover{border-color:var(--green);background:rgba(16,185,129,0.1)}
    .file-icon{font-size:32px;margin-bottom:8px}
    .file-text{font-size:12px;color:var(--muted)}
    
    /* Toast */
    .toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:12px 20px;background:var(--green);color:var(--bg);border-radius:8px;font-size:13px;font-weight:600;z-index:1000;opacity:0;transition:opacity .3s}
    .toast.visible{opacity:1}
  </style>
</head>
<body>

  <!-- Toast -->
  <div class="toast" id="toast">âœ“ Recorded to Ledger</div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 1: DAILY OS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content active" id="tabDaily">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">A</div>
        <span class="logo-text">AUTUS</span>
        <span class="version">v15.1</span>
      </div>
      <div class="status-badge">
        <div class="status-dot"></div>
        <span id="blockCount">0 blocks</span>
      </div>
    </header>
    
    <div class="value-hero">
      <div class="value-amount" id="valueDisplay">0</div>
      <div class="value-label">ìì‚° ê°€ì¹˜ (V)</div>
      <div class="value-formula">V = (M - T) Ã— (1 + s)^t</div>
      <div class="value-breakdown">
        <div class="breakdown-item">
          <div class="breakdown-value mint" id="mintDisplay">0</div>
          <div class="breakdown-label">Mint (M)</div>
        </div>
        <div class="breakdown-item">
          <div class="breakdown-value tax" id="taxDisplay">0</div>
          <div class="breakdown-label">Tax (T)</div>
        </div>
        <div class="breakdown-item">
          <div class="breakdown-value synergy" id="synergyDisplay">0.00</div>
          <div class="breakdown-label">Synergy (s)</div>
        </div>
      </div>
    </div>
    
    <div class="suggestion" id="suggestionCard">
      <div class="sug-header">
        <div class="sug-cat">
          <span id="sugIcon">ğŸ“Š</span>
          <span id="sugCat">ì¬ë¬´</span>
        </div>
        <div class="proof-badge">ğŸ” Proof Ready</div>
      </div>
      <div class="sug-text" id="sugText">ìë™í™” â†’ <span class="hl">4.2ì‹œê°„</span> íšŒìˆ˜</div>
      <div class="impact-row">
        <div class="impact-item">ğŸ’° <span class="impact-val" id="impactMint">+12</span> M</div>
        <div class="impact-item">ğŸ“‰ <span class="impact-val neg" id="impactTax">-4</span> T</div>
        <div class="impact-item">ğŸ¤ <span class="impact-val" id="impactSynergy">+0.10</span> s</div>
      </div>
      <div class="action-btns">
        <button class="btn-reject" onclick="handleReject()">Reject</button>
        <button class="btn-accept" onclick="handleAccept()">âœ“ ACCEPT</button>
      </div>
    </div>
    
    <div class="outcome" id="outcomeCard">
      <div class="outcome-check">âœ“</div>
      <div class="outcome-title">Recorded to Ledger</div>
      <div class="outcome-hash" id="outcomeHash">Hash: 0x0000...</div>
      <button class="btn-next" onclick="loadNext()">ë‹¤ìŒ ê²°ì • â†’</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 2: GENESIS INJECTION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tabGenesis">
    <header class="header">
      <div class="logo">
        <span style="font-size:18px">ğŸ’</span>
        <span class="logo-text">Genesis Injection</span>
      </div>
    </header>
    
    <div class="genesis-section">
      <div class="genesis-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ìì‚° ë…¸ë“œ</div>
      <div class="node-grid" id="familyNodes">
        <div class="node-card" onclick="selectNode(this,'family','ì¥ë‚¨')" data-type="family">
          <div class="node-icon">ğŸ‘¨â€ğŸ“</div>
          <div class="node-name">ì¥ë‚¨</div>
          <div class="node-desc">20ëŒ€ ëŒ€í•™ ì‹ ì…ìƒ</div>
          <div class="node-value">êµìœ¡ íˆ¬ì</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'family','ë”¸1')" data-type="family">
          <div class="node-icon">ğŸ‘§</div>
          <div class="node-name">ë”¸ (í•„ë¦¬í•€)</div>
          <div class="node-desc">ê³ 1</div>
          <div class="node-value">êµ­ì œ êµìœ¡</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'family','ë”¸2')" data-type="family">
          <div class="node-icon">ğŸ‘§</div>
          <div class="node-name">ë”¸2 (í•„ë¦¬í•€)</div>
          <div class="node-desc">ê³ 1</div>
          <div class="node-value">êµ­ì œ êµìœ¡</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'family','ì—°ìš°')" data-type="family">
          <div class="node-icon">ğŸ§’</div>
          <div class="node-name">ì—°ìš°</div>
          <div class="node-desc">êµ­ì œí•™êµ 6í•™ë…„</div>
          <div class="node-value">ì„±ì¥ íˆ¬ì</div>
        </div>
      </div>
    </div>
    
    <div class="genesis-section">
      <div class="genesis-title">ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤ ë…¸ë“œ</div>
      <div class="node-grid" id="businessNodes">
        <div class="node-card" onclick="selectNode(this,'business','ìŠ¤ì™€íŠ¼')" data-type="business">
          <div class="node-icon">ğŸ“š</div>
          <div class="node-name">ìŠ¤ì™€íŠ¼</div>
          <div class="node-desc">í•™ì› ë¸Œëœë“œ</div>
          <div class="node-value">Mint ìƒì„±</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'business','í”„ë¼ìš°ë“œ7')" data-type="business">
          <div class="node-icon">ğŸ¯</div>
          <div class="node-name">í”„ë¼ìš°ë“œ7</div>
          <div class="node-desc">í•™ì› ë¸Œëœë“œ</div>
          <div class="node-value">Mint ìƒì„±</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'business','ê·¸ë¡œíŠ¼')" data-type="business">
          <div class="node-icon">ğŸŒ±</div>
          <div class="node-name">ê·¸ë¡œíŠ¼</div>
          <div class="node-desc">í•™ì› ë¸Œëœë“œ</div>
          <div class="node-value">Mint ìƒì„±</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'business','ì—ë°€í„´')" data-type="business">
          <div class="node-icon">ğŸ†</div>
          <div class="node-name">ì—ë°€í„´</div>
          <div class="node-desc">í•™ì› ë¸Œëœë“œ</div>
          <div class="node-value">Mint ìƒì„±</div>
        </div>
        <div class="node-card" onclick="selectNode(this,'business','í•„ë¦¬í•€IP')" data-type="business">
          <div class="node-icon">ğŸŒ</div>
          <div class="node-name">í•„ë¦¬í•€ IP í™€ë”©ìŠ¤</div>
          <div class="node-desc">ìê¸ˆ íë¦„</div>
          <div class="node-value">í•´ì™¸ ìì‚°</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ“¤ ë°ì´í„° ì—…ë¡œë“œ</div>
      <div class="file-drop" id="fileDrop" onclick="document.getElementById('fileInput').click()">
        <div class="file-icon">ğŸ“</div>
        <div class="file-text">CSV/JSON íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­</div>
      </div>
      <input type="file" id="fileInput" accept=".csv,.json" style="display:none" onchange="handleFileUpload(event)">
      <button class="btn-primary" onclick="injectGenesis()">ğŸ” Genesis Block ìƒì„±</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 3: P2P SYNC
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tabP2P">
    <header class="header">
      <div class="logo">
        <span style="font-size:18px">ğŸ”—</span>
        <span class="logo-text">P2P Sync</span>
      </div>
    </header>
    
    <div class="p2p-section">
      <div class="card-title">ğŸ†” ë‚´ Peer ID</div>
      <div class="peer-id-display" id="myPeerId">AUTUS-XXXXXXXX</div>
      
      <div class="qr-container">
        <div class="qr-code" id="qrCode">QR Code</div>
      </div>
      
      <button class="btn-primary" onclick="createOffer()">ğŸ“¡ Offer ìƒì„±</button>
      <button class="btn-secondary" onclick="scanQR()">ğŸ“· QR ìŠ¤ìº”</button>
    </div>
    
    <div class="p2p-section">
      <div class="card-title">ğŸ‘¥ ì—°ê²°ëœ Peers</div>
      <div class="peer-list" id="peerList">
        <div class="peer-item">
          <div class="peer-info">
            <div class="peer-status offline"></div>
            <span class="peer-name">ì—°ê²° ëŒ€ê¸° ì¤‘...</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card" style="margin:16px;background:rgba(139,92,246,0.1);border-color:rgba(139,92,246,0.3)">
      <div class="card-title" style="color:var(--purple)">ğŸ›¡ï¸ Data Sovereignty</div>
      <p style="font-size:11px;color:var(--muted);line-height:1.5">
        ëª¨ë“  ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br>
        P2P ì—°ê²° ì‹œì—ë§Œ ì„ íƒí•œ ë°ì´í„°ê°€ ì „ì†¡ë©ë‹ˆë‹¤.<br>
        <strong style="color:var(--green)">Zero-Cloud Â· On-Device Only</strong>
      </p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 4: GRAVITY MAP (1-12-144)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tabGravity">
    <header class="header">
      <div class="logo">
        <span style="font-size:18px">ğŸŒ</span>
        <span class="logo-text">1-12-144 ì¤‘ë ¥ì¥</span>
      </div>
    </header>
    
    <div class="gravity-container">
      <div class="gravity-canvas" id="gravityCanvas">
        <div class="gravity-orbit orbit-1"></div>
        <div class="gravity-orbit orbit-2"></div>
        <div class="gravity-orbit orbit-3"></div>
        <div class="gravity-center">ë‚˜</div>
        <!-- Nodes injected by JS -->
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ“Š Catalyst ë¶„ì„</div>
      <div id="catalystList" style="font-size:12px;color:var(--muted)">
        Genesis Injection í›„ í™œì„±í™”ë©ë‹ˆë‹¤.
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">âš ï¸ ê´€ê³„ ë¦¬ìŠ¤í¬ ê²½ê³ </div>
      <div id="riskWarning" style="font-size:12px;color:var(--muted)">
        ë°ì´í„° ì£¼ì… í›„ ì‹œë®¬ë ˆì´ì…˜ì´ ì‹œì‘ë©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 5: LEDGER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tabLedger">
    <header class="header">
      <div class="logo">
        <span style="font-size:18px">ğŸ”</span>
        <span class="logo-text">Immutable Ledger</span>
      </div>
    </header>
    
    <div class="ledger-stats">
      <div class="ledger-stat">
        <div class="stat-value" id="statBlocks">0</div>
        <div class="stat-label">Blocks</div>
      </div>
      <div class="ledger-stat">
        <div class="stat-value" id="statAccepts">0</div>
        <div class="stat-label">Accepts</div>
      </div>
      <div class="ledger-stat">
        <div class="stat-value" id="statRejects">0</div>
        <div class="stat-label">Rejects</div>
      </div>
    </div>
    
    <div class="ledger-list" id="ledgerList">
      <div class="ledger-item" style="justify-content:center;color:var(--muted)">
        ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 6: SETTINGS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tabSettings">
    <header class="header">
      <div class="logo">
        <span style="font-size:18px">âš™ï¸</span>
        <span class="logo-text">Settings</span>
      </div>
    </header>
    
    <div class="settings-section">
      <div class="settings-item">
        <span class="settings-label">Storage Engine</span>
        <span class="settings-value">IndexedDB (Local)</span>
      </div>
      <div class="settings-item">
        <span class="settings-label">Cloud Sync</span>
        <span class="settings-value" style="color:var(--green)">Disabled (Sovereign)</span>
      </div>
      <div class="settings-item">
        <span class="settings-label">Encryption</span>
        <span class="settings-value">AES-256-GCM</span>
      </div>
      <div class="settings-item">
        <span class="settings-label">Total Value (V)</span>
        <span class="settings-value" id="settingsValue">0</span>
      </div>
      <div class="settings-item">
        <span class="settings-label">Total Blocks</span>
        <span class="settings-value" id="settingsBlocks">0</span>
      </div>
      <div class="settings-item">
        <span class="settings-label">Peer ID</span>
        <span class="settings-value" id="settingsPeerId">-</span>
      </div>
    </div>
    
    <div class="settings-section">
      <button class="btn-secondary" onclick="exportData()">ğŸ“¤ Export All Data</button>
      <button class="btn-danger" onclick="resetAll()">ğŸ—‘ï¸ Reset All Data</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB NAVIGATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="tab-nav">
    <div class="tab-item active" onclick="switchTab('tabDaily')">
      <span class="tab-icon">âš¡</span>
      <span class="tab-label">Daily</span>
    </div>
    <div class="tab-item" onclick="switchTab('tabGenesis')">
      <span class="tab-icon">ğŸ’</span>
      <span class="tab-label">Genesis</span>
    </div>
    <div class="tab-item" onclick="switchTab('tabP2P')">
      <span class="tab-icon">ğŸ”—</span>
      <span class="tab-label">P2P</span>
    </div>
    <div class="tab-item" onclick="switchTab('tabGravity')">
      <span class="tab-icon">ğŸŒ</span>
      <span class="tab-label">Gravity</span>
    </div>
    <div class="tab-item" onclick="switchTab('tabLedger')">
      <span class="tab-icon">ğŸ”</span>
      <span class="tab-label">Ledger</span>
    </div>
    <div class="tab-item" onclick="switchTab('tabSettings')">
      <span class="tab-icon">âš™ï¸</span>
      <span class="tab-label">ì„¤ì •</span>
    </div>
  </nav>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INDEXEDDB
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const DB_NAME = 'autus_sovereign_v15';
    const DB_VERSION = 2;
    let db = null;
    
    function initDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => { db = request.result; resolve(db); };
        request.onupgradeneeded = (e) => {
          const database = e.target.result;
          if (!database.objectStoreNames.contains('ledger')) {
            const store = database.createObjectStore('ledger', { keyPath: 'hash' });
            store.createIndex('timestamp', 'timestamp', { unique: false });
          }
          if (!database.objectStoreNames.contains('state')) {
            database.createObjectStore('state', { keyPath: 'key' });
          }
          if (!database.objectStoreNames.contains('nodes')) {
            const nodeStore = database.createObjectStore('nodes', { keyPath: 'id' });
            nodeStore.createIndex('type', 'type', { unique: false });
          }
        };
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const state = {
      V: 0, M: 0, T: 0, s: 0, index: 0,
      peerId: 'AUTUS-' + Math.random().toString(36).substring(2, 10).toUpperCase(),
      selectedNodes: [],
      injectedNodes: []
    };
    
    async function loadState() {
      return new Promise((resolve) => {
        const tx = db.transaction('state', 'readonly');
        const store = tx.objectStore('state');
        const request = store.get('main');
        request.onsuccess = () => {
          if (request.result) Object.assign(state, request.result.data);
          resolve();
        };
        request.onerror = () => resolve();
      });
    }
    
    async function saveState() {
      return new Promise((resolve) => {
        const tx = db.transaction('state', 'readwrite');
        const store = tx.objectStore('state');
        store.put({ key: 'main', data: state });
        tx.oncomplete = () => resolve();
      });
    }
    
    function calculateV() {
      state.V = Math.round((state.M - state.T) * Math.pow(1 + state.s, 1));
      return state.V;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEDGER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    async function getLastBlock() {
      return new Promise((resolve) => {
        const tx = db.transaction('ledger', 'readonly');
        const store = tx.objectStore('ledger');
        const index = store.index('timestamp');
        const request = index.openCursor(null, 'prev');
        request.onsuccess = (e) => {
          const cursor = e.target.result;
          resolve(cursor ? cursor.value : { hash: 'AUTUS_GENESIS_V15', prev_hash: '0000000000000000', timestamp: new Date().toISOString(), type: 'genesis' });
        };
      });
    }
    
    async function addBlock(type, payload) {
      const lastBlock = await getLastBlock();
      const timestamp = new Date().toISOString();
      const hash = await sha256(JSON.stringify({ prev_hash: lastBlock.hash, timestamp, type, payload }));
      const block = { hash, prev_hash: lastBlock.hash, timestamp, type, payload };
      return new Promise((resolve, reject) => {
        const tx = db.transaction('ledger', 'readwrite');
        const store = tx.objectStore('ledger');
        const request = store.add(block);
        request.onsuccess = () => resolve(block);
        request.onerror = () => reject(request.error);
      });
    }
    
    async function getAllBlocks() {
      return new Promise((resolve) => {
        const tx = db.transaction('ledger', 'readonly');
        const store = tx.objectStore('ledger');
        const index = store.index('timestamp');
        const request = index.getAll();
        request.onsuccess = () => resolve(request.result);
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SUGGESTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const suggestions = [
      { icon: 'ğŸ“š', cat: 'ìŠ¤ì™€íŠ¼', text: 'ì›”ê°„ ë§¤ì¶œ ë¦¬í¬íŠ¸ â†’ <span class="hl">ìë™í™”</span>', mint: 15, tax: 3, synergy: 0.12 },
      { icon: 'ğŸ¯', cat: 'í”„ë¼ìš°ë“œ7', text: 'ì‹ ê·œ ë“±ë¡ <span class="hl">7ëª…</span> í™•ì¸ í•„ìš”', mint: 21, tax: 5, synergy: 0.15 },
      { icon: 'ğŸ‘¨â€ğŸ“', cat: 'ì¥ë‚¨', text: 'ëŒ€í•™ ë“±ë¡ê¸ˆ <span class="hl">ë‚©ë¶€ ì¼ì •</span>', mint: 0, tax: 8, synergy: 0.20 },
      { icon: 'ğŸŒ', cat: 'í•„ë¦¬í•€IP', text: 'í™˜ìœ¨ <span class="hl">1,350ì›</span> ì†¡ê¸ˆ ì ê¸°', mint: 10, tax: 2, synergy: 0.08 },
      { icon: 'ğŸ§’', cat: 'ì—°ìš°', text: 'êµ­ì œí•™êµ <span class="hl">í•™ê¸°ë§ ì‹œí—˜</span> D-7', mint: 5, tax: 1, synergy: 0.25 }
    ];
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TAB NAVIGATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.currentTarget.classList.add('active');
      if (tabId === 'tabLedger') updateLedgerUI();
      if (tabId === 'tabGravity') renderGravityMap();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI UPDATES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateUI() {
      document.getElementById('valueDisplay').textContent = state.V;
      document.getElementById('mintDisplay').textContent = state.M;
      document.getElementById('taxDisplay').textContent = state.T;
      document.getElementById('synergyDisplay').textContent = state.s.toFixed(2);
      document.getElementById('myPeerId').textContent = state.peerId;
      document.getElementById('settingsValue').textContent = state.V;
      document.getElementById('settingsPeerId').textContent = state.peerId;
    }
    
    async function updateLedgerUI() {
      const blocks = await getAllBlocks();
      document.getElementById('blockCount').textContent = `${blocks.length} blocks`;
      document.getElementById('statBlocks').textContent = blocks.length;
      document.getElementById('settingsBlocks').textContent = blocks.length;
      
      const accepts = blocks.filter(b => b.payload?.action === 'accept').length;
      const rejects = blocks.filter(b => b.payload?.action === 'reject').length;
      document.getElementById('statAccepts').textContent = accepts;
      document.getElementById('statRejects').textContent = rejects;
      
      const list = document.getElementById('ledgerList');
      if (blocks.length === 0) {
        list.innerHTML = '<div class="ledger-item" style="justify-content:center;color:var(--muted)">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      
      list.innerHTML = blocks.slice().reverse().slice(0, 20).map(block => {
        const action = block.payload?.action || block.type;
        const typeClass = action === 'accept' ? 'accept' : action === 'reject' ? 'reject' : action === 'inject' ? 'inject' : 'genesis';
        const delta = block.payload?.delta || 0;
        const time = new Date(block.timestamp).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        return `<div class="ledger-item">
          <span class="ledger-hash">${block.hash.substring(0, 10)}...</span>
          <span class="ledger-type ${typeClass}">${action.toUpperCase()}</span>
          <span class="ledger-delta">${delta > 0 ? '+' + delta : delta}</span>
          <span class="ledger-time">${time}</span>
        </div>`;
      }).join('');
    }
    
    function loadSuggestion() {
      const sug = suggestions[state.index];
      document.getElementById('sugIcon').textContent = sug.icon;
      document.getElementById('sugCat').textContent = sug.cat;
      document.getElementById('sugText').innerHTML = sug.text;
      document.getElementById('impactMint').textContent = '+' + sug.mint;
      document.getElementById('impactTax').textContent = '-' + sug.tax;
      document.getElementById('impactSynergy').textContent = '+' + sug.synergy.toFixed(2);
    }
    
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('visible');
      setTimeout(() => toast.classList.remove('visible'), 2000);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ACTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function handleAccept() {
      const sug = suggestions[state.index];
      const oldV = state.V;
      state.M += sug.mint;
      state.T += sug.tax;
      state.s = Math.min(1, state.s + sug.synergy);
      calculateV();
      
      const block = await addBlock('decision', { action: 'accept', suggestion: sug.cat, mint: sug.mint, tax: sug.tax, synergy: sug.synergy, delta: state.V - oldV });
      await saveState();
      
      document.getElementById('suggestionCard').style.display = 'none';
      document.getElementById('outcomeCard').classList.add('visible');
      document.getElementById('outcomeHash').textContent = `Hash: ${block.hash.substring(0, 20)}...`;
      
      updateUI();
      updateLedgerUI();
      showToast('âœ“ Recorded to Ledger');
    }
    
    async function handleReject() {
      const sug = suggestions[state.index];
      await addBlock('decision', { action: 'reject', suggestion: sug.cat, delta: 0 });
      await saveState();
      await updateLedgerUI();
      loadNext();
    }
    
    function loadNext() {
      state.index = (state.index + 1) % suggestions.length;
      loadSuggestion();
      document.getElementById('suggestionCard').style.display = 'block';
      document.getElementById('outcomeCard').classList.remove('visible');
      saveState();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GENESIS INJECTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function selectNode(el, type, name) {
      el.classList.toggle('active');
      const idx = state.selectedNodes.findIndex(n => n.name === name);
      if (idx >= 0) {
        state.selectedNodes.splice(idx, 1);
      } else {
        state.selectedNodes.push({ type, name });
      }
    }
    
    async function injectGenesis() {
      if (state.selectedNodes.length === 0) {
        alert('ìµœì†Œ 1ê°œì˜ ë…¸ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      
      // Add nodes to ledger
      for (const node of state.selectedNodes) {
        const mintValue = node.type === 'business' ? 20 : 5;
        state.M += mintValue;
        state.s = Math.min(1, state.s + 0.05);
        
        await addBlock('injection', {
          action: 'inject',
          node_type: node.type,
          node_name: node.name,
          mint: mintValue,
          delta: mintValue
        });
        
        state.injectedNodes.push(node);
      }
      
      calculateV();
      await saveState();
      updateUI();
      await updateLedgerUI();
      
      showToast(`âœ“ ${state.selectedNodes.length}ê°œ ë…¸ë“œ Genesis ì™„ë£Œ`);
      state.selectedNodes = [];
      document.querySelectorAll('.node-card').forEach(c => c.classList.remove('active'));
      
      // Update catalyst analysis
      updateCatalystAnalysis();
    }
    
    function updateCatalystAnalysis() {
      const catalyst = document.getElementById('catalystList');
      if (state.injectedNodes.length === 0) {
        catalyst.innerHTML = 'Genesis Injection í›„ í™œì„±í™”ë©ë‹ˆë‹¤.';
        return;
      }
      
      const businessNodes = state.injectedNodes.filter(n => n.type === 'business');
      const familyNodes = state.injectedNodes.filter(n => n.type === 'family');
      
      catalyst.innerHTML = `
        <div style="margin-bottom:8px"><strong style="color:var(--green)">ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤:</strong> ${businessNodes.map(n => n.name).join(', ') || 'ì—†ìŒ'}</div>
        <div><strong style="color:var(--orange)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±:</strong> ${familyNodes.map(n => n.name).join(', ') || 'ì—†ìŒ'}</div>
        <div style="margin-top:12px;padding:8px;background:rgba(16,185,129,0.1);border-radius:6px;color:var(--green)">
          Synergy ì§€ìˆ˜: ${state.s.toFixed(2)} | ì´ Mint: ${state.M}
        </div>
      `;
      
      // Risk warning
      const risk = document.getElementById('riskWarning');
      if (familyNodes.length > 0) {
        risk.innerHTML = `
          <div style="color:var(--orange)">âš ï¸ ê´€ê³„ ìœ ì§€ í•„ìš”:</div>
          <div style="margin-top:4px">${familyNodes.map(n => `â€¢ ${n.name}: ì£¼ê°„ ì—°ë½ ê¶Œì¥`).join('<br>')}</div>
        `;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FILE UPLOAD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const fileDrop = document.getElementById('fileDrop');
    fileDrop.addEventListener('dragover', (e) => { e.preventDefault(); fileDrop.classList.add('dragover'); });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) processFile(file);
    });
    
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (file) processFile(file);
    }
    
    async function processFile(file) {
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          let data;
          if (file.name.endsWith('.json')) {
            data = JSON.parse(e.target.result);
          } else {
            // CSV parsing
            const lines = e.target.result.split('\n');
            data = lines.slice(1).map(line => {
              const [name, type, value] = line.split(',');
              return { name, type, value: parseInt(value) || 0 };
            }).filter(d => d.name);
          }
          
          // Inject data
          for (const item of data) {
            state.M += item.value || 10;
            await addBlock('injection', {
              action: 'inject',
              node_name: item.name,
              node_type: item.type || 'data',
              mint: item.value || 10,
              delta: item.value || 10
            });
          }
          
          calculateV();
          await saveState();
          updateUI();
          await updateLedgerUI();
          showToast(`âœ“ ${data.length}ê°œ ë°ì´í„° ì£¼ì… ì™„ë£Œ`);
        } catch (err) {
          alert('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // P2P
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let peerConnection = null;
    
    async function createOffer() {
      const pc = new RTCPeerConnection();
      const dc = pc.createDataChannel('autus_sync');
      peerConnection = pc;
      
      pc.onicecandidate = (e) => {
        if (!e.candidate) {
          const offer = JSON.stringify({ type: 'offer', peerId: state.peerId, sdp: pc.localDescription });
          generateQR(offer);
          showToast('Offer QR ìƒì„±ë¨');
        }
      };
      
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    }
    
    function generateQR(data) {
      // Simple QR placeholder - in production use qrcode.js
      const qr = document.getElementById('qrCode');
      qr.innerHTML = `<div style="word-break:break-all;font-size:8px;max-height:160px;overflow:auto">${data.substring(0, 200)}...</div>`;
      qr.style.background = '#fff';
      qr.style.color = '#333';
    }
    
    function scanQR() {
      // In production: use camera API
      const data = prompt('ì—°ê²° ë°ì´í„° ë¶™ì—¬ë„£ê¸°:');
      if (data) processConnection(data);
    }
    
    async function processConnection(data) {
      try {
        const parsed = JSON.parse(data);
        if (parsed.type === 'offer') {
          const pc = new RTCPeerConnection();
          peerConnection = pc;
          
          pc.ondatachannel = (e) => {
            updatePeerList(parsed.peerId);
            showToast('P2P ì—°ê²° ì™„ë£Œ!');
          };
          
          pc.onicecandidate = (e) => {
            if (!e.candidate) {
              const answer = JSON.stringify({ type: 'answer', peerId: state.peerId, sdp: pc.localDescription });
              prompt('Answerë¥¼ ìƒëŒ€ë°©ì—ê²Œ ì „ë‹¬:', answer);
            }
          };
          
          await pc.setRemoteDescription(parsed.sdp);
          const answer = await pc.createAnswer();
          await pc.setLocalDescription(answer);
        } else if (parsed.type === 'answer') {
          await peerConnection.setRemoteDescription(parsed.sdp);
          updatePeerList(parsed.peerId);
          showToast('P2P ì—°ê²° ì™„ë£Œ!');
        }
      } catch (e) {
        alert('ì—°ê²° ì˜¤ë¥˜: ' + e.message);
      }
    }
    
    function updatePeerList(peerId) {
      document.getElementById('peerList').innerHTML = `
        <div class="peer-item">
          <div class="peer-info">
            <div class="peer-status"></div>
            <span class="peer-name">${peerId}</span>
          </div>
          <button class="peer-action" onclick="syncWithPeer('${peerId}')">Sync</button>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GRAVITY MAP
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderGravityMap() {
      const canvas = document.getElementById('gravityCanvas');
      // Remove existing nodes
      canvas.querySelectorAll('.gravity-node').forEach(n => n.remove());
      
      const nodes = [
        { name: 'ì¥ë‚¨', icon: 'ğŸ‘¨â€ğŸ“', type: 'family', angle: 0, orbit: 1 },
        { name: 'ë”¸1', icon: 'ğŸ‘§', type: 'family', angle: 72, orbit: 1 },
        { name: 'ë”¸2', icon: 'ğŸ‘§', type: 'family', angle: 144, orbit: 1 },
        { name: 'ì—°ìš°', icon: 'ğŸ§’', type: 'family', angle: 216, orbit: 1 },
        { name: 'ìŠ¤ì™€íŠ¼', icon: 'ğŸ“š', type: 'business', angle: 288, orbit: 1 },
        { name: 'í”„ë¼ìš°ë“œ7', icon: 'ğŸ¯', type: 'business', angle: 30, orbit: 2 },
        { name: 'ê·¸ë¡œíŠ¼', icon: 'ğŸŒ±', type: 'business', angle: 90, orbit: 2 },
        { name: 'ì—ë°€í„´', icon: 'ğŸ†', type: 'business', angle: 150, orbit: 2 },
        { name: 'í•„ë¦¬í•€IP', icon: 'ğŸŒ', type: 'business', angle: 210, orbit: 2 },
      ];
      
      nodes.forEach(node => {
        const radius = node.orbit === 1 ? 60 : 100;
        const rad = (node.angle * Math.PI) / 180;
        const x = 50 + (radius / 150) * 50 * Math.cos(rad);
        const y = 50 + (radius / 150) * 50 * Math.sin(rad);
        
        const el = document.createElement('div');
        el.className = `gravity-node ${node.type}`;
        el.style.left = `calc(${x}% - 16px)`;
        el.style.top = `calc(${y}% - 16px)`;
        el.textContent = node.icon;
        el.title = node.name;
        el.onclick = () => showToast(`${node.name} ì„ íƒë¨`);
        canvas.appendChild(el);
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SETTINGS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function exportData() {
      const blocks = await getAllBlocks();
      const exportObj = {
        version: '15.1.0',
        peerId: state.peerId,
        state: { V: state.V, M: state.M, T: state.T, s: state.s },
        nodes: state.injectedNodes,
        ledger: blocks
      };
      
      const blob = new Blob([JSON.stringify(exportObj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `autus-sovereign-${Date.now()}.json`;
      a.click();
    }
    
    function resetAll() {
      if (confirm('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        indexedDB.deleteDatabase(DB_NAME);
        location.reload();
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEYBOARD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('keydown', (e) => {
      if (e.key === 'a' || e.key === 'A') handleAccept();
      if (e.key === 'r' || e.key === 'R') handleReject();
    });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function init() {
      await initDB();
      await loadState();
      calculateV();
      updateUI();
      loadSuggestion();
      await updateLedgerUI();
      updateCatalystAnalysis();
      
      console.log('[AUTUS v15.1] Sovereign Master Active');
      console.log('[AUTUS] Peer ID:', state.peerId);
      console.log('[AUTUS] Zero-Cloud: All data stored locally');
    }
    
    init();
  </script>
</body>
</html>
