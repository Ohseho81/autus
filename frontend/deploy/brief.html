<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AUTUS | Daily Brief</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #0a0f1a;
      --surface: #111827;
      --surface-2: #1f2937;
      --border: #374151;
      --text: #f9fafb;
      --text-dim: #9ca3af;
      --primary: #10b981;
      --blue: #3b82f6;
      --purple: #8b5cf6;
      --yellow: #f59e0b;
      --red: #ef4444;
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Header */
    .header {
      text-align: center;
      padding: 30px 0;
    }
    
    .greeting {
      font-size: 14px;
      color: var(--text-dim);
      margin-bottom: 8px;
    }
    
    .date {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 20px;
      background: var(--surface-2);
      color: var(--text-dim);
    }
    
    .card-badge.important {
      background: rgba(239, 68, 68, 0.2);
      color: var(--red);
    }
    
    /* Event Item */
    .event-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .event-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    
    .event-time {
      font-size: 12px;
      font-weight: 700;
      color: var(--blue);
      min-width: 50px;
    }
    
    .event-content {
      flex: 1;
    }
    
    .event-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .event-meta {
      font-size: 12px;
      color: var(--text-dim);
    }
    
    /* Email Item */
    .email-item {
      padding: 12px;
      background: var(--surface-2);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .email-item:last-child {
      margin-bottom: 0;
    }
    
    .email-from {
      font-size: 11px;
      color: var(--text-dim);
      margin-bottom: 4px;
    }
    
    .email-subject {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .email-preview {
      font-size: 12px;
      color: var(--text-dim);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* Message Item */
    .message-item {
      display: flex;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .message-item:last-child {
      border-bottom: none;
    }
    
    .message-channel {
      font-size: 11px;
      color: var(--purple);
      font-weight: 600;
    }
    
    .message-text {
      font-size: 13px;
      color: var(--text-dim);
    }
    
    /* Recommendation */
    .recommendation {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .recommendation:last-child {
      margin-bottom: 0;
    }
    
    .recommendation-icon {
      font-size: 20px;
    }
    
    .recommendation-text {
      font-size: 13px;
      line-height: 1.5;
    }
    
    /* Summary Stats */
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
      padding: 12px;
      background: var(--surface-2);
      border-radius: 10px;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--primary);
    }
    
    .stat-label {
      font-size: 10px;
      color: var(--text-dim);
      margin-top: 2px;
    }
    
    /* Sync Button */
    .sync-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary), var(--blue));
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .sync-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }
    
    .sync-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 30px;
      color: var(--text-dim);
    }
    
    .empty-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      width: 30px;
      height: 30px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Footer Nav */
    .footer-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    
    .nav-item {
      text-align: center;
      color: var(--text-dim);
      text-decoration: none;
      font-size: 10px;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    .nav-icon {
      font-size: 20px;
      display: block;
      margin-bottom: 2px;
    }
    
    /* Bottom padding for nav */
    .container {
      padding-bottom: 80px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="greeting">â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”</div>
      <div class="date" id="todayDate">ì˜¤ëŠ˜</div>
    </div>
    
    <!-- Summary -->
    <div class="card">
      <div class="summary-stats" id="summaryStats">
        <div class="stat-item">
          <div class="stat-value" id="emailCount">-</div>
          <div class="stat-label">ì´ë©”ì¼</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="eventCount">-</div>
          <div class="stat-label">ì¼ì •</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="messageCount">-</div>
          <div class="stat-label">ë©”ì‹œì§€</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalCount">-</div>
          <div class="stat-label">ì „ì²´</div>
        </div>
      </div>
      <button class="sync-btn" id="syncBtn" onclick="syncData()">
        <span>ğŸ”„</span> ìƒˆë¡œê³ ì¹¨
      </button>
    </div>
    
    <!-- Today's Events -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ğŸ“… ì˜¤ëŠ˜ ì¼ì •</div>
        <div class="card-badge" id="eventBadge">0ê°œ</div>
      </div>
      <div id="eventsList">
        <div class="empty-state">
          <div class="empty-icon">ğŸ‰</div>
          <div>ì˜¤ëŠ˜ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
    
    <!-- Important Emails -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ğŸ“§ ì¤‘ìš” ì´ë©”ì¼</div>
        <div class="card-badge important" id="emailBadge">0ê°œ</div>
      </div>
      <div id="emailsList">
        <div class="empty-state">
          <div class="empty-icon">âœ…</div>
          <div>ì¤‘ìš” ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
    
    <!-- Recent Messages -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ğŸ’¬ ìµœê·¼ ë©”ì‹œì§€</div>
        <div class="card-badge" id="messageBadge">0ê°œ</div>
      </div>
      <div id="messagesList">
        <div class="empty-state">
          <div class="empty-icon">ğŸ’¤</div>
          <div>ìƒˆ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
    
    <!-- Recommendations -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ğŸ’¡ ì˜¤ëŠ˜ì˜ ì¶”ì²œ</div>
      </div>
      <div id="recommendationsList">
        <div class="recommendation">
          <div class="recommendation-icon">ğŸ”—</div>
          <div class="recommendation-text">ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•˜ë©´ ë” ì •í™•í•œ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer Navigation -->
  <nav class="footer-nav">
    <a href="/" class="nav-item">
      <span class="nav-icon">ğŸ </span>
      í™ˆ
    </a>
    <a href="/brief" class="nav-item active">
      <span class="nav-icon">ğŸ“‹</span>
      ë¸Œë¦¬í•‘
    </a>
    <a href="/integrations" class="nav-item">
      <span class="nav-icon">ğŸ”—</span>
      ì—°ë™
    </a>
    <a href="/setup" class="nav-item">
      <span class="nav-icon">âš™ï¸</span>
      ì„¤ì •
    </a>
  </nav>

  <script>
    const API_BASE = 'https://api.autus-ai.com';
    const USER_ID = 'default';
    
    // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
    function setTodayDate() {
      const today = new Date();
      const options = { month: 'long', day: 'numeric', weekday: 'long' };
      document.getElementById('todayDate').textContent = today.toLocaleDateString('ko-KR', options);
      
      // ì‹œê°„ì— ë”°ë¥¸ ì¸ì‚¬
      const hour = today.getHours();
      let greeting = 'â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”';
      if (hour >= 12 && hour < 18) greeting = 'ğŸŒ¤ï¸ ì¢‹ì€ ì˜¤í›„ì˜ˆìš”';
      else if (hour >= 18) greeting = 'ğŸŒ™ ì¢‹ì€ ì €ë…ì´ì—ìš”';
      document.querySelector('.greeting').textContent = greeting;
    }
    
    async function loadBrief() {
      try {
        const resp = await fetch(`${API_BASE}/sync/brief/${USER_ID}`);
        const data = await resp.json();
        const brief = data.brief;
        
        // Summary
        const summary = brief.summary || {};
        const byType = summary.by_type || {};
        
        document.getElementById('emailCount').textContent = byType.email || 0;
        document.getElementById('eventCount').textContent = byType.calendar || 0;
        document.getElementById('messageCount').textContent = byType.message || 0;
        document.getElementById('totalCount').textContent = summary.total_items || 0;
        
        // Events
        const events = brief.today_events || [];
        document.getElementById('eventBadge').textContent = `${events.length}ê°œ`;
        
        if (events.length > 0) {
          document.getElementById('eventsList').innerHTML = events.map(e => `
            <div class="event-item">
              <div class="event-time">${formatTime(e.time)}</div>
              <div class="event-content">
                <div class="event-title">${escapeHtml(e.title)}</div>
                ${e.location ? `<div class="event-meta">ğŸ“ ${escapeHtml(e.location)}</div>` : ''}
              </div>
            </div>
          `).join('');
        }
        
        // Emails
        const emails = brief.important_emails || [];
        document.getElementById('emailBadge').textContent = `${emails.length}ê°œ`;
        
        if (emails.length > 0) {
          document.getElementById('emailsList').innerHTML = emails.map(e => `
            <div class="email-item">
              <div class="email-from">${escapeHtml(e.from)}</div>
              <div class="email-subject">${escapeHtml(e.title)}</div>
              <div class="email-preview">${escapeHtml(e.preview)}</div>
            </div>
          `).join('');
        }
        
        // Messages
        const messages = brief.recent_messages || [];
        document.getElementById('messageBadge').textContent = `${messages.length}ê°œ`;
        
        if (messages.length > 0) {
          document.getElementById('messagesList').innerHTML = messages.map(m => `
            <div class="message-item">
              <div>
                <div class="message-channel">${escapeHtml(m.channel)}</div>
                <div class="message-text">${escapeHtml(m.content)}</div>
              </div>
            </div>
          `).join('');
        }
        
        // Recommendations
        const recs = brief.recommendations || [];
        if (recs.length > 0) {
          document.getElementById('recommendationsList').innerHTML = recs.map(r => `
            <div class="recommendation">
              <div class="recommendation-text">${escapeHtml(r)}</div>
            </div>
          `).join('');
        }
        
      } catch (err) {
        console.error('Failed to load brief:', err);
      }
    }
    
    async function syncData() {
      const btn = document.getElementById('syncBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner" style="width:16px;height:16px;border-width:2px;margin:0"></span> ë™ê¸°í™” ì¤‘...';
      
      try {
        await fetch(`${API_BASE}/sync/now`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: USER_ID })
        });
        
        await loadBrief();
        
      } catch (err) {
        console.error('Sync failed:', err);
      }
      
      btn.disabled = false;
      btn.innerHTML = '<span>ğŸ”„</span> ìƒˆë¡œê³ ì¹¨';
    }
    
    function formatTime(isoString) {
      if (!isoString) return '';
      const date = new Date(isoString);
      return date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
    }
    
    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/&/g, '&amp;')
                 .replace(/</g, '&lt;')
                 .replace(/>/g, '&gt;');
    }
    
    // Init
    setTodayDate();
    loadBrief();
  </script>
</body>
</html>
