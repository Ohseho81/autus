<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AUTUS SOLAR — Pure View</title>
  <!--
    ╔═══════════════════════════════════════════════════════════════╗
    ║  AUTUS SOLAR — PURE VIEW (LOCK)                               ║
    ║                                                               ║
    ║  목표: 1초 안에 "지금 안전한가"를 알게 한다                   ║
    ║                                                               ║
    ║  규칙:                                                        ║
    ║  - 클릭 ❌ 드래그 ❌ 확대 ❌ 스크롤 ❌                        ║
    ║  - SOLAR는 '보기만 하는 화면'                                 ║
    ║  - ACTION은 조건 충족 시에만 출현                             ║
    ║                                                               ║
    ║  해상도: 1440 × 900                                           ║
    ║  배경: Deep Space Black (#050608)                             ║
    ║  텍스트: Muted White (#E6E6E6)                                ║
    ╚═══════════════════════════════════════════════════════════════╝
  -->
  <style>
    :root {
      --bg: #050608;
      --text: #E6E6E6;
      --green: #6EDC9A;
      --yellow: #FFD166;
      --red: #EF476F;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--bg);
      font-family: 'Inter', 'SF Pro Display', system-ui, sans-serif;
      color: var(--text);
      cursor: default;
      user-select: none;
    }
    
    /* 전체 캔버스 */
    #canvas {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       (A) SOLAR CANVAS — 중앙
       ═══════════════════════════════════════════════════════════════════ */
    
    #solar-canvas {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 440px;
      height: 440px;
    }
    
    /* Central Sun */
    #sun {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 32px;
      height: 32px;
      background: radial-gradient(circle, #fff 0%, rgba(255,255,255,0.8) 40%, rgba(255,255,255,0) 70%);
      border-radius: 50%;
      animation: sun-pulse 3s ease-in-out infinite;
    }
    
    @keyframes sun-pulse {
      0%, 100% { opacity: 0.9; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
    }
    
    /* Orbit Track (보이지 않는 가이드) */
    .orbit-track {
      position: absolute;
      top: 50%; left: 50%;
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 50%;
      pointer-events: none;
    }
    
    .orbit-track.inner {
      width: 160px; height: 160px;
      transform: translate(-50%, -50%);
    }
    .orbit-track.middle {
      width: 260px; height: 260px;
      transform: translate(-50%, -50%);
    }
    .orbit-track.outer {
      width: 360px; height: 360px;
      transform: translate(-50%, -50%);
    }
    
    /* Orbit Objects */
    .orbit-obj {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.3s ease;
    }
    
    /* 상태별 색상 */
    .orbit-obj.safe { background: var(--green); box-shadow: 0 0 12px var(--green); }
    .orbit-obj.warning { background: var(--yellow); box-shadow: 0 0 12px var(--yellow); }
    .orbit-obj.danger { background: var(--red); box-shadow: 0 0 16px var(--red); }
    
    /* 위험 시 진동 */
    .orbit-obj.danger {
      animation: orbit-shake 0.15s infinite;
    }
    
    @keyframes orbit-shake {
      0%, 100% { transform: translate(-50%, -50%) translateX(0); }
      25% { transform: translate(-50%, -50%) translateX(-2px); }
      75% { transform: translate(-50%, -50%) translateX(2px); }
    }
    
    /* 임계 시 정지 + 강한 글로우 */
    .orbit-obj.critical {
      background: var(--red);
      box-shadow: 0 0 20px var(--red), 0 0 40px rgba(239, 71, 111, 0.5);
      animation: critical-glow 0.8s infinite;
    }
    
    @keyframes critical-glow {
      0%, 100% { 
        box-shadow: 0 0 20px var(--red), 0 0 40px rgba(239, 71, 111, 0.5);
        transform: translate(-50%, -50%) scale(1);
      }
      50% { 
        box-shadow: 0 0 30px var(--red), 0 0 60px rgba(239, 71, 111, 0.7);
        transform: translate(-50%, -50%) scale(1.15);
      }
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       상태별 애니메이션 상세 스펙
       
       GREEN (0-39%): 부드러운 회전
       - 궤도: 일정 속도 회전 (0.3°/frame)
       - Sun: 미세 pulse (3s)
       - 모든 객체 녹색 발광
       
       YELLOW (40-69%): 주의 신호
       - 궤도: 회전 유지
       - 가장 안쪽 객체만 노란색 + 느린 pulse
       - Sun: pulse 속도 증가 (2s)
       
       RED (70-79%): 위험 경고
       - 궤도: 회전 유지
       - 모든 객체 빨간색 + 진동
       - Sun: 붉은 tint + 빠른 pulse (1s)
       
       CRITICAL (80-100%): 임계 상태
       - 궤도: 회전 정지
       - 모든 객체 강한 글로우 + 확대/축소
       - Sun: 붉은 발광 + 경고 pulse
       ═══════════════════════════════════════════════════════════════════ */
    
    /* Sun 상태별 변화 */
    #sun.warning {
      background: radial-gradient(circle, #fff 0%, rgba(255, 209, 102, 0.8) 40%, rgba(255, 209, 102, 0) 70%);
      animation: sun-pulse-fast 2s ease-in-out infinite;
    }
    
    #sun.danger {
      background: radial-gradient(circle, #fff 0%, rgba(239, 71, 111, 0.6) 40%, rgba(239, 71, 111, 0) 70%);
      animation: sun-pulse-danger 1s ease-in-out infinite;
    }
    
    #sun.critical {
      background: radial-gradient(circle, #ff6b6b 0%, rgba(239, 71, 111, 0.8) 40%, rgba(239, 71, 111, 0.2) 70%);
      animation: sun-critical 0.6s ease-in-out infinite;
      box-shadow: 0 0 40px rgba(239, 71, 111, 0.5);
    }
    
    @keyframes sun-pulse-fast {
      0%, 100% { opacity: 0.9; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.08); }
    }
    
    @keyframes sun-pulse-danger {
      0%, 100% { opacity: 0.85; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.12); }
    }
    
    @keyframes sun-critical {
      0%, 100% { 
        opacity: 0.8; 
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 40px rgba(239, 71, 111, 0.5);
      }
      50% { 
        opacity: 1; 
        transform: translate(-50%, -50%) scale(1.2);
        box-shadow: 0 0 80px rgba(239, 71, 111, 0.8);
      }
    }
    
    /* 배경 상태 반영 */
    body.warning {
      background: linear-gradient(180deg, #050608 0%, #0a0806 100%);
    }
    
    body.danger {
      background: linear-gradient(180deg, #050608 0%, #0d0508 100%);
    }
    
    body.critical {
      background: linear-gradient(180deg, #050608 0%, #100508 100%);
      animation: bg-pulse 2s infinite;
    }
    
    @keyframes bg-pulse {
      0%, 100% { background: linear-gradient(180deg, #050608 0%, #100508 100%); }
      50% { background: linear-gradient(180deg, #080608 0%, #150510 100%); }
    }
    
    /* 궤도 트랙 상태 반영 */
    body.warning .orbit-track {
      border-color: rgba(255, 209, 102, 0.05);
    }
    
    body.danger .orbit-track {
      border-color: rgba(239, 71, 111, 0.08);
    }
    
    body.critical .orbit-track {
      border-color: rgba(239, 71, 111, 0.15);
      animation: track-pulse 1s infinite;
    }
    
    @keyframes track-pulse {
      0%, 100% { border-color: rgba(239, 71, 111, 0.15); }
      50% { border-color: rgba(239, 71, 111, 0.25); }
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       (B) RISK % — 좌하단
       ═══════════════════════════════════════════════════════════════════ */
    
    #risk-display {
      position: fixed;
      bottom: 80px;
      left: 80px;
    }
    
    #risk-label {
      font-size: 12px;
      font-weight: 300;
      letter-spacing: 0.3em;
      color: rgba(230, 230, 230, 0.5);
      margin-bottom: 4px;
    }
    
    #risk-value {
      font-size: 72px;
      font-weight: 700;
      line-height: 1;
      transition: color 0.3s ease;
    }
    
    #risk-value.safe { color: var(--green); }
    #risk-value.warning { color: var(--yellow); }
    #risk-value.danger { color: var(--red); }
    
    /* ═══════════════════════════════════════════════════════════════════
       (C) STATUS DOT — 우하단
       ═══════════════════════════════════════════════════════════════════ */
    
    #status-dot {
      position: fixed;
      bottom: 100px;
      right: 80px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    #status-dot.safe {
      background: var(--green);
      box-shadow: 0 0 8px var(--green);
    }
    #status-dot.warning {
      background: var(--yellow);
      box-shadow: 0 0 8px var(--yellow);
    }
    #status-dot.danger {
      background: var(--red);
      box-shadow: 0 0 12px var(--red);
      animation: status-pulse 1s infinite;
    }
    
    @keyframes status-pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       (D) ACTION 버튼 — 조건부 출현
       
       출현 조건:
       - YELLOW: "확인" 버튼 페이드인 (3초 후)
       - RED: "조치" 버튼 즉시 출현
       - GREEN: 버튼 없음
       
       위치: 중앙 하단 (720, 800)
       ═══════════════════════════════════════════════════════════════════ */
    
    #action-area {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    #action-area.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .action-btn {
      padding: 16px 48px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.15em;
      border: 2px solid;
      border-radius: 8px;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    /* 확인 버튼 (YELLOW 상태) */
    .action-btn.confirm {
      color: var(--yellow);
      border-color: var(--yellow);
    }
    .action-btn.confirm:hover {
      background: var(--yellow);
      color: var(--bg);
    }
    
    /* 조치 버튼 (RED 상태) */
    .action-btn.action {
      color: var(--red);
      border-color: var(--red);
      animation: action-glow 1.5s infinite;
    }
    .action-btn.action:hover {
      background: var(--red);
      color: #fff;
    }
    
    @keyframes action-glow {
      0%, 100% { box-shadow: 0 0 10px rgba(239, 71, 111, 0.3); }
      50% { box-shadow: 0 0 25px rgba(239, 71, 111, 0.6); }
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       (E) 역할 인디케이터 — 최소화
       ═══════════════════════════════════════════════════════════════════ */
    
    #role-indicator {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 300;
      letter-spacing: 0.4em;
      color: rgba(230, 230, 230, 0.3);
    }
    
    /* 데모 힌트 (개발용) */
    #demo-hint {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      letter-spacing: 0.1em;
      color: rgba(230, 230, 230, 0.15);
      pointer-events: none;
    }
    
    /* 배포 시 숨기려면: */
    /* #demo-hint { display: none; } */
    
    /* ═══════════════════════════════════════════════════════════════════
       모바일 대응
       ═══════════════════════════════════════════════════════════════════ */
    
    @media (max-width: 768px) {
      #solar-canvas {
        width: 300px;
        height: 300px;
      }
      
      .orbit-track.inner { width: 100px; height: 100px; }
      .orbit-track.middle { width: 170px; height: 170px; }
      .orbit-track.outer { width: 240px; height: 240px; }
      
      #risk-display {
        bottom: 60px;
        left: 40px;
      }
      
      #risk-value {
        font-size: 48px;
      }
      
      #status-dot {
        bottom: 80px;
        right: 40px;
      }
      
      #action-area {
        bottom: 40px;
      }
      
      .action-btn {
        padding: 12px 32px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="canvas">
    <!-- (A) SOLAR CANVAS -->
    <div id="solar-canvas">
      <!-- Orbit Tracks (가이드) -->
      <div class="orbit-track inner"></div>
      <div class="orbit-track middle"></div>
      <div class="orbit-track outer"></div>
      
      <!-- Central Sun -->
      <div id="sun"></div>
      
      <!-- Orbit Objects (학업 / 취업 / 비자) -->
      <div id="orbit-1" class="orbit-obj safe"></div>
      <div id="orbit-2" class="orbit-obj safe"></div>
      <div id="orbit-3" class="orbit-obj safe"></div>
    </div>
    
    <!-- (B) RISK % -->
    <div id="risk-display">
      <div id="risk-label">RISK</div>
      <div id="risk-value" class="safe">0%</div>
    </div>
    
    <!-- (C) STATUS DOT -->
    <div id="status-dot" class="safe"></div>
    
    <!-- (D) ACTION BUTTON (조건부) -->
    <div id="action-area">
      <button id="action-btn" class="action-btn confirm">확인</button>
    </div>
    
    <!-- (E) ROLE INDICATOR -->
    <div id="role-indicator">STUDENT</div>
    
    <!-- (F) DEMO HINT (개발용 — 실제 배포 시 숨김) -->
    <div id="demo-hint">
      <span>DEMO: 1-4 학생 | 5-6 ATB | 7-8 기업 | 9-0 정부</span>
    </div>
  </div>
  
  <script>
    // ═══════════════════════════════════════════════════════════════════════════
    // AUTUS SOLAR — PURE VIEW ENGINE
    // ═══════════════════════════════════════════════════════════════════════════
    
    const API_BASE = window.location.hostname === 'localhost' 
      ? 'http://localhost:8000' 
      : 'https://autus-production.up.railway.app';
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 상태
    // ═══════════════════════════════════════════════════════════════════════════
    
    let state = {
      risk: 0,
      status: 'safe', // safe | warning | danger | critical
      orbits: [
        { id: 'study', angle: 0, radius: 80, status: 'safe' },   // 학업
        { id: 'work', angle: 120, radius: 130, status: 'safe' }, // 취업
        { id: 'visa', angle: 240, radius: 180, status: 'safe' }  // 비자
      ],
      role: 'student', // student | atb | employer | government | ceo
      actionVisible: false,
      actionType: null, // confirm | action
      orbitsPaused: false,
      orbitSpeed: 0.3 // 기본 회전 속도
    };
    
    // 역할별 라벨
    const ROLE_LABELS = {
      student: 'STUDENT',
      atb: 'ATB OPERATOR',
      employer: 'EMPLOYER',
      government: 'GOVERNMENT',
      ceo: 'CEO'
    };
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 궤도 애니메이션
    // ═══════════════════════════════════════════════════════════════════════════
    
    function updateOrbits() {
      const canvas = document.getElementById('solar-canvas');
      const centerX = canvas.offsetWidth / 2;
      const centerY = canvas.offsetHeight / 2;
      
      state.orbits.forEach((orbit, i) => {
        const el = document.getElementById(`orbit-${i + 1}`);
        if (!el) return;
        
        // 정상: 회전, 임계/critical: 정지
        if (!state.orbitsPaused && orbit.status !== 'critical') {
          const baseSpeed = state.orbitSpeed;
          const speed = baseSpeed - (i * 0.05); // 안쪽이 빠름
          orbit.angle = (orbit.angle + speed) % 360;
        }
        
        const rad = orbit.angle * Math.PI / 180;
        const x = centerX + Math.cos(rad) * orbit.radius;
        const y = centerY + Math.sin(rad) * orbit.radius;
        
        el.style.left = `${x}px`;
        el.style.top = `${y}px`;
        
        // 상태 클래스
        el.className = `orbit-obj ${orbit.status}`;
      });
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // RISK % 업데이트
    // ═══════════════════════════════════════════════════════════════════════════
    
    function updateRisk(risk) {
      state.risk = risk;
      
      const el = document.getElementById('risk-value');
      el.textContent = `${Math.round(risk)}%`;
      
      // 상태 결정
      let status = 'safe';
      if (risk >= 70) status = 'danger';
      else if (risk >= 40) status = 'warning';
      
      el.className = status;
      state.status = status;
      
      // STATUS DOT 업데이트
      updateStatusDot(status);
      
      // ACTION 버튼 조건
      updateActionButton(status);
      
      // 궤도 상태 반영
      updateOrbitStatus(risk);
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // STATUS DOT 업데이트
    // ═══════════════════════════════════════════════════════════════════════════
    
    function updateStatusDot(status) {
      const dot = document.getElementById('status-dot');
      dot.className = status;
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // ACTION 버튼 조건
    // 
    // 출현 조건:
    // - GREEN: 버튼 없음 (개입 불필요)
    // - YELLOW: "확인" 버튼 (3초 후 페이드인)
    // - RED: "조치" 버튼 (즉시 출현)
    // ═══════════════════════════════════════════════════════════════════════════
    
    let actionTimeout = null;
    
    function updateActionButton(status) {
      const area = document.getElementById('action-area');
      const btn = document.getElementById('action-btn');
      
      // 기존 타이머 취소
      if (actionTimeout) {
        clearTimeout(actionTimeout);
        actionTimeout = null;
      }
      
      if (status === 'safe') {
        // GREEN: 버튼 숨김
        area.classList.remove('visible');
        state.actionVisible = false;
        
      } else if (status === 'warning') {
        // YELLOW: 3초 후 "확인" 버튼
        actionTimeout = setTimeout(() => {
          btn.textContent = '확인';
          btn.className = 'action-btn confirm';
          area.classList.add('visible');
          state.actionVisible = true;
          state.actionType = 'confirm';
        }, 3000);
        
      } else if (status === 'danger') {
        // RED: 즉시 "조치" 버튼
        btn.textContent = '조치';
        btn.className = 'action-btn action';
        area.classList.add('visible');
        state.actionVisible = true;
        state.actionType = 'action';
      }
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 궤도 상태 반영 + 전체 애니메이션 제어
    // 
    // 상태별 애니메이션 스펙:
    // 
    // GREEN (0-39%): 부드러운 회전
    //   - 궤도: 일정 속도 회전 (0.3°/frame)
    //   - Sun: 미세 pulse (3s)
    //   - 모든 객체 녹색 발광
    // 
    // YELLOW (40-69%): 주의 신호
    //   - 궤도: 회전 유지
    //   - 가장 안쪽 객체만 노란색 + 느린 pulse
    //   - Sun: pulse 속도 증가 (2s)
    // 
    // RED (70-79%): 위험 경고
    //   - 궤도: 회전 유지 (약간 느리게)
    //   - 모든 객체 빨간색 + 진동
    //   - Sun: 붉은 tint + 빠른 pulse (1s)
    // 
    // CRITICAL (80-100%): 임계 상태
    //   - 궤도: 회전 정지
    //   - 모든 객체 강한 글로우 + 확대/축소
    //   - Sun: 붉은 발광 + 경고 pulse
    // ═══════════════════════════════════════════════════════════════════════════
    
    function updateOrbitStatus(risk) {
      const sun = document.getElementById('sun');
      const body = document.body;
      
      // 기존 상태 클래스 제거
      sun.classList.remove('warning', 'danger', 'critical');
      body.classList.remove('warning', 'danger', 'critical');
      
      // 리스크에 따라 상태 결정
      if (risk >= 80) {
        // ═══ CRITICAL (80-100%) ═══
        // 모든 것 정지, 강한 경고
        state.orbitsPaused = true;
        sun.classList.add('critical');
        body.classList.add('critical');
        
        state.orbits.forEach((orbit) => {
          orbit.status = 'critical';
        });
        
      } else if (risk >= 70) {
        // ═══ RED/DANGER (70-79%) ═══
        // 회전 유지, 진동
        state.orbitsPaused = false;
        state.orbitSpeed = 0.2; // 느려짐
        sun.classList.add('danger');
        body.classList.add('danger');
        
        state.orbits.forEach((orbit) => {
          orbit.status = 'danger';
        });
        
      } else if (risk >= 40) {
        // ═══ YELLOW/WARNING (40-69%) ═══
        // 회전 유지, 일부만 경고
        state.orbitsPaused = false;
        state.orbitSpeed = 0.25;
        sun.classList.add('warning');
        body.classList.add('warning');
        
        // 위험도에 따라 경고 객체 수 증가
        const warningCount = Math.ceil((risk - 40) / 15); // 40→1개, 55→2개, 70→2개
        state.orbits.forEach((orbit, i) => {
          orbit.status = i < warningCount ? 'warning' : 'safe';
        });
        
      } else {
        // ═══ GREEN/SAFE (0-39%) ═══
        // 정상 회전
        state.orbitsPaused = false;
        state.orbitSpeed = 0.3;
        
        state.orbits.forEach((orbit) => {
          orbit.status = 'safe';
        });
      }
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 역할 전환 + 시나리오
    // 
    // 역할별 체감 차이:
    // - 학생: "내 인생 상태" → 학업/취업/비자 3개 모두 표시
    // - ATB: "관리 밀도" → 위험 인력만 표시 (다른 것은 희미하게)
    // - 기업: "채용 안정성" → 채용 대상만 강조
    // - 정부: "프로그램 건전성" → 추상화된 집계 (점 크기로 표현)
    // - CEO: "확장 가능 여부" → 전체 시스템 상태
    // ═══════════════════════════════════════════════════════════════════════════
    
    const SCENARIOS = {
      // 학생 시나리오: 정상 상태
      student_safe: {
        role: 'student',
        risk: 15,
        label: '학생 - 정상',
        description: '모든 Commit 안정'
      },
      // 학생 시나리오: 학업 위험
      student_warning: {
        role: 'student',
        risk: 52,
        label: '학생 - 주의',
        description: '학업 Commit 지연'
      },
      // 학생 시나리오: 비자 위험
      student_danger: {
        role: 'student',
        risk: 78,
        label: '학생 - 위험',
        description: '비자 만료 임박'
      },
      // 학생 시나리오: 임계
      student_critical: {
        role: 'student',
        risk: 92,
        label: '학생 - 임계',
        description: '즉시 조치 필요'
      },
      
      // ATB 시나리오
      atb_normal: {
        role: 'atb',
        risk: 25,
        label: 'ATB - 정상',
        description: '관리 대상 안정'
      },
      atb_alert: {
        role: 'atb',
        risk: 65,
        label: 'ATB - 주의',
        description: '3명 위험 감지'
      },
      
      // 기업 시나리오
      employer_stable: {
        role: 'employer',
        risk: 18,
        label: '기업 - 안정',
        description: '채용 풀 안정'
      },
      employer_risk: {
        role: 'employer',
        risk: 55,
        label: '기업 - 주의',
        description: '채용 대상 이탈 위험'
      },
      
      // 정부 시나리오
      government_healthy: {
        role: 'government',
        risk: 12,
        label: '정부 - 건전',
        description: '프로그램 정상 운영'
      },
      government_concern: {
        role: 'government',
        risk: 48,
        label: '정부 - 관심',
        description: '일부 지표 주의'
      }
    };
    
    function setRole(role) {
      state.role = role;
      document.getElementById('role-indicator').textContent = ROLE_LABELS[role] || role.toUpperCase();
      
      // 역할별 궤도 표시 스타일
      const orbits = document.querySelectorAll('.orbit-obj');
      
      orbits.forEach((el, i) => {
        el.style.opacity = '1';
        el.style.filter = 'none';
      });
      
      if (role === 'atb') {
        // ATB: 위험 객체만 강조, 나머지 희미
        orbits.forEach((el, i) => {
          const orbit = state.orbits[i];
          if (orbit.status === 'safe') {
            el.style.opacity = '0.3';
            el.style.filter = 'grayscale(0.5)';
          }
        });
      } else if (role === 'employer') {
        // 기업: 첫 번째(취업) 강조
        orbits.forEach((el, i) => {
          if (i !== 1) { // work = index 1
            el.style.opacity = '0.5';
          }
        });
      } else if (role === 'government') {
        // 정부: 모든 것 약간 추상화
        orbits.forEach((el) => {
          el.style.filter = 'blur(1px)';
        });
      }
    }
    
    // 시나리오 적용
    function applyScenario(scenarioKey) {
      const scenario = SCENARIOS[scenarioKey];
      if (!scenario) return;
      
      setRole(scenario.role);
      updateRisk(scenario.risk);
      
      console.log(`[SOLAR] Scenario: ${scenario.label} - ${scenario.description}`);
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // ACTION 버튼 클릭
    // ═══════════════════════════════════════════════════════════════════════════
    
    document.getElementById('action-btn').addEventListener('click', async () => {
      if (!state.actionVisible) return;
      
      // ACTION 실행 → solar.html로 이동
      const actionPage = `${window.location.origin}/frontend/solar.html?action=${state.actionType}&risk=${state.risk}`;
      window.location.href = actionPage;
    });
    
    // ═══════════════════════════════════════════════════════════════════════════
    // API에서 상태 가져오기
    // ═══════════════════════════════════════════════════════════════════════════
    
    async function fetchState() {
      try {
        const res = await fetch(`${API_BASE}/state`);
        if (!res.ok) return;
        
        const data = await res.json();
        const engine = data.engine || {};
        
        // Risk 계산 (entropy + pressure 기반)
        const entropy = engine.entropy || 0;
        const pressure = engine.pressure || 0;
        const risk = Math.min(100, Math.max(0, (entropy * 50) + (pressure * 30)));
        
        updateRisk(risk);
      } catch (e) {
        console.warn('[SOLAR] API fetch failed, using demo');
      }
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // URL 파라미터 처리
    // ═══════════════════════════════════════════════════════════════════════════
    
    function handleURLParams() {
      const params = new URLSearchParams(window.location.search);
      
      // 시나리오 (우선)
      const scenario = params.get('scenario');
      if (scenario && SCENARIOS[scenario]) {
        applyScenario(scenario);
        return;
      }
      
      // 역할
      const role = params.get('role');
      if (role) setRole(role);
      
      // 데모 리스크
      const demoRisk = params.get('risk');
      if (demoRisk) {
        updateRisk(parseInt(demoRisk));
      }
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 키보드 단축키 (데모용)
    // 
    // 1-4: 학생 시나리오 (safe → critical)
    // 5-6: ATB 시나리오
    // 7-8: 기업 시나리오
    // 9-0: 정부 시나리오
    // ═══════════════════════════════════════════════════════════════════════════
    
    document.addEventListener('keydown', (e) => {
      const key = e.key;
      
      const keyMap = {
        '1': 'student_safe',
        '2': 'student_warning',
        '3': 'student_danger',
        '4': 'student_critical',
        '5': 'atb_normal',
        '6': 'atb_alert',
        '7': 'employer_stable',
        '8': 'employer_risk',
        '9': 'government_healthy',
        '0': 'government_concern'
      };
      
      if (keyMap[key]) {
        applyScenario(keyMap[key]);
      }
    });
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 애니메이션 루프
    // ═══════════════════════════════════════════════════════════════════════════
    
    function animate() {
      updateOrbits();
      requestAnimationFrame(animate);
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // 초기화
    // ═══════════════════════════════════════════════════════════════════════════
    
    function init() {
      handleURLParams();
      
      // 초기 상태 설정
      updateRisk(state.risk);
      
      // API 폴링 (10초)
      fetchState();
      setInterval(fetchState, 10000);
      
      // 애니메이션 시작
      animate();
      
      console.log('[SOLAR] Pure View initialized');
    }
    
    // DOM 로드 후 시작
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
