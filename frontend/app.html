<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS ‚Äî Dashboard</title>
    <link rel="stylesheet" href="css/common.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }

        .stat-card {
            padding: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
        }

        .stat-card.urgent::before { background: var(--urgent); box-shadow: 0 0 20px var(--urgent); }
        .stat-card.warning::before { background: var(--warning); box-shadow: 0 0 20px var(--warning); }
        .stat-card.opportunity::before { background: var(--opportunity); box-shadow: 0 0 20px var(--opportunity); }
        .stat-card.total::before { background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple)); }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            font-family: 'SF Mono', monospace;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stat-change {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 12px;
            font-weight: 600;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 1000px) {
            .quick-actions { grid-template-columns: repeat(2, 1fr); }
        }

        .quick-action {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .quick-action:hover {
            border-color: var(--neon-cyan);
            background: rgba(0, 240, 255, 0.05);
            transform: translateX(4px);
        }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(180, 74, 255, 0.2));
        }

        .quick-action-text h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .quick-action-text p {
            font-size: 11px;
            color: var(--text-dim);
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .content-grid { grid-template-columns: 1fr; }
        }

        .mini-matrix {
            height: 300px;
            position: relative;
        }

        #miniMatrixCanvas {
            width: 100%;
            height: 100%;
        }

        .rec-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .rec-item {
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .rec-item:hover {
            border-color: var(--neon-orange);
            background: rgba(255, 136, 0, 0.1);
        }

        .rec-rank {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--neon-orange), #cc6600);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #000;
            flex-shrink: 0;
        }

        .rec-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .rec-info {
            flex: 1;
        }

        .rec-info h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .rec-info p {
            font-size: 10px;
            color: var(--text-dim);
        }

        .rec-action {
            text-align: right;
        }

        .rec-action-name {
            font-size: 11px;
            color: var(--neon-orange);
            margin-bottom: 2px;
        }

        .rec-roi {
            font-size: 13px;
            font-weight: 700;
            color: var(--neon-green);
        }

        .system-status {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: rgba(0, 240, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .system-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }

        .system-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
            animation: pulse 1s ease-in-out infinite;
        }

        /* Reward Card Section */
        .reward-section {
            margin-top: 24px;
        }

        .reward-card {
            padding: 24px;
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.08), rgba(180, 74, 255, 0.05));
            border: 1px solid var(--neon-cyan);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .reward-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
        }

        .reward-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .reward-icon {
            font-size: 40px;
        }

        .reward-title {
            font-size: 18px;
            font-weight: 700;
        }

        .reward-benefit {
            font-size: 12px;
            color: var(--neon-green);
        }

        .reward-message {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text);
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border-left: 3px solid var(--neon-cyan);
        }

        .reward-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .reward-action-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .reward-action-btn.primary {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            color: #000;
        }

        .reward-action-btn.primary:hover {
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.4);
            transform: translateY(-2px);
        }

        .reward-action-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
        }

        .reward-action-btn.secondary:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .orbit-hint {
            margin-top: 16px;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 11px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .orbit-hint a {
            color: var(--neon-cyan);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <div id="nav"></div>

    <div class="page-container">
        <div class="page-content">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="page-title-icon">‚óà</span>
                    Dashboard Overview
                </h1>
                <p class="page-subtitle">Real-time entity monitoring and solution management</p>
            </div>

            <!-- Stats Grid -->
            <div class="dashboard-grid" id="statsGrid"></div>

            <!-- Reward Card -->
            <div class="reward-section" id="rewardSection"></div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <a href="solar.html" class="quick-action">
                    <div class="quick-action-icon">üåê</div>
                    <div class="quick-action-text">
                        <h3>Solar HQ</h3>
                        <p>Physics visualization</p>
                    </div>
                </a>
                <a href="gamification.html" class="quick-action">
                    <div class="quick-action-icon">üéÆ</div>
                    <div class="quick-action-text">
                        <h3>Gamification</h3>
                        <p>V spiral & rewards</p>
                    </div>
                </a>
                <a href="timeline.html" class="quick-action">
                    <div class="quick-action-icon">‚óá</div>
                    <div class="quick-action-text">
                        <h3>Timeline</h3>
                        <p>Historical data</p>
                    </div>
                </a>
                <a href="heatmap.html" class="quick-action">
                    <div class="quick-action-icon">üó∫Ô∏è</div>
                    <div class="quick-action-text">
                        <h3>Heatmap</h3>
                        <p>Planet status</p>
                    </div>
                </a>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Mini Matrix -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Entity Matrix Preview</div>
                        <a href="solar.html" class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px;">
                            View Full ‚Üí
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="mini-matrix">
                            <canvas id="miniMatrixCanvas"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Priority Recommendations</div>
                    </div>
                    <div class="card-body">
                        <div class="rec-list" id="recList"></div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="system-status">
                <div class="system-indicator">
                    <div class="system-dot"></div>
                    <span>System Online</span>
                </div>
                <div class="system-indicator">
                    <span class="text-dim">Last Sync:</span>
                    <span id="lastSync">-</span>
                </div>
                <div class="system-indicator">
                    <span class="text-dim">Entities:</span>
                    <span id="entityCount">-</span>
                </div>
                <div class="system-indicator">
                    <span class="text-dim">Kernel:</span>
                    <span id="kernelRole">-</span>
                </div>
                <div style="flex: 1;"></div>
                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 10px;" onclick="resetData()">
                    Reset Data
                </button>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        // Insert navigation
        document.getElementById('nav').innerHTML = generateNav('index');

        // Render stats
        function renderStats() {
            const stats = AUTUS.getStats();
            const grid = document.getElementById('statsGrid');
            
            grid.innerHTML = `
                <div class="stat-card urgent fade-in">
                    <div class="stat-icon">üö®</div>
                    <div class="stat-value text-urgent">${stats.urgent}</div>
                    <div class="stat-label">Urgent Entities</div>
                    <div class="stat-change text-urgent">Needs Action</div>
                </div>
                <div class="stat-card warning fade-in" style="animation-delay: 0.1s;">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-value text-warning">${stats.warning}</div>
                    <div class="stat-label">Warning</div>
                    <div class="stat-change text-warning">Monitor</div>
                </div>
                <div class="stat-card opportunity fade-in" style="animation-delay: 0.2s;">
                    <div class="stat-icon">üåü</div>
                    <div class="stat-value text-opportunity">${stats.opportunity}</div>
                    <div class="stat-label">Opportunity</div>
                    <div class="stat-change text-opportunity">Growth</div>
                </div>
                <div class="stat-card total fade-in" style="animation-delay: 0.3s;">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value text-cyan">${AUTUS.formatMoney(stats.totalValue)}</div>
                    <div class="stat-label">Total Value</div>
                    <div class="stat-change text-green">+12.5%</div>
                </div>
            `;
        }

        // Render reward card
        function renderRewardCard() {
            const section = document.getElementById('rewardSection');
            const reward = AUTUS.generateRewardCard();
            
            if (!reward) {
                section.innerHTML = `
                    <div class="reward-card">
                        <div class="reward-header">
                            <div class="reward-icon">üéØ</div>
                            <div>
                                <div class="reward-title">ÏãúÏûë ÏÑ§Ï†ïÏùÑ ÏôÑÎ£åÌïòÏÑ∏Ïöî</div>
                                <div class="reward-benefit">ÎßûÏ∂§Ìòï Î≥¥ÏÉÅ Ïπ¥ÎìúÎ•º Î∞õÏúºÏÑ∏Ïöî</div>
                            </div>
                        </div>
                        <div class="reward-message">
                            Ïò®Î≥¥Îî©ÏùÑ ÏôÑÎ£åÌïòÎ©¥ Ïó≠Ìï†Ïóê ÎßûÎäî Ï≤´ Î≤àÏß∏ Î≥¥ÏÉÅ Ïπ¥ÎìúÍ∞Ä Ï§ÄÎπÑÎê©ÎãàÎã§.
                        </div>
                        <div class="reward-actions">
                            <button class="reward-action-btn primary" onclick="location.href='signup.html'">
                                ÏãúÏûë ÏÑ§Ï†ïÌïòÍ∏∞ ‚Üí
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            const actionsHtml = reward.actions.map((a, i) => `
                <button class="reward-action-btn ${i === 0 ? 'primary' : 'secondary'}" onclick="handleRewardAction('${a.type}')">
                    ${a.label}
                </button>
            `).join('');

            section.innerHTML = `
                <div class="reward-card fade-in">
                    <div class="reward-header">
                        <div class="reward-icon">${reward.icon}</div>
                        <div>
                            <div class="reward-title">${reward.title}</div>
                            <div class="reward-benefit">‚úì ${reward.one_line_benefit}</div>
                        </div>
                    </div>
                    <div class="reward-message">${reward.message}</div>
                    <div class="reward-actions">${actionsHtml}</div>
                    <div class="orbit-hint">
                        üí° ÌòÑÏû¨ ÏûêÎèôÌôî Í±∞Î¶¨: ${reward.orbit_mode === 'core' ? 'Í∞ÄÍπåÏù¥' : reward.orbit_mode === 'mid' ? 'Ï§ëÍ∞Ñ' : 'Î©ÄÎ¶¨'} 
                        <a href="signup.html">Ï°∞Ï†ïÌïòÍ∏∞</a>
                    </div>
                </div>
            `;
        }

        function handleRewardAction(type) {
            console.log('Reward action:', type);
            alert(`${type} Ïï°ÏÖòÏù¥ Ïã§ÌñâÎê©ÎãàÎã§.`);
        }

        // Render mini matrix
        function renderMiniMatrix() {
            const canvas = document.getElementById('miniMatrixCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            const w = canvas.width;
            const h = canvas.height;
            const padding = 30;

            ctx.fillStyle = '#0a0a10';
            ctx.fillRect(0, 0, w, h);

            ctx.strokeStyle = 'rgba(0, 240, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let x = padding; x < w - padding; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, h - padding);
                ctx.stroke();
            }
            for (let y = padding; y < h - padding; y += 40) {
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(w - padding, y);
                ctx.stroke();
            }

            const maxMoney = Math.max(...AUTUS.entities.map(e => e.money));

            AUTUS.entities.forEach(e => {
                const x = padding + (e.urgency * (w - 2*padding));
                const y = h - padding - ((e.money / maxMoney) * (h - 2*padding));
                const size = 4 + (e.money / maxMoney) * 10;

                const glow = ctx.createRadialGradient(x, y, 0, x, y, size * 2);
                glow.addColorStop(0, AUTUS.statusColors[e.status] + '40');
                glow.addColorStop(1, 'transparent');
                ctx.beginPath();
                ctx.arc(x, y, size * 2, 0, Math.PI * 2);
                ctx.fillStyle = glow;
                ctx.fill();

                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = AUTUS.statusColors[e.status];
                ctx.fill();
            });

            ctx.fillStyle = '#3a3a4a';
            ctx.font = '9px SF Pro Display';
            ctx.textAlign = 'center';
            ctx.fillText('URGENCY ‚Üí', w / 2, h - 8);
            
            ctx.save();
            ctx.translate(10, h / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('VALUE ‚Üí', 0, 0);
            ctx.restore();
        }

        // Render recommendations
        function renderRecommendations() {
            const list = document.getElementById('recList');
            const recs = AUTUS.getTopRecommendations(5);

            list.innerHTML = recs.map((rec, i) => {
                const e = rec.entity;
                const action = rec.bestAction;
                return `
                    <div class="rec-item fade-in" style="animation-delay: ${i * 0.1}s;">
                        <div class="rec-rank">${i + 1}</div>
                        <div class="rec-avatar" style="background: linear-gradient(135deg, ${AUTUS.statusColors[e.status]}33, ${AUTUS.statusColors[e.status]}11);">
                            ${e.emoji}
                        </div>
                        <div class="rec-info">
                            <h4>${e.name}</h4>
                            <p>${e.type === 'teacher' ? 'Teacher' : 'Parent'} ‚Ä¢ ${e.status.toUpperCase()}</p>
                        </div>
                        <div class="rec-action">
                            <div class="rec-action-name">${action?.icon} ${action?.name}</div>
                            <div class="rec-roi">+${action?.effects.roi}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update system info
        function updateSystemInfo() {
            document.getElementById('lastSync').textContent = new Date().toLocaleTimeString();
            document.getElementById('entityCount').textContent = AUTUS.entities.length;
            
            const roleNames = {
                owner: 'Ïò§ÎÑà',
                director: 'ÏõêÏû•',
                teacher: 'Í∞ïÏÇ¨',
                staff: 'ÌñâÏ†ï',
                parent: 'ÌïôÎ∂ÄÎ™®',
                student: 'ÌïôÏÉù'
            };
            document.getElementById('kernelRole').textContent = roleNames[AUTUS.kernel.role_id] || 'ÎØ∏ÏÑ§Ï†ï';
        }

        // Reset data
        function resetData() {
            if (confirm('Reset all data? This cannot be undone.')) {
                AUTUS.resetData();
                renderStats();
                renderMiniMatrix();
                renderRecommendations();
                renderRewardCard();
            }
        }

        // Init
        renderStats();
        renderMiniMatrix();
        renderRecommendations();
        renderRewardCard();
        updateSystemInfo();

        window.addEventListener('resize', renderMiniMatrix);
    </script>
</body>
</html>
