<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS MVP í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .status {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .status-item {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .status-item.connected { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }
        .status-item.disconnected { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .chat-box {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .message {
            padding: 10px 14px;
            margin: 8px 0;
            border-radius: 12px;
            max-width: 80%;
        }
        .message.user {
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            margin-left: auto;
        }
        .message.system {
            background: rgba(255,255,255,0.1);
        }
        .message.progress {
            background: rgba(34, 197, 94, 0.2);
            border-left: 3px solid #22c55e;
        }
        .message.error {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
        }
        .input-area {
            display: flex;
            gap: 10px;
        }
        input {
            flex: 1;
            padding: 14px 18px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }
        input::placeholder { color: rgba(255,255,255,0.5); }
        input:focus { outline: 2px solid #7c3aed; }
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover { transform: scale(1.05); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #00d4ff);
            border-radius: 3px;
            transition: width 0.3s;
            width: 0%;
        }
        .quick-commands {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .quick-cmd {
            padding: 8px 14px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .quick-cmd:hover {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
        }
        pre {
            background: rgba(0,0,0,0.5);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ AUTUS MVP í…ŒìŠ¤íŠ¸</h1>
        
        <div class="status">
            <div id="ws-status" class="status-item disconnected">
                <span id="ws-icon">âšª</span>
                <span id="ws-text">ì—°ê²° ì¤‘...</span>
            </div>
            <div id="api-status" class="status-item disconnected">
                <span id="api-icon">âšª</span>
                <span id="api-text">API í™•ì¸ ì¤‘...</span>
            </div>
        </div>

        <div class="chat-box">
            <div class="quick-commands">
                <div class="quick-cmd" onclick="sendQuickCmd('í—¬ìŠ¤ ì²´í¬')">ğŸ’“ í—¬ìŠ¤ ì²´í¬</div>
                <div class="quick-cmd" onclick="sendQuickCmd('ì›” 1íšŒ ìµœì‹ í™” í•˜ì')">ğŸ”„ ì›”ë³„ ì—…ë°ì´íŠ¸</div>
                <div class="quick-cmd" onclick="sendQuickCmd('LangGraph ì›Œí¬í”Œë¡œìš° ì‹¤í–‰')">ğŸ”€ ì›Œí¬í”Œë¡œìš°</div>
                <div class="quick-cmd" onclick="sendQuickCmd('ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸')">ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœ</div>
            </div>
            
            <div id="messages" class="messages">
                <div class="message system">ğŸ‘‹ AUTUS MVPì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</div>
            </div>
            
            <div class="progress-bar">
                <div id="progress-fill" class="progress-bar-fill"></div>
            </div>
            
            <div class="input-area" style="margin-top: 15px;">
                <input 
                    type="text" 
                    id="command" 
                    placeholder="ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì•„ìš°íˆ¬ìŠ¤ ì™¸ë¶€ ê¸°ìˆ  ìµœì‹ í™” í•˜ì)"
                    onkeypress="if(event.key==='Enter') send()"
                >
                <button onclick="send()" id="send-btn">ë³´ë‚´ê¸°</button>
            </div>
        </div>

        <div class="chat-box">
            <h3 style="margin-bottom: 15px;">ğŸ“¡ API í…ŒìŠ¤íŠ¸</h3>
            <div class="quick-commands">
                <div class="quick-cmd" onclick="testAPI('/health')">GET /health</div>
                <div class="quick-cmd" onclick="testAPI('/state')">GET /state</div>
                <div class="quick-cmd" onclick="testAPI('/api/langgraph/workflows')">GET /workflows</div>
                <div class="quick-cmd" onclick="testAPI('/api/langgraph/integrations/status')">GET /integrations</div>
            </div>
            <pre id="api-result">API ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</pre>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let socket = null;
        let isConnected = false;

        // WebSocket ì—°ê²°
        function connectWebSocket() {
            try {
                socket = io(API_URL, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionAttempts: 5,
                    reconnectionDelay: 1000,
                });

                socket.on('connect', () => {
                    isConnected = true;
                    updateStatus('ws', true, 'ì—°ê²°ë¨');
                    addMessage('system', 'âœ… WebSocket ì—°ê²°ë¨');
                });

                socket.on('disconnect', () => {
                    isConnected = false;
                    updateStatus('ws', false, 'ì—°ê²° ëŠê¹€');
                    addMessage('error', 'âŒ WebSocket ì—°ê²° ëŠê¹€');
                });

                socket.on('progress', (data) => {
                    const percent = data.percent || 0;
                    document.getElementById('progress-fill').style.width = percent + '%';
                    addMessage('progress', `ğŸ“Š ${data.stage} (${percent}%)`);
                });

                socket.on('result', (data) => {
                    document.getElementById('progress-fill').style.width = '100%';
                    addMessage('system', `âœ… ê²°ê³¼: ${JSON.stringify(data.output, null, 2)}`);
                    setTimeout(() => {
                        document.getElementById('progress-fill').style.width = '0%';
                    }, 2000);
                });

                socket.on('error', (data) => {
                    addMessage('error', `âŒ ì˜¤ë¥˜: ${data.message}`);
                });

            } catch (e) {
                console.error('WebSocket ì—°ê²° ì‹¤íŒ¨:', e);
                updateStatus('ws', false, 'ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // API ìƒíƒœ í™•ì¸
        async function checkAPIStatus() {
            try {
                const res = await fetch(API_URL + '/health');
                const data = await res.json();
                updateStatus('api', data.status === 'healthy', data.status);
            } catch (e) {
                updateStatus('api', false, 'ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(type, ok, text) {
            const statusEl = document.getElementById(type + '-status');
            const iconEl = document.getElementById(type + '-icon');
            const textEl = document.getElementById(type + '-text');
            
            statusEl.className = 'status-item ' + (ok ? 'connected' : 'disconnected');
            iconEl.textContent = ok ? 'ğŸŸ¢' : 'ğŸ”´';
            textEl.textContent = text;
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(type, content) {
            const messages = document.getElementById('messages');
            const msg = document.createElement('div');
            msg.className = 'message ' + type;
            
            if (typeof content === 'object') {
                msg.innerHTML = `<pre>${JSON.stringify(content, null, 2)}</pre>`;
            } else {
                msg.textContent = content;
            }
            
            messages.appendChild(msg);
            messages.scrollTop = messages.scrollHeight;
        }

        // ëª…ë ¹ ì „ì†¡
        function send() {
            const input = document.getElementById('command');
            const cmd = input.value.trim();
            
            if (!cmd) return;
            
            addMessage('user', cmd);
            input.value = '';
            
            document.getElementById('progress-fill').style.width = '10%';

            if (socket && isConnected) {
                socket.emit('message', { command: cmd });
            } else {
                // WebSocket ì—†ìœ¼ë©´ REST APIë¡œ í´ë°±
                sendViaAPI(cmd);
            }
        }

        // REST APIë¡œ ì „ì†¡
        async function sendViaAPI(cmd) {
            try {
                addMessage('progress', 'ğŸ“¡ REST APIë¡œ ì „ì†¡ ì¤‘...');
                
                const res = await fetch(API_URL + '/api/langgraph/hybrid', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        user_id: 'test_user',
                        goal: cmd 
                    })
                });
                
                const data = await res.json();
                document.getElementById('progress-fill').style.width = '100%';
                addMessage('system', data);
                
            } catch (e) {
                addMessage('error', 'âŒ API ì˜¤ë¥˜: ' + e.message);
            }
        }

        // ë¹ ë¥¸ ëª…ë ¹
        function sendQuickCmd(cmd) {
            document.getElementById('command').value = cmd;
            send();
        }

        // API í…ŒìŠ¤íŠ¸
        async function testAPI(endpoint) {
            const resultEl = document.getElementById('api-result');
            resultEl.textContent = 'ë¡œë”© ì¤‘...';
            
            try {
                const res = await fetch(API_URL + endpoint);
                const data = await res.json();
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
                resultEl.textContent = 'ì˜¤ë¥˜: ' + e.message;
            }
        }

        // ì´ˆê¸°í™”
        window.onload = () => {
            checkAPIStatus();
            connectWebSocket();
            setInterval(checkAPIStatus, 30000);
        };
    </script>
</body>
</html>
