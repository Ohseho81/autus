<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>











<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ AUTUS Physics Map - CrewAI ì™„ì„±í˜•</title>
  <script src="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
  <link href="https://unpkg.com/mapbox-gl@2.15.0/dist/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
    
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #graph-canvas {
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 25px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }
    
    .header h1 {
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 span { color: #00ff88; }
    
    .kpi-bar {
      display: flex;
      gap: 30px;
    }
    
    .kpi-item {
      text-align: center;
    }
    
    .kpi-value {
      color: #00ff88;
      font-size: 22px;
      font-weight: bold;
    }
    
    .kpi-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    /* CrewAI Panel */
    #panel {
      position: absolute;
      top: 80px;
      right: 20px;
      width: 420px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(153, 102, 255, 0.5);
      border-radius: 16px;
      padding: 20px;
      z-index: 100;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(153, 102, 255, 0.3);
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .panel-header h2 {
      color: white;
      font-size: 18px;
      margin: 0;
    }
    
    .agent-badges {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .agent-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .agent-delete { background: rgba(255, 68, 68, 0.3); color: #ff4444; border: 1px solid #ff4444; }
    .agent-automate { background: rgba(0, 255, 136, 0.3); color: #00ff88; border: 1px solid #00ff88; }
    .agent-outsource { background: rgba(153, 102, 255, 0.3); color: #9966ff; border: 1px solid #9966ff; }
    
    #response {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 120px;
      line-height: 1.8;
      color: #ccc;
      font-size: 14px;
    }
    
    #response strong { color: #00ff88; }
    #response .warning { color: #ff6b6b; }
    #response .highlight { color: #ffcc00; }
    
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #9966ff 0%, #6633cc 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 102, 255, 0.5);
    }
    
    .btn-secondary {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .btn-secondary:hover {
      background: rgba(0, 255, 136, 0.3);
    }
    
    .btn-action {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .btn-action:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 1px solid #ff4444;
    }
    
    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    /* Node Info Panel */
    .node-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 10, 20, 0.95);
      border: 1px solid rgba(0, 255, 136, 0.5);
      border-radius: 16px;
      padding: 20px;
      min-width: 300px;
      z-index: 100;
      display: none;
    }
    
    .node-info.active { display: block; }
    
    .node-name {
      font-size: 20px;
      color: white;
      margin-bottom: 10px;
    }
    
    .node-value {
      font-size: 28px;
      color: #00ff88;
      font-weight: bold;
    }
    
    .node-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
    }
    
    .stat-label { color: #888; font-size: 11px; }
    .stat-value { color: white; font-size: 16px; font-weight: bold; }
    
    /* Status Bar */
    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px 25px;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      font-size: 12px;
      color: #666;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="canvas-container">
    <canvas id="graph-canvas"></canvas>
  </div>
  
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ AUTUS <span>Physics Map</span> + CrewAI</h1>
    <div class="kpi-bar">
      <div class="kpi-item">
        <div class="kpi-value" id="total-value">â‚©122M</div>
        <div class="kpi-label">ì´ ê°€ì¹˜</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="synergy-rate">30%</div>
        <div class="kpi-label">ì‹œë„ˆì§€ìœ¨</div>
      </div>
      <div class="kpi-item">
        <div class="kpi-value" id="prediction-12m">â‚©558M</div>
        <div class="kpi-label">12ê°œì›” ì˜ˆì¸¡</div>
      </div>
    </div>
  </div>
  
  <!-- CrewAI Panel -->
  <div id="panel">
    <div class="panel-header">
      <span style="font-size: 28px;">ğŸ¤–</span>
      <h2>CrewAI ë©€í‹° ì—ì´ì „íŠ¸</h2>
    </div>
    
    <div class="agent-badges">
      <span class="agent-badge agent-delete">ğŸ—‘ï¸ ì‚­ì œ ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-automate">âš¡ ìë™í™” ì „ë¬¸ê°€</span>
      <span class="agent-badge agent-outsource">ğŸŒ ì™¸ë¶€ ìš©ì—­</span>
    </div>
    
    <div id="response">
      <p style="color: #9966ff;">CrewAI ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
      <p style="margin-top: 10px;">3ëª…ì˜ ì „ë¬¸ê°€ê°€ í˜‘ì—…í•˜ì—¬ ëˆ ìµœê³ ì¹˜ ì œì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤:</p>
      <p style="margin-top: 5px; color: #888;">â€¢ Grok (ì‚­ì œ ë¶„ì„) + Claude (ìë™í™”) + GPT (ì™¸ë¶€ ìš©ì—­)</p>
    </div>
    
    <div class="btn-group">
      <button class="btn btn-primary" onclick="runCrewAI()">
        ğŸ§  CrewAI ì „ì²´ ë¶„ì„ ì‹¤í–‰
      </button>
      <button class="btn btn-secondary" onclick="predict12Months()">
        ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡
      </button>
      
      <div class="action-row">
        <button class="btn btn-danger" onclick="executeAction('delete')">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
        <button class="btn btn-action" onclick="executeAction('automate')">
          âš¡ ìë™í™”
        </button>
        <button class="btn btn-action" onclick="executeAction('outsource')">
          ğŸŒ ì™¸ë¶€
        </button>
      </div>
    </div>
  </div>
  
  <!-- Node Info -->
  <div class="node-info" id="node-info">
    <div class="node-name" id="node-name">ì˜¤ì„¸í˜¸</div>
    <div class="node-value" id="node-value">â‚©56,000,000</div>
    <div class="node-stats">
      <div class="stat-item">
        <div class="stat-label">ì—°ê²° ìˆ˜</div>
        <div class="stat-value" id="node-connections">3</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ì‹œë„ˆì§€</div>
        <div class="stat-value" id="node-synergy">25%</div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <span class="status-dot"></span>
      <span id="crewai-status">CrewAI Ready</span>
    </div>
    <div class="status-item">
      <span>Neo4j: <span style="color: #00ff88;">Connected</span></span>
    </div>
    <div class="status-item">
      <span>Nodes: <span id="node-count">5</span> | Links: <span id="link-count">5</span></span>
    </div>
  </div>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const state = {
      nodes: [
        { id: "ì˜¤ì„¸í˜¸", label: "ì˜¤ì„¸í˜¸ (ëŒ€í‘œ)", value: 56000000, lat: 37.5415, lon: 127.0155 },
        { id: "ê¹€ê²½í¬", label: "ê¹€ê²½í¬ (ë§¤ë‹ˆì €)", value: 25000000, lat: 37.5416, lon: 127.0156 },
        { id: "ì˜¤ì„ ìš°", label: "ì˜¤ì„ ìš° (í—¤ë“œ ê°•ì‚¬)", value: 23000000, lat: 37.5414, lon: 127.0154 },
        { id: "ì˜¤ì—°ìš°", label: "ì˜¤ì—°ìš° (ê°•ì‚¬)", value: 11000000, lat: 37.5417, lon: 127.0157 },
        { id: "ì˜¤ì€ìš°", label: "ì˜¤ì€ìš° (ê°•ì‚¬)", value: 7000000, lat: 37.5413, lon: 127.0153 }
      ],
      links: [
        { source: "ì˜¤ì„¸í˜¸", target: "ê¹€ê²½í¬", value: 15000000, type: "current" },
        { source: "ê¹€ê²½í¬", target: "ì˜¤ì„ ìš°", value: 12000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì—°ìš°", value: 8000000, type: "current" },
        { source: "ì˜¤ì„ ìš°", target: "ì˜¤ì€ìš°", value: 6000000, type: "current" },
        { source: "ì˜¤ì„¸í˜¸", target: "ì˜¤ì€ìš°", value: 20000000, type: "prediction" }
      ],
      selectedNode: null,
      synergyRate: 0.30
    };
    
    const API_BASE = 'http://localhost:3002';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP + CANVAS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Mapbox (optional - works without token too)
    mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
    
    let map;
    try {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12',
        center: [127.0155, 37.5415],
        zoom: 16,
        pitch: 45
      });
    } catch (e) {
      console.log('Mapbox not available, using canvas only');
      document.getElementById('map').style.background = '#0a0a14';
    }
    
    const canvas = document.getElementById('graph-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    
    window.addEventListener('resize', resize);
    resize();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function positionNodes() {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;
      
      state.nodes.forEach((node, i) => {
        const angle = (i / state.nodes.length) * Math.PI * 2 - Math.PI / 2;
        node.x = centerX + Math.cos(angle) * radius;
        node.y = centerY + Math.sin(angle) * radius;
      });
    }
    
    function render() {
      ctx.clearRect(0, 0, width, height);
      
      // Draw links
      state.links.forEach(link => {
        const source = state.nodes.find(n => n.id === link.source);
        const target = state.nodes.find(n => n.id === link.target);
        if (!source || !target) return;
        
        ctx.beginPath();
        ctx.moveTo(source.x, source.y);
        ctx.lineTo(target.x, target.y);
        
        if (link.type === 'prediction') {
          ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
          ctx.setLineDash([10, 5]);
        } else {
          ctx.strokeStyle = `rgba(0, 255, 136, ${0.3 + (link.value / 20000000) * 0.5})`;
          ctx.setLineDash([]);
        }
        
        ctx.lineWidth = Math.max(1, link.value / 5000000);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Animated particles
        drawParticle(source, target, link);
      });
      
      // Draw nodes
      state.nodes.forEach(node => {
        const size = Math.sqrt(node.value) / 300;
        const isSelected = state.selectedNode === node.id;
        
        // Glow
        const gradient = ctx.createRadialGradient(node.x, node.y, 0, node.x, node.y, size * 2);
        gradient.addColorStop(0, isSelected ? 'rgba(153, 102, 255, 0.8)' : 'rgba(0, 255, 136, 0.5)');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, size * 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Node circle
        ctx.beginPath();
        ctx.arc(node.x, node.y, size, 0, Math.PI * 2);
        ctx.fillStyle = isSelected ? '#9966ff' : '#00ff88';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Label
        ctx.font = 'bold 14px Arial';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.fillText(node.label.split(' ')[0], node.x, node.y + size + 20);
        
        // Value
        ctx.font = '12px Arial';
        ctx.fillStyle = '#00ff88';
        ctx.fillText(formatMoney(node.value), node.x, node.y + size + 36);
      });
      
      requestAnimationFrame(render);
    }
    
    let particlePhase = 0;
    function drawParticle(source, target, link) {
      particlePhase += 0.01;
      const t = (Math.sin(particlePhase + link.value / 10000000) + 1) / 2;
      const x = source.x + (target.x - source.x) * t;
      const y = source.y + (target.y - source.y) * t;
      
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = link.type === 'prediction' ? '#ffcc00' : '#00ff88';
      ctx.fill();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CREWAI INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function runCrewAI() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ§  CrewAI ë©€í‹° ì—ì´ì „íŠ¸ í˜‘ì—… ë¶„ì„ ì¤‘...</p>';
      document.getElementById('crewai-status').textContent = 'Analyzing...';
      
      try {
        const result = await fetch(`${API_BASE}/crewai/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nodes: state.nodes, links: state.links })
        });
        
        if (result.ok) {
          const data = await result.json();
          response.innerHTML = formatCrewAIResponse(data.analysis);
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // Simulation fallback
        await simulateDelay(2000);
        response.innerHTML = `
          <p><strong style="color: #9966ff;">ğŸ§  CrewAI ë¶„ì„ ê²°ê³¼</strong></p>
          <br>
          <p><span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€ - Grok]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì€ìš° ê°€ì¹˜ 700ë§Œ (ë‚®ìŒ) â†’ <strong>ì‚­ì œ ë˜ëŠ” ì¬ë°°ì¹˜</strong> ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì ˆê°: ì›” +500ë§Œì›</p>
          <br>
          <p><span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€ - Claude]</span></p>
          <p style="margin-left: 16px;">ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²° <strong>ìë™í™”</strong> ì œì•ˆ</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ì‹œë„ˆì§€: ì›” +1,000ë§Œì›</p>
          <br>
          <p><span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€ - GPT]</span></p>
          <p style="margin-left: 16px;">ì…ì‹œ ì „ë¬¸ê°€ ì™¸ë¶€ ë„ì… ê¶Œì¥</p>
          <p style="margin-left: 16px; color: #888;">ì˜ˆìƒ ê°€ì†: ì›” +3,000ë§Œì›</p>
          <br>
          <p><strong class="highlight">ğŸ“Š ì¢…í•©: 12ê°œì›” í›„ 5ì–µ 5,800ë§Œì› (9.3ë°°)</strong></p>
        `;
      }
      
      document.getElementById('crewai-status').textContent = 'CrewAI Ready';
    }
    
    async function predict12Months() {
      const response = document.getElementById('response');
      response.innerHTML = '<p class="loading" style="color: #9966ff;">ğŸ“ˆ 12ê°œì›” ë³µë¦¬ ì˜ˆì¸¡ ê³„ì‚° ì¤‘...</p>';
      
      await simulateDelay(1500);
      
      const current = 60000000;
      const s30 = current * Math.pow(1.30, 12);
      const s40 = current * Math.pow(1.40, 12);
      
      response.innerHTML = `
        <p><strong style="color: #9966ff;">ğŸ“ˆ CrewAI ë³µë¦¬ ì˜ˆì¸¡</strong></p>
        <br>
        <p>í˜„ì¬ ì›” ê°€ì¹˜: <strong class="highlight">${formatMoney(current)}</strong></p>
        <br>
        <table style="width: 100%; color: white; font-size: 14px;">
          <tr style="color: #888;"><td>ì‹œë„ˆì§€ìœ¨</td><td>6ê°œì›”</td><td>12ê°œì›”</td><td>ë°°ìˆ˜</td></tr>
          <tr><td>20%</td><td>${formatMoney(current * Math.pow(1.20, 6))}</td><td>${formatMoney(current * Math.pow(1.20, 12))}</td><td>4.2x</td></tr>
          <tr style="color: #00ff88;"><td><strong>30%</strong></td><td>${formatMoney(current * Math.pow(1.30, 6))}</td><td><strong>${formatMoney(s30)}</strong></td><td><strong>9.3x</strong></td></tr>
          <tr><td>40%</td><td>${formatMoney(current * Math.pow(1.40, 6))}</td><td>${formatMoney(s40)}</td><td>21.7x</td></tr>
        </table>
        <br>
        <p style="color: #ffcc00;">â­ ë³„ë˜¥ë³„ ê²½ë¡œ(ì˜ˆì¸¡ ì—°ê²°) ê°•í™” ì‹œ 40% ë‹¬ì„± ê°€ëŠ¥</p>
      `;
      
      document.getElementById('prediction-12m').textContent = formatMoney(s30, true);
    }
    
    function executeAction(type) {
      const response = document.getElementById('response');
      
      switch(type) {
        case 'delete':
          response.innerHTML = `
            <p><strong class="warning">ğŸ—‘ï¸ ì‚­ì œ ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì€ìš° (ê°€ì¹˜ 700ë§Œ)</p>
            <p style="color: #888;">â€¢ ëˆ ìœ ì¶œ ì¦‰ì‹œ ì°¨ë‹¨</p>
            <p style="color: #888;">â€¢ ê´€ë ¨ ë§í¬ ìë™ ì •ë¦¬</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +500ë§Œì›</p>
          `;
          break;
        case 'automate':
          response.innerHTML = `
            <p><strong style="color: #00ff88;">âš¡ ìë™í™” ì‹¤í–‰</strong></p>
            <br>
            <p>ëŒ€ìƒ: ì˜¤ì„¸í˜¸ â†’ ì˜¤ì€ìš° ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ ìë™ ê°•í™”</p>
            <p style="color: #888;">â€¢ ë°˜ë³µ ì—…ë¬´ ì œê±°</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +1,000ë§Œì›</p>
          `;
          break;
        case 'outsource':
          response.innerHTML = `
            <p><strong style="color: #9966ff;">ğŸŒ ì™¸ë¶€ ìš©ì—­ ë„ì…</strong></p>
            <br>
            <p>ì¶”ì²œ: ì…ì‹œ ì „ë¬¸ê°€</p>
            <p style="color: #888;">â€¢ ê³ ê°€ì¹˜ ì™¸ë¶€ ë…¸ë“œ ì—°ê²°</p>
            <p style="color: #888;">â€¢ ì‹œë„ˆì§€ í­ë°œ ê°€ì†</p>
            <p style="color: #00ff88;">ì˜ˆìƒ íš¨ê³¼: ì›” +3,000ë§Œì›</p>
          `;
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function formatMoney(value, compact = false) {
      if (compact) {
        if (value >= 100000000) return `â‚©${(value / 100000000).toFixed(0)}ì–µ`;
        if (value >= 10000000) return `â‚©${(value / 10000000).toFixed(0)}ì²œë§Œ`;
        return `â‚©${(value / 10000).toFixed(0)}ë§Œ`;
      }
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(value);
    }
    
    function formatCrewAIResponse(text) {
      return text
        .replace(/\[ì‚­ì œ ì „ë¬¸ê°€\]/g, '<span class="warning">ğŸ—‘ï¸ [ì‚­ì œ ì „ë¬¸ê°€]</span>')
        .replace(/\[ìë™í™” ì „ë¬¸ê°€\]/g, '<span style="color: #00ff88;">âš¡ [ìë™í™” ì „ë¬¸ê°€]</span>')
        .replace(/\[ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€\]/g, '<span style="color: #9966ff;">ğŸŒ [ì™¸ë¶€ ìš©ì—­ ì „ë¬¸ê°€]</span>')
        .replace(/\n/g, '<br>');
    }
    
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function init() {
      positionNodes();
      
      // Update KPIs
      const totalValue = state.nodes.reduce((sum, n) => sum + n.value, 0);
      document.getElementById('total-value').textContent = formatMoney(totalValue, true);
      document.getElementById('node-count').textContent = state.nodes.length;
      document.getElementById('link-count').textContent = state.links.length;
      
      // Canvas click
      canvas.style.pointerEvents = 'auto';
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        state.nodes.forEach(node => {
          const size = Math.sqrt(node.value) / 300;
          const dist = Math.sqrt((x - node.x) ** 2 + (y - node.y) ** 2);
          
          if (dist < size + 20) {
            state.selectedNode = node.id;
            showNodeInfo(node);
          }
        });
      });
      
      render();
      console.log('ğŸš€ AUTUS Physics Map + CrewAI initialized');
    }
    
    function showNodeInfo(node) {
      const panel = document.getElementById('node-info');
      const connections = state.links.filter(l => l.source === node.id || l.target === node.id).length;
      
      document.getElementById('node-name').textContent = node.label;
      document.getElementById('node-value').textContent = formatMoney(node.value);
      document.getElementById('node-connections').textContent = connections;
      document.getElementById('node-synergy').textContent = `${Math.round(state.synergyRate * 100)}%`;
      
      panel.classList.add('active');
    }
    
    init();
  </script>
</body>
</html>
















