<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AUTUS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: #fff; 
            font-family: -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .status-line {
            font-size: 12px;
            letter-spacing: 0.3em;
            opacity: 0.5;
            margin-bottom: 8px;
        }
        .failure-line {
            font-size: 28px;
            font-weight: 200;
            letter-spacing: 0.05em;
            margin-bottom: 64px;
        }
        .failure-line.GREEN { color: #00ff88; }
        .failure-line.YELLOW { color: #ffaa00; }
        .failure-line.RED { color: #ff2244; animation: pulse 0.5s infinite; }
        @keyframes pulse { 50% { opacity: 0.5; } }
        
        .action-label {
            font-size: 10px;
            letter-spacing: 0.4em;
            opacity: 0.3;
            margin-bottom: 12px;
        }
        .action-text {
            font-size: 36px;
            font-weight: 300;
            letter-spacing: 0.1em;
            margin-bottom: 48px;
        }
        .action-text.YELLOW { color: #ffaa00; }
        .action-text.RED { color: #ff2244; }
        .action-text.GREEN { color: #00ff88; }
        
        button {
            background: transparent;
            border: 1px solid #ffaa00;
            color: #ffaa00;
            padding: 18px 64px;
            font-size: 14px;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover { background: #ffaa0022; }
        button.RED { border-color: #ff2244; color: #ff2244; }
        button.RED:hover { background: #ff224422; }
        button.hidden { display: none; }
        
        /* OPS Panel */
        .ops-toggle {
            position: fixed;
            bottom: 16px;
            right: 16px;
            font-size: 10px;
            opacity: 0.3;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #333;
            border-radius: 4px;
        }
        .ops-toggle:hover { opacity: 0.8; }
        
        .ops-panel {
            position: fixed;
            bottom: 50px;
            right: 16px;
            background: #111;
            border: 1px solid #222;
            border-radius: 8px;
            padding: 16px;
            display: none;
        }
        .ops-panel.show { display: block; }
        .ops-panel h4 {
            font-size: 10px;
            letter-spacing: 0.2em;
            opacity: 0.4;
            margin-bottom: 12px;
        }
        .ops-panel .ops-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .ops-panel button {
            padding: 10px 16px;
            font-size: 10px;
            border-color: #444;
            color: #888;
        }
        .ops-panel button:hover {
            border-color: #888;
            color: #fff;
        }
        .ops-panel button.p { border-color: #ff6644; color: #ff6644; }
        .ops-panel button.r { border-color: #00ff88; color: #00ff88; }
        .ops-panel button.d { border-color: #00d4ff; color: #00d4ff; }
        
        .ops-panel .ops-info {
            font-size: 9px;
            opacity: 0.4;
            margin-top: 8px;
        }
        .ops-panel .ops-info div { margin: 4px 0; }
        
        /* Top Risk Actor */
        .risk-actor {
            position: fixed;
            top: 16px;
            right: 16px;
            font-size: 10px;
            opacity: 0.5;
            text-align: right;
        }
        .risk-actor.high { color: #ff6644; opacity: 1; }
        
        /* Nav */
        .nav {
            position: fixed;
            top: 16px;
            left: 16px;
            font-size: 10px;
            opacity: 0.3;
        }
        .nav a { color: #fff; text-decoration: none; margin-right: 16px; }
        .nav a:hover { opacity: 1; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="/frontend/index.html">SOLAR</a>
        <a href="/frontend/galaxy.html">GALAXY</a>
        <a href="/frontend/dashboard.html">DASHBOARD</a>
    </div>
    
    <div class="risk-actor" id="risk-actor"></div>
    
    <div class="status-line" id="status-line">SYSTEM STABLE</div>
    <div class="failure-line GREEN" id="failure-line">ALL CLEAR</div>
    
    <div class="action-label">ACTION REQUIRED</div>
    <div class="action-text GREEN" id="action-text">NONE</div>
    
    <button id="btn" class="hidden" onclick="exec()">EXECUTE</button>
    
    <div class="ops-toggle" onclick="toggleOps()">OPS</div>
    <div class="ops-panel" id="ops-panel">
        <h4>OPERATIONS</h4>
        <div class="ops-buttons">
            <button class="p" onclick="post('/event/add_work',{count:1,weight:1,actor_id:'OPS'})">+P</button>
            <button class="r" onclick="post('/event/remove_work',{count:1,weight:1,actor_id:'OPS'})">+R</button>
            <button class="d" onclick="post('/event/commit_decision',{decision:'commit',actor_id:'OPS'})">+D</button>
        </div>
        <div class="ops-info">
            <div>tick: <span id="ops-tick">0</span> | cycle: <span id="ops-cycle">0</span></div>
            <div>P: <span id="ops-p">0</span> | R: <span id="ops-r">0</span> | D: <span id="ops-d">0</span></div>
            <div>E: <span id="ops-e">0</span> | G: <span id="ops-g">0</span></div>
        </div>
    </div>
    
    <script>
        const API_KEY = 'autus-secure-key-2024';
        let opsVisible = false;
        
        function toggleOps() {
            opsVisible = !opsVisible;
            document.getElementById('ops-panel').className = opsVisible ? 'ops-panel show' : 'ops-panel';
        }
        
        async function get() {
            const r = await fetch('/status', {cache:'no-store'});
            return r.ok ? await r.json() : null;
        }
        
        async function post(p, b) {
            await fetch(p, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-AUTUS-KEY': API_KEY},
                body: JSON.stringify(b)
            });
        }
        
        async function exec() {
            await post('/execute', {action: 'AUTO_STABILIZE', actor_id: 'UI'});
        }
        
        function render(s) {
            if (!s || !s.output) return;
            const st = s.output.status;
            const fail = s.output.failure_in_ticks;
            const act = s.output.required_action;
            const bn = s.output.bottleneck;
            
            const sl = document.getElementById('status-line');
            const fl = document.getElementById('failure-line');
            const at = document.getElementById('action-text');
            const btn = document.getElementById('btn');
            
            if (st === 'GREEN') {
                sl.textContent = 'SYSTEM STABLE';
                fl.textContent = 'ALL CLEAR';
                fl.className = 'failure-line GREEN';
                at.textContent = 'NONE';
                at.className = 'action-text GREEN';
                btn.className = 'hidden';
            } else if (st === 'YELLOW') {
                sl.textContent = 'SYSTEM AT RISK';
                fl.textContent = fail ? 'FAILURE IN ' + fail + ' TICKS' : 'ATTENTION NEEDED';
                fl.className = 'failure-line YELLOW';
                at.textContent = act === 'DECIDE' ? 'DECIDE NOW' : act === 'REMOVE' ? 'REDUCE LOAD' : bn !== 'NONE' ? bn.replace('_', ' ') : 'STABILIZE';
                at.className = 'action-text YELLOW';
                btn.className = '';
            } else {
                sl.textContent = 'SYSTEM CRITICAL';
                fl.textContent = fail ? 'FAILURE IN ' + fail + ' TICKS' : 'IMMEDIATE ACTION';
                fl.className = 'failure-line RED';
                at.textContent = act === 'DECIDE' ? 'DECIDE NOW' : act === 'REMOVE' ? 'REDUCE LOAD' : 'STABILIZE NOW';
                at.className = 'action-text RED';
                btn.className = 'RED';
            }
            
            // OPS info
            if (s.signals) {
                document.getElementById('ops-tick').textContent = s.tick;
                document.getElementById('ops-cycle').textContent = s.cycle;
                document.getElementById('ops-p').textContent = s.signals.pressure.toFixed(2);
                document.getElementById('ops-r').textContent = s.signals.release.toFixed(2);
                document.getElementById('ops-d').textContent = s.signals.decision.toFixed(2);
                document.getElementById('ops-e').textContent = s.signals.entropy.toFixed(3);
                document.getElementById('ops-g').textContent = s.signals.gravity.toFixed(3);
            }
            
            // Top risk actor
            const riskEl = document.getElementById('risk-actor');
            if (s.top_risk_actor && s.top_risk_actor.risk_score > 0.5) {
                riskEl.textContent = 'âš  ' + s.top_risk_actor.actor_id;
                riskEl.className = 'risk-actor high';
            } else if (s.top_risk_actor) {
                riskEl.textContent = s.top_risk_actor.actor_id;
                riskEl.className = 'risk-actor';
            } else {
                riskEl.textContent = '';
            }
        }
        
        (async function poll() {
            while (1) {
                try { render(await get()); } catch(e) {}
                await new Promise(r => setTimeout(r, 1000));
            }
        })();
    </script>
</body>
</html>
