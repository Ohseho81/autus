<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTUS Strategy Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #111118;
            --border: #1e1e2e;
            --text: #e4e4e7;
            --dim: #71717a;
            --cyan: #00f0ff;
            --green: #00ff88;
            --purple: #b44aff;
            --orange: #ff8800;
            --red: #ff4444;
            --gold: #ffd700;
            --pink: #ff0080;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        .header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--cyan), var(--purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--cyan), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--dim);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            border-color: var(--cyan);
            color: var(--cyan);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            height: calc(100vh - 73px);
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        /* Left Panel - External Intelligence */
        .left-panel {
            background: var(--card);
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }

        .panel-section {
            border-bottom: 1px solid var(--border);
        }

        .panel-header {
            padding: 16px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0,0,0,0.3);
        }

        .panel-body {
            padding: 12px;
        }

        /* News Cards */
        .news-card {
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid var(--border);
        }

        .news-card:hover {
            background: rgba(0,240,255,0.05);
            border-left-color: var(--cyan);
        }

        .news-card.policy { border-left-color: var(--purple); }
        .news-card.admission { border-left-color: var(--orange); }
        .news-card.trend { border-left-color: var(--green); }

        .news-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .news-tag.policy { background: var(--purple); color: #fff; }
        .news-tag.admission { background: var(--orange); color: #000; }
        .news-tag.trend { background: var(--green); color: #000; }

        .news-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .news-date {
            font-size: 11px;
            color: var(--dim);
        }

        /* Center - Map */
        .map-container {
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
            background: var(--bg);
        }

        /* Map Controls */
        .map-controls {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .map-btn {
            padding: 10px 16px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-btn:hover, .map-btn.active {
            border-color: var(--cyan);
            color: var(--cyan);
        }

        /* Map Legend */
        .map-legend {
            position: absolute;
            bottom: 24px;
            left: 16px;
            z-index: 1000;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .legend-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--dim);
            margin-bottom: 6px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Right Panel - Internal Intelligence */
        .right-panel {
            background: var(--card);
            border-left: 1px solid var(--border);
            overflow-y: auto;
        }

        /* Competitor Cards */
        .competitor-card {
            padding: 14px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .competitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .competitor-name {
            font-size: 13px;
            font-weight: 600;
        }

        .threat-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }

        .threat-badge.high { background: var(--red); color: #fff; }
        .threat-badge.medium { background: var(--orange); color: #000; }
        .threat-badge.low { background: var(--green); color: #000; }

        .competitor-address {
            font-size: 11px;
            color: var(--dim);
            margin-bottom: 8px;
        }

        .competitor-stats {
            display: flex;
            gap: 12px;
        }

        .stat-item {
            font-size: 11px;
        }

        .stat-label {
            color: var(--dim);
        }

        .stat-value {
            font-weight: 600;
            color: var(--cyan);
        }

        /* Customer Zone Cards */
        .zone-card {
            padding: 14px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--green);
        }

        .zone-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .zone-potential {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .potential-bar {
            flex: 1;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .potential-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green), var(--gold));
            border-radius: 3px;
        }

        .potential-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--gold);
        }

        /* Strategy Summary */
        .strategy-box {
            padding: 16px;
            background: linear-gradient(135deg, rgba(0,240,255,0.1), rgba(180,74,255,0.1));
            border: 1px solid var(--cyan);
            border-radius: 12px;
            margin: 12px;
        }

        .strategy-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--cyan);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .strategy-text {
            font-size: 12px;
            line-height: 1.6;
            color: var(--text);
        }

        /* Custom Leaflet Styles */
        .leaflet-container {
            background: var(--bg);
        }

        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .marker-competitor {
            background: var(--red);
            border: 2px solid #fff;
        }

        .marker-customer {
            background: var(--green);
            border: 2px solid #fff;
        }

        .marker-academy {
            background: var(--gold);
            border: 3px solid #fff;
        }

        /* Pulse animation for academy marker */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,215,0,0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255,215,0,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,215,0,0); }
        }

        .marker-academy {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ğŸ—ºï¸</div>
            <span class="logo-text">AUTUS Strategy Intelligence</span>
        </div>
        <div class="nav-links">
            <a href="live-dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
            <a href="agent-dashboard.html" class="nav-link">ğŸ¤– Agent</a>
            <a href="physics-visualization.html" class="nav-link">ğŸ§¬ Physics</a>
            <a href="strategy-map.html" class="nav-link active">ğŸ—ºï¸ Strategy</a>
        </div>
    </header>

    <div class="main-layout">
        <!-- Left Panel: External Intelligence -->
        <div class="left-panel">
            <div class="panel-section">
                <div class="panel-header">
                    ğŸ“° ì™¸ë¶€ ì¸í…”ë¦¬ì „ìŠ¤
                </div>
            </div>

            <!-- Education Policy -->
            <div class="panel-section">
                <div class="panel-header" style="font-size:12px;">
                    ğŸ›ï¸ êµìœ¡ì •ì±…
                </div>
                <div class="panel-body" id="policy-news">
                    <div class="news-card policy">
                        <span class="news-tag policy">ì •ì±…</span>
                        <div class="news-title">2026í•™ë…„ë„ ëŒ€ì… ì •ì‹œ ë¹„ìœ¨ í™•ëŒ€ ë°œí‘œ</div>
                        <div class="news-date">2ì‹œê°„ ì „</div>
                    </div>
                    <div class="news-card policy">
                        <span class="news-tag policy">ì •ì±…</span>
                        <div class="news-title">êµìœ¡ë¶€, ì‚¬êµìœ¡ë¹„ ê²½ê° ëŒ€ì±… ì¶”ì§„</div>
                        <div class="news-date">5ì‹œê°„ ì „</div>
                    </div>
                </div>
            </div>

            <!-- Admission Trends -->
            <div class="panel-section">
                <div class="panel-header" style="font-size:12px;">
                    ğŸ“ ì…ì‹œ íŠ¸ë Œë“œ
                </div>
                <div class="panel-body" id="admission-news">
                    <div class="news-card admission">
                        <span class="news-tag admission">ì…ì‹œ</span>
                        <div class="news-title">SKY ìˆ˜ì‹œ í•©ê²©ì ë‚´ì‹  í‰ê·  1.2ë“±ê¸‰</div>
                        <div class="news-date">3ì‹œê°„ ì „</div>
                    </div>
                    <div class="news-card admission">
                        <span class="news-tag admission">ì…ì‹œ</span>
                        <div class="news-title">ì˜ëŒ€ ì •ì› ì¦ì›, ê²½ìŸë¥  ì™„í™” ì „ë§</div>
                        <div class="news-date">6ì‹œê°„ ì „</div>
                    </div>
                </div>
            </div>

            <!-- Market Trends -->
            <div class="panel-section">
                <div class="panel-header" style="font-size:12px;">
                    ğŸ“ˆ ì‹œì¥ íŠ¸ë Œë“œ
                </div>
                <div class="panel-body" id="market-news">
                    <div class="news-card trend">
                        <span class="news-tag trend">íŠ¸ë Œë“œ</span>
                        <div class="news-title">AI í•™ìŠµ í”Œë«í¼ ì‚¬ìš©ë¥  300% ì¦ê°€</div>
                        <div class="news-date">1ì¼ ì „</div>
                    </div>
                    <div class="news-card trend">
                        <span class="news-tag trend">íŠ¸ë Œë“œ</span>
                        <div class="news-title">í•™ì› ì˜¨ë¼ì¸ ì „í™˜ ê°€ì†í™”</div>
                        <div class="news-date">2ì¼ ì „</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center: Map -->
        <div class="map-container">
            <div id="map"></div>

            <div class="map-controls">
                <button class="map-btn active" onclick="toggleLayer('competitors')">
                    ğŸ”´ ê²½ìŸì‚¬
                </button>
                <button class="map-btn active" onclick="toggleLayer('customers')">
                    ğŸŸ¢ ê³ ê° ë‹¨ì§€
                </button>
                <button class="map-btn" onclick="toggleLayer('heatmap')">
                    ğŸ”¥ Hot Zone
                </button>
            </div>

            <div class="map-legend">
                <div class="legend-title">ğŸ“ ì§€ë„ ë²”ë¡€</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background:var(--gold)"></div>
                    ìš°ë¦¬ í•™ì›
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background:var(--red)"></div>
                    ê²½ìŸ í•™ì›
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background:var(--green)"></div>
                    ì ì¬ ê³ ê° ë‹¨ì§€
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background:var(--orange)"></div>
                    ê¸°íšŒ ì§€ì—­
                </div>
            </div>
        </div>

        <!-- Right Panel: Internal Intelligence -->
        <div class="right-panel">
            <div class="panel-section">
                <div class="panel-header">
                    ğŸ¯ ë‚´ë¶€ ì¸í…”ë¦¬ì „ìŠ¤
                </div>
            </div>

            <!-- AI Strategy -->
            <div class="strategy-box">
                <div class="strategy-title">ğŸ§  AI ì „ëµ ë¶„ì„</div>
                <div class="strategy-text">
                    ë°˜ê²½ 2km ë‚´ <strong>ê²½ìŸì‚¬ 8ê³³</strong> ê°ì§€. 
                    <strong>ë˜ë¯¸ì•ˆëŒ€ì¹˜íŒ°ë¦¬ìŠ¤</strong> ë°©ë©´ ì ìœ ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. 
                    í•´ë‹¹ êµ¬ì—­ íƒ€ê²Ÿ ë§ˆì¼€íŒ… ê¶Œì¥.
                </div>
            </div>

            <!-- Competitors -->
            <div class="panel-section">
                <div class="panel-header" style="font-size:12px;">
                    âš”ï¸ ê²½ìŸì‚¬ (ë°˜ê²½ 2km)
                </div>
                <div class="panel-body" id="competitors-list">
                    <div class="competitor-card">
                        <div class="competitor-header">
                            <span class="competitor-name">ëŒ€ì¹˜ë©”ê°€ìŠ¤í„°ë””</span>
                            <span class="threat-badge high">High</span>
                        </div>
                        <div class="competitor-address">ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 123</div>
                        <div class="competitor-stats">
                            <div class="stat-item">
                                <span class="stat-label">ê±°ë¦¬</span>
                                <span class="stat-value">0.8km</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ìœ„í˜‘ë„</span>
                                <span class="stat-value">85%</span>
                            </div>
                        </div>
                    </div>
                    <div class="competitor-card">
                        <div class="competitor-header">
                            <span class="competitor-name">ê°•ë‚¨ëŒ€ì„±í•™ì›</span>
                            <span class="threat-badge medium">Med</span>
                        </div>
                        <div class="competitor-address">ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 456</div>
                        <div class="competitor-stats">
                            <div class="stat-item">
                                <span class="stat-label">ê±°ë¦¬</span>
                                <span class="stat-value">1.2km</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ìœ„í˜‘ë„</span>
                                <span class="stat-value">62%</span>
                            </div>
                        </div>
                    </div>
                    <div class="competitor-card">
                        <div class="competitor-header">
                            <span class="competitor-name">ì‹œëŒ€ì¸ì¬</span>
                            <span class="threat-badge low">Low</span>
                        </div>
                        <div class="competitor-address">ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 789</div>
                        <div class="competitor-stats">
                            <div class="stat-item">
                                <span class="stat-label">ê±°ë¦¬</span>
                                <span class="stat-value">1.8km</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ìœ„í˜‘ë„</span>
                                <span class="stat-value">35%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Zones -->
            <div class="panel-section">
                <div class="panel-header" style="font-size:12px;">
                    ğŸ  ì ì¬ ê³ ê° ë‹¨ì§€
                </div>
                <div class="panel-body" id="zones-list">
                    <div class="zone-card">
                        <div class="zone-name">ë˜ë¯¸ì•ˆëŒ€ì¹˜íŒ°ë¦¬ìŠ¤</div>
                        <div class="zone-potential">
                            <div class="potential-bar">
                                <div class="potential-fill" style="width:85%"></div>
                            </div>
                            <span class="potential-value">V 85</span>
                        </div>
                    </div>
                    <div class="zone-card">
                        <div class="zone-name">ëŒ€ì¹˜ì•„ì´íŒŒí¬</div>
                        <div class="zone-potential">
                            <div class="potential-bar">
                                <div class="potential-fill" style="width:72%"></div>
                            </div>
                            <span class="potential-value">V 72</span>
                        </div>
                    </div>
                    <div class="zone-card">
                        <div class="zone-name">ì„ ê²½ì•„íŒŒíŠ¸</div>
                        <div class="zone-potential">
                            <div class="potential-bar">
                                <div class="potential-fill" style="width:68%"></div>
                            </div>
                            <span class="potential-value">V 68</span>
                        </div>
                    </div>
                    <div class="zone-card">
                        <div class="zone-name">ì€ë§ˆì•„íŒŒíŠ¸</div>
                        <div class="zone-potential">
                            <div class="potential-bar">
                                <div class="potential-fill" style="width:55%"></div>
                            </div>
                            <span class="potential-value">V 55</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AUTUS API Base URL
        const API_BASE = 'https://vercel-7dnjuc6bb-ohsehos-projects.vercel.app/api';
        
        // Initialize Map (ëŒ€ì¹˜ë™ ì¤‘ì‹¬)
        const academyLocation = [37.4949, 127.0664];
        const map = L.map('map', {
            center: academyLocation,
            zoom: 15,
            zoomControl: false
        });

        // Dark tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // Custom icon creator
        function createIcon(type, size = 30) {
            return L.divIcon({
                className: 'custom-marker',
                html: `<div class="custom-marker marker-${type}" style="width:${size}px;height:${size}px;"></div>`,
                iconSize: [size, size],
                iconAnchor: [size/2, size/2]
            });
        }

        // Academy marker (center)
        const academyMarker = L.marker(academyLocation, {
            icon: createIcon('academy', 40)
        }).addTo(map);
        academyMarker.bindPopup('<strong>ğŸ« ìš°ë¦¬ í•™ì›</strong><br>AUTUS ë³¸ì›');

        // Layer groups
        const competitorMarkers = L.layerGroup().addTo(map);
        const customerMarkers = L.layerGroup().addTo(map);

        // 2km radius circle
        L.circle(academyLocation, {
            radius: 2000,
            color: '#00f0ff',
            fillColor: '#00f0ff',
            fillOpacity: 0.05,
            weight: 1,
            dashArray: '5, 10'
        }).addTo(map);

        // 1km radius circle
        L.circle(academyLocation, {
            radius: 1000,
            color: '#b44aff',
            fillColor: '#b44aff',
            fillOpacity: 0.05,
            weight: 1,
            dashArray: '5, 10'
        }).addTo(map);

        // Toggle layer visibility
        const layers = {
            competitors: { layer: competitorMarkers, active: true },
            customers: { layer: customerMarkers, active: true },
            heatmap: { layer: null, active: false }
        };

        function toggleLayer(name) {
            const layerInfo = layers[name];
            if (!layerInfo.layer) return;

            layerInfo.active = !layerInfo.active;
            
            if (layerInfo.active) {
                layerInfo.layer.addTo(map);
            } else {
                map.removeLayer(layerInfo.layer);
            }

            const btns = document.querySelectorAll('.map-btn');
            btns.forEach(btn => {
                if (btn.textContent.includes(name === 'competitors' ? 'ê²½ìŸì‚¬' : name === 'customers' ? 'ê³ ê°' : 'Hot')) {
                    btn.classList.toggle('active', layerInfo.active);
                }
            });
        }

        // Add zoom control
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // ============ LOAD DATA FROM API ============
        
        // Load competitors from Naver API
        async function loadCompetitors() {
            try {
                const res = await fetch(`${API_BASE}/geo?type=competitors&query=${encodeURIComponent('ëŒ€ì¹˜ë™ í•™ì›')}&display=10`);
                const data = await res.json();
                
                if (data.success && data.data) {
                    competitorMarkers.clearLayers();
                    const listEl = document.getElementById('competitors-list');
                    listEl.innerHTML = '';
                    
                    data.data.forEach((comp, i) => {
                        // Calculate distance from academy
                        const distance = calculateDistance(academyLocation[0], academyLocation[1], comp.lat, comp.lng);
                        const threat = Math.max(20, 100 - (distance * 50)); // Closer = higher threat
                        const threatLevel = threat > 70 ? 'high' : threat > 40 ? 'medium' : 'low';
                        
                        // Add marker if coordinates valid
                        if (comp.lat && comp.lng) {
                            const marker = L.marker([comp.lat, comp.lng], {
                                icon: createIcon('competitor', 24)
                            });
                            marker.bindPopup(`<strong>âš”ï¸ ${comp.name}</strong><br>ì¹´í…Œê³ ë¦¬: ${comp.category}<br>ìœ„í˜‘ë„: ${threat.toFixed(0)}%`);
                            competitorMarkers.addLayer(marker);
                        }
                        
                        // Add to list
                        listEl.innerHTML += `
                            <div class="competitor-card">
                                <div class="competitor-header">
                                    <span class="competitor-name">${comp.name}</span>
                                    <span class="threat-badge ${threatLevel}">${threatLevel.charAt(0).toUpperCase() + threatLevel.slice(1)}</span>
                                </div>
                                <div class="competitor-address">${comp.address || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</div>
                                <div class="competitor-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">ê±°ë¦¬</span>
                                        <span class="stat-value">${distance.toFixed(1)}km</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">ìœ„í˜‘ë„</span>
                                        <span class="stat-value">${threat.toFixed(0)}%</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (err) {
                console.error('Failed to load competitors:', err);
            }
        }

        // Load customer zones (ì•„íŒŒíŠ¸ ë‹¨ì§€)
        async function loadCustomerZones() {
            try {
                const res = await fetch(`${API_BASE}/geo?type=apartments&query=${encodeURIComponent('ëŒ€ì¹˜ë™ ì•„íŒŒíŠ¸')}&display=10`);
                const data = await res.json();
                
                if (data.success && data.data) {
                    customerMarkers.clearLayers();
                    const listEl = document.getElementById('zones-list');
                    listEl.innerHTML = '';
                    
                    data.data.forEach((zone, i) => {
                        const potential = Math.floor(50 + Math.random() * 40); // Random V potential for demo
                        
                        if (zone.lat && zone.lng) {
                            const marker = L.marker([zone.lat, zone.lng], {
                                icon: createIcon('customer', 20)
                            });
                            marker.bindPopup(`<strong>ğŸ  ${zone.name}</strong><br>ì ì¬ V: ${potential}`);
                            customerMarkers.addLayer(marker);
                        }
                        
                        listEl.innerHTML += `
                            <div class="zone-card">
                                <div class="zone-name">${zone.name}</div>
                                <div class="zone-potential">
                                    <div class="potential-bar">
                                        <div class="potential-fill" style="width:${potential}%"></div>
                                    </div>
                                    <span class="potential-value">V ${potential}</span>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (err) {
                console.error('Failed to load customer zones:', err);
            }
        }

        // Load news
        async function loadNews() {
            try {
                // Policy news
                const policyRes = await fetch(`${API_BASE}/geo?type=news&query=${encodeURIComponent('êµìœ¡ ì •ì±…')}&display=3`);
                const policyData = await policyRes.json();
                if (policyData.success && policyData.data) {
                    renderNews('policy-news', policyData.data, 'policy');
                }
                
                // Admission news
                const admissionRes = await fetch(`${API_BASE}/geo?type=news&query=${encodeURIComponent('ì…ì‹œ ìˆ˜ëŠ¥')}&display=3`);
                const admissionData = await admissionRes.json();
                if (admissionData.success && admissionData.data) {
                    renderNews('admission-news', admissionData.data, 'admission');
                }
                
                // Market trends
                const marketRes = await fetch(`${API_BASE}/geo?type=news&query=${encodeURIComponent('ì‚¬êµìœ¡ í•™ì› íŠ¸ë Œë“œ')}&display=3`);
                const marketData = await marketRes.json();
                if (marketData.success && marketData.data) {
                    renderNews('market-news', marketData.data, 'trend');
                }
            } catch (err) {
                console.error('Failed to load news:', err);
            }
        }

        function renderNews(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map(item => `
                <div class="news-card ${type}" onclick="window.open('${item.link}', '_blank')">
                    <span class="news-tag ${type}">${type === 'policy' ? 'ì •ì±…' : type === 'admission' ? 'ì…ì‹œ' : 'íŠ¸ë Œë“œ'}</span>
                    <div class="news-title">${item.title}</div>
                    <div class="news-date">${formatDate(item.pubDate)}</div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = Math.floor((now - date) / (1000 * 60 * 60));
            if (diff < 1) return 'ë°©ê¸ˆ ì „';
            if (diff < 24) return `${diff}ì‹œê°„ ì „`;
            return `${Math.floor(diff/24)}ì¼ ì „`;
        }

        // Calculate distance between two coordinates (km)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Load strategic analysis
        async function loadStrategicAnalysis() {
            try {
                const res = await fetch(`${API_BASE}/geo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        center_lat: academyLocation[0],
                        center_lng: academyLocation[1],
                        academy_name: 'ëŒ€ì¹˜ë™'
                    })
                });
                const data = await res.json();
                
                if (data.success && data.data?.analysis) {
                    const analysis = data.data.analysis;
                    const strategyBox = document.querySelector('.strategy-text');
                    strategyBox.innerHTML = `
                        ë°˜ê²½ 2km ë‚´ <strong>ê²½ìŸì‚¬ ${analysis.competitor_count}ê³³</strong> ê°ì§€.
                        ìœ„í˜‘ ìˆ˜ì¤€: <strong style="color:${analysis.threat_level === 'high' ? '#ff4444' : analysis.threat_level === 'medium' ? '#ff8800' : '#00ff88'}">${analysis.threat_level.toUpperCase()}</strong><br>
                        ê¸°íšŒ ì ìˆ˜: <strong>${(analysis.opportunity_score * 100).toFixed(0)}%</strong><br><br>
                        ğŸ“Œ ${analysis.recommendations.join('<br>ğŸ“Œ ')}
                    `;
                }
            } catch (err) {
                console.error('Failed to load strategic analysis:', err);
            }
        }

        // Initialize all data
        async function initializeData() {
            console.log('ğŸ—ºï¸ Loading Strategy Intelligence from Naver API...');
            await Promise.all([
                loadCompetitors(),
                loadCustomerZones(),
                loadNews(),
                loadStrategicAnalysis()
            ]);
            console.log('âœ… Strategy Intelligence loaded!');
        }

        // Load on page ready
        initializeData();
    </script>
</body>
</html>
