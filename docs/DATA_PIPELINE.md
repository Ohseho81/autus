# 📊 AUTUS 데이터 파이프라인

> "측정할 수 없으면 관리할 수 없다" - 피터 드러커

## 🎯 핵심 공식

```
V = (M - T) × (1 + s)^t

V: Value (가치)
M: Mint (수입)
T: Tax (비용)
s: Synergy (시너지)
t: Time (시간)
```

---

## 📌 1. 핵심 데이터 정의

### 💰 M (Mint) - 수입 데이터

| 데이터 | 소스 | 수집 주기 | 중요도 |
|--------|------|----------|--------|
| **수강료 매출** | ERP/결제시스템 | 실시간 | ⭐⭐⭐ |
| **신규 등록** | ERP | 실시간 | ⭐⭐⭐ |
| **재등록** | ERP | 월간 | ⭐⭐⭐ |
| **특강/이벤트 매출** | ERP | 이벤트시 | ⭐⭐ |
| **교재 판매** | ERP | 월간 | ⭐ |
| **추천 보상** | CRM | 발생시 | ⭐⭐ |

**핵심 KPI:**
- 월 매출 (MRR)
- 신규 등록 수
- 재등록률

---

### 💸 T (Tax) - 비용 데이터

| 데이터 | 소스 | 수집 주기 | 중요도 |
|--------|------|----------|--------|
| **인건비** | 급여대장 | 월간 | ⭐⭐⭐ |
| **임대료** | 고정비 | 월간 | ⭐⭐ |
| **마케팅비** | 광고플랫폼 | 주간 | ⭐⭐⭐ |
| **운영비** | 경비장부 | 월간 | ⭐⭐ |
| **미수금** | ERP | 실시간 | ⭐⭐⭐ |
| **환불** | ERP | 실시간 | ⭐⭐⭐ |

**핵심 KPI:**
- 월 총비용
- 미수금 비율
- 환불률

---

### 🤝 s (Synergy) - 시너지 데이터

| 데이터 | 소스 | 수집 주기 | 중요도 |
|--------|------|----------|--------|
| **학부모 만족도** | 설문/NPS | 월간 | ⭐⭐⭐ |
| **재등록률** | ERP | 월간 | ⭐⭐⭐ |
| **추천율** | CRM | 월간 | ⭐⭐⭐ |
| **출석률** | 출결시스템 | 일간 | ⭐⭐ |
| **성적 향상도** | 성적관리 | 시험후 | ⭐⭐ |
| **상담 전환율** | CRM | 주간 | ⭐⭐ |

**핵심 KPI:**
- NPS (순추천지수)
- 재등록률
- 추천 전환율

---

## 📌 2. 외부 데이터

### 🏢 경쟁 환경

| 데이터 | 소스 | 수집 주기 | 용도 |
|--------|------|----------|------|
| **경쟁사 위치** | 네이버 지도 | 주간 | 위협 분석 |
| **경쟁사 평점** | 네이버/구글 | 주간 | 벤치마킹 |
| **경쟁사 가격** | 수동 조사 | 월간 | 가격 전략 |
| **신규 개원** | 뉴스/지도 | 주간 | 조기 경보 |

### 📰 시장 환경

| 데이터 | 소스 | 수집 주기 | 용도 |
|--------|------|----------|------|
| **교육 정책** | 교육부/뉴스 | 일간 | 정책 대응 |
| **입시 트렌드** | 입시 뉴스 | 일간 | 커리큘럼 |
| **학사 일정** | 학교 공지 | 월간 | 마케팅 타이밍 |
| **인구 통계** | 통계청 | 연간 | 장기 전략 |

### 🏠 고객 환경

| 데이터 | 소스 | 수집 주기 | 용도 |
|--------|------|----------|------|
| **아파트 단지** | 네이버 지도 | 월간 | 타겟팅 |
| **학교 정보** | 학교알리미 | 학기초 | 내신 대비 |
| **학군 정보** | 부동산 데이터 | 연간 | 잠재 고객 |

---

## 📌 3. 데이터 파이프라인 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        DATA SOURCES                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [내부]                              [외부]                      │
│  ┌─────────┐  ┌─────────┐           ┌─────────┐  ┌─────────┐   │
│  │ 학원ERP │  │  결제   │           │네이버API│  │ 교육부  │   │
│  │(학원나라)│  │(토스/PG)│           │(지도/뉴스)│  │  RSS   │   │
│  └────┬────┘  └────┬────┘           └────┬────┘  └────┬────┘   │
│       │            │                     │            │         │
└───────┼────────────┼─────────────────────┼────────────┼─────────┘
        │            │                     │            │
        ▼            ▼                     ▼            ▼
┌─────────────────────────────────────────────────────────────────┐
│                        n8n WORKFLOWS                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ ERP Sync     │  │ Geo Intel    │  │ News Collect │          │
│  │ (실시간)      │  │ (6시간)       │  │ (1시간)       │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                 │                 │                   │
└─────────┼─────────────────┼─────────────────┼───────────────────┘
          │                 │                 │
          ▼                 ▼                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                        SUPABASE                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Core Tables                           │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │   │
│  │  │ organisms│  │  users   │  │  tasks   │  │ solutions│ │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Intel Tables                          │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │   │
│  │  │competitors│  │cust_zones│  │ edu_news │  │ geo_intel│ │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────┐
│                     VERCEL EDGE API                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ /brain   │  │ /physics │  │ /execute │  │ /geo     │        │
│  │ (Claude) │  │ (V계산)   │  │ (액션)    │  │ (지도)   │        │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────┐
│                       FRONTEND                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Live Dashboard│  │Strategy Map  │  │Agent Dashboard│          │
│  │ (V 모니터링)   │  │ (전략 지도)   │  │ (액션 실행)   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📌 4. 데이터 수집 우선순위

### 🔴 P0 (필수 - 지금 당장)

| # | 데이터 | 소스 | 액션 |
|---|--------|------|------|
| 1 | **월 매출** | ERP 수동 입력 | Supabase organisms.mint |
| 2 | **월 비용** | 경비 수동 입력 | Supabase organisms.tax |
| 3 | **재등록률** | ERP 계산 | organisms.synergy |
| 4 | **미수금** | ERP | 알림 자동화 |

### 🟡 P1 (중요 - 1주 내)

| # | 데이터 | 소스 | 액션 |
|---|--------|------|------|
| 5 | 경쟁사 위치 | 네이버 API | geo_intel |
| 6 | 교육 뉴스 | 네이버 뉴스 API | edu_news |
| 7 | 출석 현황 | 출결 시스템 | 자동 알림 |

### 🟢 P2 (개선 - 1개월 내)

| # | 데이터 | 소스 | 액션 |
|---|--------|------|------|
| 8 | 학부모 만족도 | 설문 시스템 | NPS 추적 |
| 9 | 성적 데이터 | 성적 관리 | 성과 분석 |
| 10 | 상담 전환율 | CRM | 마케팅 최적화 |

---

## 📌 5. 실제 데이터 수집 워크플로우

### 워크플로우 1: ERP 동기화

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  학원나라    │ ──→ │    n8n      │ ──→ │  Supabase   │
│  API/Export │     │  Transform  │     │  organisms  │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ V 자동 계산  │
                    │ 상태 업데이트 │
                    └─────────────┘
```

### 워크플로우 2: 외부 인텔리전스

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 네이버 API   │ ──→ │    n8n      │ ──→ │  Supabase   │
│ 지도 + 뉴스  │     │  정제/분류   │     │ geo_intel   │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Claude 분석  │
                    │ 전략 제안    │
                    └─────────────┘
```

### 워크플로우 3: 액션 실행

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Claude 제안  │ ──→ │ User 승인   │ ──→ │    n8n      │
│ 보상 카드    │     │ Dashboard   │     │  Execute    │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                           ┌──────────────────┼──────────────────┐
                           ▼                  ▼                  ▼
                    ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
                    │   알리고    │   │   카카오    │   │    ERP     │
                    │    SMS     │   │   알림톡    │   │   업데이트  │
                    └─────────────┘   └─────────────┘   └─────────────┘
```

---

## 📌 6. 데이터 품질 규칙

### 필수 검증

1. **Mint (M)**: 0 이상, 숫자만
2. **Tax (T)**: 0 이상, M보다 작음 (정상 운영 시)
3. **Synergy (s)**: 0 ~ 1 범위 (0% ~ 100%)
4. **V 계산**: (M-T) × (1+s)^t 자동 계산

### 이상 탐지

```sql
-- 비정상 데이터 탐지
SELECT * FROM organisms
WHERE mint < tax  -- 적자 상태
   OR synergy < 0.1  -- 시너지 낮음
   OR entropy > 0.8;  -- 엔트로피 높음 (위험)
```

---

## 📌 7. 즉시 실행 체크리스트

- [ ] P0 데이터 수동 입력 (오늘)
  - [ ] organisms 테이블에 학원 데이터 입력
  - [ ] mint, tax 값 설정
  - [ ] synergy 초기값 설정

- [ ] 네이버 API 발급 (오늘)
  - [ ] https://developers.naver.com/apps
  - [ ] 지역 검색 API 신청
  - [ ] 뉴스 검색 API 신청

- [ ] n8n 워크플로우 활성화 (내일)
  - [ ] geo_intelligence.json Import
  - [ ] 환경변수 설정
  - [ ] 테스트 실행

---

*"데이터 없이 의견을 말하는 것은 추측일 뿐이다"*
