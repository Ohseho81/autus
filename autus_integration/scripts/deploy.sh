#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AUTUS ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

# ìƒ‰ìƒ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# ë””ë ‰í† ë¦¬
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BLUE}        AUTUS Integration Hub ë°°í¬ ì‹œì‘                         ${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í™˜ê²½ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_requirements() {
    echo -e "\n${YELLOW}[1/6] í™˜ê²½ í™•ì¸...${NC}"
    
    if ! command -v docker &> /dev/null; then
        echo -e "${RED}âŒ Dockerê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.${NC}"
        exit 1
    fi
    
    if ! command -v docker-compose &> /dev/null && ! docker compose version &> /dev/null; then
        echo -e "${RED}âŒ Docker Composeê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.${NC}"
        exit 1
    fi
    
    echo -e "${GREEN}âœ… Docker: $(docker --version)${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# .env íŒŒì¼ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_env() {
    echo -e "\n${YELLOW}[2/6] í™˜ê²½ ë³€ìˆ˜ í™•ì¸...${NC}"
    
    if [ ! -f "$ROOT_DIR/.env" ]; then
        if [ -f "$ROOT_DIR/env-template.txt" ]; then
            echo -e "${YELLOW}âš ï¸  .env íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í…œí”Œë¦¿ì—ì„œ ë³µì‚¬í•©ë‹ˆë‹¤.${NC}"
            cp "$ROOT_DIR/env-template.txt" "$ROOT_DIR/.env"
            echo -e "${YELLOW}âš ï¸  $ROOT_DIR/.env íŒŒì¼ì„ í¸ì§‘í•˜ì„¸ìš”!${NC}"
        else
            echo -e "${RED}âŒ .env íŒŒì¼ê³¼ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.${NC}"
            exit 1
        fi
    fi
    
    echo -e "${GREEN}âœ… .env íŒŒì¼ í™•ì¸ ì™„ë£Œ${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë„¤íŠ¸ì›Œí¬ ìƒì„±
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
create_network() {
    echo -e "\n${YELLOW}[3/6] Docker ë„¤íŠ¸ì›Œí¬ ìƒì„±...${NC}"
    
    if ! docker network inspect autus-network &> /dev/null; then
        docker network create autus-network
        echo -e "${GREEN}âœ… autus-network ìƒì„± ì™„ë£Œ${NC}"
    else
        echo -e "${GREEN}âœ… autus-network ì´ë¯¸ ì¡´ì¬${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
deploy_main() {
    echo -e "\n${YELLOW}[4/6] ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬...${NC}"
    
    cd "$ROOT_DIR"
    
    # ì´ì „ ì»¨í…Œì´ë„ˆ ì •ë¦¬
    docker compose down --remove-orphans 2>/dev/null || true
    
    # ë¹Œë“œ ë° ì‹¤í–‰
    docker compose build --no-cache
    docker compose up -d
    
    echo -e "${GREEN}âœ… ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬ ì™„ë£Œ${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ëª¨ë‹ˆí„°ë§ ë°°í¬ (ì„ íƒ)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
deploy_monitoring() {
    echo -e "\n${YELLOW}[5/6] ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ë°°í¬...${NC}"
    
    if [ -f "$ROOT_DIR/monitoring/docker-compose.monitoring.yml" ]; then
        cd "$ROOT_DIR/monitoring"
        docker compose -f docker-compose.monitoring.yml up -d
        echo -e "${GREEN}âœ… ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ë°°í¬ ì™„ë£Œ${NC}"
    else
        echo -e "${YELLOW}âš ï¸  ëª¨ë‹ˆí„°ë§ ì„¤ì • íŒŒì¼ ì—†ìŒ (ìŠ¤í‚µ)${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ìƒíƒœ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_status() {
    echo -e "\n${YELLOW}[6/6] ìƒíƒœ í™•ì¸...${NC}"
    
    echo -e "\n${BLUE}ğŸ³ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ:${NC}"
    docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
    
    echo -e "\n${BLUE}ğŸ”— ì ‘ì† URL:${NC}"
    echo -e "  ğŸ“¡ AUTUS API: ${GREEN}http://localhost:8000${NC}"
    echo -e "  ğŸ“¡ Swagger:   ${GREEN}http://localhost:8000/docs${NC}"
    echo -e "  ğŸ”„ n8n:       ${GREEN}http://localhost:5678${NC}"
    echo -e "  ğŸ”µ Neo4j:     ${GREEN}http://localhost:7474${NC}"
    
    if docker ps | grep -q prometheus; then
        echo -e "  ğŸ“Š Prometheus: ${GREEN}http://localhost:9090${NC}"
        echo -e "  ğŸ“ˆ Grafana:    ${GREEN}http://localhost:3001${NC} (admin/autus123)"
        echo -e "  â¬†ï¸  Uptime:     ${GREEN}http://localhost:3002${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í—¬ìŠ¤ì²´í¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
health_check() {
    echo -e "\n${YELLOW}ğŸ¥ í—¬ìŠ¤ì²´í¬ (30ì´ˆ ëŒ€ê¸°)...${NC}"
    
    sleep 10
    
    for i in {1..6}; do
        if curl -s http://localhost:8000/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… API ì„œë²„ ì •ìƒ ì‘ë™!${NC}"
            return 0
        fi
        echo -e "${YELLOW}â³ ëŒ€ê¸° ì¤‘... ($i/6)${NC}"
        sleep 5
    done
    
    echo -e "${RED}âŒ API ì„œë²„ ì‘ë‹µ ì—†ìŒ${NC}"
    return 1
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ ì‹¤í–‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
main() {
    check_requirements
    check_env
    create_network
    deploy_main
    
    # ëª¨ë‹ˆí„°ë§ ë°°í¬ (ì¸ìê°€ ìˆìœ¼ë©´)
    if [[ "$1" == "--with-monitoring" ]] || [[ "$1" == "-m" ]]; then
        deploy_monitoring
    fi
    
    check_status
    health_check
    
    echo -e "\n${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${GREEN}        ğŸš€ AUTUS Integration Hub ë°°í¬ ì™„ë£Œ!                     ${NC}"
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
}

# ì‹¤í–‰
main "$@"


#!/bin/bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AUTUS ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

# ìƒ‰ìƒ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# ë””ë ‰í† ë¦¬
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BLUE}        AUTUS Integration Hub ë°°í¬ ì‹œì‘                         ${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í™˜ê²½ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_requirements() {
    echo -e "\n${YELLOW}[1/6] í™˜ê²½ í™•ì¸...${NC}"
    
    if ! command -v docker &> /dev/null; then
        echo -e "${RED}âŒ Dockerê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.${NC}"
        exit 1
    fi
    
    if ! command -v docker-compose &> /dev/null && ! docker compose version &> /dev/null; then
        echo -e "${RED}âŒ Docker Composeê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.${NC}"
        exit 1
    fi
    
    echo -e "${GREEN}âœ… Docker: $(docker --version)${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# .env íŒŒì¼ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_env() {
    echo -e "\n${YELLOW}[2/6] í™˜ê²½ ë³€ìˆ˜ í™•ì¸...${NC}"
    
    if [ ! -f "$ROOT_DIR/.env" ]; then
        if [ -f "$ROOT_DIR/env-template.txt" ]; then
            echo -e "${YELLOW}âš ï¸  .env íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í…œí”Œë¦¿ì—ì„œ ë³µì‚¬í•©ë‹ˆë‹¤.${NC}"
            cp "$ROOT_DIR/env-template.txt" "$ROOT_DIR/.env"
            echo -e "${YELLOW}âš ï¸  $ROOT_DIR/.env íŒŒì¼ì„ í¸ì§‘í•˜ì„¸ìš”!${NC}"
        else
            echo -e "${RED}âŒ .env íŒŒì¼ê³¼ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.${NC}"
            exit 1
        fi
    fi
    
    echo -e "${GREEN}âœ… .env íŒŒì¼ í™•ì¸ ì™„ë£Œ${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë„¤íŠ¸ì›Œí¬ ìƒì„±
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
create_network() {
    echo -e "\n${YELLOW}[3/6] Docker ë„¤íŠ¸ì›Œí¬ ìƒì„±...${NC}"
    
    if ! docker network inspect autus-network &> /dev/null; then
        docker network create autus-network
        echo -e "${GREEN}âœ… autus-network ìƒì„± ì™„ë£Œ${NC}"
    else
        echo -e "${GREEN}âœ… autus-network ì´ë¯¸ ì¡´ì¬${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
deploy_main() {
    echo -e "\n${YELLOW}[4/6] ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬...${NC}"
    
    cd "$ROOT_DIR"
    
    # ì´ì „ ì»¨í…Œì´ë„ˆ ì •ë¦¬
    docker compose down --remove-orphans 2>/dev/null || true
    
    # ë¹Œë“œ ë° ì‹¤í–‰
    docker compose build --no-cache
    docker compose up -d
    
    echo -e "${GREEN}âœ… ë©”ì¸ ì„œë¹„ìŠ¤ ë°°í¬ ì™„ë£Œ${NC}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ëª¨ë‹ˆí„°ë§ ë°°í¬ (ì„ íƒ)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
deploy_monitoring() {
    echo -e "\n${YELLOW}[5/6] ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ë°°í¬...${NC}"
    
    if [ -f "$ROOT_DIR/monitoring/docker-compose.monitoring.yml" ]; then
        cd "$ROOT_DIR/monitoring"
        docker compose -f docker-compose.monitoring.yml up -d
        echo -e "${GREEN}âœ… ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ ë°°í¬ ì™„ë£Œ${NC}"
    else
        echo -e "${YELLOW}âš ï¸  ëª¨ë‹ˆí„°ë§ ì„¤ì • íŒŒì¼ ì—†ìŒ (ìŠ¤í‚µ)${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ìƒíƒœ í™•ì¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
check_status() {
    echo -e "\n${YELLOW}[6/6] ìƒíƒœ í™•ì¸...${NC}"
    
    echo -e "\n${BLUE}ğŸ³ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ:${NC}"
    docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
    
    echo -e "\n${BLUE}ğŸ”— ì ‘ì† URL:${NC}"
    echo -e "  ğŸ“¡ AUTUS API: ${GREEN}http://localhost:8000${NC}"
    echo -e "  ğŸ“¡ Swagger:   ${GREEN}http://localhost:8000/docs${NC}"
    echo -e "  ğŸ”„ n8n:       ${GREEN}http://localhost:5678${NC}"
    echo -e "  ğŸ”µ Neo4j:     ${GREEN}http://localhost:7474${NC}"
    
    if docker ps | grep -q prometheus; then
        echo -e "  ğŸ“Š Prometheus: ${GREEN}http://localhost:9090${NC}"
        echo -e "  ğŸ“ˆ Grafana:    ${GREEN}http://localhost:3001${NC} (admin/autus123)"
        echo -e "  â¬†ï¸  Uptime:     ${GREEN}http://localhost:3002${NC}"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í—¬ìŠ¤ì²´í¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
health_check() {
    echo -e "\n${YELLOW}ğŸ¥ í—¬ìŠ¤ì²´í¬ (30ì´ˆ ëŒ€ê¸°)...${NC}"
    
    sleep 10
    
    for i in {1..6}; do
        if curl -s http://localhost:8000/health > /dev/null 2>&1; then
            echo -e "${GREEN}âœ… API ì„œë²„ ì •ìƒ ì‘ë™!${NC}"
            return 0
        fi
        echo -e "${YELLOW}â³ ëŒ€ê¸° ì¤‘... ($i/6)${NC}"
        sleep 5
    done
    
    echo -e "${RED}âŒ API ì„œë²„ ì‘ë‹µ ì—†ìŒ${NC}"
    return 1
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ ì‹¤í–‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
main() {
    check_requirements
    check_env
    create_network
    deploy_main
    
    # ëª¨ë‹ˆí„°ë§ ë°°í¬ (ì¸ìê°€ ìˆìœ¼ë©´)
    if [[ "$1" == "--with-monitoring" ]] || [[ "$1" == "-m" ]]; then
        deploy_monitoring
    fi
    
    check_status
    health_check
    
    echo -e "\n${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${GREEN}        ğŸš€ AUTUS Integration Hub ë°°í¬ ì™„ë£Œ!                     ${NC}"
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
}

# ì‹¤í–‰
main "$@"







