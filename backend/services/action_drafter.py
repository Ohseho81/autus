#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()




















#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()










#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                           â•‘
â•‘                          AUTUS-PRIME: Action Drafter Service                              â•‘
â•‘                          Zero-Click ìë™í™” ì•¡ì…˜ ìƒì„±ê¸°                                     â•‘
â•‘                                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê¸°ëŠ¥:
- í•™ìƒ í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±
- ì¹´ì¹´ì˜¤í†¡/SMS/ì´ë©”ì¼ ë©”ì‹œì§€ í…œí”Œë¦¿
- Intent URI ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš©)
- ë°°ì¹˜ ì•¡ì…˜ ìŠ¤ì¼€ì¤„ë§

ë²•ì  ë©´ì±…:
- ë³¸ ì„œë¹„ìŠ¤ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆë§Œ ìƒì„±í•©ë‹ˆë‹¤
- ì‹¤ì œ ë°œì†¡ì€ ì‚¬ìš©ìê°€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
- ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
"""

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
from datetime import datetime, timedelta
import urllib.parse
import re


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì•¡ì…˜ íƒ€ì…
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionType(str, Enum):
    """ì•¡ì…˜ íƒ€ì…"""
    SMS = "sms"
    KAKAO = "kakao"
    CALL = "call"
    EMAIL = "email"


class ActionPriority(str, Enum):
    """ì•¡ì…˜ ìš°ì„ ìˆœìœ„"""
    URGENT = "urgent"       # ì¦‰ì‹œ ì‹¤í–‰
    HIGH = "high"           # ì˜¤ëŠ˜ ì¤‘
    NORMAL = "normal"       # ì´ë²ˆ ì£¼
    LOW = "low"             # ë‚˜ì¤‘ì—


class ActionCategory(str, Enum):
    """ì•¡ì…˜ ì¹´í…Œê³ ë¦¬"""
    PAYMENT = "payment"           # ìˆ˜ë‚© ê´€ë ¨
    ATTENDANCE = "attendance"     # ì¶œê²° ê´€ë ¨
    GRADE = "grade"               # ì„±ì  ê´€ë ¨
    RETENTION = "retention"       # ì´íƒˆ ë°©ì§€
    UPSELL = "upsell"             # ì¶”ê°€ ê³¼ëª©/ì—°ì¥
    THANK_YOU = "thank_you"       # ê°ì‚¬ ì¸ì‚¬
    CUSTOM = "custom"             # ì»¤ìŠ¤í…€


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë°ì´í„° ëª¨ë¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class ActionResult:
    """ì•¡ì…˜ ìƒì„± ê²°ê³¼"""
    action_id: str
    student_id: int
    student_name: str
    action_type: ActionType
    category: ActionCategory
    priority: ActionPriority
    
    # ë©”ì‹œì§€ ë‚´ìš©
    message: str
    subject: Optional[str] = None  # ì´ë©”ì¼ìš©
    
    # ì‹¤í–‰ ì •ë³´
    intent_uri: str = ""           # í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ìš© URI
    target_phone: Optional[str] = None
    target_email: Optional[str] = None
    
    # ë©”íƒ€ë°ì´í„°
    reason: str = ""               # ì•¡ì…˜ ìƒì„± ì´ìœ 
    expected_impact: str = ""      # ì˜ˆìƒ íš¨ê³¼
    created_at: datetime = field(default_factory=datetime.utcnow)
    scheduled_at: Optional[datetime] = None
    
    # ìƒíƒœ
    executed: bool = False
    executed_at: Optional[datetime] = None


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë©”ì‹œì§€ í…œí”Œë¦¿
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MessageTemplates:
    """í•™ì› íŠ¹í™” ë©”ì‹œì§€ í…œí”Œë¦¿"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ìˆ˜ë‚© ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    PAYMENT_REMINDER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì´ë²ˆ ë‹¬ ìˆ˜ê°•ë£Œ ë‚©ë¶€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“… ë‚©ë¶€ ê¸°í•œ: {due_date}
ğŸ’° ìˆ˜ê°•ë£Œ: {amount:,}ì›

â€» ìë™ì´ì²´ ë“±ë¡ ì‹œ 3% í• ì¸ í˜œíƒ!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_OVERDUE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ê°€ {days_overdue}ì¼ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ’° ë¯¸ë‚© ê¸ˆì•¡: {amount:,}ì›

ì›í™œí•œ ìˆ˜ì—… ì§„í–‰ì„ ìœ„í•´ ë‚©ë¶€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
ë¬¸ì˜ì‚¬í•­ ìˆìœ¼ì‹œë©´ ì—°ë½ ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    PAYMENT_THANKS = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìˆ˜ê°•ë£Œ ë‚©ë¶€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™

{student_name} í•™ìƒì˜ ì‹¤ë ¥ í–¥ìƒì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì„±ì  ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    GRADE_UP = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê¸°ìœ ì†Œì‹ ì „í•´ë“œë¦½ë‹ˆë‹¤! ğŸ‰

{student_name} í•™ìƒì˜ ì„±ì ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ˆ ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 
ğŸ“Š í–¥ìƒí­: +{improvement}ì 

ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ëŠ” {student_name} í•™ìƒì—ê²Œ ë§ì€ ê²©ë ¤ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_DOWN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ì„±ì  ë³€í™” ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ“Š ì´ì „: {prev_score}ì  â†’ í˜„ì¬: {curr_score}ì 

ì›ì¸ íŒŒì•…ê³¼ ë³´ì™„ ìˆ˜ì—… ê³„íšì„ ìœ„í•´ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
í•¨ê»˜ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    GRADE_REPORT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name} ì›”ê°„ ì„±ì  ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

ğŸ“Š {student_name} í•™ìƒ ì„±ì  í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ í˜„ì¬ ì ìˆ˜: {curr_score}ì 
â€¢ í•™ì› ë‚´ ìˆœìœ„: {rank}ë“±/{total}ëª…
â€¢ ì¶œì„ë¥ : {attendance}%
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{comment}

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì¶œê²° ê´€ë ¨
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    ATTENDANCE_ABSENT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜({date}) {student_name} í•™ìƒì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ì „ ì—°ë½ì´ ì—†ì–´ í™•ì¸ì°¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
í˜¹ì‹œ ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    ATTENDANCE_CHECKIN = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ í•™ì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. âœ…

ğŸ“ ë„ì°© ì‹œê°„: {time}

ì¢‹ì€ ìˆ˜ì—… ë˜ê² ìŠµë‹ˆë‹¤!"""

    ATTENDANCE_LOW = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ìµœê·¼ {student_name} í•™ìƒì˜ ì¶œì„ë¥ ì´ {attendance}%ì…ë‹ˆë‹¤.

ê¾¸ì¤€í•œ ì¶œì„ì´ ì„±ì  í–¥ìƒì˜ ê¸°ë³¸ì…ë‹ˆë‹¤.
í˜¹ì‹œ ì–´ë ¤ì›€ì´ ìˆìœ¼ì‹œë©´ ìƒë‹´ ìš”ì²­ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì´íƒˆ ë°©ì§€ / ì—…ì…€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    RETENTION_CARE = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
ê·¸ë™ì•ˆ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

{student_name} í•™ìƒì˜ í•™ìŠµ ìƒí™©ì— ëŒ€í•´ ìƒë‹´ ë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.
í¸í•˜ì‹  ì‹œê°„ì— ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    UPSELL_SUBJECT = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì´ {current_subject}ì—ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆì–´
{recommended_subject} ì¶”ê°€ ìˆ˜ê°•ì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.

ğŸ“š ì¶”ì²œ ê³¼ëª©: {recommended_subject}
ğŸ’° íŒ¨í‚¤ì§€ í• ì¸: 10% ì ìš©

ìì„¸í•œ ë‚´ìš©ì€ ìƒë‹´ ì˜ˆì•½ ë¶€íƒë“œë¦½ë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    RENEWAL_OFFER = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ë“±ë¡ ê¸°ê°„ì´ ê³§ ë§Œë£Œë©ë‹ˆë‹¤.

ğŸ ì—°ì¥ ë“±ë¡ íŠ¹ë³„ í˜œíƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ 3ê°œì›” ì—°ì¥: 5% í• ì¸
â€¢ 6ê°œì›” ì—°ì¥: 10% í• ì¸
â€¢ 12ê°œì›” ì—°ì¥: 15% í• ì¸ + êµì¬ ë¬´ë£Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{expiry_date}ê¹Œì§€ ë“±ë¡ ì‹œ ì ìš©ë©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤."""

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê¸°íƒ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    THANK_YOU = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
í•­ìƒ ì €í¬ í•™ì›ì„ ë¯¿ê³  ë§¡ê²¨ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ğŸ™

{student_name} í•™ìƒì˜ ì„±ì¥ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!"""

    BIRTHDAY = """ì•ˆë…•í•˜ì„¸ìš”, {student_name} í•™ë¶€ëª¨ë‹˜.

{academy_name}ì…ë‹ˆë‹¤.
{student_name} í•™ìƒì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‚ğŸ‰

íŠ¹ë³„í•œ í•˜ë£¨ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ê°ì‚¬í•©ë‹ˆë‹¤."""

    CUSTOM = """{message}"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¹´ì¹´ì˜¤í†¡ ë§í¬ ìƒì„±ê¸°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class KakaoLinkGenerator:
    """ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë§í¬ ìƒì„±"""
    
    @staticmethod
    def generate_text_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ê³µìœ  Intent URI ìƒì„±
        
        Android: intent://send?text=...#Intent;package=com.kakao.talk;end
        """
        encoded = urllib.parse.quote(message)
        return f"intent://send?text={encoded}#Intent;package=com.kakao.talk;end"
    
    @staticmethod
    def generate_web_share(message: str) -> str:
        """
        ì¹´ì¹´ì˜¤í†¡ ì›¹ ê³µìœ  (Kakao Link APIìš©)
        
        Note: ì‹¤ì œ ì‚¬ìš© ì‹œ Kakao Developersì—ì„œ ì•± ë“±ë¡ í•„ìš”
        """
        encoded = urllib.parse.quote(message)
        return f"https://sharer.kakao.com/talk/friends/picker/link?text={encoded}"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Action Drafter ë©”ì¸ í´ë˜ìŠ¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class ActionDrafter:
    """
    Zero-Click ìë™í™” ì•¡ì…˜ ì´ˆì•ˆ ìƒì„±ê¸°
    
    í´ëŸ¬ìŠ¤í„°/ìƒí™©ë³„ë¡œ ì ì ˆí•œ ì•¡ì…˜ ì´ˆì•ˆì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.
    ì‹¤ì œ ë°œì†¡ì€ í´ë¼ì´ì–¸íŠ¸ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Usage:
        drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
        actions = drafter.generate_actions_for_students(students)
    """
    
    def __init__(
        self,
        academy_name: str = "AUTUS í•™ì›",
        default_due_day: int = 10,  # ë§¤ì›” 10ì¼ ìˆ˜ë‚©ì¼
    ):
        self.academy_name = academy_name
        self.default_due_day = default_due_day
        self._action_counter = 0
    
    def _generate_action_id(self) -> str:
        """ì•¡ì…˜ ID ìƒì„±"""
        self._action_counter += 1
        return f"ACT-{datetime.now().strftime('%Y%m%d')}-{self._action_counter:04d}"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Intent URI ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_sms_uri(self, phone: str, message: str) -> str:
        """SMS Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        encoded_msg = urllib.parse.quote(message)
        return f"sms:{clean_phone}?body={encoded_msg}"
    
    def generate_call_uri(self, phone: str) -> str:
        """ì „í™” Intent URI ìƒì„±"""
        clean_phone = re.sub(r'[^0-9]', '', phone)
        return f"tel:{clean_phone}"
    
    def generate_email_uri(self, email: str, subject: str, body: str) -> str:
        """ì´ë©”ì¼ Intent URI ìƒì„±"""
        encoded_subject = urllib.parse.quote(subject)
        encoded_body = urllib.parse.quote(body)
        return f"mailto:{email}?subject={encoded_subject}&body={encoded_body}"
    
    def generate_kakao_uri(self, message: str) -> str:
        """ì¹´ì¹´ì˜¤í†¡ Intent URI ìƒì„±"""
        return KakaoLinkGenerator.generate_text_share(message)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def format_message(
        self,
        template: str,
        student_name: str,
        **kwargs
    ) -> str:
        """ë©”ì‹œì§€ í…œí”Œë¦¿ í¬ë§·íŒ…"""
        return template.format(
            academy_name=self.academy_name,
            student_name=student_name,
            **kwargs
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def create_payment_reminder(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        amount: int,
        due_date: str,
    ) -> ActionResult:
        """ìˆ˜ë‚© ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.PAYMENT_REMINDER,
            student_name=student_name,
            amount=amount,
            due_date=due_date,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.PAYMENT,
            priority=ActionPriority.HIGH,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason="ìˆ˜ë‚©ì¼ ë„ë˜",
            expected_impact="ì •ì‹œ ìˆ˜ë‚©ë¥  í–¥ìƒ",
        )
    
    def create_grade_notification(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        prev_score: float,
        curr_score: float,
    ) -> ActionResult:
        """ì„±ì  ì•Œë¦¼ ì•¡ì…˜ ìƒì„±"""
        improvement = curr_score - prev_score
        
        if improvement > 0:
            template = MessageTemplates.GRADE_UP
            priority = ActionPriority.NORMAL
            reason = "ì„±ì  í–¥ìƒ"
            impact = "í•™ë¶€ëª¨ ë§Œì¡±ë„ í–¥ìƒ"
        else:
            template = MessageTemplates.GRADE_DOWN
            priority = ActionPriority.HIGH
            reason = "ì„±ì  í•˜ë½"
            impact = "ì´íƒˆ ë°©ì§€"
        
        message = self.format_message(
            template,
            student_name=student_name,
            prev_score=prev_score,
            curr_score=curr_score,
            improvement=abs(improvement),
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.SMS,
            category=ActionCategory.GRADE,
            priority=priority,
            message=message,
            intent_uri=self.generate_sms_uri(phone, message),
            target_phone=phone,
            reason=reason,
            expected_impact=impact,
        )
    
    def create_retention_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        risk_reason: str,
    ) -> ActionResult:
        """ì´íƒˆ ë°©ì§€ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.RETENTION_CARE,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.CALL,
            category=ActionCategory.RETENTION,
            priority=ActionPriority.URGENT,
            message=message,
            intent_uri=self.generate_call_uri(phone),
            target_phone=phone,
            reason=f"ì´íƒˆ ìœ„í—˜: {risk_reason}",
            expected_impact="ì´íƒˆ ë°©ì§€, ì¬ë“±ë¡ë¥  í–¥ìƒ",
        )
    
    def create_upsell_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        current_subject: str,
        recommended_subject: str,
    ) -> ActionResult:
        """ì¶”ê°€ ê³¼ëª© ì œì•ˆ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.UPSELL_SUBJECT,
            student_name=student_name,
            current_subject=current_subject,
            recommended_subject=recommended_subject,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.UPSELL,
            priority=ActionPriority.NORMAL,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="ìš°ìˆ˜ í•™ìƒ ì¶”ê°€ ê³¼ëª© ì œì•ˆ",
            expected_impact="ê°ë‹¨ê°€ ìƒìŠ¹",
        )
    
    def create_thank_you_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
    ) -> ActionResult:
        """ê°ì‚¬ ì¸ì‚¬ ì•¡ì…˜ ìƒì„±"""
        message = self.format_message(
            MessageTemplates.THANK_YOU,
            student_name=student_name,
        )
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=ActionType.KAKAO,
            category=ActionCategory.THANK_YOU,
            priority=ActionPriority.LOW,
            message=message,
            intent_uri=self.generate_kakao_uri(message),
            target_phone=phone,
            reason="VIP ê³ ê° ê´€ë¦¬",
            expected_impact="ì¶©ì„±ë„ í–¥ìƒ",
        )
    
    def create_custom_action(
        self,
        student_id: int,
        student_name: str,
        phone: str,
        message: str,
        action_type: ActionType = ActionType.SMS,
    ) -> ActionResult:
        """ì»¤ìŠ¤í…€ ì•¡ì…˜ ìƒì„±"""
        formatted_message = self.format_message(
            MessageTemplates.CUSTOM,
            student_name=student_name,
            message=message,
        )
        
        if action_type == ActionType.SMS:
            intent_uri = self.generate_sms_uri(phone, formatted_message)
        elif action_type == ActionType.KAKAO:
            intent_uri = self.generate_kakao_uri(formatted_message)
        elif action_type == ActionType.CALL:
            intent_uri = self.generate_call_uri(phone)
        else:
            intent_uri = ""
        
        return ActionResult(
            action_id=self._generate_action_id(),
            student_id=student_id,
            student_name=student_name,
            action_type=action_type,
            category=ActionCategory.CUSTOM,
            priority=ActionPriority.NORMAL,
            message=formatted_message,
            intent_uri=intent_uri,
            target_phone=phone,
            reason="ì‚¬ìš©ì ì§€ì •",
            expected_impact="ì‚¬ìš©ì íŒë‹¨",
        )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë°°ì¹˜ ì•¡ì…˜ ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_actions_for_cluster(
        self,
        students: List[Dict],
        cluster: str,
    ) -> List[ActionResult]:
        """
        í´ëŸ¬ìŠ¤í„°ë³„ ìë™ ì•¡ì…˜ ìƒì„±
        
        Args:
            students: í•™ìƒ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
            cluster: í´ëŸ¬ìŠ¤í„° íƒ€ì… (golden_core, high_potential, etc.)
            
        Returns:
            List[ActionResult]: ìƒì„±ëœ ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸
        """
        actions = []
        
        for student in students:
            student_id = student.get("id", 0)
            student_name = student.get("name", "")
            phone = student.get("parent_phone") or student.get("phone", "")
            
            if not phone:
                continue
            
            if cluster == "golden_core":
                # VIP ê°ì‚¬ ì¸ì‚¬
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
                
                # ì¶”ê°€ ê³¼ëª© ì œì•ˆ (ê³¼ëª©ì´ 1ê°œì¸ ê²½ìš°)
                subjects = student.get("subjects", [])
                if len(subjects) == 1:
                    actions.append(self.create_upsell_action(
                        student_id, student_name, phone,
                        current_subject=subjects[0],
                        recommended_subject="ì˜ì–´" if subjects[0] == "ìˆ˜í•™" else "ìˆ˜í•™"
                    ))
            
            elif cluster == "high_potential":
                # ê²©ë ¤ ë©”ì‹œì§€
                actions.append(self.create_thank_you_action(
                    student_id, student_name, phone
                ))
            
            elif cluster == "friction_zone":
                # ì´íƒˆ ë°©ì§€ ì—°ë½
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ë§ˆì°° ì§€ëŒ€ í•™ìƒ"
                ))
            
            elif cluster == "entropy_sink":
                # ê¸´ê¸‰ ìƒë‹´ ìš”ì²­
                actions.append(self.create_retention_action(
                    student_id, student_name, phone,
                    risk_reason="ì—”íŠ¸ë¡œí”¼ í•™ìƒ - ì¦‰ê° ëŒ€ì‘ í•„ìš”"
                ))
        
        return actions
    
    def generate_batch_payment_reminders(
        self,
        students: List[Dict],
        due_date: str,
    ) -> List[ActionResult]:
        """ìˆ˜ë‚© ì•Œë¦¼ ì¼ê´„ ìƒì„±"""
        actions = []
        
        for student in students:
            phone = student.get("parent_phone") or student.get("phone", "")
            if not phone:
                continue
            
            actions.append(self.create_payment_reminder(
                student_id=student.get("id", 0),
                student_name=student.get("name", ""),
                phone=phone,
                amount=student.get("monthly_fee", 0),
                due_date=due_date,
            ))
        
        return actions


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë²•ì  ë©´ì±… ì¡°í•­
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGAL_DISCLAIMER = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            ë²•ì  ë©´ì±… ì¡°í•­                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ë³¸ ì‹œìŠ¤í…œì€ ë©”ì‹œì§€ "ì´ˆì•ˆ"ë§Œ ìƒì„±í•©ë‹ˆë‹¤.                                   â•‘
â•‘                                                                           â•‘
â•‘  ë™ì‘ ë°©ì‹:                                                                â•‘
â•‘  1. ì„œë²„ëŠ” ë©”ì‹œì§€ ì´ˆì•ˆê³¼ Intent URIë§Œ ìƒì„±í•©ë‹ˆë‹¤.                          â•‘
â•‘  2. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ Intent URIë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.                               â•‘
â•‘  3. ì‚¬ìš©ìê°€ í•´ë‹¹ ì•±ì—ì„œ 'ì „ì†¡'ì„ ì§ì ‘ ëˆŒëŸ¬ì•¼ ë©”ì‹œì§€ê°€ ë°œì†¡ë©ë‹ˆë‹¤.         â•‘
â•‘                                                                           â•‘
â•‘  ë”°ë¼ì„œ:                                                                   â•‘
â•‘  - ë©”ì‹œì§€ ë°œì†¡ì˜ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.                          â•‘
â•‘  - ë³¸ ì„œë¹„ìŠ¤ëŠ” 'í¸ì˜ ê¸°ëŠ¥'ì„ ì œê³µí•  ë¿ì…ë‹ˆë‹¤.                              â•‘
â•‘  - ìŠ¤íŒ¸ ë°©ì§€ë²•(ì •ë³´í†µì‹ ë§ë²• ì œ50ì¡°) ì¤€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ ì±…ì„ì…ë‹ˆë‹¤.            â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í…ŒìŠ¤íŠ¸ / ë°ëª¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def run_demo():
    """ë°ëª¨ ì‹¤í–‰"""
    print("=" * 70)
    print("  ğŸ“ AUTUS-PRIME Action Drafter Demo")
    print("=" * 70)
    
    drafter = ActionDrafter(academy_name="ìˆ˜í•™ì™• í•™ì›")
    
    # í…ŒìŠ¤íŠ¸ í•™ìƒ ë°ì´í„°
    test_students = [
        {"id": 1, "name": "ê¹€ì˜ì¬", "parent_phone": "010-1234-5678", "monthly_fee": 500000, "subjects": ["ìˆ˜í•™"]},
        {"id": 2, "name": "ì´ì„±ì‹¤", "parent_phone": "010-2345-6789", "monthly_fee": 350000, "subjects": ["ìˆ˜í•™", "ì˜ì–´"]},
        {"id": 3, "name": "ë°•í˜ë‚´", "parent_phone": "010-3456-7890", "monthly_fee": 300000, "subjects": ["ìˆ˜í•™"]},
    ]
    
    print("\n[1] ìˆ˜ë‚© ì•Œë¦¼ ìƒì„±...")
    payment_actions = drafter.generate_batch_payment_reminders(test_students, "2025ë…„ 1ì›” 10ì¼")
    
    for action in payment_actions[:2]:
        print(f"\n  ğŸ“± {action.student_name}")
        print(f"     ì¹´í…Œê³ ë¦¬: {action.category.value}")
        print(f"     ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°: {action.message[:50]}...")
        print(f"     Intent URI: {action.intent_uri[:50]}...")
    
    print("\n[2] í´ëŸ¬ìŠ¤í„°ë³„ ì•¡ì…˜ ìƒì„±...")
    cluster_actions = drafter.generate_actions_for_cluster(test_students, "golden_core")
    print(f"  âœ“ Golden Core ì•¡ì…˜: {len(cluster_actions)}ê±´ ìƒì„±")
    
    print("\n[3] ì„±ì  ì•Œë¦¼ ìƒì„±...")
    grade_action = drafter.create_grade_notification(
        student_id=1,
        student_name="ê¹€ì˜ì¬",
        phone="010-1234-5678",
        prev_score=85,
        curr_score=92
    )
    print(f"  âœ“ {grade_action.student_name}: {grade_action.reason}")
    
    print("\n" + LEGAL_DISCLAIMER)


if __name__ == "__main__":
    run_demo()

























