"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¼ AUTUS v3.0 - Orchestrator (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ì „ì²´ ë°ì´í„° íŒŒì´í”„ë¼ì¸:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   [ì¸¡ì •]        [ì •ê·œí™”]      [ì €ì¥]        [ë¬¼ë¦¬ì—”ì§„]    [ì¶œë ¥]            â”‚
â”‚                                                                             â”‚
â”‚   Banking  â”€â”€â”                                                              â”‚
â”‚   Wearable â”€â”€â”¼â”€â†’ Meter â”€â”€â†’ 0~1 â”€â”€â†’ Storage â”€â”€â†’ Physics â”€â”€â†’ Alert          â”‚
â”‚   Manual   â”€â”€â”˜                                  Engine                      â”‚
â”‚                                                                             â”‚
â”‚   ì‚¬ìš©ìë³€ìˆ˜: ë…¸ë“œì••ë ¥, P/M/Îµ/W                                             â”‚
â”‚   ìƒí˜¸ì‘ìš©ë³€ìˆ˜: ì—£ì§€ê°€ì¤‘ì¹˜, ì „íŒŒë¸íƒ€                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

from dataclasses import dataclass, field
from typing import Any, Dict, List, Optional, Tuple
from datetime import datetime

from .measurement import (
    MeasurementRegistry,
    NormalizedMeasurement,
    FinancialMeter,
    BiometricMeter,
    ManualMeter,
)
from .storage import (
    UnifiedStorage,
    CurrentState,
    UserVariableRecord,
    InteractionVariableRecord,
)
from .physics_engine import (
    PhysicsEngine,
    NodePhysics,
    EdgePhysics,
    CycleResult,
    CONSTANTS,
)
from .engine import (
    NODES,
    EDGES,
    Entity,
    Relation,
    TimeType,
    Work,
    decide_strategy,
    DecisionResult,
)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Œ íŒŒì´í”„ë¼ì¸ ì„¤ì •
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class PipelineConfig:
    """íŒŒì´í”„ë¼ì¸ ì„¤ì •"""
    storage_path: str = '~/.autus'
    auto_save: bool = True
    auto_entropy: bool = True
    alert_threshold: float = 0.5


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class AutusOrchestrator:
    """
    AUTUS ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
    
    ì „ì²´ íŒŒì´í”„ë¼ì¸ ì¡°ìœ¨:
    1. ì¸¡ì • (Measurement) - ì™¸ë¶€ ë°ì´í„° ìˆ˜ì§‘
    2. ì •ê·œí™” (Normalization) - 0~1ë¡œ ë³€í™˜
    3. ì €ì¥ (Storage) - ë¡œì»¬ ì €ì¥ì†Œì— ê¸°ë¡
    4. ë¬¼ë¦¬ ì—”ì§„ (Physics) - ë²•ì¹™ ì ìš©
    5. ì¶œë ¥ (Output) - ê²°ê³¼ ë° ê²½ê³ 
    """
    
    def __init__(self, config: Optional[PipelineConfig] = None):
        self.config = config or PipelineConfig()
        
        # ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”
        self.measurement = MeasurementRegistry()
        self.storage = UnifiedStorage(self.config.storage_path)
        self.physics = PhysicsEngine()
        
        # 36ë…¸ë“œ + 29ì—£ì§€ ì´ˆê¸°í™”
        self._initialize_structure()
        
        # ìƒíƒœ
        self.initialized = True
        self.cycle_count = 0
    
    def _initialize_structure(self):
        """36ë…¸ë“œ + 29ì—£ì§€ êµ¬ì¡° ì´ˆê¸°í™”"""
        # ë…¸ë“œ ì´ˆê¸°í™”
        for node_id, node_data in NODES.items():
            self.physics.initialize_node(
                node_id=node_id,
                pressure=node_data.pressure,
                mass=node_data.mass,
                entropy_rate=node_data.entropy_rate,
            )
        
        # ì—£ì§€ ì´ˆê¸°í™”
        for edge in EDGES:
            self.physics.add_edge(
                from_node=edge.from_node,
                to_node=edge.to_node,
                edge_type=edge.edge_type,
                weight=edge.weight,
                conductivity=edge.conductivity,
            )
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 1. ì¸¡ì • ë‹¨ê³„
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def measure(
        self,
        financial_data: Optional[Dict[str, Any]] = None,
        biometric_data: Optional[Dict[str, Any]] = None,
        manual_data: Optional[Dict[str, Any]] = None,
    ) -> List[NormalizedMeasurement]:
        """
        ì¸¡ì • ë‹¨ê³„
        
        ì…ë ¥:
        - financial_data: {'balance': 5000000, 'runway_months': 8}
        - biometric_data: {'sleep_hours': 6, 'stress_score': 60}
        - manual_data: {'stress_level': 7}
        
        ì¶œë ¥:
        - ì •ê·œí™”ëœ ì¸¡ì •ê°’ ë¦¬ìŠ¤íŠ¸
        """
        data = {}
        if financial_data:
            data['financial'] = financial_data
        if biometric_data:
            data['biometric'] = biometric_data
        if manual_data:
            data['manual'] = manual_data
        
        return self.measurement.measure_all(data)
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 2. ì••ë ¥ ì—…ë°ì´íŠ¸ ë‹¨ê³„
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def update_pressures(
        self,
        measurements: List[NormalizedMeasurement]
    ) -> Dict[str, float]:
        """
        ì¸¡ì •ê°’ìœ¼ë¡œ ë…¸ë“œ ì••ë ¥ ì—…ë°ì´íŠ¸
        """
        pressures = self.measurement.get_node_pressures(measurements)
        
        for node_id, pressure in pressures.items():
            if node_id in self.physics.nodes:
                self.physics.nodes[node_id].pressure = pressure
        
        return pressures
    
    def set_pressure(self, node_id: str, pressure: float) -> None:
        """ë‹¨ì¼ ë…¸ë“œ ì••ë ¥ ì§ì ‘ ì„¤ì •"""
        if node_id in self.physics.nodes:
            self.physics.nodes[node_id].pressure = max(0, min(1, pressure))
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 3. ë¬¼ë¦¬ ì‚¬ì´í´ ë‹¨ê³„
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def run_physics_cycle(self) -> CycleResult:
        """
        ë¬¼ë¦¬ ì‚¬ì´í´ ì‹¤í–‰
        
        ì ìš©ë˜ëŠ” ë²•ì¹™:
        1. ì—”íŠ¸ë¡œí”¼ ì¦ê°€
        2. ì••ë ¥ ì „íŒŒ (4ê°€ì§€ ì—£ì§€)
        3. ê´€ì„±
        """
        self.cycle_count += 1
        return self.physics.run_cycle()
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 4. ì €ì¥ ë‹¨ê³„
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def save_variables(self) -> Tuple[UserVariableRecord, InteractionVariableRecord]:
        """
        ë³€ìˆ˜ ì €ì¥
        
        ì €ì¥ë˜ëŠ” ê²ƒ:
        - ì‚¬ìš©ì ë³€ìˆ˜: ë…¸ë“œ ì••ë ¥
        - ìƒí˜¸ì‘ìš© ë³€ìˆ˜: ì—£ì§€ ê°€ì¤‘ì¹˜, ì „íŒŒ ë¸íƒ€
        """
        # ì‚¬ìš©ì ë³€ìˆ˜
        user_var = self.storage.record_user_variable(
            node_pressures=self.physics.get_node_pressures()
        )
        
        # ìƒí˜¸ì‘ìš© ë³€ìˆ˜
        last_cycle = self.physics.history[-1] if self.physics.history else None
        propagation_deltas = {}
        if last_cycle:
            for p in last_cycle.propagations:
                propagation_deltas[p.node_id] = p.delta
        
        interaction_var = self.storage.record_interaction_variable(
            edge_weights={
                f'{e.from_node}â†’{e.to_node}': e.weight 
                for e in self.physics.edges
            },
            propagation_deltas=propagation_deltas,
            edge_activations=self.physics.get_edge_activations(),
        )
        
        return user_var, interaction_var
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 5. ê²½ê³  ë‹¨ê³„
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def get_top_alert(self) -> Optional[Dict]:
        """
        Top-1 ê²½ê³  (ê°€ì¥ ë†’ì€ ì••ë ¥ ë…¸ë“œ)
        """
        pressures = self.physics.get_node_pressures()
        
        if not pressures:
            return None
        
        top_node = max(pressures.items(), key=lambda x: x[1])
        node_id, pressure = top_node
        
        if pressure < self.config.alert_threshold:
            return None
        
        node_data = NODES.get(node_id)
        name_ko = node_data.name_ko if node_data else node_id
        
        state = 'CRITICAL' if pressure >= 0.9 else \
                'IRREVERSIBLE' if pressure >= 0.78 else \
                'PRESSURING' if pressure >= 0.5 else 'MONITORING'
        
        return {
            'node_id': node_id,
            'name_ko': name_ko,
            'pressure': pressure,
            'state': state,
            'message': f'âš ï¸ {name_ko} {state} ({pressure*100:.0f}%)',
        }
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # í†µí•© ì‹¤í–‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def run_full_cycle(
        self,
        financial_data: Optional[Dict] = None,
        biometric_data: Optional[Dict] = None,
        manual_data: Optional[Dict] = None,
    ) -> Dict:
        """
        ì „ì²´ ì‚¬ì´í´ ì‹¤í–‰
        
        1. ì¸¡ì • â†’ 2. ì••ë ¥ ì—…ë°ì´íŠ¸ â†’ 3. ë¬¼ë¦¬ ì‚¬ì´í´ â†’ 4. ì €ì¥ â†’ 5. ê²½ê³ 
        """
        # 1. ì¸¡ì •
        measurements = self.measure(financial_data, biometric_data, manual_data)
        
        # 2. ì••ë ¥ ì—…ë°ì´íŠ¸
        if measurements:
            self.update_pressures(measurements)
        
        # 3. ë¬¼ë¦¬ ì‚¬ì´í´
        cycle_result = self.run_physics_cycle()
        
        # 4. ì €ì¥
        user_var, interaction_var = self.save_variables()
        
        # 5. ê²½ê³ 
        alert = self.get_top_alert()
        
        return {
            'cycle': self.cycle_count,
            'measurements': len(measurements),
            'entropy_added': cycle_result.total_entropy_added,
            'propagation': cycle_result.total_propagation,
            'energy_before': cycle_result.energy_before,
            'energy_after': cycle_result.energy_after,
            'alert': alert,
            'node_pressures': self.physics.get_node_pressures(),
        }
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë¦¬í¬íŠ¸
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    def generate_report(self) -> str:
        """ì „ì²´ ë¦¬í¬íŠ¸ ìƒì„±"""
        pressures = self.physics.get_node_pressures()
        
        # ê³„ì¸µë³„ í‰ê· 
        layers = {'FINANCIAL': [], 'BIOMETRIC': [], 'OPERATIONAL': [], 'CUSTOMER': [], 'EXTERNAL': []}
        for node_id, pressure in pressures.items():
            node_data = NODES.get(node_id)
            if node_data:
                layers[node_data.layer].append(pressure)
        
        layer_avg = {l: sum(ps)/len(ps) if ps else 0 for l, ps in layers.items()}
        
        # ìƒíƒœ ì¹´ìš´íŠ¸
        stable = sum(1 for p in pressures.values() if p < 0.3)
        monitoring = sum(1 for p in pressures.values() if 0.3 <= p < 0.5)
        pressuring = sum(1 for p in pressures.values() if 0.5 <= p < 0.78)
        danger = sum(1 for p in pressures.values() if p >= 0.78)
        
        alert = self.get_top_alert()
        
        def bar(v: float) -> str:
            w = 20
            f = int(v * w)
            return 'â–ˆ' * f + 'â–‘' * (w - f)
        
        report = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ¯ AUTUS v3.0 - Pipeline Report                                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ì‚¬ì´í´: {self.cycle_count:>5}                                                              â•‘
â•‘ 36ë…¸ë“œ: ì•ˆì • {stable:>2} | ê´€ì°° {monitoring:>2} | ì••ë ¥ {pressuring:>2} | ìœ„í—˜ {danger:>2}                            â•‘
â• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•£
â•‘ ê³„ì¸µë³„ ì••ë ¥                                                                   â•‘
â•‘   FINANCIAL   [{bar(layer_avg['FINANCIAL'])}] {layer_avg['FINANCIAL']*100:>3.0f}%                      â•‘
â•‘   BIOMETRIC   [{bar(layer_avg['BIOMETRIC'])}] {layer_avg['BIOMETRIC']*100:>3.0f}%                      â•‘
â•‘   OPERATIONAL [{bar(layer_avg['OPERATIONAL'])}] {layer_avg['OPERATIONAL']*100:>3.0f}%                      â•‘
â•‘   CUSTOMER    [{bar(layer_avg['CUSTOMER'])}] {layer_avg['CUSTOMER']*100:>3.0f}%                      â•‘
â•‘   EXTERNAL    [{bar(layer_avg['EXTERNAL'])}] {layer_avg['EXTERNAL']*100:>3.0f}%                      â•‘"""
        
        if alert:
            report += f"""
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âš ï¸  TOP-1: {alert['message']:<62} â•‘"""
        
        report += """
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ "ë¬´ìŠ¨ ì¡´ì¬ê°€ ë ì§€ëŠ” ë‹¹ì‹ ì´ ì •í•œë‹¤. ê·¸ ì¡´ì¬ë¥¼ ìœ ì§€í•˜ëŠ” ì¼ì€ ìš°ë¦¬ê°€ í•œë‹¤."        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"""
        
        return report


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Œ ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def print_data_flow():
    """ë°ì´í„° íë¦„ ì¶œë ¥"""
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“Š AUTUS ë°ì´í„° íŒŒì´í”„ë¼ì¸                                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                          1. ì¸¡ì • (Measurement)                         â”‚ â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   [Banking API] â”€â”€â†’ balance, cashflow â”€â”€â†’ FinancialMeter              â”‚ â•‘
â•‘   â”‚   [Wearable]    â”€â”€â†’ sleep, hrv, stress â”€â”€â†’ BiometricMeter             â”‚ â•‘
â•‘   â”‚   [User Input]  â”€â”€â†’ 1~10 scale â”€â”€â†’ ManualMeter                        â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                    â”‚                                          â•‘
â•‘                                    â–¼                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                         2. ì •ê·œí™” (Normalization)                       â”‚ â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ì›ì‹œê°’ â”€â”€â†’ ì„ê³„ê°’/ê³„ë‹¨/ì‹œê·¸ëª¨ì´ë“œ ë³€í™˜ â”€â”€â†’ ì••ë ¥ (0~1)                â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ì˜ˆ: balance 5,000,000ì› â”€â”€â†’ inverse_threshold â”€â”€â†’ P=0.5              â”‚ â•‘
â•‘   â”‚   ì˜ˆ: sleep 6ì‹œê°„ â”€â”€â†’ steps â”€â”€â†’ P=0.7                                  â”‚ â•‘
â•‘   â”‚   ì˜ˆ: stress_level 7/10 â”€â”€â†’ scale_10 â”€â”€â†’ P=0.67                        â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                    â”‚                                          â•‘
â•‘                                    â–¼                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                          3. ì €ì¥ (Storage)                              â”‚ â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ~/.autus/                                                             â”‚ â•‘
â•‘   â”‚   â”œâ”€â”€ variables/user/YYYY-MM-DD.json      # ì‚¬ìš©ì ë³€ìˆ˜ (ì‹œê³„ì—´)       â”‚ â•‘
â•‘   â”‚   â”‚   â””â”€â”€ {timestamp, node_pressures: {n01: 0.8, ...}}                 â”‚ â•‘
â•‘   â”‚   â””â”€â”€ variables/interaction/YYYY-MM-DD.json  # ìƒí˜¸ì‘ìš© ë³€ìˆ˜          â”‚ â•‘
â•‘   â”‚       â””â”€â”€ {timestamp, edge_weights, propagation_deltas}                â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                    â”‚                                          â•‘
â•‘                                    â–¼                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                       4. ë¬¼ë¦¬ ì—”ì§„ (Physics)                            â”‚ â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ë²•ì¹™ 1: ì—”íŠ¸ë¡œí”¼ ì¦ê°€                                                 â”‚ â•‘
â•‘   â”‚           Î”P_entropy = Îµ Ã— (1 + P Ã— 0.5)                               â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ë²•ì¹™ 2: ì••ë ¥ ì „íŒŒ (4ê°€ì§€ ì—£ì§€)                                        â”‚ â•‘
â•‘   â”‚           DEPENDENCY: Î”P = +k Ã— w Ã— (Pj - Pi)                          â”‚ â•‘
â•‘   â”‚           BUFFER:     Î”P = -min(P, cap) Ã— k Ã— w                        â”‚ â•‘
â•‘   â”‚           SUBSTITUTION: Î”P = -ratio Ã— (1-Pj) Ã— Pi Ã— w                  â”‚ â•‘
â•‘   â”‚           AMPLIFY:    Î”P = +k Ã— w Ã— Pi Ã— Pj Ã— f                        â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   ë²•ì¹™ 3: ê´€ì„±                                                          â”‚ â•‘
â•‘   â”‚           a = Î”P / m (ì§ˆëŸ‰ì´ í¬ë©´ ë³€í™” ì €í•­)                            â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                    â”‚                                          â•‘
â•‘                                    â–¼                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘   â”‚                          5. ì¶œë ¥ (Output)                               â”‚ â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â”‚   â€¢ 36ë…¸ë“œ ì••ë ¥ ìƒíƒœ                                                    â”‚ â•‘
â•‘   â”‚   â€¢ Top-1 ê²½ê³  (P â‰¥ 0.5ì¸ ê²½ìš°ë§Œ)                                      â”‚ â•‘
â•‘   â”‚   â€¢ ë‚˜ë¨¸ì§€ 35ë…¸ë“œëŠ” ì¹¨ë¬µ                                                â”‚ â•‘
â•‘   â”‚                                                                         â”‚ â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
""")
