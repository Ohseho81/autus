{
  "name": "AUTUS Passive God Mode - V-Index Auto Report",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {"triggerAtHour": 0, "triggerAtMinute": 0},
            {"triggerAtHour": 12, "triggerAtMinute": 0},
            {"triggerAtHour": 18, "triggerAtMinute": 0}
          ]
        }
      },
      "id": "cron-trigger",
      "name": "íŒ¨ì‹œë¸Œ ìŠ¤ì¼€ì¤„ (00:00, 12:00, 18:00)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "={{ $env.AUTUS_API_URL }}/api/v/consolidate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth"
      },
      "id": "get-v-data",
      "name": "V-Index í†µí•© ë°ì´í„° ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.data.urgent_count }}",
              "rightValue": 0,
              "operator": {"type": "number", "operation": "gt"}
            }
          ]
        }
      },
      "id": "check-urgent",
      "name": "ê¸´ê¸‰ ìƒí™© ì²´í¬",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json.data;\nconst now = new Date();\nconst timeSlot = now.getHours() === 0 ? 'ìì •' : now.getHours() === 12 ? 'ì •ì˜¤' : 'ì €ë…';\n\nlet msg = 'ğŸ›ï¸ *AUTUS V-Index ' + timeSlot + ' ë¦¬í¬íŠ¸*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n';\nmsg += 'ğŸ“ˆ *ì „ì²´ í˜„í™©*\\n';\nmsg += 'â€¢ ì´ V-Index: ' + (data.global?.total_v || 0).toLocaleString() + '\\n';\nmsg += 'â€¢ ì¡°ì§ ìˆ˜: ' + (data.global?.total_orgs || 0) + 'ê°œ\\n';\nmsg += 'â€¢ ê´€ë¦¬ ëŒ€ìƒ: ' + (data.global?.total_entities || 0) + 'ëª…\\n\\n';\n\nif (data.urgent_count > 0) msg += 'ğŸš¨ ê¸´ê¸‰: ' + data.urgent_count + 'ê±´\\n';\nif (data.warning_count > 0) msg += 'âš¡ ê²½ê³ : ' + data.warning_count + 'ê±´\\n';\n\nmsg += '\\nğŸ¤– _íŒ¨ì‹œë¸Œ ì‹  ëª¨ë“œ ìë™ ìƒì„±_';\n\nreturn { telegramMessage: msg };"
      },
      "id": "generate-report",
      "name": "ë¦¬í¬íŠ¸ ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 200]
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_OWNER_CHAT_ID }}",
        "text": "={{ $json.telegramMessage }}",
        "additionalFields": {"parse_mode": "Markdown"}
      },
      "id": "send-telegram",
      "name": "í…”ë ˆê·¸ë¨ ì „ì†¡",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1050, 200]
    },
    {
      "parameters": {
        "url": "={{ $env.AUTUS_API_URL }}/api/v/recalculate",
        "method": "POST"
      },
      "id": "recalculate-v",
      "name": "V-Index ì¬ê³„ì‚°",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "url": "={{ $env.AUTUS_API_URL }}/api/churn/detect",
        "method": "POST"
      },
      "id": "detect-churn",
      "name": "ì´íƒˆ ìœ„í—˜ ê°ì§€",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 300]
    }
  ],
  "connections": {
    "íŒ¨ì‹œë¸Œ ìŠ¤ì¼€ì¤„ (00:00, 12:00, 18:00)": {"main": [[{"node": "V-Index í†µí•© ë°ì´í„° ì¡°íšŒ", "type": "main", "index": 0}]]},
    "V-Index í†µí•© ë°ì´í„° ì¡°íšŒ": {"main": [[{"node": "ê¸´ê¸‰ ìƒí™© ì²´í¬", "type": "main", "index": 0}]]},
    "ê¸´ê¸‰ ìƒí™© ì²´í¬": {"main": [[{"node": "ë¦¬í¬íŠ¸ ìƒì„±", "type": "main", "index": 0}], [{"node": "ë¦¬í¬íŠ¸ ìƒì„±", "type": "main", "index": 0}]]},
    "ë¦¬í¬íŠ¸ ìƒì„±": {"main": [[{"node": "í…”ë ˆê·¸ë¨ ì „ì†¡", "type": "main", "index": 0}]]},
    "í…”ë ˆê·¸ë¨ ì „ì†¡": {"main": [[{"node": "V-Index ì¬ê³„ì‚°", "type": "main", "index": 0}]]},
    "V-Index ì¬ê³„ì‚°": {"main": [[{"node": "ì´íƒˆ ìœ„í—˜ ê°ì§€", "type": "main", "index": 0}]]}
  },
  "settings": {"executionOrder": "v1"},
  "meta": {"instanceId": "autus-kraton"},
  "tags": [{"name": "passive"}, {"name": "v-index"}, {"name": "auto-report"}]
}
