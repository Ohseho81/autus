# ì˜¨ë¦¬ìŒ¤ ì•± â†’ Profiles í…Œì´ë¸” ì—°ë™ ê°€ì´ë“œ

**ë¬¸ì œ**: í˜„ì¬ EntityListScreenì´ `students` í…Œì´ë¸”ì„ ì‚¬ìš© ì¤‘ì´ì§€ë§Œ, ì‹¤ì œ 780ëª… ë°ì´í„°ëŠ” `profiles` í…Œì´ë¸”ì— ìˆìŒ

**í•´ê²°**: ì•„ë˜ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ë©´ ì¦‰ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ê²° ê°€ëŠ¥

---

## ğŸ”§ EntityListScreen.tsx ìˆ˜ì •

### 1ë‹¨ê³„: í…Œì´ë¸” ë³€ê²½ (students â†’ profiles)

**íŒŒì¼**: `/sessions/modest-bold-einstein/mnt/autus/ì˜¨ë¦¬ìŒ¤/src/screens/v2/EntityListScreen.tsx`

**Line 86**: í…Œì´ë¸” ì´ë¦„ ë³€ê²½
```typescript
// ë³€ê²½ ì „
.from('students')

// ë³€ê²½ í›„
.from('profiles')
```

### 2ë‹¨ê³„: í•„ë“œ ë§¤í•‘ ìˆ˜ì •

**Line 87-96**: Select ì¿¼ë¦¬ ìˆ˜ì •
```typescript
// ë³€ê²½ í›„
.select(`
  id,
  name,
  phone,
  metadata,
  status,
  created_at
`)
.eq('type', 'student')  // í•™ìƒë§Œ í•„í„°ë§ (ì¤‘ìš”!)
.eq('status', 'active')
.order('name', { ascending: true })
```

### 3ë‹¨ê³„: ë°ì´í„° ë§¤í•‘ ìˆ˜ì •

**Line 108-117**: ë°ì´í„° ë³€í™˜ ë¡œì§ ìˆ˜ì •
```typescript
// ë³€ê²½ í›„
const formatted: Entity[] = data.map((profile: any) => ({
  id: profile.id,
  name: profile.name || 'ì´ë¦„ ì—†ìŒ',
  contact: profile.phone || '-',
  vIndex: 50,  // V-IndexëŠ” ì•„ì§ êµ¬í˜„ ì „, ê¸°ë³¸ê°’ ì‚¬ìš©
  status: 'safe',  // risk_level ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’
  lastSession: undefined,
  nextSession: undefined,
  unpaidAmount: undefined,
}));
```

**ì°¸ê³ **: `metadata.classes` ë°°ì—´ì— ìˆ˜ê°• í´ë˜ìŠ¤ ì •ë³´ê°€ ìˆìŒ
```typescript
// í´ë˜ìŠ¤ ì •ë³´ í‘œì‹œ ì˜ˆì‹œ
const classes = profile.metadata?.classes || [];
// classes = ["ì„ ìˆ˜ë°˜", "ì‹¤ì „ë°˜", "ê°œì¸ë ˆìŠ¨"]
```

---

## ğŸ“Š ì‹¤ì œ ë°ì´í„° êµ¬ì¡° (profiles í…Œì´ë¸”)

```json
{
  "id": "uuid",
  "type": "student",
  "name": "ì˜¤ì€ìš°",
  "phone": "010-2048-6048",
  "status": "active",
  "metadata": {
    "classes": ["ì„ ìˆ˜ë°˜", "ì‹¤ì „ë°˜"],
    "needs_shuttle": false
  },
  "created_at": "2026-02-14T...",
  "updated_at": "2026-02-14T..."
}
```

### ì£¼ìš” í•„ë“œ
- `type`: "student", "parent", "coach" (í•„í„°ë§ í•„ìˆ˜)
- `name`: í•™ìƒ ì´ë¦„
- `phone`: ì „í™”ë²ˆí˜¸
- `metadata.classes`: ìˆ˜ê°• í´ë˜ìŠ¤ ë°°ì—´
- `status`: "active", "inactive"

### ì—†ëŠ” í•„ë“œ (ë‚˜ì¤‘ì— ì¶”ê°€ ì˜ˆì •)
- `v_index`: V-Index ì ìˆ˜
- `risk_level`: ìœ„í—˜ë„
- `parent_phone`: í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ (ë³„ë„ parent í”„ë¡œí•„ ì—°ê²° í•„ìš”)
- `tier`: ë“±ê¸‰
- `last_session`: ë§ˆì§€ë§‰ ìˆ˜ì—… (bookings í…Œì´ë¸” ì¡°ì¸ í•„ìš”)
- `unpaid_amount`: ë¯¸ë‚©ê¸ˆ (payments í…Œì´ë¸” ì¡°ì¸ í•„ìš”)

---

## ğŸš€ ë¹ ë¥¸ ì ìš© ë°©ë²•

### Option A: ìµœì†Œ ë³€ê²½ (ì¦‰ì‹œ ì‘ë™)

```typescript
// Line 85-100 ì „ì²´ êµì²´
const { data, error } = await supabase
  .from('profiles')
  .select('id, name, phone, metadata, status, created_at')
  .eq('type', 'student')
  .eq('status', 'active')
  .order('name')
  .range(offset, offset + PAGE_SIZE - 1);

// Line 108-117 ì „ì²´ êµì²´
const formatted: Entity[] = data.map((profile: any) => ({
  id: profile.id,
  name: profile.name || 'ì´ë¦„ ì—†ìŒ',
  contact: profile.phone || '-',
  vIndex: 50,
  status: 'safe',
  lastSession: undefined,
  nextSession: undefined,
  unpaidAmount: undefined,
}));
```

**ê²°ê³¼**: 780ëª… í•™ìƒì´ ì¦‰ì‹œ í‘œì‹œë¨

### Option B: í´ë˜ìŠ¤ ì •ë³´ í‘œì‹œ ì¶”ê°€

EntityCardì— í´ë˜ìŠ¤ ë°°ì§€ ì¶”ê°€:

```typescript
// Line 246-263 ì‚¬ì´ì— ì¶”ê°€
{profile.metadata?.classes && profile.metadata.classes.length > 0 && (
  <View style={styles.classesRow}>
    {profile.metadata.classes.map((className: string, idx: number) => (
      <View key={idx} style={styles.classBadge}>
        <Text style={styles.classText}>{className}</Text>
      </View>
    ))}
  </View>
)}

// ìŠ¤íƒ€ì¼ ì¶”ê°€ (Line 525 ì´í›„)
classesRow: {
  flexDirection: 'row',
  flexWrap: 'wrap',
  gap: spacing[2],
  marginTop: spacing[2],
},
classBadge: {
  backgroundColor: colors.primary + '20',
  paddingHorizontal: spacing[2],
  paddingVertical: spacing[1],
  borderRadius: borderRadius.sm,
},
classText: {
  fontSize: typography.fontSize.xs,
  color: colors.primary,
  fontWeight: '500',
},
```

---

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. ë°ì´í„° ë¡œë”© í™•ì¸
- [ ] ì•± ì‹¤í–‰ ì‹œ 780ëª… í•™ìƒ ëª©ë¡ í‘œì‹œ
- [ ] ìŠ¤í¬ë¡¤ ì‹œ í˜ì´ì§€ë„¤ì´ì…˜ ì‘ë™
- [ ] Pull-to-refresh ì‘ë™

### 2. ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
- [ ] ì´ë¦„ ê²€ìƒ‰ (ì˜ˆ: "ì˜¤ì€ìš°")
- [ ] ì „í™”ë²ˆí˜¸ ê²€ìƒ‰ (ì˜ˆ: "010-2048")
- [ ] ê²€ìƒ‰ ê²°ê³¼ ì •í™•ë„

### 3. í•„í„° í…ŒìŠ¤íŠ¸
- [ ] "ì „ì²´" í•„í„°: 780ëª… í‘œì‹œ
- [ ] "ì •ìƒ/ì£¼ì˜/ìœ„í—˜" í•„í„° (í˜„ì¬ëŠ” ëª¨ë‘ "ì •ìƒ"ìœ¼ë¡œ í‘œì‹œë¨)

### 4. ìƒì„¸ í™”ë©´ ì´ë™
- [ ] í•™ìƒ ì¹´ë“œ í„°ì¹˜ ì‹œ EntityDetailScreenìœ¼ë¡œ ì´ë™
- [ ] IDê°€ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë¨

---

## ğŸ”® ë‹¤ìŒ ë‹¨ê³„ (Phase 2)

### 1. V-Index ì‹¤ì‹œê°„ ê³„ì‚°
```typescript
// universal_profilesì™€ ì¡°ì¸í•´ì„œ V-Index ê°€ì ¸ì˜¤ê¸°
.select(`
  id,
  name,
  phone,
  metadata,
  status,
  universal_profiles!inner(v_index)
`)
```

### 2. í•™ë¶€ëª¨ ì •ë³´ ì—°ê²°
```typescript
// parent_idë¡œ ì¡°ì¸
.select(`
  *,
  parent:profiles!parent_id(name, phone)
`)
```

### 3. ì¶œì„ ì •ë³´ í‘œì‹œ
```typescript
// bookings í…Œì´ë¸” ì¡°ì¸
.select(`
  *,
  recent_bookings:bookings(
    attended_at,
    status
  )
`)
.order('bookings.attended_at', { ascending: false })
.limit(1, { foreignTable: 'bookings' })
```

### 4. ë¯¸ë‚©ê¸ˆ í‘œì‹œ
```typescript
// payments í…Œì´ë¸” ì¡°ì¸
.select(`
  *,
  payments(
    payment_status,
    amount
  )
`)
.eq('payments.payment_status', 'pending')
```

---

## ğŸ“ ì£¼ì˜ì‚¬í•­

1. **type í•„í„° í•„ìˆ˜**: `profiles` í…Œì´ë¸”ì—ëŠ” í•™ìƒ, í•™ë¶€ëª¨, ì½”ì¹˜ê°€ ëª¨ë‘ ìˆìœ¼ë¯€ë¡œ `.eq('type', 'student')` í•„ìˆ˜

2. **Universal ID**: ì¼ë¶€ í•™ìƒì€ `universal_id`ê°€ ì—°ê²°ë˜ì–´ ìˆìŒ (727ëª…/780ëª…)

3. **metadata êµ¬ì¡°**: JSON í•„ë“œì´ë¯€ë¡œ íƒ€ì… ì•ˆì „ì„± ì£¼ì˜
   ```typescript
   interface ProfileMetadata {
     classes?: string[];
     needs_shuttle?: boolean;
     [key: string]: any;
   }
   ```

4. **ì„±ëŠ¥ ìµœì í™”**: 780ëª…ì€ ë§ì§€ ì•Šì§€ë§Œ, 1000ëª… ì´ìƒ ì‹œ í˜ì´ì§€ë„¤ì´ì…˜ í•„ìˆ˜

---

**ì‘ì„±**: 2026-02-14
**ì ìš© ì‹œê°„**: ~5ë¶„
**í…ŒìŠ¤íŠ¸ í•„ìš”**: ì˜ˆ
